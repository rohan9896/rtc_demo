function yy(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var _e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function js(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mp={exports:{}},_a={},Op={exports:{}},we={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gs=Symbol.for("react.element"),Sy=Symbol.for("react.portal"),ky=Symbol.for("react.fragment"),Ty=Symbol.for("react.strict_mode"),by=Symbol.for("react.profiler"),Cy=Symbol.for("react.provider"),Ey=Symbol.for("react.context"),wy=Symbol.for("react.forward_ref"),Py=Symbol.for("react.suspense"),Ry=Symbol.for("react.memo"),Ay=Symbol.for("react.lazy"),Dd=Symbol.iterator;function _y(e){return e===null||typeof e!="object"?null:(e=Dd&&e[Dd]||e["@@iterator"],typeof e=="function"?e:null)}var xp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Np=Object.assign,Up={};function Fn(e,t,i){this.props=e,this.context=t,this.refs=Up,this.updater=i||xp}Fn.prototype.isReactComponent={};Fn.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Fn.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Fp(){}Fp.prototype=Fn.prototype;function ic(e,t,i){this.props=e,this.context=t,this.refs=Up,this.updater=i||xp}var rc=ic.prototype=new Fp;rc.constructor=ic;Np(rc,Fn.prototype);rc.isPureReactComponent=!0;var Md=Array.isArray,$p=Object.prototype.hasOwnProperty,nc={current:null},Bp={key:!0,ref:!0,__self:!0,__source:!0};function jp(e,t,i){var r,n={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)$p.call(t,r)&&!Bp.hasOwnProperty(r)&&(n[r]=t[r]);var a=arguments.length-2;if(a===1)n.children=i;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];n.children=l}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)n[r]===void 0&&(n[r]=a[r]);return{$$typeof:Gs,type:e,key:s,ref:o,props:n,_owner:nc.current}}function Iy(e,t){return{$$typeof:Gs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function sc(e){return typeof e=="object"&&e!==null&&e.$$typeof===Gs}function Ly(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var Od=/\/+/g;function il(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ly(""+e.key):t.toString(36)}function Ao(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Gs:case Sy:o=!0}}if(o)return o=e,n=n(o),e=r===""?"."+il(o,0):r,Md(n)?(i="",e!=null&&(i=e.replace(Od,"$&/")+"/"),Ao(n,t,i,"",function(u){return u})):n!=null&&(sc(n)&&(n=Iy(n,i+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Od,"$&/")+"/")+e)),t.push(n)),1;if(o=0,r=r===""?".":r+":",Md(e))for(var a=0;a<e.length;a++){s=e[a];var l=r+il(s,a);o+=Ao(s,t,i,l,n)}else if(l=_y(e),typeof l=="function")for(e=l.call(e),a=0;!(s=e.next()).done;)s=s.value,l=r+il(s,a++),o+=Ao(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function so(e,t,i){if(e==null)return e;var r=[],n=0;return Ao(e,r,"","",function(s){return t.call(i,s,n++)}),r}function Dy(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Dt={current:null},_o={transition:null},My={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:_o,ReactCurrentOwner:nc};we.Children={map:so,forEach:function(e,t,i){so(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return so(e,function(){t++}),t},toArray:function(e){return so(e,function(t){return t})||[]},only:function(e){if(!sc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};we.Component=Fn;we.Fragment=ky;we.Profiler=by;we.PureComponent=ic;we.StrictMode=Ty;we.Suspense=Py;we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=My;we.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Np({},e.props),n=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=nc.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)$p.call(t,l)&&!Bp.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Gs,type:e.type,key:n,ref:s,props:r,_owner:o}};we.createContext=function(e){return e={$$typeof:Ey,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Cy,_context:e},e.Consumer=e};we.createElement=jp;we.createFactory=function(e){var t=jp.bind(null,e);return t.type=e,t};we.createRef=function(){return{current:null}};we.forwardRef=function(e){return{$$typeof:wy,render:e}};we.isValidElement=sc;we.lazy=function(e){return{$$typeof:Ay,_payload:{_status:-1,_result:e},_init:Dy}};we.memo=function(e,t){return{$$typeof:Ry,type:e,compare:t===void 0?null:t}};we.startTransition=function(e){var t=_o.transition;_o.transition={};try{e()}finally{_o.transition=t}};we.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};we.useCallback=function(e,t){return Dt.current.useCallback(e,t)};we.useContext=function(e){return Dt.current.useContext(e)};we.useDebugValue=function(){};we.useDeferredValue=function(e){return Dt.current.useDeferredValue(e)};we.useEffect=function(e,t){return Dt.current.useEffect(e,t)};we.useId=function(){return Dt.current.useId()};we.useImperativeHandle=function(e,t,i){return Dt.current.useImperativeHandle(e,t,i)};we.useInsertionEffect=function(e,t){return Dt.current.useInsertionEffect(e,t)};we.useLayoutEffect=function(e,t){return Dt.current.useLayoutEffect(e,t)};we.useMemo=function(e,t){return Dt.current.useMemo(e,t)};we.useReducer=function(e,t,i){return Dt.current.useReducer(e,t,i)};we.useRef=function(e){return Dt.current.useRef(e)};we.useState=function(e){return Dt.current.useState(e)};we.useSyncExternalStore=function(e,t,i){return Dt.current.useSyncExternalStore(e,t,i)};we.useTransition=function(){return Dt.current.useTransition()};we.version="18.2.0";Op.exports=we;var Re=Op.exports;const Ul=js(Re);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oy=Re,xy=Symbol.for("react.element"),Ny=Symbol.for("react.fragment"),Uy=Object.prototype.hasOwnProperty,Fy=Oy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$y={key:!0,ref:!0,__self:!0,__source:!0};function Gp(e,t,i){var r,n={},s=null,o=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)Uy.call(t,r)&&!$y.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:xy,type:e,key:s,ref:o,props:n,_owner:Fy.current}}_a.Fragment=Ny;_a.jsx=Gp;_a.jsxs=Gp;Mp.exports=_a;var rt=Mp.exports,Fl={},zp={exports:{}},Jt={},Vp={exports:{}},Wp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(g,b){var v=g.length;g.push(b);e:for(;0<v;){var d=v-1>>>1,m=g[d];if(0<n(m,b))g[d]=b,g[v]=m,v=d;else break e}}function i(g){return g.length===0?null:g[0]}function r(g){if(g.length===0)return null;var b=g[0],v=g.pop();if(v!==b){g[0]=v;e:for(var d=0,m=g.length,C=m>>>1;d<C;){var _=2*(d+1)-1,P=g[_],L=_+1,w=g[L];if(0>n(P,v))L<m&&0>n(w,P)?(g[d]=w,g[L]=v,d=L):(g[d]=P,g[_]=v,d=_);else if(L<m&&0>n(w,v))g[d]=w,g[L]=v,d=L;else break e}}return b}function n(g,b){var v=g.sortIndex-b.sortIndex;return v!==0?v:g.id-b.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,p=3,S=!1,k=!1,E=!1,O=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(g){for(var b=i(u);b!==null;){if(b.callback===null)r(u);else if(b.startTime<=g)r(u),b.sortIndex=b.expirationTime,t(l,b);else break;b=i(u)}}function M(g){if(E=!1,A(g),!k)if(i(l)!==null)k=!0,At(W);else{var b=i(u);b!==null&&ut(M,b.startTime-g)}}function W(g,b){k=!1,E&&(E=!1,I(ee),ee=-1),S=!0;var v=p;try{for(A(b),h=i(l);h!==null&&(!(h.expirationTime>b)||g&&!Oe());){var d=h.callback;if(typeof d=="function"){h.callback=null,p=h.priorityLevel;var m=d(h.expirationTime<=b);b=e.unstable_now(),typeof m=="function"?h.callback=m:h===i(l)&&r(l),A(b)}else r(l);h=i(l)}if(h!==null)var C=!0;else{var _=i(u);_!==null&&ut(M,_.startTime-b),C=!1}return C}finally{h=null,p=v,S=!1}}var Z=!1,X=null,ee=-1,ce=5,pe=-1;function Oe(){return!(e.unstable_now()-pe<ce)}function Ve(){if(X!==null){var g=e.unstable_now();pe=g;var b=!0;try{b=X(!0,g)}finally{b?We():(Z=!1,X=null)}}else Z=!1}var We;if(typeof R=="function")We=function(){R(Ve)};else if(typeof MessageChannel<"u"){var He=new MessageChannel,ve=He.port2;He.port1.onmessage=Ve,We=function(){ve.postMessage(null)}}else We=function(){O(Ve,0)};function At(g){X=g,Z||(Z=!0,We())}function ut(g,b){ee=O(function(){g(e.unstable_now())},b)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){k||S||(k=!0,At(W))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ce=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(g){switch(p){case 1:case 2:case 3:var b=3;break;default:b=p}var v=p;p=b;try{return g()}finally{p=v}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,b){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var v=p;p=g;try{return b()}finally{p=v}},e.unstable_scheduleCallback=function(g,b,v){var d=e.unstable_now();switch(typeof v=="object"&&v!==null?(v=v.delay,v=typeof v=="number"&&0<v?d+v:d):v=d,g){case 1:var m=-1;break;case 2:m=250;break;case 5:m=1073741823;break;case 4:m=1e4;break;default:m=5e3}return m=v+m,g={id:c++,callback:b,priorityLevel:g,startTime:v,expirationTime:m,sortIndex:-1},v>d?(g.sortIndex=v,t(u,g),i(l)===null&&g===i(u)&&(E?(I(ee),ee=-1):E=!0,ut(M,v-d))):(g.sortIndex=m,t(l,g),k||S||(k=!0,At(W))),g},e.unstable_shouldYield=Oe,e.unstable_wrapCallback=function(g){var b=p;return function(){var v=p;p=b;try{return g.apply(this,arguments)}finally{p=v}}}})(Wp);Vp.exports=Wp;var By=Vp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hp=Re,Ht=By;function J(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qp=new Set,ks={};function qr(e,t){Rn(e,t),Rn(e+"Capture",t)}function Rn(e,t){for(ks[e]=t,e=0;e<t.length;e++)qp.add(t[e])}var zi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$l=Object.prototype.hasOwnProperty,jy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xd={},Nd={};function Gy(e){return $l.call(Nd,e)?!0:$l.call(xd,e)?!1:jy.test(e)?Nd[e]=!0:(xd[e]=!0,!1)}function zy(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Vy(e,t,i,r){if(t===null||typeof t>"u"||zy(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Mt(e,t,i,r,n,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var St={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){St[e]=new Mt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];St[t]=new Mt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){St[e]=new Mt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){St[e]=new Mt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){St[e]=new Mt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){St[e]=new Mt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){St[e]=new Mt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){St[e]=new Mt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){St[e]=new Mt(e,5,!1,e.toLowerCase(),null,!1,!1)});var oc=/[\-:]([a-z])/g;function ac(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(oc,ac);St[t]=new Mt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(oc,ac);St[t]=new Mt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(oc,ac);St[t]=new Mt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){St[e]=new Mt(e,1,!1,e.toLowerCase(),null,!1,!1)});St.xlinkHref=new Mt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){St[e]=new Mt(e,1,!1,e.toLowerCase(),null,!0,!0)});function lc(e,t,i,r){var n=St.hasOwnProperty(t)?St[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Vy(t,i,n,r)&&(i=null),r||n===null?Gy(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var Ji=Hp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oo=Symbol.for("react.element"),tn=Symbol.for("react.portal"),rn=Symbol.for("react.fragment"),uc=Symbol.for("react.strict_mode"),Bl=Symbol.for("react.profiler"),Kp=Symbol.for("react.provider"),Jp=Symbol.for("react.context"),cc=Symbol.for("react.forward_ref"),jl=Symbol.for("react.suspense"),Gl=Symbol.for("react.suspense_list"),dc=Symbol.for("react.memo"),rr=Symbol.for("react.lazy"),Qp=Symbol.for("react.offscreen"),Ud=Symbol.iterator;function Kn(e){return e===null||typeof e!="object"?null:(e=Ud&&e[Ud]||e["@@iterator"],typeof e=="function"?e:null)}var ze=Object.assign,rl;function os(e){if(rl===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);rl=t&&t[1]||""}return`
`+rl+e}var nl=!1;function sl(e,t){if(!e||nl)return"";nl=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var n=u.stack.split(`
`),s=r.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=a);break}}}finally{nl=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?os(e):""}function Wy(e){switch(e.tag){case 5:return os(e.type);case 16:return os("Lazy");case 13:return os("Suspense");case 19:return os("SuspenseList");case 0:case 2:case 15:return e=sl(e.type,!1),e;case 11:return e=sl(e.type.render,!1),e;case 1:return e=sl(e.type,!0),e;default:return""}}function zl(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case rn:return"Fragment";case tn:return"Portal";case Bl:return"Profiler";case uc:return"StrictMode";case jl:return"Suspense";case Gl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Jp:return(e.displayName||"Context")+".Consumer";case Kp:return(e._context.displayName||"Context")+".Provider";case cc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case dc:return t=e.displayName||null,t!==null?t:zl(e.type)||"Memo";case rr:t=e._payload,e=e._init;try{return zl(e(t))}catch{}}return null}function Hy(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zl(t);case 8:return t===uc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function gr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Yp(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function qy(e){var t=Yp(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ao(e){e._valueTracker||(e._valueTracker=qy(e))}function Xp(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=Yp(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function Jo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Vl(e,t){var i=t.checked;return ze({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function Fd(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=gr(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Zp(e,t){t=t.checked,t!=null&&lc(e,"checked",t,!1)}function Wl(e,t){Zp(e,t);var i=gr(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Hl(e,t.type,i):t.hasOwnProperty("defaultValue")&&Hl(e,t.type,gr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function $d(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function Hl(e,t,i){(t!=="number"||Jo(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var as=Array.isArray;function vn(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+gr(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function ql(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return ze({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Bd(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(J(92));if(as(i)){if(1<i.length)throw Error(J(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:gr(i)}}function ef(e,t){var i=gr(t.value),r=gr(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function jd(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function tf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kl(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?tf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var lo,rf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(lo=lo||document.createElement("div"),lo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=lo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ts(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var ds={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ky=["Webkit","ms","Moz","O"];Object.keys(ds).forEach(function(e){Ky.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ds[t]=ds[e]})});function nf(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||ds.hasOwnProperty(e)&&ds[e]?(""+t).trim():t+"px"}function sf(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=nf(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var Jy=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jl(e,t){if(t){if(Jy[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function Ql(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yl=null;function hc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Xl=null,mn=null,gn=null;function Gd(e){if(e=Ws(e)){if(typeof Xl!="function")throw Error(J(280));var t=e.stateNode;t&&(t=Oa(t),Xl(e.stateNode,e.type,t))}}function of(e){mn?gn?gn.push(e):gn=[e]:mn=e}function af(){if(mn){var e=mn,t=gn;if(gn=mn=null,Gd(e),t)for(e=0;e<t.length;e++)Gd(t[e])}}function lf(e,t){return e(t)}function uf(){}var ol=!1;function cf(e,t,i){if(ol)return e(t,i);ol=!0;try{return lf(e,t,i)}finally{ol=!1,(mn!==null||gn!==null)&&(uf(),af())}}function bs(e,t){var i=e.stateNode;if(i===null)return null;var r=Oa(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(J(231,t,typeof i));return i}var Zl=!1;if(zi)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){Zl=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{Zl=!1}function Qy(e,t,i,r,n,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(i,u)}catch(c){this.onError(c)}}var hs=!1,Qo=null,Yo=!1,eu=null,Yy={onError:function(e){hs=!0,Qo=e}};function Xy(e,t,i,r,n,s,o,a,l){hs=!1,Qo=null,Qy.apply(Yy,arguments)}function Zy(e,t,i,r,n,s,o,a,l){if(Xy.apply(this,arguments),hs){if(hs){var u=Qo;hs=!1,Qo=null}else throw Error(J(198));Yo||(Yo=!0,eu=u)}}function Kr(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function df(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function zd(e){if(Kr(e)!==e)throw Error(J(188))}function eS(e){var t=e.alternate;if(!t){if(t=Kr(e),t===null)throw Error(J(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return zd(n),e;if(s===r)return zd(n),t;s=s.sibling}throw Error(J(188))}if(i.return!==r.return)i=n,r=s;else{for(var o=!1,a=n.child;a;){if(a===i){o=!0,i=n,r=s;break}if(a===r){o=!0,r=n,i=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===i){o=!0,i=s,r=n;break}if(a===r){o=!0,r=s,i=n;break}a=a.sibling}if(!o)throw Error(J(189))}}if(i.alternate!==r)throw Error(J(190))}if(i.tag!==3)throw Error(J(188));return i.stateNode.current===i?e:t}function hf(e){return e=eS(e),e!==null?pf(e):null}function pf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=pf(e);if(t!==null)return t;e=e.sibling}return null}var ff=Ht.unstable_scheduleCallback,Vd=Ht.unstable_cancelCallback,tS=Ht.unstable_shouldYield,iS=Ht.unstable_requestPaint,Ye=Ht.unstable_now,rS=Ht.unstable_getCurrentPriorityLevel,pc=Ht.unstable_ImmediatePriority,vf=Ht.unstable_UserBlockingPriority,Xo=Ht.unstable_NormalPriority,nS=Ht.unstable_LowPriority,mf=Ht.unstable_IdlePriority,Ia=null,Ri=null;function sS(e){if(Ri&&typeof Ri.onCommitFiberRoot=="function")try{Ri.onCommitFiberRoot(Ia,e,void 0,(e.current.flags&128)===128)}catch{}}var yi=Math.clz32?Math.clz32:lS,oS=Math.log,aS=Math.LN2;function lS(e){return e>>>=0,e===0?32:31-(oS(e)/aS|0)|0}var uo=64,co=4194304;function ls(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Zo(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,o=i&268435455;if(o!==0){var a=o&~n;a!==0?r=ls(a):(s&=o,s!==0&&(r=ls(s)))}else o=i&~n,o!==0?r=ls(o):s!==0&&(r=ls(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-yi(t),n=1<<i,r|=e[i],t&=~n;return r}function uS(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cS(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-yi(s),a=1<<o,l=n[o];l===-1?(!(a&i)||a&r)&&(n[o]=uS(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}function tu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gf(){var e=uo;return uo<<=1,!(uo&4194240)&&(uo=64),e}function al(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function zs(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-yi(t),e[t]=i}function dS(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-yi(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function fc(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-yi(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var Ie=0;function yf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Sf,vc,kf,Tf,bf,iu=!1,ho=[],ur=null,cr=null,dr=null,Cs=new Map,Es=new Map,sr=[],hS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wd(e,t){switch(e){case"focusin":case"focusout":ur=null;break;case"dragenter":case"dragleave":cr=null;break;case"mouseover":case"mouseout":dr=null;break;case"pointerover":case"pointerout":Cs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Es.delete(t.pointerId)}}function Qn(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=Ws(t),t!==null&&vc(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function pS(e,t,i,r,n){switch(t){case"focusin":return ur=Qn(ur,e,t,i,r,n),!0;case"dragenter":return cr=Qn(cr,e,t,i,r,n),!0;case"mouseover":return dr=Qn(dr,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return Cs.set(s,Qn(Cs.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,Es.set(s,Qn(Es.get(s)||null,e,t,i,r,n)),!0}return!1}function Cf(e){var t=xr(e.target);if(t!==null){var i=Kr(t);if(i!==null){if(t=i.tag,t===13){if(t=df(i),t!==null){e.blockedOn=t,bf(e.priority,function(){kf(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Io(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=ru(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);Yl=r,i.target.dispatchEvent(r),Yl=null}else return t=Ws(i),t!==null&&vc(t),e.blockedOn=i,!1;t.shift()}return!0}function Hd(e,t,i){Io(e)&&i.delete(t)}function fS(){iu=!1,ur!==null&&Io(ur)&&(ur=null),cr!==null&&Io(cr)&&(cr=null),dr!==null&&Io(dr)&&(dr=null),Cs.forEach(Hd),Es.forEach(Hd)}function Yn(e,t){e.blockedOn===t&&(e.blockedOn=null,iu||(iu=!0,Ht.unstable_scheduleCallback(Ht.unstable_NormalPriority,fS)))}function ws(e){function t(n){return Yn(n,e)}if(0<ho.length){Yn(ho[0],e);for(var i=1;i<ho.length;i++){var r=ho[i];r.blockedOn===e&&(r.blockedOn=null)}}for(ur!==null&&Yn(ur,e),cr!==null&&Yn(cr,e),dr!==null&&Yn(dr,e),Cs.forEach(t),Es.forEach(t),i=0;i<sr.length;i++)r=sr[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<sr.length&&(i=sr[0],i.blockedOn===null);)Cf(i),i.blockedOn===null&&sr.shift()}var yn=Ji.ReactCurrentBatchConfig,ea=!0;function vS(e,t,i,r){var n=Ie,s=yn.transition;yn.transition=null;try{Ie=1,mc(e,t,i,r)}finally{Ie=n,yn.transition=s}}function mS(e,t,i,r){var n=Ie,s=yn.transition;yn.transition=null;try{Ie=4,mc(e,t,i,r)}finally{Ie=n,yn.transition=s}}function mc(e,t,i,r){if(ea){var n=ru(e,t,i,r);if(n===null)gl(e,t,r,ta,i),Wd(e,r);else if(pS(n,e,t,i,r))r.stopPropagation();else if(Wd(e,r),t&4&&-1<hS.indexOf(e)){for(;n!==null;){var s=Ws(n);if(s!==null&&Sf(s),s=ru(e,t,i,r),s===null&&gl(e,t,r,ta,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else gl(e,t,r,null,i)}}var ta=null;function ru(e,t,i,r){if(ta=null,e=hc(r),e=xr(e),e!==null)if(t=Kr(e),t===null)e=null;else if(i=t.tag,i===13){if(e=df(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ta=e,null}function Ef(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rS()){case pc:return 1;case vf:return 4;case Xo:case nS:return 16;case mf:return 536870912;default:return 16}default:return 16}}var ar=null,gc=null,Lo=null;function wf(){if(Lo)return Lo;var e,t=gc,i=t.length,r,n="value"in ar?ar.value:ar.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var o=i-e;for(r=1;r<=o&&t[i-r]===n[s-r];r++);return Lo=n.slice(e,1<r?1-r:void 0)}function Do(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function po(){return!0}function qd(){return!1}function Qt(e){function t(i,r,n,s,o){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(i=e[a],this[a]=i?i(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?po:qd,this.isPropagationStopped=qd,this}return ze(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=po)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=po)},persist:function(){},isPersistent:po}),t}var $n={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yc=Qt($n),Vs=ze({},$n,{view:0,detail:0}),gS=Qt(Vs),ll,ul,Xn,La=ze({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xn&&(Xn&&e.type==="mousemove"?(ll=e.screenX-Xn.screenX,ul=e.screenY-Xn.screenY):ul=ll=0,Xn=e),ll)},movementY:function(e){return"movementY"in e?e.movementY:ul}}),Kd=Qt(La),yS=ze({},La,{dataTransfer:0}),SS=Qt(yS),kS=ze({},Vs,{relatedTarget:0}),cl=Qt(kS),TS=ze({},$n,{animationName:0,elapsedTime:0,pseudoElement:0}),bS=Qt(TS),CS=ze({},$n,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ES=Qt(CS),wS=ze({},$n,{data:0}),Jd=Qt(wS),PS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _S(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=AS[e])?!!t[e]:!1}function Sc(){return _S}var IS=ze({},Vs,{key:function(e){if(e.key){var t=PS[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Do(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?RS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sc,charCode:function(e){return e.type==="keypress"?Do(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Do(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),LS=Qt(IS),DS=ze({},La,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qd=Qt(DS),MS=ze({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sc}),OS=Qt(MS),xS=ze({},$n,{propertyName:0,elapsedTime:0,pseudoElement:0}),NS=Qt(xS),US=ze({},La,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),FS=Qt(US),$S=[9,13,27,32],kc=zi&&"CompositionEvent"in window,ps=null;zi&&"documentMode"in document&&(ps=document.documentMode);var BS=zi&&"TextEvent"in window&&!ps,Pf=zi&&(!kc||ps&&8<ps&&11>=ps),Yd=" ",Xd=!1;function Rf(e,t){switch(e){case"keyup":return $S.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Af(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var nn=!1;function jS(e,t){switch(e){case"compositionend":return Af(t);case"keypress":return t.which!==32?null:(Xd=!0,Yd);case"textInput":return e=t.data,e===Yd&&Xd?null:e;default:return null}}function GS(e,t){if(nn)return e==="compositionend"||!kc&&Rf(e,t)?(e=wf(),Lo=gc=ar=null,nn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pf&&t.locale!=="ko"?null:t.data;default:return null}}var zS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!zS[e.type]:t==="textarea"}function _f(e,t,i,r){of(r),t=ia(t,"onChange"),0<t.length&&(i=new yc("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var fs=null,Ps=null;function VS(e){Bf(e,0)}function Da(e){var t=an(e);if(Xp(t))return e}function WS(e,t){if(e==="change")return t}var If=!1;if(zi){var dl;if(zi){var hl="oninput"in document;if(!hl){var eh=document.createElement("div");eh.setAttribute("oninput","return;"),hl=typeof eh.oninput=="function"}dl=hl}else dl=!1;If=dl&&(!document.documentMode||9<document.documentMode)}function th(){fs&&(fs.detachEvent("onpropertychange",Lf),Ps=fs=null)}function Lf(e){if(e.propertyName==="value"&&Da(Ps)){var t=[];_f(t,Ps,e,hc(e)),cf(VS,t)}}function HS(e,t,i){e==="focusin"?(th(),fs=t,Ps=i,fs.attachEvent("onpropertychange",Lf)):e==="focusout"&&th()}function qS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Da(Ps)}function KS(e,t){if(e==="click")return Da(t)}function JS(e,t){if(e==="input"||e==="change")return Da(t)}function QS(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ki=typeof Object.is=="function"?Object.is:QS;function Rs(e,t){if(ki(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!$l.call(t,n)||!ki(e[n],t[n]))return!1}return!0}function ih(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function rh(e,t){var i=ih(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ih(i)}}function Df(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Df(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Mf(){for(var e=window,t=Jo();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Jo(e.document)}return t}function Tc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function YS(e){var t=Mf(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&Df(i.ownerDocument.documentElement,i)){if(r!==null&&Tc(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=rh(i,s);var o=rh(i,r);n&&o&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var XS=zi&&"documentMode"in document&&11>=document.documentMode,sn=null,nu=null,vs=null,su=!1;function nh(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;su||sn==null||sn!==Jo(r)||(r=sn,"selectionStart"in r&&Tc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),vs&&Rs(vs,r)||(vs=r,r=ia(nu,"onSelect"),0<r.length&&(t=new yc("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=sn)))}function fo(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var on={animationend:fo("Animation","AnimationEnd"),animationiteration:fo("Animation","AnimationIteration"),animationstart:fo("Animation","AnimationStart"),transitionend:fo("Transition","TransitionEnd")},pl={},Of={};zi&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete on.animationend.animation,delete on.animationiteration.animation,delete on.animationstart.animation),"TransitionEvent"in window||delete on.transitionend.transition);function Ma(e){if(pl[e])return pl[e];if(!on[e])return e;var t=on[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Of)return pl[e]=t[i];return e}var xf=Ma("animationend"),Nf=Ma("animationiteration"),Uf=Ma("animationstart"),Ff=Ma("transitionend"),$f=new Map,sh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){$f.set(e,t),qr(t,[e])}for(var fl=0;fl<sh.length;fl++){var vl=sh[fl],ZS=vl.toLowerCase(),ek=vl[0].toUpperCase()+vl.slice(1);kr(ZS,"on"+ek)}kr(xf,"onAnimationEnd");kr(Nf,"onAnimationIteration");kr(Uf,"onAnimationStart");kr("dblclick","onDoubleClick");kr("focusin","onFocus");kr("focusout","onBlur");kr(Ff,"onTransitionEnd");Rn("onMouseEnter",["mouseout","mouseover"]);Rn("onMouseLeave",["mouseout","mouseover"]);Rn("onPointerEnter",["pointerout","pointerover"]);Rn("onPointerLeave",["pointerout","pointerover"]);qr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qr("onBeforeInput",["compositionend","keypress","textInput","paste"]);qr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var us="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tk=new Set("cancel close invalid load scroll toggle".split(" ").concat(us));function oh(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,Zy(r,t,void 0,e),e.currentTarget=null}function Bf(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;oh(n,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;oh(n,a,u),s=l}}}if(Yo)throw e=eu,Yo=!1,eu=null,e}function Ne(e,t){var i=t[cu];i===void 0&&(i=t[cu]=new Set);var r=e+"__bubble";i.has(r)||(jf(t,e,2,!1),i.add(r))}function ml(e,t,i){var r=0;t&&(r|=4),jf(i,e,r,t)}var vo="_reactListening"+Math.random().toString(36).slice(2);function As(e){if(!e[vo]){e[vo]=!0,qp.forEach(function(i){i!=="selectionchange"&&(tk.has(i)||ml(i,!1,e),ml(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[vo]||(t[vo]=!0,ml("selectionchange",!1,t))}}function jf(e,t,i,r){switch(Ef(t)){case 1:var n=vS;break;case 4:n=mS;break;default:n=mc}i=n.bind(null,t,i,e),n=void 0,!Zl||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function gl(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=xr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}cf(function(){var u=s,c=hc(i),h=[];e:{var p=$f.get(e);if(p!==void 0){var S=yc,k=e;switch(e){case"keypress":if(Do(i)===0)break e;case"keydown":case"keyup":S=LS;break;case"focusin":k="focus",S=cl;break;case"focusout":k="blur",S=cl;break;case"beforeblur":case"afterblur":S=cl;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=Kd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=SS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=OS;break;case xf:case Nf:case Uf:S=bS;break;case Ff:S=NS;break;case"scroll":S=gS;break;case"wheel":S=FS;break;case"copy":case"cut":case"paste":S=ES;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=Qd}var E=(t&4)!==0,O=!E&&e==="scroll",I=E?p!==null?p+"Capture":null:p;E=[];for(var R=u,A;R!==null;){A=R;var M=A.stateNode;if(A.tag===5&&M!==null&&(A=M,I!==null&&(M=bs(R,I),M!=null&&E.push(_s(R,M,A)))),O)break;R=R.return}0<E.length&&(p=new S(p,k,null,i,c),h.push({event:p,listeners:E}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",S=e==="mouseout"||e==="pointerout",p&&i!==Yl&&(k=i.relatedTarget||i.fromElement)&&(xr(k)||k[Vi]))break e;if((S||p)&&(p=c.window===c?c:(p=c.ownerDocument)?p.defaultView||p.parentWindow:window,S?(k=i.relatedTarget||i.toElement,S=u,k=k?xr(k):null,k!==null&&(O=Kr(k),k!==O||k.tag!==5&&k.tag!==6)&&(k=null)):(S=null,k=u),S!==k)){if(E=Kd,M="onMouseLeave",I="onMouseEnter",R="mouse",(e==="pointerout"||e==="pointerover")&&(E=Qd,M="onPointerLeave",I="onPointerEnter",R="pointer"),O=S==null?p:an(S),A=k==null?p:an(k),p=new E(M,R+"leave",S,i,c),p.target=O,p.relatedTarget=A,M=null,xr(c)===u&&(E=new E(I,R+"enter",k,i,c),E.target=A,E.relatedTarget=O,M=E),O=M,S&&k)t:{for(E=S,I=k,R=0,A=E;A;A=en(A))R++;for(A=0,M=I;M;M=en(M))A++;for(;0<R-A;)E=en(E),R--;for(;0<A-R;)I=en(I),A--;for(;R--;){if(E===I||I!==null&&E===I.alternate)break t;E=en(E),I=en(I)}E=null}else E=null;S!==null&&ah(h,p,S,E,!1),k!==null&&O!==null&&ah(h,O,k,E,!0)}}e:{if(p=u?an(u):window,S=p.nodeName&&p.nodeName.toLowerCase(),S==="select"||S==="input"&&p.type==="file")var W=WS;else if(Zd(p))if(If)W=JS;else{W=qS;var Z=HS}else(S=p.nodeName)&&S.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(W=KS);if(W&&(W=W(e,u))){_f(h,W,i,c);break e}Z&&Z(e,p,u),e==="focusout"&&(Z=p._wrapperState)&&Z.controlled&&p.type==="number"&&Hl(p,"number",p.value)}switch(Z=u?an(u):window,e){case"focusin":(Zd(Z)||Z.contentEditable==="true")&&(sn=Z,nu=u,vs=null);break;case"focusout":vs=nu=sn=null;break;case"mousedown":su=!0;break;case"contextmenu":case"mouseup":case"dragend":su=!1,nh(h,i,c);break;case"selectionchange":if(XS)break;case"keydown":case"keyup":nh(h,i,c)}var X;if(kc)e:{switch(e){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else nn?Rf(e,i)&&(ee="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ee="onCompositionStart");ee&&(Pf&&i.locale!=="ko"&&(nn||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&nn&&(X=wf()):(ar=c,gc="value"in ar?ar.value:ar.textContent,nn=!0)),Z=ia(u,ee),0<Z.length&&(ee=new Jd(ee,e,null,i,c),h.push({event:ee,listeners:Z}),X?ee.data=X:(X=Af(i),X!==null&&(ee.data=X)))),(X=BS?jS(e,i):GS(e,i))&&(u=ia(u,"onBeforeInput"),0<u.length&&(c=new Jd("onBeforeInput","beforeinput",null,i,c),h.push({event:c,listeners:u}),c.data=X))}Bf(h,t)})}function _s(e,t,i){return{instance:e,listener:t,currentTarget:i}}function ia(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=bs(e,i),s!=null&&r.unshift(_s(e,s,n)),s=bs(e,t),s!=null&&r.push(_s(e,s,n))),e=e.return}return r}function en(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ah(e,t,i,r,n){for(var s=t._reactName,o=[];i!==null&&i!==r;){var a=i,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,n?(l=bs(i,s),l!=null&&o.unshift(_s(i,l,a))):n||(l=bs(i,s),l!=null&&o.push(_s(i,l,a)))),i=i.return}o.length!==0&&e.push({event:t,listeners:o})}var ik=/\r\n?/g,rk=/\u0000|\uFFFD/g;function lh(e){return(typeof e=="string"?e:""+e).replace(ik,`
`).replace(rk,"")}function mo(e,t,i){if(t=lh(t),lh(e)!==t&&i)throw Error(J(425))}function ra(){}var ou=null,au=null;function lu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var uu=typeof setTimeout=="function"?setTimeout:void 0,nk=typeof clearTimeout=="function"?clearTimeout:void 0,uh=typeof Promise=="function"?Promise:void 0,sk=typeof queueMicrotask=="function"?queueMicrotask:typeof uh<"u"?function(e){return uh.resolve(null).then(e).catch(ok)}:uu;function ok(e){setTimeout(function(){throw e})}function yl(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),ws(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);ws(t)}function hr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function ch(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var Bn=Math.random().toString(36).slice(2),wi="__reactFiber$"+Bn,Is="__reactProps$"+Bn,Vi="__reactContainer$"+Bn,cu="__reactEvents$"+Bn,ak="__reactListeners$"+Bn,lk="__reactHandles$"+Bn;function xr(e){var t=e[wi];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Vi]||i[wi]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=ch(e);e!==null;){if(i=e[wi])return i;e=ch(e)}return t}e=i,i=e.parentNode}return null}function Ws(e){return e=e[wi]||e[Vi],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function an(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function Oa(e){return e[Is]||null}var du=[],ln=-1;function Tr(e){return{current:e}}function Ue(e){0>ln||(e.current=du[ln],du[ln]=null,ln--)}function Me(e,t){ln++,du[ln]=e.current,e.current=t}var yr={},Pt=Tr(yr),Ft=Tr(!1),jr=yr;function An(e,t){var i=e.type.contextTypes;if(!i)return yr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function $t(e){return e=e.childContextTypes,e!=null}function na(){Ue(Ft),Ue(Pt)}function dh(e,t,i){if(Pt.current!==yr)throw Error(J(168));Me(Pt,t),Me(Ft,i)}function Gf(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(J(108,Hy(e)||"Unknown",n));return ze({},i,r)}function sa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||yr,jr=Pt.current,Me(Pt,e),Me(Ft,Ft.current),!0}function hh(e,t,i){var r=e.stateNode;if(!r)throw Error(J(169));i?(e=Gf(e,t,jr),r.__reactInternalMemoizedMergedChildContext=e,Ue(Ft),Ue(Pt),Me(Pt,e)):Ue(Ft),Me(Ft,i)}var Ui=null,xa=!1,Sl=!1;function zf(e){Ui===null?Ui=[e]:Ui.push(e)}function uk(e){xa=!0,zf(e)}function br(){if(!Sl&&Ui!==null){Sl=!0;var e=0,t=Ie;try{var i=Ui;for(Ie=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Ui=null,xa=!1}catch(n){throw Ui!==null&&(Ui=Ui.slice(e+1)),ff(pc,br),n}finally{Ie=t,Sl=!1}}return null}var un=[],cn=0,oa=null,aa=0,ei=[],ti=0,Gr=null,Fi=1,$i="";function Lr(e,t){un[cn++]=aa,un[cn++]=oa,oa=e,aa=t}function Vf(e,t,i){ei[ti++]=Fi,ei[ti++]=$i,ei[ti++]=Gr,Gr=e;var r=Fi;e=$i;var n=32-yi(r)-1;r&=~(1<<n),i+=1;var s=32-yi(t)+n;if(30<s){var o=n-n%5;s=(r&(1<<o)-1).toString(32),r>>=o,n-=o,Fi=1<<32-yi(t)+n|i<<n|r,$i=s+e}else Fi=1<<s|i<<n|r,$i=e}function bc(e){e.return!==null&&(Lr(e,1),Vf(e,1,0))}function Cc(e){for(;e===oa;)oa=un[--cn],un[cn]=null,aa=un[--cn],un[cn]=null;for(;e===Gr;)Gr=ei[--ti],ei[ti]=null,$i=ei[--ti],ei[ti]=null,Fi=ei[--ti],ei[ti]=null}var Wt=null,Vt=null,$e=!1,pi=null;function Wf(e,t){var i=ii(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function ph(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Wt=e,Vt=hr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Wt=e,Vt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Gr!==null?{id:Fi,overflow:$i}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=ii(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Wt=e,Vt=null,!0):!1;default:return!1}}function hu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function pu(e){if($e){var t=Vt;if(t){var i=t;if(!ph(e,t)){if(hu(e))throw Error(J(418));t=hr(i.nextSibling);var r=Wt;t&&ph(e,t)?Wf(r,i):(e.flags=e.flags&-4097|2,$e=!1,Wt=e)}}else{if(hu(e))throw Error(J(418));e.flags=e.flags&-4097|2,$e=!1,Wt=e}}}function fh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Wt=e}function go(e){if(e!==Wt)return!1;if(!$e)return fh(e),$e=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!lu(e.type,e.memoizedProps)),t&&(t=Vt)){if(hu(e))throw Hf(),Error(J(418));for(;t;)Wf(e,t),t=hr(t.nextSibling)}if(fh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Vt=hr(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Vt=null}}else Vt=Wt?hr(e.stateNode.nextSibling):null;return!0}function Hf(){for(var e=Vt;e;)e=hr(e.nextSibling)}function _n(){Vt=Wt=null,$e=!1}function Ec(e){pi===null?pi=[e]:pi.push(e)}var ck=Ji.ReactCurrentBatchConfig;function di(e,t){if(e&&e.defaultProps){t=ze({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}var la=Tr(null),ua=null,dn=null,wc=null;function Pc(){wc=dn=ua=null}function Rc(e){var t=la.current;Ue(la),e._currentValue=t}function fu(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Sn(e,t){ua=e,wc=dn=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ut=!0),e.firstContext=null)}function si(e){var t=e._currentValue;if(wc!==e)if(e={context:e,memoizedValue:t,next:null},dn===null){if(ua===null)throw Error(J(308));dn=e,ua.dependencies={lanes:0,firstContext:e}}else dn=dn.next=e;return t}var Nr=null;function Ac(e){Nr===null?Nr=[e]:Nr.push(e)}function qf(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,Ac(t)):(i.next=n.next,n.next=i),t.interleaved=i,Wi(e,r)}function Wi(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var nr=!1;function _c(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Kf(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ji(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function pr(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Pe&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,Wi(e,i)}return n=r.interleaved,n===null?(t.next=t,Ac(r)):(t.next=n.next,n.next=t),r.interleaved=t,Wi(e,i)}function Mo(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,fc(e,i)}}function vh(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=o:s=s.next=o,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function ca(e,t,i,r){var n=e.updateQueue;nr=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=e.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;o=0,c=u=l=null,a=s;do{var p=a.lane,S=a.eventTime;if((r&p)===p){c!==null&&(c=c.next={eventTime:S,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var k=e,E=a;switch(p=t,S=i,E.tag){case 1:if(k=E.payload,typeof k=="function"){h=k.call(S,h,p);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=E.payload,p=typeof k=="function"?k.call(S,h,p):k,p==null)break e;h=ze({},h,p);break e;case 2:nr=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,p=n.effects,p===null?n.effects=[a]:p.push(a))}else S={eventTime:S,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=S,l=h):c=c.next=S,o|=p;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;p=a,a=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(!0);if(c===null&&(l=h),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=c,t=n.shared.interleaved,t!==null){n=t;do o|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Vr|=o,e.lanes=o,e.memoizedState=h}}function mh(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(J(191,n));n.call(r)}}}var Jf=new Hp.Component().refs;function vu(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:ze({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Na={isMounted:function(e){return(e=e._reactInternals)?Kr(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=Lt(),n=vr(e),s=ji(r,n);s.payload=t,i!=null&&(s.callback=i),t=pr(e,s,n),t!==null&&(Si(t,e,n,r),Mo(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=Lt(),n=vr(e),s=ji(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=pr(e,s,n),t!==null&&(Si(t,e,n,r),Mo(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Lt(),r=vr(e),n=ji(i,r);n.tag=2,t!=null&&(n.callback=t),t=pr(e,n,r),t!==null&&(Si(t,e,r,i),Mo(t,e,r))}};function gh(e,t,i,r,n,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,o):t.prototype&&t.prototype.isPureReactComponent?!Rs(i,r)||!Rs(n,s):!0}function Qf(e,t,i){var r=!1,n=yr,s=t.contextType;return typeof s=="object"&&s!==null?s=si(s):(n=$t(t)?jr:Pt.current,r=t.contextTypes,s=(r=r!=null)?An(e,n):yr),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Na,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function yh(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&Na.enqueueReplaceState(t,t.state,null)}function mu(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs=Jf,_c(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=si(s):(s=$t(t)?jr:Pt.current,n.context=An(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(vu(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&Na.enqueueReplaceState(n,n.state,null),ca(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function Zn(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(J(309));var r=i.stateNode}if(!r)throw Error(J(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var a=n.refs;a===Jf&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(J(284));if(!i._owner)throw Error(J(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Sh(e){var t=e._init;return t(e._payload)}function Yf(e){function t(I,R){if(e){var A=I.deletions;A===null?(I.deletions=[R],I.flags|=16):A.push(R)}}function i(I,R){if(!e)return null;for(;R!==null;)t(I,R),R=R.sibling;return null}function r(I,R){for(I=new Map;R!==null;)R.key!==null?I.set(R.key,R):I.set(R.index,R),R=R.sibling;return I}function n(I,R){return I=mr(I,R),I.index=0,I.sibling=null,I}function s(I,R,A){return I.index=A,e?(A=I.alternate,A!==null?(A=A.index,A<R?(I.flags|=2,R):A):(I.flags|=2,R)):(I.flags|=1048576,R)}function o(I){return e&&I.alternate===null&&(I.flags|=2),I}function a(I,R,A,M){return R===null||R.tag!==6?(R=Pl(A,I.mode,M),R.return=I,R):(R=n(R,A),R.return=I,R)}function l(I,R,A,M){var W=A.type;return W===rn?c(I,R,A.props.children,M,A.key):R!==null&&(R.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===rr&&Sh(W)===R.type)?(M=n(R,A.props),M.ref=Zn(I,R,A),M.return=I,M):(M=$o(A.type,A.key,A.props,null,I.mode,M),M.ref=Zn(I,R,A),M.return=I,M)}function u(I,R,A,M){return R===null||R.tag!==4||R.stateNode.containerInfo!==A.containerInfo||R.stateNode.implementation!==A.implementation?(R=Rl(A,I.mode,M),R.return=I,R):(R=n(R,A.children||[]),R.return=I,R)}function c(I,R,A,M,W){return R===null||R.tag!==7?(R=$r(A,I.mode,M,W),R.return=I,R):(R=n(R,A),R.return=I,R)}function h(I,R,A){if(typeof R=="string"&&R!==""||typeof R=="number")return R=Pl(""+R,I.mode,A),R.return=I,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case oo:return A=$o(R.type,R.key,R.props,null,I.mode,A),A.ref=Zn(I,null,R),A.return=I,A;case tn:return R=Rl(R,I.mode,A),R.return=I,R;case rr:var M=R._init;return h(I,M(R._payload),A)}if(as(R)||Kn(R))return R=$r(R,I.mode,A,null),R.return=I,R;yo(I,R)}return null}function p(I,R,A,M){var W=R!==null?R.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return W!==null?null:a(I,R,""+A,M);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case oo:return A.key===W?l(I,R,A,M):null;case tn:return A.key===W?u(I,R,A,M):null;case rr:return W=A._init,p(I,R,W(A._payload),M)}if(as(A)||Kn(A))return W!==null?null:c(I,R,A,M,null);yo(I,A)}return null}function S(I,R,A,M,W){if(typeof M=="string"&&M!==""||typeof M=="number")return I=I.get(A)||null,a(R,I,""+M,W);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case oo:return I=I.get(M.key===null?A:M.key)||null,l(R,I,M,W);case tn:return I=I.get(M.key===null?A:M.key)||null,u(R,I,M,W);case rr:var Z=M._init;return S(I,R,A,Z(M._payload),W)}if(as(M)||Kn(M))return I=I.get(A)||null,c(R,I,M,W,null);yo(R,M)}return null}function k(I,R,A,M){for(var W=null,Z=null,X=R,ee=R=0,ce=null;X!==null&&ee<A.length;ee++){X.index>ee?(ce=X,X=null):ce=X.sibling;var pe=p(I,X,A[ee],M);if(pe===null){X===null&&(X=ce);break}e&&X&&pe.alternate===null&&t(I,X),R=s(pe,R,ee),Z===null?W=pe:Z.sibling=pe,Z=pe,X=ce}if(ee===A.length)return i(I,X),$e&&Lr(I,ee),W;if(X===null){for(;ee<A.length;ee++)X=h(I,A[ee],M),X!==null&&(R=s(X,R,ee),Z===null?W=X:Z.sibling=X,Z=X);return $e&&Lr(I,ee),W}for(X=r(I,X);ee<A.length;ee++)ce=S(X,I,ee,A[ee],M),ce!==null&&(e&&ce.alternate!==null&&X.delete(ce.key===null?ee:ce.key),R=s(ce,R,ee),Z===null?W=ce:Z.sibling=ce,Z=ce);return e&&X.forEach(function(Oe){return t(I,Oe)}),$e&&Lr(I,ee),W}function E(I,R,A,M){var W=Kn(A);if(typeof W!="function")throw Error(J(150));if(A=W.call(A),A==null)throw Error(J(151));for(var Z=W=null,X=R,ee=R=0,ce=null,pe=A.next();X!==null&&!pe.done;ee++,pe=A.next()){X.index>ee?(ce=X,X=null):ce=X.sibling;var Oe=p(I,X,pe.value,M);if(Oe===null){X===null&&(X=ce);break}e&&X&&Oe.alternate===null&&t(I,X),R=s(Oe,R,ee),Z===null?W=Oe:Z.sibling=Oe,Z=Oe,X=ce}if(pe.done)return i(I,X),$e&&Lr(I,ee),W;if(X===null){for(;!pe.done;ee++,pe=A.next())pe=h(I,pe.value,M),pe!==null&&(R=s(pe,R,ee),Z===null?W=pe:Z.sibling=pe,Z=pe);return $e&&Lr(I,ee),W}for(X=r(I,X);!pe.done;ee++,pe=A.next())pe=S(X,I,ee,pe.value,M),pe!==null&&(e&&pe.alternate!==null&&X.delete(pe.key===null?ee:pe.key),R=s(pe,R,ee),Z===null?W=pe:Z.sibling=pe,Z=pe);return e&&X.forEach(function(Ve){return t(I,Ve)}),$e&&Lr(I,ee),W}function O(I,R,A,M){if(typeof A=="object"&&A!==null&&A.type===rn&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case oo:e:{for(var W=A.key,Z=R;Z!==null;){if(Z.key===W){if(W=A.type,W===rn){if(Z.tag===7){i(I,Z.sibling),R=n(Z,A.props.children),R.return=I,I=R;break e}}else if(Z.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===rr&&Sh(W)===Z.type){i(I,Z.sibling),R=n(Z,A.props),R.ref=Zn(I,Z,A),R.return=I,I=R;break e}i(I,Z);break}else t(I,Z);Z=Z.sibling}A.type===rn?(R=$r(A.props.children,I.mode,M,A.key),R.return=I,I=R):(M=$o(A.type,A.key,A.props,null,I.mode,M),M.ref=Zn(I,R,A),M.return=I,I=M)}return o(I);case tn:e:{for(Z=A.key;R!==null;){if(R.key===Z)if(R.tag===4&&R.stateNode.containerInfo===A.containerInfo&&R.stateNode.implementation===A.implementation){i(I,R.sibling),R=n(R,A.children||[]),R.return=I,I=R;break e}else{i(I,R);break}else t(I,R);R=R.sibling}R=Rl(A,I.mode,M),R.return=I,I=R}return o(I);case rr:return Z=A._init,O(I,R,Z(A._payload),M)}if(as(A))return k(I,R,A,M);if(Kn(A))return E(I,R,A,M);yo(I,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,R!==null&&R.tag===6?(i(I,R.sibling),R=n(R,A),R.return=I,I=R):(i(I,R),R=Pl(A,I.mode,M),R.return=I,I=R),o(I)):i(I,R)}return O}var In=Yf(!0),Xf=Yf(!1),Hs={},Ai=Tr(Hs),Ls=Tr(Hs),Ds=Tr(Hs);function Ur(e){if(e===Hs)throw Error(J(174));return e}function Ic(e,t){switch(Me(Ds,t),Me(Ls,e),Me(Ai,Hs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Kl(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Kl(t,e)}Ue(Ai),Me(Ai,t)}function Ln(){Ue(Ai),Ue(Ls),Ue(Ds)}function Zf(e){Ur(Ds.current);var t=Ur(Ai.current),i=Kl(t,e.type);t!==i&&(Me(Ls,e),Me(Ai,i))}function Lc(e){Ls.current===e&&(Ue(Ai),Ue(Ls))}var je=Tr(0);function da(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var kl=[];function Dc(){for(var e=0;e<kl.length;e++)kl[e]._workInProgressVersionPrimary=null;kl.length=0}var Oo=Ji.ReactCurrentDispatcher,Tl=Ji.ReactCurrentBatchConfig,zr=0,Ge=null,nt=null,at=null,ha=!1,ms=!1,Ms=0,dk=0;function Ct(){throw Error(J(321))}function Mc(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!ki(e[i],t[i]))return!1;return!0}function Oc(e,t,i,r,n,s){if(zr=s,Ge=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Oo.current=e===null||e.memoizedState===null?vk:mk,e=i(r,n),ms){s=0;do{if(ms=!1,Ms=0,25<=s)throw Error(J(301));s+=1,at=nt=null,t.updateQueue=null,Oo.current=gk,e=i(r,n)}while(ms)}if(Oo.current=pa,t=nt!==null&&nt.next!==null,zr=0,at=nt=Ge=null,ha=!1,t)throw Error(J(300));return e}function xc(){var e=Ms!==0;return Ms=0,e}function Ei(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return at===null?Ge.memoizedState=at=e:at=at.next=e,at}function oi(){if(nt===null){var e=Ge.alternate;e=e!==null?e.memoizedState:null}else e=nt.next;var t=at===null?Ge.memoizedState:at.next;if(t!==null)at=t,nt=e;else{if(e===null)throw Error(J(310));nt=e,e={memoizedState:nt.memoizedState,baseState:nt.baseState,baseQueue:nt.baseQueue,queue:nt.queue,next:null},at===null?Ge.memoizedState=at=e:at=at.next=e}return at}function Os(e,t){return typeof t=="function"?t(e):t}function bl(e){var t=oi(),i=t.queue;if(i===null)throw Error(J(311));i.lastRenderedReducer=e;var r=nt,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((zr&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,Ge.lanes|=c,Vr|=c}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,ki(r,t.memoizedState)||(Ut=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,Ge.lanes|=s,Vr|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Cl(e){var t=oi(),i=t.queue;if(i===null)throw Error(J(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var o=n=n.next;do s=e(s,o.action),o=o.next;while(o!==n);ki(s,t.memoizedState)||(Ut=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function ev(){}function tv(e,t){var i=Ge,r=oi(),n=t(),s=!ki(r.memoizedState,n);if(s&&(r.memoizedState=n,Ut=!0),r=r.queue,Nc(nv.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||at!==null&&at.memoizedState.tag&1){if(i.flags|=2048,xs(9,rv.bind(null,i,r,n,t),void 0,null),lt===null)throw Error(J(349));zr&30||iv(i,t,n)}return n}function iv(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Ge.updateQueue,t===null?(t={lastEffect:null,stores:null},Ge.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function rv(e,t,i,r){t.value=i,t.getSnapshot=r,sv(t)&&ov(e)}function nv(e,t,i){return i(function(){sv(t)&&ov(e)})}function sv(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!ki(e,i)}catch{return!0}}function ov(e){var t=Wi(e,1);t!==null&&Si(t,e,1,-1)}function kh(e){var t=Ei();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:e},t.queue=e,e=e.dispatch=fk.bind(null,Ge,e),[t.memoizedState,e]}function xs(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=Ge.updateQueue,t===null?(t={lastEffect:null,stores:null},Ge.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function av(){return oi().memoizedState}function xo(e,t,i,r){var n=Ei();Ge.flags|=e,n.memoizedState=xs(1|t,i,void 0,r===void 0?null:r)}function Ua(e,t,i,r){var n=oi();r=r===void 0?null:r;var s=void 0;if(nt!==null){var o=nt.memoizedState;if(s=o.destroy,r!==null&&Mc(r,o.deps)){n.memoizedState=xs(t,i,s,r);return}}Ge.flags|=e,n.memoizedState=xs(1|t,i,s,r)}function Th(e,t){return xo(8390656,8,e,t)}function Nc(e,t){return Ua(2048,8,e,t)}function lv(e,t){return Ua(4,2,e,t)}function uv(e,t){return Ua(4,4,e,t)}function cv(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function dv(e,t,i){return i=i!=null?i.concat([e]):null,Ua(4,4,cv.bind(null,t,e),i)}function Uc(){}function hv(e,t){var i=oi();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Mc(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function pv(e,t){var i=oi();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Mc(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function fv(e,t,i){return zr&21?(ki(i,t)||(i=gf(),Ge.lanes|=i,Vr|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ut=!0),e.memoizedState=i)}function hk(e,t){var i=Ie;Ie=i!==0&&4>i?i:4,e(!0);var r=Tl.transition;Tl.transition={};try{e(!1),t()}finally{Ie=i,Tl.transition=r}}function vv(){return oi().memoizedState}function pk(e,t,i){var r=vr(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},mv(e))gv(t,i);else if(i=qf(e,t,i,r),i!==null){var n=Lt();Si(i,e,r,n),yv(i,t,r)}}function fk(e,t,i){var r=vr(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(mv(e))gv(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,a=s(o,i);if(n.hasEagerState=!0,n.eagerState=a,ki(a,o)){var l=t.interleaved;l===null?(n.next=n,Ac(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=qf(e,t,n,r),i!==null&&(n=Lt(),Si(i,e,r,n),yv(i,t,r))}}function mv(e){var t=e.alternate;return e===Ge||t!==null&&t===Ge}function gv(e,t){ms=ha=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function yv(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,fc(e,i)}}var pa={readContext:si,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useInsertionEffect:Ct,useLayoutEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useMutableSource:Ct,useSyncExternalStore:Ct,useId:Ct,unstable_isNewReconciler:!1},vk={readContext:si,useCallback:function(e,t){return Ei().memoizedState=[e,t===void 0?null:t],e},useContext:si,useEffect:Th,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,xo(4194308,4,cv.bind(null,t,e),i)},useLayoutEffect:function(e,t){return xo(4194308,4,e,t)},useInsertionEffect:function(e,t){return xo(4,2,e,t)},useMemo:function(e,t){var i=Ei();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=Ei();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=pk.bind(null,Ge,e),[r.memoizedState,e]},useRef:function(e){var t=Ei();return e={current:e},t.memoizedState=e},useState:kh,useDebugValue:Uc,useDeferredValue:function(e){return Ei().memoizedState=e},useTransition:function(){var e=kh(!1),t=e[0];return e=hk.bind(null,e[1]),Ei().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=Ge,n=Ei();if($e){if(i===void 0)throw Error(J(407));i=i()}else{if(i=t(),lt===null)throw Error(J(349));zr&30||iv(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,Th(nv.bind(null,r,s,e),[e]),r.flags|=2048,xs(9,rv.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=Ei(),t=lt.identifierPrefix;if($e){var i=$i,r=Fi;i=(r&~(1<<32-yi(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=Ms++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=dk++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mk={readContext:si,useCallback:hv,useContext:si,useEffect:Nc,useImperativeHandle:dv,useInsertionEffect:lv,useLayoutEffect:uv,useMemo:pv,useReducer:bl,useRef:av,useState:function(){return bl(Os)},useDebugValue:Uc,useDeferredValue:function(e){var t=oi();return fv(t,nt.memoizedState,e)},useTransition:function(){var e=bl(Os)[0],t=oi().memoizedState;return[e,t]},useMutableSource:ev,useSyncExternalStore:tv,useId:vv,unstable_isNewReconciler:!1},gk={readContext:si,useCallback:hv,useContext:si,useEffect:Nc,useImperativeHandle:dv,useInsertionEffect:lv,useLayoutEffect:uv,useMemo:pv,useReducer:Cl,useRef:av,useState:function(){return Cl(Os)},useDebugValue:Uc,useDeferredValue:function(e){var t=oi();return nt===null?t.memoizedState=e:fv(t,nt.memoizedState,e)},useTransition:function(){var e=Cl(Os)[0],t=oi().memoizedState;return[e,t]},useMutableSource:ev,useSyncExternalStore:tv,useId:vv,unstable_isNewReconciler:!1};function Dn(e,t){try{var i="",r=t;do i+=Wy(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function El(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function gu(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var yk=typeof WeakMap=="function"?WeakMap:Map;function Sv(e,t,i){i=ji(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){va||(va=!0,Ru=r),gu(e,t)},i}function kv(e,t,i){i=ji(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){gu(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){gu(e,t),typeof r!="function"&&(fr===null?fr=new Set([this]):fr.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),i}function bh(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new yk;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=Dk.bind(null,e,t,i),t.then(e,e))}function Ch(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Eh(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=ji(-1,1),t.tag=2,pr(i,t,1))),i.lanes|=1),e)}var Sk=Ji.ReactCurrentOwner,Ut=!1;function It(e,t,i,r){t.child=e===null?Xf(t,null,i,r):In(t,e.child,i,r)}function wh(e,t,i,r,n){i=i.render;var s=t.ref;return Sn(t,n),r=Oc(e,t,i,r,s,n),i=xc(),e!==null&&!Ut?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Hi(e,t,n)):($e&&i&&bc(t),t.flags|=1,It(e,t,r,n),t.child)}function Ph(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!Wc(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,Tv(e,t,s,r,n)):(e=$o(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var o=s.memoizedProps;if(i=i.compare,i=i!==null?i:Rs,i(o,r)&&e.ref===t.ref)return Hi(e,t,n)}return t.flags|=1,e=mr(s,r),e.ref=t.ref,e.return=t,t.child=e}function Tv(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(Rs(s,r)&&e.ref===t.ref)if(Ut=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(Ut=!0);else return t.lanes=e.lanes,Hi(e,t,n)}return yu(e,t,i,r,n)}function bv(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Me(pn,zt),zt|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Me(pn,zt),zt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,Me(pn,zt),zt|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,Me(pn,zt),zt|=r;return It(e,t,n,i),t.child}function Cv(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function yu(e,t,i,r,n){var s=$t(i)?jr:Pt.current;return s=An(t,s),Sn(t,n),i=Oc(e,t,i,r,s,n),r=xc(),e!==null&&!Ut?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Hi(e,t,n)):($e&&r&&bc(t),t.flags|=1,It(e,t,i,n),t.child)}function Rh(e,t,i,r,n){if($t(i)){var s=!0;sa(t)}else s=!1;if(Sn(t,n),t.stateNode===null)No(e,t),Qf(t,i,r),mu(t,i,r,n),r=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,u=i.contextType;typeof u=="object"&&u!==null?u=si(u):(u=$t(i)?jr:Pt.current,u=An(t,u));var c=i.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&yh(t,o,r,u),nr=!1;var p=t.memoizedState;o.state=p,ca(t,r,o,n),l=t.memoizedState,a!==r||p!==l||Ft.current||nr?(typeof c=="function"&&(vu(t,i,c,r),l=t.memoizedState),(a=nr||gh(t,i,a,r,p,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Kf(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:di(t.type,a),o.props=u,h=t.pendingProps,p=o.context,l=i.contextType,typeof l=="object"&&l!==null?l=si(l):(l=$t(i)?jr:Pt.current,l=An(t,l));var S=i.getDerivedStateFromProps;(c=typeof S=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==l)&&yh(t,o,r,l),nr=!1,p=t.memoizedState,o.state=p,ca(t,r,o,n);var k=t.memoizedState;a!==h||p!==k||Ft.current||nr?(typeof S=="function"&&(vu(t,i,S,r),k=t.memoizedState),(u=nr||gh(t,i,u,r,p,k,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),o.props=r,o.state=k,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return Su(e,t,i,r,s,n)}function Su(e,t,i,r,n,s){Cv(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return n&&hh(t,i,!1),Hi(e,t,s);r=t.stateNode,Sk.current=t;var a=o&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=In(t,e.child,null,s),t.child=In(t,null,a,s)):It(e,t,a,s),t.memoizedState=r.state,n&&hh(t,i,!0),t.child}function Ev(e){var t=e.stateNode;t.pendingContext?dh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&dh(e,t.context,!1),Ic(e,t.containerInfo)}function Ah(e,t,i,r,n){return _n(),Ec(n),t.flags|=256,It(e,t,i,r),t.child}var ku={dehydrated:null,treeContext:null,retryLane:0};function Tu(e){return{baseLanes:e,cachePool:null,transitions:null}}function wv(e,t,i){var r=t.pendingProps,n=je.current,s=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(n&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),Me(je,n&1),e===null)return pu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ba(o,r,0,null),e=$r(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Tu(i),t.memoizedState=ku,e):Fc(t,o));if(n=e.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return kk(e,t,o,r,a,n,i);if(s){s=r.fallback,o=t.mode,n=e.child,a=n.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=mr(n,l),r.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=mr(a,s):(s=$r(s,o,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=e.child.memoizedState,o=o===null?Tu(i):{baseLanes:o.baseLanes|i,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~i,t.memoizedState=ku,r}return s=e.child,e=s.sibling,r=mr(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function Fc(e,t){return t=Ba({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function So(e,t,i,r){return r!==null&&Ec(r),In(t,e.child,null,i),e=Fc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function kk(e,t,i,r,n,s,o){if(i)return t.flags&256?(t.flags&=-257,r=El(Error(J(422))),So(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=Ba({mode:"visible",children:r.children},n,0,null),s=$r(s,n,o,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&In(t,e.child,null,o),t.child.memoizedState=Tu(o),t.memoizedState=ku,s);if(!(t.mode&1))return So(e,t,o,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(J(419)),r=El(s,r,void 0),So(e,t,o,r)}if(a=(o&e.childLanes)!==0,Ut||a){if(r=lt,r!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Wi(e,n),Si(r,e,n,-1))}return Vc(),r=El(Error(J(421))),So(e,t,o,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=Mk.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,Vt=hr(n.nextSibling),Wt=t,$e=!0,pi=null,e!==null&&(ei[ti++]=Fi,ei[ti++]=$i,ei[ti++]=Gr,Fi=e.id,$i=e.overflow,Gr=t),t=Fc(t,r.children),t.flags|=4096,t)}function _h(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),fu(e.return,t,i)}function wl(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function Pv(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(It(e,t,r.children,i),r=je.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&_h(e,i,t);else if(e.tag===19)_h(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Me(je,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&da(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),wl(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&da(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}wl(t,!0,i,null,s);break;case"together":wl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function No(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hi(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Vr|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(J(153));if(t.child!==null){for(e=t.child,i=mr(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=mr(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Tk(e,t,i){switch(t.tag){case 3:Ev(t),_n();break;case 5:Zf(t);break;case 1:$t(t.type)&&sa(t);break;case 4:Ic(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;Me(la,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Me(je,je.current&1),t.flags|=128,null):i&t.child.childLanes?wv(e,t,i):(Me(je,je.current&1),e=Hi(e,t,i),e!==null?e.sibling:null);Me(je,je.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return Pv(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Me(je,je.current),r)break;return null;case 22:case 23:return t.lanes=0,bv(e,t,i)}return Hi(e,t,i)}var Rv,bu,Av,_v;Rv=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};bu=function(){};Av=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,Ur(Ai.current);var s=null;switch(i){case"input":n=Vl(e,n),r=Vl(e,r),s=[];break;case"select":n=ze({},n,{value:void 0}),r=ze({},r,{value:void 0}),s=[];break;case"textarea":n=ql(e,n),r=ql(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=ra)}Jl(i,r);var o;i=null;for(u in n)if(!r.hasOwnProperty(u)&&n.hasOwnProperty(u)&&n[u]!=null)if(u==="style"){var a=n[u];for(o in a)a.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ks.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=n!=null?n[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(i||(i={}),i[o]=l[o])}else i||(s||(s=[]),s.push(u,i)),i=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ks.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ne("scroll",e),s||a===l||(s=[])):(s=s||[]).push(u,l))}i&&(s=s||[]).push("style",i);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};_v=function(e,t,i,r){i!==r&&(t.flags|=4)};function es(e,t){if(!$e)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Et(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function bk(e,t,i){var r=t.pendingProps;switch(Cc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(t),null;case 1:return $t(t.type)&&na(),Et(t),null;case 3:return r=t.stateNode,Ln(),Ue(Ft),Ue(Pt),Dc(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(go(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pi!==null&&(Iu(pi),pi=null))),bu(e,t),Et(t),null;case 5:Lc(t);var n=Ur(Ds.current);if(i=t.type,e!==null&&t.stateNode!=null)Av(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return Et(t),null}if(e=Ur(Ai.current),go(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[wi]=t,r[Is]=s,e=(t.mode&1)!==0,i){case"dialog":Ne("cancel",r),Ne("close",r);break;case"iframe":case"object":case"embed":Ne("load",r);break;case"video":case"audio":for(n=0;n<us.length;n++)Ne(us[n],r);break;case"source":Ne("error",r);break;case"img":case"image":case"link":Ne("error",r),Ne("load",r);break;case"details":Ne("toggle",r);break;case"input":Fd(r,s),Ne("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ne("invalid",r);break;case"textarea":Bd(r,s),Ne("invalid",r)}Jl(i,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&mo(r.textContent,a,e),n=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&mo(r.textContent,a,e),n=["children",""+a]):ks.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ne("scroll",r)}switch(i){case"input":ao(r),$d(r,s,!0);break;case"textarea":ao(r),jd(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ra)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tf(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(i,{is:r.is}):(e=o.createElement(i),i==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,i),e[wi]=t,e[Is]=r,Rv(e,t,!1,!1),t.stateNode=e;e:{switch(o=Ql(i,r),i){case"dialog":Ne("cancel",e),Ne("close",e),n=r;break;case"iframe":case"object":case"embed":Ne("load",e),n=r;break;case"video":case"audio":for(n=0;n<us.length;n++)Ne(us[n],e);n=r;break;case"source":Ne("error",e),n=r;break;case"img":case"image":case"link":Ne("error",e),Ne("load",e),n=r;break;case"details":Ne("toggle",e),n=r;break;case"input":Fd(e,r),n=Vl(e,r),Ne("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=ze({},r,{value:void 0}),Ne("invalid",e);break;case"textarea":Bd(e,r),n=ql(e,r),Ne("invalid",e);break;default:n=r}Jl(i,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?sf(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&rf(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Ts(e,l):typeof l=="number"&&Ts(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ks.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ne("scroll",e):l!=null&&lc(e,s,l,o))}switch(i){case"input":ao(e),$d(e,r,!1);break;case"textarea":ao(e),jd(e);break;case"option":r.value!=null&&e.setAttribute("value",""+gr(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?vn(e,!!r.multiple,s,!1):r.defaultValue!=null&&vn(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=ra)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Et(t),null;case 6:if(e&&t.stateNode!=null)_v(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(i=Ur(Ds.current),Ur(Ai.current),go(t)){if(r=t.stateNode,i=t.memoizedProps,r[wi]=t,(s=r.nodeValue!==i)&&(e=Wt,e!==null))switch(e.tag){case 3:mo(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&mo(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[wi]=t,t.stateNode=r}return Et(t),null;case 13:if(Ue(je),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if($e&&Vt!==null&&t.mode&1&&!(t.flags&128))Hf(),_n(),t.flags|=98560,s=!1;else if(s=go(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(J(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(J(317));s[wi]=t}else _n(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Et(t),s=!1}else pi!==null&&(Iu(pi),pi=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||je.current&1?st===0&&(st=3):Vc())),t.updateQueue!==null&&(t.flags|=4),Et(t),null);case 4:return Ln(),bu(e,t),e===null&&As(t.stateNode.containerInfo),Et(t),null;case 10:return Rc(t.type._context),Et(t),null;case 17:return $t(t.type)&&na(),Et(t),null;case 19:if(Ue(je),s=t.memoizedState,s===null)return Et(t),null;if(r=(t.flags&128)!==0,o=s.rendering,o===null)if(r)es(s,!1);else{if(st!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=da(e),o!==null){for(t.flags|=128,es(s,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Me(je,je.current&1|2),t.child}e=e.sibling}s.tail!==null&&Ye()>Mn&&(t.flags|=128,r=!0,es(s,!1),t.lanes=4194304)}else{if(!r)if(e=da(o),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),es(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!$e)return Et(t),null}else 2*Ye()-s.renderingStartTime>Mn&&i!==1073741824&&(t.flags|=128,r=!0,es(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(i=s.last,i!==null?i.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ye(),t.sibling=null,i=je.current,Me(je,r?i&1|2:i&1),t):(Et(t),null);case 22:case 23:return zc(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?zt&1073741824&&(Et(t),t.subtreeFlags&6&&(t.flags|=8192)):Et(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function Ck(e,t){switch(Cc(t),t.tag){case 1:return $t(t.type)&&na(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ln(),Ue(Ft),Ue(Pt),Dc(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Lc(t),null;case 13:if(Ue(je),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(J(340));_n()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ue(je),null;case 4:return Ln(),null;case 10:return Rc(t.type._context),null;case 22:case 23:return zc(),null;case 24:return null;default:return null}}var ko=!1,wt=!1,Ek=typeof WeakSet=="function"?WeakSet:Set,oe=null;function hn(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){Je(e,t,r)}else i.current=null}function Cu(e,t,i){try{i()}catch(r){Je(e,t,r)}}var Ih=!1;function wk(e,t){if(ou=ea,e=Mf(),Tc(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=e,p=null;t:for(;;){for(var S;h!==i||n!==0&&h.nodeType!==3||(a=o+n),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(S=h.firstChild)!==null;)p=h,h=S;for(;;){if(h===e)break t;if(p===i&&++u===n&&(a=o),p===s&&++c===r&&(l=o),(S=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=S}i=a===-1||l===-1?null:{start:a,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(au={focusedElem:e,selectionRange:i},ea=!1,oe=t;oe!==null;)if(t=oe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,oe=e;else for(;oe!==null;){t=oe;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var E=k.memoizedProps,O=k.memoizedState,I=t.stateNode,R=I.getSnapshotBeforeUpdate(t.elementType===t.type?E:di(t.type,E),O);I.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var A=t.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(M){Je(t,t.return,M)}if(e=t.sibling,e!==null){e.return=t.return,oe=e;break}oe=t.return}return k=Ih,Ih=!1,k}function gs(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&Cu(t,i,s)}n=n.next}while(n!==r)}}function Fa(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function Eu(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function Iv(e){var t=e.alternate;t!==null&&(e.alternate=null,Iv(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[wi],delete t[Is],delete t[cu],delete t[ak],delete t[lk])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Lv(e){return e.tag===5||e.tag===3||e.tag===4}function Lh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Lv(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function wu(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=ra));else if(r!==4&&(e=e.child,e!==null))for(wu(e,t,i),e=e.sibling;e!==null;)wu(e,t,i),e=e.sibling}function Pu(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Pu(e,t,i),e=e.sibling;e!==null;)Pu(e,t,i),e=e.sibling}var gt=null,hi=!1;function tr(e,t,i){for(i=i.child;i!==null;)Dv(e,t,i),i=i.sibling}function Dv(e,t,i){if(Ri&&typeof Ri.onCommitFiberUnmount=="function")try{Ri.onCommitFiberUnmount(Ia,i)}catch{}switch(i.tag){case 5:wt||hn(i,t);case 6:var r=gt,n=hi;gt=null,tr(e,t,i),gt=r,hi=n,gt!==null&&(hi?(e=gt,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):gt.removeChild(i.stateNode));break;case 18:gt!==null&&(hi?(e=gt,i=i.stateNode,e.nodeType===8?yl(e.parentNode,i):e.nodeType===1&&yl(e,i),ws(e)):yl(gt,i.stateNode));break;case 4:r=gt,n=hi,gt=i.stateNode.containerInfo,hi=!0,tr(e,t,i),gt=r,hi=n;break;case 0:case 11:case 14:case 15:if(!wt&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Cu(i,t,o),n=n.next}while(n!==r)}tr(e,t,i);break;case 1:if(!wt&&(hn(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(a){Je(i,t,a)}tr(e,t,i);break;case 21:tr(e,t,i);break;case 22:i.mode&1?(wt=(r=wt)||i.memoizedState!==null,tr(e,t,i),wt=r):tr(e,t,i);break;default:tr(e,t,i)}}function Dh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new Ek),t.forEach(function(r){var n=Ok.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function ci(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:gt=a.stateNode,hi=!1;break e;case 3:gt=a.stateNode.containerInfo,hi=!0;break e;case 4:gt=a.stateNode.containerInfo,hi=!0;break e}a=a.return}if(gt===null)throw Error(J(160));Dv(s,o,n),gt=null,hi=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(u){Je(n,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Mv(t,e),t=t.sibling}function Mv(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ci(t,e),Ci(e),r&4){try{gs(3,e,e.return),Fa(3,e)}catch(E){Je(e,e.return,E)}try{gs(5,e,e.return)}catch(E){Je(e,e.return,E)}}break;case 1:ci(t,e),Ci(e),r&512&&i!==null&&hn(i,i.return);break;case 5:if(ci(t,e),Ci(e),r&512&&i!==null&&hn(i,i.return),e.flags&32){var n=e.stateNode;try{Ts(n,"")}catch(E){Je(e,e.return,E)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,o=i!==null?i.memoizedProps:s,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Zp(n,s),Ql(a,o);var u=Ql(a,s);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?sf(n,h):c==="dangerouslySetInnerHTML"?rf(n,h):c==="children"?Ts(n,h):lc(n,c,h,u)}switch(a){case"input":Wl(n,s);break;case"textarea":ef(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var S=s.value;S!=null?vn(n,!!s.multiple,S,!1):p!==!!s.multiple&&(s.defaultValue!=null?vn(n,!!s.multiple,s.defaultValue,!0):vn(n,!!s.multiple,s.multiple?[]:"",!1))}n[Is]=s}catch(E){Je(e,e.return,E)}}break;case 6:if(ci(t,e),Ci(e),r&4){if(e.stateNode===null)throw Error(J(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(E){Je(e,e.return,E)}}break;case 3:if(ci(t,e),Ci(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{ws(t.containerInfo)}catch(E){Je(e,e.return,E)}break;case 4:ci(t,e),Ci(e);break;case 13:ci(t,e),Ci(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(jc=Ye())),r&4&&Dh(e);break;case 22:if(c=i!==null&&i.memoizedState!==null,e.mode&1?(wt=(u=wt)||c,ci(t,e),wt=u):ci(t,e),Ci(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!c&&e.mode&1)for(oe=e,c=e.child;c!==null;){for(h=oe=c;oe!==null;){switch(p=oe,S=p.child,p.tag){case 0:case 11:case 14:case 15:gs(4,p,p.return);break;case 1:hn(p,p.return);var k=p.stateNode;if(typeof k.componentWillUnmount=="function"){r=p,i=p.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(E){Je(r,i,E)}}break;case 5:hn(p,p.return);break;case 22:if(p.memoizedState!==null){Oh(h);continue}}S!==null?(S.return=p,oe=S):Oh(h)}c=c.sibling}e:for(c=null,h=e;;){if(h.tag===5){if(c===null){c=h;try{n=h.stateNode,u?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=nf("display",o))}catch(E){Je(e,e.return,E)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(E){Je(e,e.return,E)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ci(t,e),Ci(e),r&4&&Dh(e);break;case 21:break;default:ci(t,e),Ci(e)}}function Ci(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(Lv(i)){var r=i;break e}i=i.return}throw Error(J(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(Ts(n,""),r.flags&=-33);var s=Lh(e);Pu(e,s,n);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Lh(e);wu(e,a,o);break;default:throw Error(J(161))}}catch(l){Je(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Pk(e,t,i){oe=e,Ov(e)}function Ov(e,t,i){for(var r=(e.mode&1)!==0;oe!==null;){var n=oe,s=n.child;if(n.tag===22&&r){var o=n.memoizedState!==null||ko;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||wt;a=ko;var u=wt;if(ko=o,(wt=l)&&!u)for(oe=n;oe!==null;)o=oe,l=o.child,o.tag===22&&o.memoizedState!==null?xh(n):l!==null?(l.return=o,oe=l):xh(n);for(;s!==null;)oe=s,Ov(s),s=s.sibling;oe=n,ko=a,wt=u}Mh(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,oe=s):Mh(e)}}function Mh(e){for(;oe!==null;){var t=oe;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:wt||Fa(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!wt)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:di(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&mh(t,s,r);break;case 3:var o=t.updateQueue;if(o!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}mh(t,o,i)}break;case 5:var a=t.stateNode;if(i===null&&t.flags&4){i=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&ws(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}wt||t.flags&512&&Eu(t)}catch(p){Je(t,t.return,p)}}if(t===e){oe=null;break}if(i=t.sibling,i!==null){i.return=t.return,oe=i;break}oe=t.return}}function Oh(e){for(;oe!==null;){var t=oe;if(t===e){oe=null;break}var i=t.sibling;if(i!==null){i.return=t.return,oe=i;break}oe=t.return}}function xh(e){for(;oe!==null;){var t=oe;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{Fa(4,t)}catch(l){Je(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){Je(t,n,l)}}var s=t.return;try{Eu(t)}catch(l){Je(t,s,l)}break;case 5:var o=t.return;try{Eu(t)}catch(l){Je(t,o,l)}}}catch(l){Je(t,t.return,l)}if(t===e){oe=null;break}var a=t.sibling;if(a!==null){a.return=t.return,oe=a;break}oe=t.return}}var Rk=Math.ceil,fa=Ji.ReactCurrentDispatcher,$c=Ji.ReactCurrentOwner,ri=Ji.ReactCurrentBatchConfig,Pe=0,lt=null,tt=null,yt=0,zt=0,pn=Tr(0),st=0,Ns=null,Vr=0,$a=0,Bc=0,ys=null,Nt=null,jc=0,Mn=1/0,Ni=null,va=!1,Ru=null,fr=null,To=!1,lr=null,ma=0,Ss=0,Au=null,Uo=-1,Fo=0;function Lt(){return Pe&6?Ye():Uo!==-1?Uo:Uo=Ye()}function vr(e){return e.mode&1?Pe&2&&yt!==0?yt&-yt:ck.transition!==null?(Fo===0&&(Fo=gf()),Fo):(e=Ie,e!==0||(e=window.event,e=e===void 0?16:Ef(e.type)),e):1}function Si(e,t,i,r){if(50<Ss)throw Ss=0,Au=null,Error(J(185));zs(e,i,r),(!(Pe&2)||e!==lt)&&(e===lt&&(!(Pe&2)&&($a|=i),st===4&&or(e,yt)),Bt(e,r),i===1&&Pe===0&&!(t.mode&1)&&(Mn=Ye()+500,xa&&br()))}function Bt(e,t){var i=e.callbackNode;cS(e,t);var r=Zo(e,e===lt?yt:0);if(r===0)i!==null&&Vd(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&Vd(i),t===1)e.tag===0?uk(Nh.bind(null,e)):zf(Nh.bind(null,e)),sk(function(){!(Pe&6)&&br()}),i=null;else{switch(yf(r)){case 1:i=pc;break;case 4:i=vf;break;case 16:i=Xo;break;case 536870912:i=mf;break;default:i=Xo}i=Gv(i,xv.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function xv(e,t){if(Uo=-1,Fo=0,Pe&6)throw Error(J(327));var i=e.callbackNode;if(kn()&&e.callbackNode!==i)return null;var r=Zo(e,e===lt?yt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ga(e,r);else{t=r;var n=Pe;Pe|=2;var s=Uv();(lt!==e||yt!==t)&&(Ni=null,Mn=Ye()+500,Fr(e,t));do try{Ik();break}catch(a){Nv(e,a)}while(!0);Pc(),fa.current=s,Pe=n,tt!==null?t=0:(lt=null,yt=0,t=st)}if(t!==0){if(t===2&&(n=tu(e),n!==0&&(r=n,t=_u(e,n))),t===1)throw i=Ns,Fr(e,0),or(e,r),Bt(e,Ye()),i;if(t===6)or(e,r);else{if(n=e.current.alternate,!(r&30)&&!Ak(n)&&(t=ga(e,r),t===2&&(s=tu(e),s!==0&&(r=s,t=_u(e,s))),t===1))throw i=Ns,Fr(e,0),or(e,r),Bt(e,Ye()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:Dr(e,Nt,Ni);break;case 3:if(or(e,r),(r&130023424)===r&&(t=jc+500-Ye(),10<t)){if(Zo(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){Lt(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=uu(Dr.bind(null,e,Nt,Ni),t);break}Dr(e,Nt,Ni);break;case 4:if(or(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var o=31-yi(r);s=1<<o,o=t[o],o>n&&(n=o),r&=~s}if(r=n,r=Ye()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Rk(r/1960))-r,10<r){e.timeoutHandle=uu(Dr.bind(null,e,Nt,Ni),r);break}Dr(e,Nt,Ni);break;case 5:Dr(e,Nt,Ni);break;default:throw Error(J(329))}}}return Bt(e,Ye()),e.callbackNode===i?xv.bind(null,e):null}function _u(e,t){var i=ys;return e.current.memoizedState.isDehydrated&&(Fr(e,t).flags|=256),e=ga(e,t),e!==2&&(t=Nt,Nt=i,t!==null&&Iu(t)),e}function Iu(e){Nt===null?Nt=e:Nt.push.apply(Nt,e)}function Ak(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!ki(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function or(e,t){for(t&=~Bc,t&=~$a,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-yi(t),r=1<<i;e[i]=-1,t&=~r}}function Nh(e){if(Pe&6)throw Error(J(327));kn();var t=Zo(e,0);if(!(t&1))return Bt(e,Ye()),null;var i=ga(e,t);if(e.tag!==0&&i===2){var r=tu(e);r!==0&&(t=r,i=_u(e,r))}if(i===1)throw i=Ns,Fr(e,0),or(e,t),Bt(e,Ye()),i;if(i===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Dr(e,Nt,Ni),Bt(e,Ye()),null}function Gc(e,t){var i=Pe;Pe|=1;try{return e(t)}finally{Pe=i,Pe===0&&(Mn=Ye()+500,xa&&br())}}function Wr(e){lr!==null&&lr.tag===0&&!(Pe&6)&&kn();var t=Pe;Pe|=1;var i=ri.transition,r=Ie;try{if(ri.transition=null,Ie=1,e)return e()}finally{Ie=r,ri.transition=i,Pe=t,!(Pe&6)&&br()}}function zc(){zt=pn.current,Ue(pn)}function Fr(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,nk(i)),tt!==null)for(i=tt.return;i!==null;){var r=i;switch(Cc(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&na();break;case 3:Ln(),Ue(Ft),Ue(Pt),Dc();break;case 5:Lc(r);break;case 4:Ln();break;case 13:Ue(je);break;case 19:Ue(je);break;case 10:Rc(r.type._context);break;case 22:case 23:zc()}i=i.return}if(lt=e,tt=e=mr(e.current,null),yt=zt=t,st=0,Ns=null,Bc=$a=Vr=0,Nt=ys=null,Nr!==null){for(t=0;t<Nr.length;t++)if(i=Nr[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var o=s.next;s.next=n,r.next=o}i.pending=r}Nr=null}return e}function Nv(e,t){do{var i=tt;try{if(Pc(),Oo.current=pa,ha){for(var r=Ge.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}ha=!1}if(zr=0,at=nt=Ge=null,ms=!1,Ms=0,$c.current=null,i===null||i.return===null){st=1,Ns=t,tt=null;break}e:{var s=e,o=i.return,a=i,l=t;if(t=yt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var p=c.alternate;p?(c.updateQueue=p.updateQueue,c.memoizedState=p.memoizedState,c.lanes=p.lanes):(c.updateQueue=null,c.memoizedState=null)}var S=Ch(o);if(S!==null){S.flags&=-257,Eh(S,o,a,s,t),S.mode&1&&bh(s,u,t),t=S,l=u;var k=t.updateQueue;if(k===null){var E=new Set;E.add(l),t.updateQueue=E}else k.add(l);break e}else{if(!(t&1)){bh(s,u,t),Vc();break e}l=Error(J(426))}}else if($e&&a.mode&1){var O=Ch(o);if(O!==null){!(O.flags&65536)&&(O.flags|=256),Eh(O,o,a,s,t),Ec(Dn(l,a));break e}}s=l=Dn(l,a),st!==4&&(st=2),ys===null?ys=[s]:ys.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var I=Sv(s,l,t);vh(s,I);break e;case 1:a=l;var R=s.type,A=s.stateNode;if(!(s.flags&128)&&(typeof R.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(fr===null||!fr.has(A)))){s.flags|=65536,t&=-t,s.lanes|=t;var M=kv(s,a,t);vh(s,M);break e}}s=s.return}while(s!==null)}$v(i)}catch(W){t=W,tt===i&&i!==null&&(tt=i=i.return);continue}break}while(!0)}function Uv(){var e=fa.current;return fa.current=pa,e===null?pa:e}function Vc(){(st===0||st===3||st===2)&&(st=4),lt===null||!(Vr&268435455)&&!($a&268435455)||or(lt,yt)}function ga(e,t){var i=Pe;Pe|=2;var r=Uv();(lt!==e||yt!==t)&&(Ni=null,Fr(e,t));do try{_k();break}catch(n){Nv(e,n)}while(!0);if(Pc(),Pe=i,fa.current=r,tt!==null)throw Error(J(261));return lt=null,yt=0,st}function _k(){for(;tt!==null;)Fv(tt)}function Ik(){for(;tt!==null&&!tS();)Fv(tt)}function Fv(e){var t=jv(e.alternate,e,zt);e.memoizedProps=e.pendingProps,t===null?$v(e):tt=t,$c.current=null}function $v(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=Ck(i,t),i!==null){i.flags&=32767,tt=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{st=6,tt=null;return}}else if(i=bk(i,t,zt),i!==null){tt=i;return}if(t=t.sibling,t!==null){tt=t;return}tt=t=e}while(t!==null);st===0&&(st=5)}function Dr(e,t,i){var r=Ie,n=ri.transition;try{ri.transition=null,Ie=1,Lk(e,t,i,r)}finally{ri.transition=n,Ie=r}return null}function Lk(e,t,i,r){do kn();while(lr!==null);if(Pe&6)throw Error(J(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(dS(e,s),e===lt&&(tt=lt=null,yt=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||To||(To=!0,Gv(Xo,function(){return kn(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=ri.transition,ri.transition=null;var o=Ie;Ie=1;var a=Pe;Pe|=4,$c.current=null,wk(e,i),Mv(i,e),YS(au),ea=!!ou,au=ou=null,e.current=i,Pk(i),iS(),Pe=a,Ie=o,ri.transition=s}else e.current=i;if(To&&(To=!1,lr=e,ma=n),s=e.pendingLanes,s===0&&(fr=null),sS(i.stateNode),Bt(e,Ye()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(va)throw va=!1,e=Ru,Ru=null,e;return ma&1&&e.tag!==0&&kn(),s=e.pendingLanes,s&1?e===Au?Ss++:(Ss=0,Au=e):Ss=0,br(),null}function kn(){if(lr!==null){var e=yf(ma),t=ri.transition,i=Ie;try{if(ri.transition=null,Ie=16>e?16:e,lr===null)var r=!1;else{if(e=lr,lr=null,ma=0,Pe&6)throw Error(J(331));var n=Pe;for(Pe|=4,oe=e.current;oe!==null;){var s=oe,o=s.child;if(oe.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(oe=u;oe!==null;){var c=oe;switch(c.tag){case 0:case 11:case 15:gs(8,c,s)}var h=c.child;if(h!==null)h.return=c,oe=h;else for(;oe!==null;){c=oe;var p=c.sibling,S=c.return;if(Iv(c),c===u){oe=null;break}if(p!==null){p.return=S,oe=p;break}oe=S}}}var k=s.alternate;if(k!==null){var E=k.child;if(E!==null){k.child=null;do{var O=E.sibling;E.sibling=null,E=O}while(E!==null)}}oe=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,oe=o;else e:for(;oe!==null;){if(s=oe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:gs(9,s,s.return)}var I=s.sibling;if(I!==null){I.return=s.return,oe=I;break e}oe=s.return}}var R=e.current;for(oe=R;oe!==null;){o=oe;var A=o.child;if(o.subtreeFlags&2064&&A!==null)A.return=o,oe=A;else e:for(o=R;oe!==null;){if(a=oe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Fa(9,a)}}catch(W){Je(a,a.return,W)}if(a===o){oe=null;break e}var M=a.sibling;if(M!==null){M.return=a.return,oe=M;break e}oe=a.return}}if(Pe=n,br(),Ri&&typeof Ri.onPostCommitFiberRoot=="function")try{Ri.onPostCommitFiberRoot(Ia,e)}catch{}r=!0}return r}finally{Ie=i,ri.transition=t}}return!1}function Uh(e,t,i){t=Dn(i,t),t=Sv(e,t,1),e=pr(e,t,1),t=Lt(),e!==null&&(zs(e,1,t),Bt(e,t))}function Je(e,t,i){if(e.tag===3)Uh(e,e,i);else for(;t!==null;){if(t.tag===3){Uh(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fr===null||!fr.has(r))){e=Dn(i,e),e=kv(t,e,1),t=pr(t,e,1),e=Lt(),t!==null&&(zs(t,1,e),Bt(t,e));break}}t=t.return}}function Dk(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=Lt(),e.pingedLanes|=e.suspendedLanes&i,lt===e&&(yt&i)===i&&(st===4||st===3&&(yt&130023424)===yt&&500>Ye()-jc?Fr(e,0):Bc|=i),Bt(e,t)}function Bv(e,t){t===0&&(e.mode&1?(t=co,co<<=1,!(co&130023424)&&(co=4194304)):t=1);var i=Lt();e=Wi(e,t),e!==null&&(zs(e,t,i),Bt(e,i))}function Mk(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Bv(e,i)}function Ok(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),Bv(e,i)}var jv;jv=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ft.current)Ut=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Ut=!1,Tk(e,t,i);Ut=!!(e.flags&131072)}else Ut=!1,$e&&t.flags&1048576&&Vf(t,aa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;No(e,t),e=t.pendingProps;var n=An(t,Pt.current);Sn(t,i),n=Oc(null,t,r,e,n,i);var s=xc();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,$t(r)?(s=!0,sa(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,_c(t),n.updater=Na,t.stateNode=n,n._reactInternals=t,mu(t,r,e,i),t=Su(null,t,r,!0,s,i)):(t.tag=0,$e&&s&&bc(t),It(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(No(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=Nk(r),e=di(r,e),n){case 0:t=yu(null,t,r,e,i);break e;case 1:t=Rh(null,t,r,e,i);break e;case 11:t=wh(null,t,r,e,i);break e;case 14:t=Ph(null,t,r,di(r.type,e),i);break e}throw Error(J(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:di(r,n),yu(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:di(r,n),Rh(e,t,r,n,i);case 3:e:{if(Ev(t),e===null)throw Error(J(387));r=t.pendingProps,s=t.memoizedState,n=s.element,Kf(e,t),ca(t,r,null,i);var o=t.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=Dn(Error(J(423)),t),t=Ah(e,t,r,i,n);break e}else if(r!==n){n=Dn(Error(J(424)),t),t=Ah(e,t,r,i,n);break e}else for(Vt=hr(t.stateNode.containerInfo.firstChild),Wt=t,$e=!0,pi=null,i=Xf(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(_n(),r===n){t=Hi(e,t,i);break e}It(e,t,r,i)}t=t.child}return t;case 5:return Zf(t),e===null&&pu(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,o=n.children,lu(r,n)?o=null:s!==null&&lu(r,s)&&(t.flags|=32),Cv(e,t),It(e,t,o,i),t.child;case 6:return e===null&&pu(t),null;case 13:return wv(e,t,i);case 4:return Ic(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=In(t,null,r,i):It(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:di(r,n),wh(e,t,r,n,i);case 7:return It(e,t,t.pendingProps,i),t.child;case 8:return It(e,t,t.pendingProps.children,i),t.child;case 12:return It(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,o=n.value,Me(la,r._currentValue),r._currentValue=o,s!==null)if(ki(s.value,o)){if(s.children===n.children&&!Ft.current){t=Hi(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ji(-1,i&-i),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),fu(s.return,i,t),a.lanes|=i;break}l=l.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(J(341));o.lanes|=i,a=o.alternate,a!==null&&(a.lanes|=i),fu(o,i,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}It(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,Sn(t,i),n=si(n),r=r(n),t.flags|=1,It(e,t,r,i),t.child;case 14:return r=t.type,n=di(r,t.pendingProps),n=di(r.type,n),Ph(e,t,r,n,i);case 15:return Tv(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:di(r,n),No(e,t),t.tag=1,$t(r)?(e=!0,sa(t)):e=!1,Sn(t,i),Qf(t,r,n),mu(t,r,n,i),Su(null,t,r,!0,e,i);case 19:return Pv(e,t,i);case 22:return bv(e,t,i)}throw Error(J(156,t.tag))};function Gv(e,t){return ff(e,t)}function xk(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ii(e,t,i,r){return new xk(e,t,i,r)}function Wc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Nk(e){if(typeof e=="function")return Wc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===cc)return 11;if(e===dc)return 14}return 2}function mr(e,t){var i=e.alternate;return i===null?(i=ii(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function $o(e,t,i,r,n,s){var o=2;if(r=e,typeof e=="function")Wc(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case rn:return $r(i.children,n,s,t);case uc:o=8,n|=8;break;case Bl:return e=ii(12,i,t,n|2),e.elementType=Bl,e.lanes=s,e;case jl:return e=ii(13,i,t,n),e.elementType=jl,e.lanes=s,e;case Gl:return e=ii(19,i,t,n),e.elementType=Gl,e.lanes=s,e;case Qp:return Ba(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Kp:o=10;break e;case Jp:o=9;break e;case cc:o=11;break e;case dc:o=14;break e;case rr:o=16,r=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return t=ii(o,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function $r(e,t,i,r){return e=ii(7,e,r,t),e.lanes=i,e}function Ba(e,t,i,r){return e=ii(22,e,r,t),e.elementType=Qp,e.lanes=i,e.stateNode={isHidden:!1},e}function Pl(e,t,i){return e=ii(6,e,null,t),e.lanes=i,e}function Rl(e,t,i){return t=ii(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uk(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=al(0),this.expirationTimes=al(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=al(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Hc(e,t,i,r,n,s,o,a,l){return e=new Uk(e,t,i,a,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=ii(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},_c(s),e}function Fk(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tn,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function zv(e){if(!e)return yr;e=e._reactInternals;e:{if(Kr(e)!==e||e.tag!==1)throw Error(J(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if($t(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(J(171))}if(e.tag===1){var i=e.type;if($t(i))return Gf(e,i,t)}return t}function Vv(e,t,i,r,n,s,o,a,l){return e=Hc(i,r,!0,e,n,s,o,a,l),e.context=zv(null),i=e.current,r=Lt(),n=vr(i),s=ji(r,n),s.callback=t??null,pr(i,s,n),e.current.lanes=n,zs(e,n,r),Bt(e,r),e}function ja(e,t,i,r){var n=t.current,s=Lt(),o=vr(n);return i=zv(i),t.context===null?t.context=i:t.pendingContext=i,t=ji(s,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=pr(n,t,o),e!==null&&(Si(e,n,o,s),Mo(e,n,o)),o}function ya(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Fh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function qc(e,t){Fh(e,t),(e=e.alternate)&&Fh(e,t)}function $k(){return null}var Wv=typeof reportError=="function"?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}Ga.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(J(409));ja(e,t,null,null)};Ga.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Wr(function(){ja(null,e,null,null)}),t[Vi]=null}};function Ga(e){this._internalRoot=e}Ga.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tf();e={blockedOn:null,target:e,priority:t};for(var i=0;i<sr.length&&t!==0&&t<sr[i].priority;i++);sr.splice(i,0,e),i===0&&Cf(e)}};function Jc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function za(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function $h(){}function Bk(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var u=ya(o);s.call(u)}}var o=Vv(t,r,e,0,null,!1,!1,"",$h);return e._reactRootContainer=o,e[Vi]=o.current,As(e.nodeType===8?e.parentNode:e),Wr(),o}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var a=r;r=function(){var u=ya(l);a.call(u)}}var l=Hc(e,0,!1,null,null,!1,!1,"",$h);return e._reactRootContainer=l,e[Vi]=l.current,As(e.nodeType===8?e.parentNode:e),Wr(function(){ja(t,l,i,r)}),l}function Va(e,t,i,r,n){var s=i._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=ya(o);a.call(l)}}ja(t,o,e,n)}else o=Bk(i,t,e,n,r);return ya(o)}Sf=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ls(t.pendingLanes);i!==0&&(fc(t,i|1),Bt(t,Ye()),!(Pe&6)&&(Mn=Ye()+500,br()))}break;case 13:Wr(function(){var r=Wi(e,1);if(r!==null){var n=Lt();Si(r,e,1,n)}}),qc(e,1)}};vc=function(e){if(e.tag===13){var t=Wi(e,134217728);if(t!==null){var i=Lt();Si(t,e,134217728,i)}qc(e,134217728)}};kf=function(e){if(e.tag===13){var t=vr(e),i=Wi(e,t);if(i!==null){var r=Lt();Si(i,e,t,r)}qc(e,t)}};Tf=function(){return Ie};bf=function(e,t){var i=Ie;try{return Ie=e,t()}finally{Ie=i}};Xl=function(e,t,i){switch(t){case"input":if(Wl(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=Oa(r);if(!n)throw Error(J(90));Xp(r),Wl(r,n)}}}break;case"textarea":ef(e,i);break;case"select":t=i.value,t!=null&&vn(e,!!i.multiple,t,!1)}};lf=Gc;uf=Wr;var jk={usingClientEntryPoint:!1,Events:[Ws,an,Oa,of,af,Gc]},ts={findFiberByHostInstance:xr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Gk={bundleType:ts.bundleType,version:ts.version,rendererPackageName:ts.rendererPackageName,rendererConfig:ts.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ji.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=hf(e),e===null?null:e.stateNode},findFiberByHostInstance:ts.findFiberByHostInstance||$k,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bo.isDisabled&&bo.supportsFiber)try{Ia=bo.inject(Gk),Ri=bo}catch{}}Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jk;Jt.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jc(t))throw Error(J(200));return Fk(e,t,null,i)};Jt.createRoot=function(e,t){if(!Jc(e))throw Error(J(299));var i=!1,r="",n=Wv;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=Hc(e,1,!1,null,null,i,!1,r,n),e[Vi]=t.current,As(e.nodeType===8?e.parentNode:e),new Kc(t)};Jt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=hf(t),e=e===null?null:e.stateNode,e};Jt.flushSync=function(e){return Wr(e)};Jt.hydrate=function(e,t,i){if(!za(t))throw Error(J(200));return Va(null,e,t,!0,i)};Jt.hydrateRoot=function(e,t,i){if(!Jc(e))throw Error(J(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",o=Wv;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(o=i.onRecoverableError)),t=Vv(t,null,e,1,i??null,n,!1,s,o),e[Vi]=t.current,As(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new Ga(t)};Jt.render=function(e,t,i){if(!za(t))throw Error(J(200));return Va(null,e,t,!1,i)};Jt.unmountComponentAtNode=function(e){if(!za(e))throw Error(J(40));return e._reactRootContainer?(Wr(function(){Va(null,null,e,!1,function(){e._reactRootContainer=null,e[Vi]=null})}),!0):!1};Jt.unstable_batchedUpdates=Gc;Jt.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!za(i))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return Va(e,t,i,!1,r)};Jt.version="18.2.0-next-9e3b772b8-20220608";function Hv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Hv)}catch(e){console.error(e)}}Hv(),zp.exports=Jt;var zk=zp.exports,Bh=zk;Fl.createRoot=Bh.createRoot,Fl.hydrateRoot=Bh.hydrateRoot;function Vk(e){let t;const i=new Set,r=(u,c)=>{const h=typeof u=="function"?u(t):u;if(h!==t){const p=t;t=c?h:Object.assign({},t,h),i.forEach(S=>S(t,p))}},n=()=>t,s=(u,c=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let p=c(t);function S(){const k=c(t);if(!h(p,k)){const E=p;u(p=k,E)}}return i.add(S),()=>i.delete(S)},l={setState:r,getState:n,subscribe:(u,c,h)=>c||h?s(u,c,h):(i.add(u),()=>i.delete(u)),destroy:()=>i.clear()};return t=e(r,n,l),l}const Wk=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),jh=Wk?Re.useEffect:Re.useLayoutEffect;function Co(e){const t=typeof e=="function"?Vk(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=Re.useReducer(O=>O+1,0),o=t.getState(),a=Re.useRef(o),l=Re.useRef(r),u=Re.useRef(n),c=Re.useRef(!1),h=Re.useRef();h.current===void 0&&(h.current=r(o));let p,S=!1;(a.current!==o||l.current!==r||u.current!==n||c.current)&&(p=r(o),S=!n(h.current,p)),jh(()=>{S&&(h.current=p),a.current=o,l.current=r,u.current=n,c.current=!1});const k=Re.useRef(o);jh(()=>{const O=()=>{try{const R=t.getState(),A=l.current(R);u.current(h.current,A)||(a.current=R,h.current=A,s())}catch{c.current=!0,s()}},I=t.subscribe(O);return t.getState()!==k.current&&O(),I},[]);const E=S?p:h.current;return Re.useDebugValue(E),E};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}function Hk(e,t){return e===t}function qk(e,t,i){if(t===null||i===null||t.length!==i.length)return!1;for(var r=t.length,n=0;n<r;n++)if(!e(t[n],i[n]))return!1;return!0}function Kk(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hk,i=null,r=null;return function(){return qk(t,i,arguments)||(r=e.apply(null,arguments)),i=arguments,r}}function Jk(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(r){return typeof r=="function"})){var i=t.map(function(r){return typeof r}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, "+("instead received the following types: ["+i+"]"))}return t}function Qk(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return function(){for(var n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];var a=0,l=s.pop(),u=Jk(s),c=e.apply(void 0,[function(){return a++,l.apply(null,arguments)}].concat(i)),h=e(function(){for(var p=[],S=u.length,k=0;k<S;k++)p.push(u[k].apply(null,arguments));return c.apply(null,p)});return h.resultFunc=l,h.dependencies=u,h.recomputations=function(){return a},h.resetRecomputations=function(){return a=0},h}}var K=Qk(Kk),Lu={exports:{}};(function(e,t){(function(i,r){var n="1.0.37",s="",o="?",a="function",l="undefined",u="object",c="string",h="major",p="model",S="name",k="type",E="vendor",O="version",I="architecture",R="console",A="mobile",M="tablet",W="smarttv",Z="wearable",X="embedded",ee=500,ce="Amazon",pe="Apple",Oe="ASUS",Ve="BlackBerry",We="Browser",He="Chrome",ve="Edge",At="Firefox",ut="Google",g="Huawei",b="LG",v="Microsoft",d="Motorola",m="Opera",C="Samsung",_="Sharp",P="Sony",L="Xiaomi",w="Zebra",N="Facebook",Q="Chromium OS",F="Mac OS",j=function(te,me){var ne={};for(var Ce in te)me[Ce]&&me[Ce].length%2===0?ne[Ce]=me[Ce].concat(te[Ce]):ne[Ce]=te[Ce];return ne},$=function(te){for(var me={},ne=0;ne<te.length;ne++)me[te[ne].toUpperCase()]=te[ne];return me},q=function(te,me){return typeof te===c?V(me).indexOf(V(te))!==-1:!1},V=function(te){return te.toLowerCase()},de=function(te){return typeof te===c?te.replace(/[^\d\.]/g,s).split(".")[0]:r},fe=function(te,me){if(typeof te===c)return te=te.replace(/^\s\s*/,s),typeof me===l?te:te.substring(0,ee)},U=function(te,me){for(var ne=0,Ce,Ae,Le,ye,le,Qe;ne<me.length&&!le;){var ct=me[ne],dt=me[ne+1];for(Ce=Ae=0;Ce<ct.length&&!le&&ct[Ce];)if(le=ct[Ce++].exec(te),le)for(Le=0;Le<dt.length;Le++)Qe=le[++Ae],ye=dt[Le],typeof ye===u&&ye.length>0?ye.length===2?typeof ye[1]==a?this[ye[0]]=ye[1].call(this,Qe):this[ye[0]]=ye[1]:ye.length===3?typeof ye[1]===a&&!(ye[1].exec&&ye[1].test)?this[ye[0]]=Qe?ye[1].call(this,Qe,ye[2]):r:this[ye[0]]=Qe?Qe.replace(ye[1],ye[2]):r:ye.length===4&&(this[ye[0]]=Qe?ye[3].call(this,Qe.replace(ye[1],ye[2])):r):this[ye]=Qe||r;ne+=2}},Y=function(te,me){for(var ne in me)if(typeof me[ne]===u&&me[ne].length>0){for(var Ce=0;Ce<me[ne].length;Ce++)if(q(me[ne][Ce],te))return ne===o?r:ne}else if(q(me[ne],te))return ne===o?r:ne;return te},re={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},x={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[O,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[O,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,O],[/opios[\/ ]+([\w\.]+)/i],[O,[S,m+" Mini"]],[/\bopr\/([\w\.]+)/i],[O,[S,m]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[O,[S,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[S,O],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[O,[S,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[O,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[O,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[O,[S,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[O,[S,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[O,[S,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+We],O],[/\bfocus\/([\w\.]+)/i],[O,[S,At+" Focus"]],[/\bopt\/([\w\.]+)/i],[O,[S,m+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[O,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[O,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[O,[S,m+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[O,[S,"MIUI "+We]],[/fxios\/([-\w\.]+)/i],[O,[S,At]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+We]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+We],O],[/samsungbrowser\/([\w\.]+)/i],[O,[S,C+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],O],[/metasr[\/ ]?([\d\.]+)/i],[O,[S,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[S,"Sogou Mobile"],O],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[S,O],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,N],O],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[S,O],[/\bgsa\/([\w\.]+) .*safari\//i],[O,[S,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[O,[S,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[O,[S,He+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,He+" WebView"],O],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[O,[S,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,O],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[O,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[O,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[O,Y,re]],[/(webkit|khtml)\/([\w\.]+)/i],[S,O],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],O],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[O,[S,At+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,O],[/(cobalt)\/([\w\.]+)/i],[S,[O,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,V]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,s,V]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[E,C],[k,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[E,C],[k,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[E,pe],[k,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[E,pe],[k,M]],[/(macintosh);/i],[p,[E,pe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[E,_],[k,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[E,g],[k,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[E,g],[k,A]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[E,L],[k,A]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[E,L],[k,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[E,"OPPO"],[k,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[E,"Vivo"],[k,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[p,[E,"Realme"],[k,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[E,d],[k,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[E,d],[k,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[E,b],[k,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[E,b],[k,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[E,"Lenovo"],[k,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[E,"Nokia"],[k,A]],[/(pixel c)\b/i],[p,[E,ut],[k,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[E,ut],[k,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[E,P],[k,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[E,P],[k,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[E,"OnePlus"],[k,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[E,ce],[k,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[E,ce],[k,A]],[/(playbook);[-\w\),; ]+(rim)/i],[p,E,[k,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[E,Ve],[k,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[E,Oe],[k,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[E,Oe],[k,A]],[/(nexus 9)/i],[p,[E,"HTC"],[k,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[p,/_/g," "],[k,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[E,"Acer"],[k,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[E,"Meizu"],[k,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[p,[E,"Ulefone"],[k,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,p,[k,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,p,[k,M]],[/(surface duo)/i],[p,[E,v],[k,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[E,"Fairphone"],[k,A]],[/(u304aa)/i],[p,[E,"AT&T"],[k,A]],[/\bsie-(\w*)/i],[p,[E,"Siemens"],[k,A]],[/\b(rct\w+) b/i],[p,[E,"RCA"],[k,M]],[/\b(venue[\d ]{2,7}) b/i],[p,[E,"Dell"],[k,M]],[/\b(q(?:mv|ta)\w+) b/i],[p,[E,"Verizon"],[k,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[E,"Barnes & Noble"],[k,M]],[/\b(tm\d{3}\w+) b/i],[p,[E,"NuVision"],[k,M]],[/\b(k88) b/i],[p,[E,"ZTE"],[k,M]],[/\b(nx\d{3}j) b/i],[p,[E,"ZTE"],[k,A]],[/\b(gen\d{3}) b.+49h/i],[p,[E,"Swiss"],[k,A]],[/\b(zur\d{3}) b/i],[p,[E,"Swiss"],[k,M]],[/\b((zeki)?tb.*\b) b/i],[p,[E,"Zeki"],[k,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],p,[k,M]],[/\b(ns-?\w{0,9}) b/i],[p,[E,"Insignia"],[k,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[E,"NextBook"],[k,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],p,[k,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],p,[k,A]],[/\b(ph-1) /i],[p,[E,"Essential"],[k,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[E,"Envizen"],[k,M]],[/\b(trio[-\w\. ]+) b/i],[p,[E,"MachSpeed"],[k,M]],[/\btu_(1491) b/i],[p,[E,"Rotor"],[k,M]],[/(shield[\w ]+) b/i],[p,[E,"Nvidia"],[k,M]],[/(sprint) (\w+)/i],[E,p,[k,A]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[E,v],[k,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[E,w],[k,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[E,w],[k,A]],[/smart-tv.+(samsung)/i],[E,[k,W]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[E,C],[k,W]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,b],[k,W]],[/(apple) ?tv/i],[E,[p,pe+" TV"],[k,W]],[/crkey/i],[[p,He+"cast"],[E,ut],[k,W]],[/droid.+aft(\w+)( bui|\))/i],[p,[E,ce],[k,W]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[E,_],[k,W]],[/(bravia[\w ]+)( bui|\))/i],[p,[E,P],[k,W]],[/(mitv-\w{5}) bui/i],[p,[E,L],[k,W]],[/Hbbtv.*(technisat) (.*);/i],[E,p,[k,W]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,fe],[p,fe],[k,W]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[k,W]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,p,[k,R]],[/droid.+; (shield) bui/i],[p,[E,"Nvidia"],[k,R]],[/(playstation [345portablevi]+)/i],[p,[E,P],[k,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[E,v],[k,R]],[/((pebble))app/i],[E,p,[k,Z]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[E,pe],[k,Z]],[/droid.+; (glass) \d/i],[p,[E,ut],[k,Z]],[/droid.+; (wt63?0{2,3})\)/i],[p,[E,w],[k,Z]],[/(quest( 2| pro)?)/i],[p,[E,N],[k,Z]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[k,X]],[/(aeobc)\b/i],[p,[E,ce],[k,X]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[p,[k,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[k,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[k,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[k,A]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[O,[S,ve+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[O,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[S,O],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[O,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,O],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[S,[O,Y,x]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[O,Y,x],[S,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[O,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,F],[O,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[O,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,O],[/\(bb(10);/i],[O,[S,Ve]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[O,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[O,[S,At+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[O,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[O,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[O,[S,He+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Q],O],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,O],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],O],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[S,O]]},ie=function(te,me){if(typeof te===u&&(me=te,te=r),!(this instanceof ie))return new ie(te,me).getResult();var ne=typeof i!==l&&i.navigator?i.navigator:r,Ce=te||(ne&&ne.userAgent?ne.userAgent:s),Ae=ne&&ne.userAgentData?ne.userAgentData:r,Le=me?j(z,me):z,ye=ne&&ne.userAgent==Ce;return this.getBrowser=function(){var le={};return le[S]=r,le[O]=r,U.call(le,Ce,Le.browser),le[h]=de(le[O]),ye&&ne&&ne.brave&&typeof ne.brave.isBrave==a&&(le[S]="Brave"),le},this.getCPU=function(){var le={};return le[I]=r,U.call(le,Ce,Le.cpu),le},this.getDevice=function(){var le={};return le[E]=r,le[p]=r,le[k]=r,U.call(le,Ce,Le.device),ye&&!le[k]&&Ae&&Ae.mobile&&(le[k]=A),ye&&le[p]=="Macintosh"&&ne&&typeof ne.standalone!==l&&ne.maxTouchPoints&&ne.maxTouchPoints>2&&(le[p]="iPad",le[k]=M),le},this.getEngine=function(){var le={};return le[S]=r,le[O]=r,U.call(le,Ce,Le.engine),le},this.getOS=function(){var le={};return le[S]=r,le[O]=r,U.call(le,Ce,Le.os),ye&&!le[S]&&Ae&&Ae.platform!="Unknown"&&(le[S]=Ae.platform.replace(/chrome os/i,Q).replace(/macos/i,F)),le},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ce},this.setUA=function(le){return Ce=typeof le===c&&le.length>ee?fe(le,ee):le,this},this.setUA(Ce),this};ie.VERSION=n,ie.BROWSER=$([S,O,h]),ie.CPU=$([I]),ie.DEVICE=$([p,E,k,R,A,W,M,Z,X]),ie.ENGINE=ie.OS=$([S,O]),e.exports&&(t=e.exports=ie),t.UAParser=ie;var ae=typeof i!==l&&(i.jQuery||i.Zepto);if(ae&&!ae.ua){var be=new ie;ae.ua=be.getResult(),ae.ua.get=function(){return be.getUA()},ae.ua.set=function(te){be.setUA(te);var me=be.getResult();for(var ne in me)ae.ua[ne]=me[ne]}}})(typeof window=="object"?window:_e)})(Lu,Lu.exports);var Yk=Lu.exports,Sa={exports:{}};Sa.exports;(function(e,t){var i=200,r="__lodash_hash_undefined__",n=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",c="[object Boolean]",h="[object Date]",p="[object Error]",S="[object Function]",k="[object GeneratorFunction]",E="[object Map]",O="[object Number]",I="[object Null]",R="[object Object]",A="[object Promise]",M="[object Proxy]",W="[object RegExp]",Z="[object Set]",X="[object String]",ee="[object Symbol]",ce="[object Undefined]",pe="[object WeakMap]",Oe="[object ArrayBuffer]",Ve="[object DataView]",We="[object Float32Array]",He="[object Float64Array]",ve="[object Int8Array]",At="[object Int16Array]",ut="[object Int32Array]",g="[object Uint8Array]",b="[object Uint8ClampedArray]",v="[object Uint16Array]",d="[object Uint32Array]",m=/[\\^$.*+?()[\]{}|]/g,C=/^\[object .+?Constructor\]$/,_=/^(?:0|[1-9]\d*)$/,P={};P[We]=P[He]=P[ve]=P[At]=P[ut]=P[g]=P[b]=P[v]=P[d]=!0,P[a]=P[l]=P[Oe]=P[c]=P[Ve]=P[h]=P[p]=P[S]=P[E]=P[O]=P[R]=P[W]=P[Z]=P[X]=P[pe]=!1;var L=typeof _e=="object"&&_e&&_e.Object===Object&&_e,w=typeof self=="object"&&self&&self.Object===Object&&self,N=L||w||Function("return this")(),Q=t&&!t.nodeType&&t,F=Q&&!0&&e&&!e.nodeType&&e,j=F&&F.exports===Q,$=j&&L.process,q=function(){try{return $&&$.binding&&$.binding("util")}catch{}}(),V=q&&q.isTypedArray;function de(T,D){for(var B=-1,se=T==null?0:T.length,xe=0,Te=[];++B<se;){var qe=T[B];D(qe,B,T)&&(Te[xe++]=qe)}return Te}function fe(T,D){for(var B=-1,se=D.length,xe=T.length;++B<se;)T[xe+B]=D[B];return T}function U(T,D){for(var B=-1,se=T==null?0:T.length;++B<se;)if(D(T[B],B,T))return!0;return!1}function Y(T,D){for(var B=-1,se=Array(T);++B<T;)se[B]=D(B);return se}function re(T){return function(D){return T(D)}}function x(T,D){return T.has(D)}function z(T,D){return T==null?void 0:T[D]}function ie(T){var D=-1,B=Array(T.size);return T.forEach(function(se,xe){B[++D]=[xe,se]}),B}function ae(T,D){return function(B){return T(D(B))}}function be(T){var D=-1,B=Array(T.size);return T.forEach(function(se){B[++D]=se}),B}var te=Array.prototype,me=Function.prototype,ne=Object.prototype,Ce=N["__core-js_shared__"],Ae=me.toString,Le=ne.hasOwnProperty,ye=function(){var T=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),le=ne.toString,Qe=RegExp("^"+Ae.call(Le).replace(m,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ct=j?N.Buffer:void 0,dt=N.Symbol,Tt=N.Uint8Array,bi=ne.propertyIsEnumerable,Gn=te.splice,li=dt?dt.toStringTag:void 0,Ys=Object.getOwnPropertySymbols,Yr=ct?ct.isBuffer:void 0,Xr=ae(Object.keys,Object),Qi=Zr(N,"DataView"),Pr=Zr(N,"Map"),Rr=Zr(N,"Promise"),Ze=Zr(N,"Set"),zn=Zr(N,"WeakMap"),Yi=Zr(Object,"create"),Xa=_r(Qi),Vn=_r(Pr),et=_r(Rr),Yt=_r(Ze),Ot=_r(zn),_t=dt?dt.prototype:void 0,it=_t?_t.valueOf:void 0;function ht(T){var D=-1,B=T==null?0:T.length;for(this.clear();++D<B;){var se=T[D];this.set(se[0],se[1])}}function Ii(){this.__data__=Yi?Yi(null):{},this.size=0}function Wn(T){var D=this.has(T)&&delete this.__data__[T];return this.size-=D?1:0,D}function Xs(T){var D=this.__data__;if(Yi){var B=D[T];return B===r?void 0:B}return Le.call(D,T)?D[T]:void 0}function Za(T){var D=this.__data__;return Yi?D[T]!==void 0:Le.call(D,T)}function el(T,D){var B=this.__data__;return this.size+=this.has(T)?0:1,B[T]=Yi&&D===void 0?r:D,this}ht.prototype.clear=Ii,ht.prototype.delete=Wn,ht.prototype.get=Xs,ht.prototype.has=Za,ht.prototype.set=el;function Li(T){var D=-1,B=T==null?0:T.length;for(this.clear();++D<B;){var se=T[D];this.set(se[0],se[1])}}function Og(){this.__data__=[],this.size=0}function xg(T){var D=this.__data__,B=eo(D,T);if(B<0)return!1;var se=D.length-1;return B==se?D.pop():Gn.call(D,B,1),--this.size,!0}function Ng(T){var D=this.__data__,B=eo(D,T);return B<0?void 0:D[B][1]}function Ug(T){return eo(this.__data__,T)>-1}function Fg(T,D){var B=this.__data__,se=eo(B,T);return se<0?(++this.size,B.push([T,D])):B[se][1]=D,this}Li.prototype.clear=Og,Li.prototype.delete=xg,Li.prototype.get=Ng,Li.prototype.has=Ug,Li.prototype.set=Fg;function Ar(T){var D=-1,B=T==null?0:T.length;for(this.clear();++D<B;){var se=T[D];this.set(se[0],se[1])}}function $g(){this.size=0,this.__data__={hash:new ht,map:new(Pr||Li),string:new ht}}function Bg(T){var D=to(this,T).delete(T);return this.size-=D?1:0,D}function jg(T){return to(this,T).get(T)}function Gg(T){return to(this,T).has(T)}function zg(T,D){var B=to(this,T),se=B.size;return B.set(T,D),this.size+=B.size==se?0:1,this}Ar.prototype.clear=$g,Ar.prototype.delete=Bg,Ar.prototype.get=jg,Ar.prototype.has=Gg,Ar.prototype.set=zg;function Zs(T){var D=-1,B=T==null?0:T.length;for(this.__data__=new Ar;++D<B;)this.add(T[D])}function Vg(T){return this.__data__.set(T,r),this}function Wg(T){return this.__data__.has(T)}Zs.prototype.add=Zs.prototype.push=Vg,Zs.prototype.has=Wg;function Xi(T){var D=this.__data__=new Li(T);this.size=D.size}function Hg(){this.__data__=new Li,this.size=0}function qg(T){var D=this.__data__,B=D.delete(T);return this.size=D.size,B}function Kg(T){return this.__data__.get(T)}function Jg(T){return this.__data__.has(T)}function Qg(T,D){var B=this.__data__;if(B instanceof Li){var se=B.__data__;if(!Pr||se.length<i-1)return se.push([T,D]),this.size=++B.size,this;B=this.__data__=new Ar(se)}return B.set(T,D),this.size=B.size,this}Xi.prototype.clear=Hg,Xi.prototype.delete=qg,Xi.prototype.get=Kg,Xi.prototype.has=Jg,Xi.prototype.set=Qg;function Yg(T,D){var B=io(T),se=!B&&hy(T),xe=!B&&!se&&tl(T),Te=!B&&!se&&!xe&&Id(T),qe=B||se||xe||Te,ot=qe?Y(T.length,String):[],pt=ot.length;for(var Be in T)(D||Le.call(T,Be))&&!(qe&&(Be=="length"||xe&&(Be=="offset"||Be=="parent")||Te&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||ay(Be,pt)))&&ot.push(Be);return ot}function eo(T,D){for(var B=T.length;B--;)if(Pd(T[B][0],D))return B;return-1}function Xg(T,D,B){var se=D(T);return io(T)?se:fe(se,B(T))}function Hn(T){return T==null?T===void 0?ce:I:li&&li in Object(T)?sy(T):dy(T)}function bd(T){return qn(T)&&Hn(T)==a}function Cd(T,D,B,se,xe){return T===D?!0:T==null||D==null||!qn(T)&&!qn(D)?T!==T&&D!==D:Zg(T,D,B,se,Cd,xe)}function Zg(T,D,B,se,xe,Te){var qe=io(T),ot=io(D),pt=qe?l:Zi(T),Be=ot?l:Zi(D);pt=pt==a?R:pt,Be=Be==a?R:Be;var Gt=pt==R,ui=Be==R,bt=pt==Be;if(bt&&tl(T)){if(!tl(D))return!1;qe=!0,Gt=!1}if(bt&&!Gt)return Te||(Te=new Xi),qe||Id(T)?Ed(T,D,B,se,xe,Te):ry(T,D,pt,B,se,xe,Te);if(!(B&n)){var Xt=Gt&&Le.call(T,"__wrapped__"),Zt=ui&&Le.call(D,"__wrapped__");if(Xt||Zt){var er=Xt?T.value():T,Di=Zt?D.value():D;return Te||(Te=new Xi),xe(er,Di,B,se,Te)}}return bt?(Te||(Te=new Xi),ny(T,D,B,se,xe,Te)):!1}function ey(T){if(!_d(T)||uy(T))return!1;var D=Rd(T)?Qe:C;return D.test(_r(T))}function ty(T){return qn(T)&&Ad(T.length)&&!!P[Hn(T)]}function iy(T){if(!cy(T))return Xr(T);var D=[];for(var B in Object(T))Le.call(T,B)&&B!="constructor"&&D.push(B);return D}function Ed(T,D,B,se,xe,Te){var qe=B&n,ot=T.length,pt=D.length;if(ot!=pt&&!(qe&&pt>ot))return!1;var Be=Te.get(T);if(Be&&Te.get(D))return Be==D;var Gt=-1,ui=!0,bt=B&s?new Zs:void 0;for(Te.set(T,D),Te.set(D,T);++Gt<ot;){var Xt=T[Gt],Zt=D[Gt];if(se)var er=qe?se(Zt,Xt,Gt,D,T,Te):se(Xt,Zt,Gt,T,D,Te);if(er!==void 0){if(er)continue;ui=!1;break}if(bt){if(!U(D,function(Di,Ir){if(!x(bt,Ir)&&(Xt===Di||xe(Xt,Di,B,se,Te)))return bt.push(Ir)})){ui=!1;break}}else if(!(Xt===Zt||xe(Xt,Zt,B,se,Te))){ui=!1;break}}return Te.delete(T),Te.delete(D),ui}function ry(T,D,B,se,xe,Te,qe){switch(B){case Ve:if(T.byteLength!=D.byteLength||T.byteOffset!=D.byteOffset)return!1;T=T.buffer,D=D.buffer;case Oe:return!(T.byteLength!=D.byteLength||!Te(new Tt(T),new Tt(D)));case c:case h:case O:return Pd(+T,+D);case p:return T.name==D.name&&T.message==D.message;case W:case X:return T==D+"";case E:var ot=ie;case Z:var pt=se&n;if(ot||(ot=be),T.size!=D.size&&!pt)return!1;var Be=qe.get(T);if(Be)return Be==D;se|=s,qe.set(T,D);var Gt=Ed(ot(T),ot(D),se,xe,Te,qe);return qe.delete(T),Gt;case ee:if(it)return it.call(T)==it.call(D)}return!1}function ny(T,D,B,se,xe,Te){var qe=B&n,ot=wd(T),pt=ot.length,Be=wd(D),Gt=Be.length;if(pt!=Gt&&!qe)return!1;for(var ui=pt;ui--;){var bt=ot[ui];if(!(qe?bt in D:Le.call(D,bt)))return!1}var Xt=Te.get(T);if(Xt&&Te.get(D))return Xt==D;var Zt=!0;Te.set(T,D),Te.set(D,T);for(var er=qe;++ui<pt;){bt=ot[ui];var Di=T[bt],Ir=D[bt];if(se)var Ld=qe?se(Ir,Di,bt,D,T,Te):se(Di,Ir,bt,T,D,Te);if(!(Ld===void 0?Di===Ir||xe(Di,Ir,B,se,Te):Ld)){Zt=!1;break}er||(er=bt=="constructor")}if(Zt&&!er){var ro=T.constructor,no=D.constructor;ro!=no&&"constructor"in T&&"constructor"in D&&!(typeof ro=="function"&&ro instanceof ro&&typeof no=="function"&&no instanceof no)&&(Zt=!1)}return Te.delete(T),Te.delete(D),Zt}function wd(T){return Xg(T,vy,oy)}function to(T,D){var B=T.__data__;return ly(D)?B[typeof D=="string"?"string":"hash"]:B.map}function Zr(T,D){var B=z(T,D);return ey(B)?B:void 0}function sy(T){var D=Le.call(T,li),B=T[li];try{T[li]=void 0;var se=!0}catch{}var xe=le.call(T);return se&&(D?T[li]=B:delete T[li]),xe}var oy=Ys?function(T){return T==null?[]:(T=Object(T),de(Ys(T),function(D){return bi.call(T,D)}))}:my,Zi=Hn;(Qi&&Zi(new Qi(new ArrayBuffer(1)))!=Ve||Pr&&Zi(new Pr)!=E||Rr&&Zi(Rr.resolve())!=A||Ze&&Zi(new Ze)!=Z||zn&&Zi(new zn)!=pe)&&(Zi=function(T){var D=Hn(T),B=D==R?T.constructor:void 0,se=B?_r(B):"";if(se)switch(se){case Xa:return Ve;case Vn:return E;case et:return A;case Yt:return Z;case Ot:return pe}return D});function ay(T,D){return D=D??o,!!D&&(typeof T=="number"||_.test(T))&&T>-1&&T%1==0&&T<D}function ly(T){var D=typeof T;return D=="string"||D=="number"||D=="symbol"||D=="boolean"?T!=="__proto__":T===null}function uy(T){return!!ye&&ye in T}function cy(T){var D=T&&T.constructor,B=typeof D=="function"&&D.prototype||ne;return T===B}function dy(T){return le.call(T)}function _r(T){if(T!=null){try{return Ae.call(T)}catch{}try{return T+""}catch{}}return""}function Pd(T,D){return T===D||T!==T&&D!==D}var hy=bd(function(){return arguments}())?bd:function(T){return qn(T)&&Le.call(T,"callee")&&!bi.call(T,"callee")},io=Array.isArray;function py(T){return T!=null&&Ad(T.length)&&!Rd(T)}var tl=Yr||gy;function fy(T,D){return Cd(T,D)}function Rd(T){if(!_d(T))return!1;var D=Hn(T);return D==S||D==k||D==u||D==M}function Ad(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=o}function _d(T){var D=typeof T;return T!=null&&(D=="object"||D=="function")}function qn(T){return T!=null&&typeof T=="object"}var Id=V?re(V):ty;function vy(T){return py(T)?Yg(T):iy(T)}function my(){return[]}function gy(){return!1}e.exports=fy})(Sa,Sa.exports);var Xk=Sa.exports;const qv=js(Xk);var Eo,Zk=new Uint8Array(16);function e0(){if(!Eo&&(Eo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Eo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Eo(Zk)}const t0=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function i0(e){return typeof e=="string"&&t0.test(e)}var mt=[];for(var Al=0;Al<256;++Al)mt.push((Al+256).toString(16).substr(1));function r0(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(mt[e[t+0]]+mt[e[t+1]]+mt[e[t+2]]+mt[e[t+3]]+"-"+mt[e[t+4]]+mt[e[t+5]]+"-"+mt[e[t+6]]+mt[e[t+7]]+"-"+mt[e[t+8]]+mt[e[t+9]]+"-"+mt[e[t+10]]+mt[e[t+11]]+mt[e[t+12]]+mt[e[t+13]]+mt[e[t+14]]+mt[e[t+15]]).toLowerCase();if(!i0(i))throw TypeError("Stringified UUID is invalid");return i}function Cr(e,t,i){e=e||{};var r=e.random||(e.rng||e0)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){i=i||0;for(var n=0;n<16;++n)t[i+n]=r[n];return t}return r0(r)}let Kv=!0,Jv=!0;function Bo(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function Jr(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(o,a){if(o!==t)return n.apply(this,arguments);const l=u=>{const c=i(u);c&&(a.handleEvent?a.handleEvent(c):a(c))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,l),n.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(a))return s.apply(this,arguments);const l=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function n0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Kv=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function s0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Jv=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Qv(){if(typeof window=="object"){if(Kv)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Qc(e,t){Jv&&console.warn(e+" is deprecated, please use "+t+" instead.")}function o0(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=Bo(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Bo(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Bo(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Gh(e){return Object.prototype.toString.call(e)==="[object Object]"}function Yv(e){return Gh(e)?Object.keys(e).reduce(function(t,i){const r=Gh(e[i]),n=r?Yv(e[i]):e[i],s=r&&!Object.keys(n).length;return n===void 0||s?t:Object.assign(t,{[i]:n})},{}):e}function Du(e,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Du(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(n=>{Du(e,e.get(n),i)})}))}function zh(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(a=>{a.type===r&&a.trackId===o.id&&Du(e,a,n)})}),n}const Vh=Qv;function Xv(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const c=typeof a[u]=="object"?a[u]:{ideal:a[u]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const h=function(p,S){return p?p+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(c.ideal!==void 0){l.optional=l.optional||[];let p={};typeof c.ideal=="number"?(p[h("min",u)]=c.ideal,l.optional.push(p),p={},p[h("max",u)]=c.ideal,l.optional.push(p)):(p[h("",u)]=c.ideal,l.optional.push(p))}c.exact!==void 0&&typeof c.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[h("",u)]=c.exact):["min","max"].forEach(p=>{c[p]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[h(p,u)]=c[p])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},n=function(a,l){if(t.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(c,h,p){h in c&&!(p in c)&&(c[p]=c[h],delete c[h])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const c=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete a.video.facingMode;let h;if(u.exact==="environment"||u.ideal==="environment"?h=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(h=["front"]),h)return i.mediaDevices.enumerateDevices().then(p=>{p=p.filter(k=>k.kind==="videoinput");let S=p.find(k=>h.some(E=>k.label.toLowerCase().includes(E)));return!S&&p.length&&h.includes("back")&&(S=p[p.length-1]),S&&(a.video.deviceId=u.exact?{exact:S.deviceId}:{ideal:S.deviceId}),a.video=r(a.video),Vh("chrome: "+JSON.stringify(a)),l(a)})}a.video=r(a.video)}return Vh("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,u){n(a,c=>{i.webkitGetUserMedia(c,l,h=>{u&&u(s(h))})})};if(i.getUserMedia=o.bind(i),i.mediaDevices.getUserMedia){const a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,u=>a(u).then(c=>{if(u.audio&&!c.getAudioTracks().length||u.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(s(c))))}}}function a0(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{const s=r.video&&r.video.width,o=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},s&&(r.video.mandatory.maxWidth=s),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}}}function Zv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function em(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):s={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===n.id):s={track:n};const o=new Event("track");o.track=n,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Jr(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function tm(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,l){let u=n.apply(this,arguments);return u||(u=t(this,a),this._senders.push(u)),u};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function im(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,n,s]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const o=function(l){const u={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(S=>{p[S]=h.stat(S)}),u[p.id]=p}),u},a=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){n(a(o(u)))};return t.apply(this,[l,r])}return new Promise((l,u)=>{t.apply(this,[function(c){l(a(o(c)))},u])}).then(n,s)}}function rm(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>zh(o,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(s=>s._pc=this),n}),Jr(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>zh(s,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let n,s,o;return this.getSenders().forEach(a=>{a.track===r&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function nm(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function sm(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return nm(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const c=i.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(h=>this._reverseStreams[h.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const h=new e.MediaStream(c.getTracks());this._streams[c.id]=h,this._reverseStreams[h.id]=c,c=h}r.apply(this,[c])};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(E=>E===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new e.MediaStream([c]);this._streams[h.id]=E,this._reverseStreams[E.id]=h,this.addStream(E)}return this.getSenders().find(E=>E.track===c)};function s(u,c){let h=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const S=u._reverseStreams[p],k=u._streams[S.id];h=h.replace(new RegExp(k.id,"g"),S.id)}),new RTCSessionDescription({type:c.type,sdp:h})}function o(u,c){let h=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const S=u._reverseStreams[p],k=u._streams[S.id];h=h.replace(new RegExp(S.id,"g"),k.id)}),new RTCSessionDescription({type:c.type,sdp:h})}["createOffer","createAnswer"].forEach(function(u){const c=e.RTCPeerConnection.prototype[u],h={[u](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[k=>{const E=s(this,k);p[0].apply(null,[E])},k=>{p[1]&&p[1].apply(null,k)},arguments[2]]):c.apply(this,arguments).then(k=>s(this,k))}};e.RTCPeerConnection.prototype[u]=h[u]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:s(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(E=>c.track===E)&&(p=this._streams[S])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Mu(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=e.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=n[i]})}function om(e,t){Jr(e,"negotiationneeded",i=>{const r=i.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return i})}const Wh=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:om,shimAddTrackRemoveTrack:sm,shimAddTrackRemoveTrackWithNative:nm,shimGetDisplayMedia:a0,shimGetSendersWithDtmf:tm,shimGetStats:im,shimGetUserMedia:Xv,shimMediaStream:Zv,shimOnTrack:em,shimPeerConnection:Mu,shimSenderReceiverGetStats:rm},Symbol.toStringTag,{value:"Module"}));function am(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(n,s,o){Qc("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(s,o)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const n=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return n(a,"mozAutoGainControl","autoGainControl"),n(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a,"autoGainControl","mozAutoGainControl"),n(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function l0(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function lm(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ou(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(l=>{if(t.version<53&&!o)try{l.forEach(u=>{u.type=i[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((c,h)=>{l.set(h,Object.assign({},c,{type:i[c.type]||c.type}))})}return l}).then(o,a)}}function um(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=i.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function cm(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),Jr(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function dm(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){Qc("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function hm(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function pm(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function fm(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function vm(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function mm(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Hh=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:pm,shimCreateAnswer:mm,shimCreateOffer:vm,shimGetDisplayMedia:l0,shimGetParameters:fm,shimGetUserMedia:am,shimOnTrack:lm,shimPeerConnection:Ou,shimRTCDataChannel:hm,shimReceiverGetStats:cm,shimRemoveStream:dm,shimSenderGetStats:um},Symbol.toStringTag,{value:"Module"}));function gm(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>t.call(this,n,r)),r.getVideoTracks().forEach(n=>t.call(this,n,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...n){return n&&n.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(r===-1)return;this._localStreams.splice(r,1);const n=i.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function ym(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),t.apply(r,arguments)}}}function Sm(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(u,c){const h=arguments.length>=2?arguments[2]:arguments[0],p=i.apply(this,[h]);return c?(p.then(u,c),Promise.resolve()):p},t.createAnswer=function(u,c){const h=arguments.length>=2?arguments[2]:arguments[0],p=r.apply(this,[h]);return c?(p.then(u,c),Promise.resolve()):p};let a=function(l,u,c){const h=n.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h};t.setLocalDescription=a,a=function(l,u,c){const h=s.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h},t.setRemoteDescription=a,a=function(l,u,c){const h=o.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h},t.addIceCandidate=a}function km(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>r(Tm(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,n,s){t.mediaDevices.getUserMedia(r).then(n,s)}).bind(t))}function Tm(e){return e&&e.video!==void 0?Object.assign({},e,{video:Yv(e.video)}):e}function bm(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(Qc("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Cm(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Em(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function wm(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const qh=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:wm,shimCallbacksAPI:Sm,shimConstraints:Tm,shimCreateOfferLegacy:Em,shimGetUserMedia:km,shimLocalStreamsAPI:gm,shimRTCIceServerUrls:bm,shimRemoteStreamsAPI:ym,shimTrackEventTransceiver:Cm},Symbol.toStringTag,{value:"Module"}));var Pm={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((n,s)=>(s>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(i){const r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){const r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(n=>n.indexOf(r)===0)},t.parseCandidate=function(i){let r;i.indexOf("a=candidate:")===0?r=i.substring(12).split(" "):r=i.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":n.relatedAddress=r[s+1];break;case"rport":n.relatedPort=parseInt(r[s+1],10);break;case"tcptype":n.tcpType=r[s+1];break;case"ufrag":n.ufrag=r[s+1],n.usernameFragment=r[s+1];break;default:n[r[s]]===void 0&&(n[r[s]]=r[s+1]);break}return n},t.writeCandidate=function(i){const r=[];r.push(i.foundation);const n=i.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const n=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){const r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const r={};let n;const s=i.substring(i.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)n=s[o].trim().split("="),r[n[0].trim()]=n[1];return r},t.writeFmtp=function(i){let r="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const s=[];Object.keys(i.parameters).forEach(o=>{i.parameters[o]!==void 0?s.push(o+"="+i.parameters[o]):s.push(o)}),r+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){const r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){const r=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,r),10)},s=i.indexOf(":",r);return s>-1?(n.attribute=i.substring(r+1,s),n.value=i.substring(s+1)):n.attribute=i.substring(r+1),n},t.parseSsrcGroup=function(i){const r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},t.getMid=function(i){const r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){const r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let n="a=setup:"+r+`\r
`;return i.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(i){const r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){const n=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(i)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],u=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(u){const c=t.parseRtpMap(u),h=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(c.parameters=h.length?t.parseFmtp(h[0]):{},c.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(c.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))});const o=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(c=>c.type===l.type&&c.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(i,r){let n="";n+="m="+i+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{n+=t.writeRtpMap(o),n+=t.writeFmtp(o),n+=t.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{n+=t.writeExtmap(o)}),n},t.parseRtpEncodingParameters=function(i){const r=[],n=t.parseRtpParameters(i),s=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(i,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),l=a.length>0&&a[0].ssrc;let u;const c=t.matchPrefix(i,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(k=>parseInt(k,10)));c.length>0&&c[0].length>1&&c[0][0]===l&&(u=c[0][1]),n.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let S={ssrc:l,codecPayloadType:parseInt(p.parameters.apt,10)};l&&u&&(S.rtx={ssrc:u}),r.push(S),s&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&l&&r.push({ssrc:l});let h=t.matchPrefix(i,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(p=>{p.maxBitrate=h})),r},t.parseRtcpParameters=function(i){const r={},n=t.matchPrefix(i,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(i,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r;const n=t.matchPrefix(i,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(i,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(i){const r=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(i,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=t.matchPrefix(i,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,n){let s;const o=r!==void 0?r:2;return i?s=i:s=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){const n=t.splitLines(i);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const n=t.splitLines(i)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){const n=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=t.splitLines(i);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(Pm);var Rm=Pm.exports;const Tn=js(Rm),u0=yy({__proto__:null,default:Tn},[Rm]);function jo(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const n=new t(r),s=Tn.parseCandidate(r.candidate);for(const o in s)o in n||Object.defineProperty(n,o,{value:s[o]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Jr(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function xu(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Jr(e,"icecandidate",t=>{if(t.candidate){const i=Tn.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Go(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(a){if(!a||!a.sdp)return!1;const l=Tn.splitSections(a.sdp);return l.shift(),l.some(u=>{const c=Tn.parseMLine(u);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},r=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},n=function(a){let l=65536;return t.browser==="firefox"&&(t.version<57?a===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},s=function(a,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const c=Tn.matchPrefix(a.sdp,"a=max-message-size:");return c.length>0?u=parseInt(c[0].substring(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=r(arguments[0]),u=n(l),c=s(arguments[0],l);let h;u===0&&c===0?h=Number.POSITIVE_INFINITY:u===0||c===0?h=Math.max(u,c):h=Math.min(u,c);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return o.apply(this,arguments)}}function zo(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,n){const s=r.send;r.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(r.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=i.apply(this,arguments);return t(n,this),n},Jr(e,"datachannel",r=>(t(r.channel,r.target),r))}function Nu(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",n);s.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Uu(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return i.apply(this,arguments)}}function Vo(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Wo(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return i.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?i.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>i.apply(this,[o]))})}const c0=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Uu,shimAddIceCandidateNullOrEmpty:Vo,shimConnectionState:Nu,shimMaxMessageSize:Go,shimParameterlessSetLocalDescription:Wo,shimRTCIceCandidate:jo,shimRTCIceCandidateRelayProtocol:xu,shimSendThrowTypeError:zo},Symbol.toStringTag,{value:"Module"}));function d0({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=Qv,r=o0(e),n={browserDetails:r,commonShim:c0,extractVersion:Bo,disableLog:n0,disableWarnings:s0,sdp:u0};switch(r.browser){case"chrome":if(!Wh||!Mu||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=Wh,Vo(e,r),Wo(e),Xv(e,r),Zv(e),Mu(e,r),em(e),sm(e,r),tm(e),im(e),rm(e),om(e,r),jo(e),xu(e),Nu(e),Go(e,r),zo(e),Uu(e,r);break;case"firefox":if(!Hh||!Ou||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=Hh,Vo(e,r),Wo(e),am(e,r),Ou(e,r),lm(e),dm(e),um(e),cm(e),hm(e),pm(e),fm(e),vm(e),mm(e),jo(e),Nu(e),Go(e,r),zo(e);break;case"safari":if(!qh||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=qh,Vo(e,r),Wo(e),bm(e),Em(e),Sm(e),gm(e),ym(e),Cm(e),km(e),wm(e),jo(e),xu(e),Go(e,r),zo(e),Uu(e,r);break;default:i("Unsupported browser!");break}return n}const Kh=d0({window:typeof window>"u"?void 0:window});var Am={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */(function(e,t){(function(i){var r=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},s=10,o=typeof process=="object"&&typeof process.nextTick=="function",a=typeof Symbol=="function",l=typeof Reflect=="object",u=typeof setImmediate=="function",c=u?setImmediate:setTimeout,h=a?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(g){var b=Object.getOwnPropertyNames(g);return b.push.apply(b,Object.getOwnPropertySymbols(g)),b}:Object.keys;function p(){this._events={},this._conf&&S.call(this,this._conf)}function S(g){g&&(this._conf=g,g.delimiter&&(this.delimiter=g.delimiter),g.maxListeners!==i&&(this._maxListeners=g.maxListeners),g.wildcard&&(this.wildcard=g.wildcard),g.newListener&&(this._newListener=g.newListener),g.removeListener&&(this._removeListener=g.removeListener),g.verboseMemoryLeak&&(this.verboseMemoryLeak=g.verboseMemoryLeak),g.ignoreErrors&&(this.ignoreErrors=g.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function k(g,b){var v="(node) warning: possible EventEmitter memory leak detected. "+g+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(v+=" Event name: "+b+"."),typeof process<"u"&&process.emitWarning){var d=new Error(v);d.name="MaxListenersExceededWarning",d.emitter=this,d.count=g,process.emitWarning(d)}else console.error(v),console.trace&&console.trace()}var E=function(g,b,v){var d=arguments.length;switch(d){case 0:return[];case 1:return[g];case 2:return[g,b];case 3:return[g,b,v];default:for(var m=new Array(d);d--;)m[d]=arguments[d];return m}};function O(g,b){for(var v={},d,m=g.length,C=b?b.length:0,_=0;_<m;_++)d=g[_],v[d]=_<C?b[_]:i;return v}function I(g,b,v){this._emitter=g,this._target=b,this._listeners={},this._listenersCount=0;var d,m;if((v.on||v.off)&&(d=v.on,m=v.off),b.addEventListener?(d=b.addEventListener,m=b.removeEventListener):b.addListener?(d=b.addListener,m=b.removeListener):b.on&&(d=b.on,m=b.off),!d&&!m)throw Error("target does not implement any known event API");if(typeof d!="function")throw TypeError("on method must be a function");if(typeof m!="function")throw TypeError("off method must be a function");this._on=d,this._off=m;var C=g._observers;C?C.push(this):g._observers=[this]}Object.assign(I.prototype,{subscribe:function(g,b,v){var d=this,m=this._target,C=this._emitter,_=this._listeners,P=function(){var L=E.apply(null,arguments),w={data:L,name:b,original:g};if(v){var N=v.call(m,w);N!==!1&&C.emit.apply(C,[w.name].concat(L));return}C.emit.apply(C,[b].concat(L))};if(_[g])throw Error("Event '"+g+"' is already listening");this._listenersCount++,C._newListener&&C._removeListener&&!d._onNewListener?(this._onNewListener=function(L){L===b&&_[g]===null&&(_[g]=P,d._on.call(m,g,P))},C.on("newListener",this._onNewListener),this._onRemoveListener=function(L){L===b&&!C.hasListeners(L)&&_[g]&&(_[g]=null,d._off.call(m,g,P))},_[g]=null,C.on("removeListener",this._onRemoveListener)):(_[g]=P,d._on.call(m,g,P))},unsubscribe:function(g){var b=this,v=this._listeners,d=this._emitter,m,C,_=this._off,P=this._target,L;if(g&&typeof g!="string")throw TypeError("event must be a string");function w(){b._onNewListener&&(d.off("newListener",b._onNewListener),d.off("removeListener",b._onRemoveListener),b._onNewListener=null,b._onRemoveListener=null);var N=ee.call(d,b);d._observers.splice(N,1)}if(g){if(m=v[g],!m)return;_.call(P,g,m),delete v[g],--this._listenersCount||w()}else{for(C=h(v),L=C.length;L-- >0;)g=C[L],_.call(P,g,v[g]);this._listeners={},this._listenersCount=0,w()}}});function R(g,b,v,d){var m=Object.assign({},b);if(!g)return m;if(typeof g!="object")throw TypeError("options must be an object");var C=Object.keys(g),_=C.length,P,L,w;function N(F){throw Error('Invalid "'+P+'" option value'+(F?". Reason: "+F:""))}for(var Q=0;Q<_;Q++){if(P=C[Q],!d&&!r.call(b,P))throw Error('Unknown "'+P+'" option');L=g[P],L!==i&&(w=v[P],m[P]=w?w(L,N):L)}return m}function A(g,b){return(typeof g!="function"||!g.hasOwnProperty("prototype"))&&b("value must be a constructor"),g}function M(g){var b="value must be type of "+g.join("|"),v=g.length,d=g[0],m=g[1];return v===1?function(C,_){if(typeof C===d)return C;_(b)}:v===2?function(C,_){var P=typeof C;if(P===d||P===m)return C;_(b)}:function(C,_){for(var P=typeof C,L=v;L-- >0;)if(P===g[L])return C;_(b)}}var W=M(["function"]),Z=M(["object","function"]);function X(g,b,v){var d,m,C=0,_,P=new g(function(L,w,N){v=R(v,{timeout:0,overload:!1},{timeout:function($,q){return $*=1,(typeof $!="number"||$<0||!Number.isFinite($))&&q("timeout must be a positive number"),$}}),d=!v.overload&&typeof g.prototype.cancel=="function"&&typeof N=="function";function Q(){m&&(m=null),C&&(clearTimeout(C),C=0)}var F=function($){Q(),L($)},j=function($){Q(),w($)};d?b(F,j,N):(m=[function($){j($||Error("canceled"))}],b(F,j,function($){if(_)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof $!="function")throw TypeError("onCancel callback must be a function");m.push($)}),_=!0),v.timeout>0&&(C=setTimeout(function(){var $=Error("timeout");$.code="ETIMEDOUT",C=0,P.cancel($),w($)},v.timeout))});return d||(P.cancel=function(L){if(m){for(var w=m.length,N=1;N<w;N++)m[N](L);m[0](L),m=null}}),P}function ee(g){var b=this._observers;if(!b)return-1;for(var v=b.length,d=0;d<v;d++)if(b[d]._target===g)return d;return-1}function ce(g,b,v,d,m){if(!v)return null;if(d===0){var C=typeof b;if(C==="string"){var _,P,L=0,w=0,N=this.delimiter,Q=N.length;if((P=b.indexOf(N))!==-1){_=new Array(5);do _[L++]=b.slice(w,P),w=P+Q;while((P=b.indexOf(N,w))!==-1);_[L++]=b.slice(w),b=_,m=L}else b=[b],m=1}else C==="object"?m=b.length:(b=[b],m=1)}var F=null,j,$,q,V,de,fe=b[d],U=b[d+1],Y,re;if(d===m)v._listeners&&(typeof v._listeners=="function"?(g&&g.push(v._listeners),F=[v]):(g&&g.push.apply(g,v._listeners),F=[v]));else if(fe==="*"){for(Y=h(v),P=Y.length;P-- >0;)j=Y[P],j!=="_listeners"&&(re=ce(g,b,v[j],d+1,m),re&&(F?F.push.apply(F,re):F=re));return F}else if(fe==="**"){for(de=d+1===m||d+2===m&&U==="*",de&&v._listeners&&(F=ce(g,b,v,m,m)),Y=h(v),P=Y.length;P-- >0;)j=Y[P],j!=="_listeners"&&(j==="*"||j==="**"?(v[j]._listeners&&!de&&(re=ce(g,b,v[j],m,m),re&&(F?F.push.apply(F,re):F=re)),re=ce(g,b,v[j],d,m)):j===U?re=ce(g,b,v[j],d+2,m):re=ce(g,b,v[j],d,m),re&&(F?F.push.apply(F,re):F=re));return F}else v[fe]&&(F=ce(g,b,v[fe],d+1,m));if($=v["*"],$&&ce(g,b,$,d+1,m),q=v["**"],q)if(d<m)for(q._listeners&&ce(g,b,q,m,m),Y=h(q),P=Y.length;P-- >0;)j=Y[P],j!=="_listeners"&&(j===U?ce(g,b,q[j],d+2,m):j===fe?ce(g,b,q[j],d+1,m):(V={},V[j]=q[j],ce(g,b,{"**":V},d+1,m)));else q._listeners?ce(g,b,q,m,m):q["*"]&&q["*"]._listeners&&ce(g,b,q["*"],m,m);return F}function pe(g,b,v){var d=0,m=0,C,_=this.delimiter,P=_.length,L;if(typeof g=="string")if((C=g.indexOf(_))!==-1){L=new Array(5);do L[d++]=g.slice(m,C),m=C+P;while((C=g.indexOf(_,m))!==-1);L[d++]=g.slice(m)}else L=[g],d=1;else L=g,d=g.length;if(d>1){for(C=0;C+1<d;C++)if(L[C]==="**"&&L[C+1]==="**")return}var w=this.listenerTree,N;for(C=0;C<d;C++)if(N=L[C],w=w[N]||(w[N]={}),C===d-1)return w._listeners?(typeof w._listeners=="function"&&(w._listeners=[w._listeners]),v?w._listeners.unshift(b):w._listeners.push(b),!w._listeners.warned&&this._maxListeners>0&&w._listeners.length>this._maxListeners&&(w._listeners.warned=!0,k.call(this,w._listeners.length,N))):w._listeners=b,!0;return!0}function Oe(g,b,v,d){for(var m=h(g),C=m.length,_,P,L,w=g._listeners,N;C-- >0;)P=m[C],_=g[P],P==="_listeners"?L=v:L=v?v.concat(P):[P],N=d||typeof P=="symbol",w&&b.push(N?L:L.join(this.delimiter)),typeof _=="object"&&Oe.call(this,_,b,L,N);return b}function Ve(g){for(var b=h(g),v=b.length,d,m,C;v-- >0;)m=b[v],d=g[m],d&&(C=!0,m!=="_listeners"&&!Ve(d)&&delete g[m]);return C}function We(g,b,v){this.emitter=g,this.event=b,this.listener=v}We.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function He(g,b,v){if(v===!0)m=!0;else if(v===!1)d=!0;else{if(!v||typeof v!="object")throw TypeError("options should be an object or true");var d=v.async,m=v.promisify,C=v.nextTick,_=v.objectify}if(d||C||m){var P=b,L=b._origin||b;if(C&&!o)throw Error("process.nextTick is not supported");m===i&&(m=b.constructor.name==="AsyncFunction"),b=function(){var w=arguments,N=this,Q=this.event;return m?C?Promise.resolve():new Promise(function(F){c(F)}).then(function(){return N.event=Q,P.apply(N,w)}):(C?process.nextTick:c)(function(){N.event=Q,P.apply(N,w)})},b._async=!0,b._origin=L}return[b,_?new We(this,g,b):this]}function ve(g){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,S.call(this,g)}ve.EventEmitter2=ve,ve.prototype.listenTo=function(g,b,v){if(typeof g!="object")throw TypeError("target musts be an object");var d=this;v=R(v,{on:i,off:i,reducers:i},{on:W,off:W,reducers:Z});function m(C){if(typeof C!="object")throw TypeError("events must be an object");var _=v.reducers,P=ee.call(d,g),L;P===-1?L=new I(d,g,v):L=d._observers[P];for(var w=h(C),N=w.length,Q,F=typeof _=="function",j=0;j<N;j++)Q=w[j],L.subscribe(Q,C[Q]||Q,F?_:_&&_[Q])}return n(b)?m(O(b)):m(typeof b=="string"?O(b.split(/\s+/)):b),this},ve.prototype.stopListeningTo=function(g,b){var v=this._observers;if(!v)return!1;var d=v.length,m,C=!1;if(g&&typeof g!="object")throw TypeError("target should be an object");for(;d-- >0;)m=v[d],(!g||m._target===g)&&(m.unsubscribe(b),C=!0);return C},ve.prototype.delimiter=".",ve.prototype.setMaxListeners=function(g){g!==i&&(this._maxListeners=g,this._conf||(this._conf={}),this._conf.maxListeners=g)},ve.prototype.getMaxListeners=function(){return this._maxListeners},ve.prototype.event="",ve.prototype.once=function(g,b,v){return this._once(g,b,!1,v)},ve.prototype.prependOnceListener=function(g,b,v){return this._once(g,b,!0,v)},ve.prototype._once=function(g,b,v,d){return this._many(g,1,b,v,d)},ve.prototype.many=function(g,b,v,d){return this._many(g,b,v,!1,d)},ve.prototype.prependMany=function(g,b,v,d){return this._many(g,b,v,!0,d)},ve.prototype._many=function(g,b,v,d,m){var C=this;if(typeof v!="function")throw new Error("many only accepts instances of Function");function _(){return--b===0&&C.off(g,_),v.apply(this,arguments)}return _._origin=v,this._on(g,_,d,m)},ve.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var g=arguments[0],b,v=this.wildcard,d,m,C,_,P;if(g==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(v&&(b=g,g!=="newListener"&&g!=="removeListener"&&typeof g=="object")){if(m=g.length,a){for(C=0;C<m;C++)if(typeof g[C]=="symbol"){P=!0;break}}P||(g=g.join(this.delimiter))}var L=arguments.length,w;if(this._all&&this._all.length)for(w=this._all.slice(),C=0,m=w.length;C<m;C++)switch(this.event=g,L){case 1:w[C].call(this,g);break;case 2:w[C].call(this,g,arguments[1]);break;case 3:w[C].call(this,g,arguments[1],arguments[2]);break;default:w[C].apply(this,arguments)}if(v)w=[],ce.call(this,w,b,this.listenerTree,0,m);else if(w=this._events[g],typeof w=="function"){switch(this.event=g,L){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:for(d=new Array(L-1),_=1;_<L;_++)d[_-1]=arguments[_];w.apply(this,d)}return!0}else w&&(w=w.slice());if(w&&w.length){if(L>3)for(d=new Array(L-1),_=1;_<L;_++)d[_-1]=arguments[_];for(C=0,m=w.length;C<m;C++)switch(this.event=g,L){case 1:w[C].call(this);break;case 2:w[C].call(this,arguments[1]);break;case 3:w[C].call(this,arguments[1],arguments[2]);break;default:w[C].apply(this,d)}return!0}else if(!this.ignoreErrors&&!this._all&&g==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},ve.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var g=arguments[0],b=this.wildcard,v,d,m,C,_,P;if(g==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(b&&(v=g,g!=="newListener"&&g!=="removeListener"&&typeof g=="object")){if(C=g.length,a){for(_=0;_<C;_++)if(typeof g[_]=="symbol"){d=!0;break}}d||(g=g.join(this.delimiter))}var L=[],w=arguments.length,N;if(this._all)for(_=0,C=this._all.length;_<C;_++)switch(this.event=g,w){case 1:L.push(this._all[_].call(this,g));break;case 2:L.push(this._all[_].call(this,g,arguments[1]));break;case 3:L.push(this._all[_].call(this,g,arguments[1],arguments[2]));break;default:L.push(this._all[_].apply(this,arguments))}if(b?(N=[],ce.call(this,N,v,this.listenerTree,0)):N=this._events[g],typeof N=="function")switch(this.event=g,w){case 1:L.push(N.call(this));break;case 2:L.push(N.call(this,arguments[1]));break;case 3:L.push(N.call(this,arguments[1],arguments[2]));break;default:for(m=new Array(w-1),P=1;P<w;P++)m[P-1]=arguments[P];L.push(N.apply(this,m))}else if(N&&N.length){if(N=N.slice(),w>3)for(m=new Array(w-1),P=1;P<w;P++)m[P-1]=arguments[P];for(_=0,C=N.length;_<C;_++)switch(this.event=g,w){case 1:L.push(N[_].call(this));break;case 2:L.push(N[_].call(this,arguments[1]));break;case 3:L.push(N[_].call(this,arguments[1],arguments[2]));break;default:L.push(N[_].apply(this,m))}}else if(!this.ignoreErrors&&!this._all&&g==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(L)},ve.prototype.on=function(g,b,v){return this._on(g,b,!1,v)},ve.prototype.prependListener=function(g,b,v){return this._on(g,b,!0,v)},ve.prototype.onAny=function(g){return this._onAny(g,!1)},ve.prototype.prependAny=function(g){return this._onAny(g,!0)},ve.prototype.addListener=ve.prototype.on,ve.prototype._onAny=function(g,b){if(typeof g!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),b?this._all.unshift(g):this._all.push(g),this},ve.prototype._on=function(g,b,v,d){if(typeof g=="function")return this._onAny(g,b),this;if(typeof b!="function")throw new Error("on only accepts instances of Function");this._events||p.call(this);var m=this,C;return d!==i&&(C=He.call(this,g,b,d),b=C[0],m=C[1]),this._newListener&&this.emit("newListener",g,b),this.wildcard?(pe.call(this,g,b,v),m):(this._events[g]?(typeof this._events[g]=="function"&&(this._events[g]=[this._events[g]]),v?this._events[g].unshift(b):this._events[g].push(b),!this._events[g].warned&&this._maxListeners>0&&this._events[g].length>this._maxListeners&&(this._events[g].warned=!0,k.call(this,this._events[g].length,g))):this._events[g]=b,m)},ve.prototype.off=function(g,b){if(typeof b!="function")throw new Error("removeListener only takes instances of Function");var v,d=[];if(this.wildcard){var m=typeof g=="string"?g.split(this.delimiter):g.slice();if(d=ce.call(this,null,m,this.listenerTree,0),!d)return this}else{if(!this._events[g])return this;v=this._events[g],d.push({_listeners:v})}for(var C=0;C<d.length;C++){var _=d[C];if(v=_._listeners,n(v)){for(var P=-1,L=0,w=v.length;L<w;L++)if(v[L]===b||v[L].listener&&v[L].listener===b||v[L]._origin&&v[L]._origin===b){P=L;break}if(P<0)continue;return this.wildcard?_._listeners.splice(P,1):this._events[g].splice(P,1),v.length===0&&(this.wildcard?delete _._listeners:delete this._events[g]),this._removeListener&&this.emit("removeListener",g,b),this}else(v===b||v.listener&&v.listener===b||v._origin&&v._origin===b)&&(this.wildcard?delete _._listeners:delete this._events[g],this._removeListener&&this.emit("removeListener",g,b))}return this.listenerTree&&Ve(this.listenerTree),this},ve.prototype.offAny=function(g){var b=0,v=0,d;if(g&&this._all&&this._all.length>0){for(d=this._all,b=0,v=d.length;b<v;b++)if(g===d[b])return d.splice(b,1),this._removeListener&&this.emit("removeListenerAny",g),this}else{if(d=this._all,this._removeListener)for(b=0,v=d.length;b<v;b++)this.emit("removeListenerAny",d[b]);this._all=[]}return this},ve.prototype.removeListener=ve.prototype.off,ve.prototype.removeAllListeners=function(g){if(g===i)return!this._events||p.call(this),this;if(this.wildcard){var b=ce.call(this,null,g,this.listenerTree,0),v,d;if(!b)return this;for(d=0;d<b.length;d++)v=b[d],v._listeners=null;this.listenerTree&&Ve(this.listenerTree)}else this._events&&(this._events[g]=null);return this},ve.prototype.listeners=function(g){var b=this._events,v,d,m,C,_;if(g===i){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!b)return[];for(v=h(b),C=v.length,m=[];C-- >0;)d=b[v[C]],typeof d=="function"?m.push(d):m.push.apply(m,d);return m}else{if(this.wildcard){if(_=this.listenerTree,!_)return[];var P=[],L=typeof g=="string"?g.split(this.delimiter):g.slice();return ce.call(this,P,L,_,0),P}return b?(d=b[g],d?typeof d=="function"?[d]:d:[]):[]}},ve.prototype.eventNames=function(g){var b=this._events;return this.wildcard?Oe.call(this,this.listenerTree,[],null,g):b?h(b):[]},ve.prototype.listenerCount=function(g){return this.listeners(g).length},ve.prototype.hasListeners=function(g){if(this.wildcard){var b=[],v=typeof g=="string"?g.split(this.delimiter):g.slice();return ce.call(this,b,v,this.listenerTree,0),b.length>0}var d=this._events,m=this._all;return!!(m&&m.length||d&&(g===i?h(d).length:d[g]))},ve.prototype.listenersAny=function(){return this._all?this._all:[]},ve.prototype.waitFor=function(g,b){var v=this,d=typeof b;return d==="number"?b={timeout:b}:d==="function"&&(b={filter:b}),b=R(b,{timeout:0,filter:i,handleError:!1,Promise,overload:!1},{filter:W,Promise:A}),X(b.Promise,function(m,C,_){function P(){var L=b.filter;if(!(L&&!L.apply(v,arguments)))if(v.off(g,P),b.handleError){var w=arguments[0];w?C(w):m(E.apply(null,arguments).slice(1))}else m(E.apply(null,arguments))}_(function(){v.off(g,P)}),v._on(g,P,!1)},{timeout:b.timeout,overload:b.overload})};function At(g,b,v){v=R(v,{Promise,timeout:0,overload:!1},{Promise:A});var d=v.Promise;return X(d,function(m,C,_){var P;if(typeof g.addEventListener=="function"){P=function(){m(E.apply(null,arguments))},_(function(){g.removeEventListener(b,P)}),g.addEventListener(b,P,{once:!0});return}var L=function(){w&&g.removeListener("error",w),m(E.apply(null,arguments))},w;b!=="error"&&(w=function(N){g.removeListener(b,L),C(N)},g.once("error",w)),_(function(){w&&g.removeListener("error",w),g.removeListener(b,L)}),g.once(b,L)},{timeout:v.timeout,overload:v.overload})}var ut=ve.prototype;Object.defineProperties(ve,{defaultMaxListeners:{get:function(){return ut._maxListeners},set:function(g){if(typeof g!="number"||g<0||Number.isNaN(g))throw TypeError("n must be a non-negative number");ut._maxListeners=g},enumerable:!0},once:{value:At,writable:!0,configurable:!0}}),Object.defineProperties(ut,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof i=="function"&&i.amd?i(function(){return ve}):e.exports=ve})()})(Am);var Wa=Am.exports;const h0=js(Wa);function vi(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map(function(n){return"'"+n+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function On(e){return!!e&&!!e[qt]}function Hr(e){var t;return!!e&&(function(i){if(!i||typeof i!="object")return!1;var r=Object.getPrototypeOf(i);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===k0}(e)||Array.isArray(e)||!!e[ip]||!!(!((t=e.constructor)===null||t===void 0)&&t[ip])||Yc(e)||Xc(e))}function Us(e,t,i){i===void 0&&(i=!1),jn(e)===0?(i?Object.keys:rd)(e).forEach(function(r){i&&typeof r=="symbol"||t(r,e[r],e)}):e.forEach(function(r,n){return t(n,r,e)})}function jn(e){var t=e[qt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Yc(e)?2:Xc(e)?3:0}function Fu(e,t){return jn(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function p0(e,t){return jn(e)===2?e.get(t):e[t]}function _m(e,t,i){var r=jn(e);r===2?e.set(t,i):r===3?e.add(i):e[t]=i}function f0(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Yc(e){return y0&&e instanceof Map}function Xc(e){return S0&&e instanceof Set}function Mr(e){return e.o||e.t}function Zc(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=T0(e);delete t[qt];for(var i=rd(t),r=0;r<i.length;r++){var n=i[r],s=t[n];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function ed(e,t){return t===void 0&&(t=!1),td(e)||On(e)||!Hr(e)||(jn(e)>1&&(e.set=e.add=e.clear=e.delete=v0),Object.freeze(e),t&&Us(e,function(i,r){return ed(r,!0)},!0)),e}function v0(){vi(2)}function td(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function _i(e){var t=b0[e];return t||vi(18,e),t}function Jh(){return Fs}function _l(e,t){t&&(_i("Patches"),e.u=[],e.s=[],e.v=t)}function ka(e){$u(e),e.p.forEach(m0),e.p=null}function $u(e){e===Fs&&(Fs=e.l)}function Qh(e){return Fs={p:[],l:Fs,h:e,m:!0,_:0}}function m0(e){var t=e[qt];t.i===0||t.i===1?t.j():t.g=!0}function Il(e,t){t._=t.p.length;var i=t.p[0],r=e!==void 0&&e!==i;return t.h.O||_i("ES5").S(t,e,r),r?(i[qt].P&&(ka(t),vi(4)),Hr(e)&&(e=Ta(t,e),t.l||ba(t,e)),t.u&&_i("Patches").M(i[qt].t,e,t.u,t.s)):e=Ta(t,i,[]),ka(t),t.u&&t.v(t.u,t.s),e!==Im?e:void 0}function Ta(e,t,i){if(td(t))return t;var r=t[qt];if(!r)return Us(t,function(a,l){return Yh(e,r,t,a,l,i)},!0),t;if(r.A!==e)return t;if(!r.P)return ba(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var n=r.i===4||r.i===5?r.o=Zc(r.k):r.o,s=n,o=!1;r.i===3&&(s=new Set(n),n.clear(),o=!0),Us(s,function(a,l){return Yh(e,r,n,a,l,i,o)}),ba(e,n,!1),i&&e.u&&_i("Patches").N(r,i,e.u,e.s)}return r.o}function Yh(e,t,i,r,n,s,o){if(On(n)){var a=Ta(e,n,s&&t&&t.i!==3&&!Fu(t.R,r)?s.concat(r):void 0);if(_m(i,r,a),!On(a))return;e.m=!1}else o&&i.add(n);if(Hr(n)&&!td(n)){if(!e.h.D&&e._<1)return;Ta(e,n),t&&t.A.l||ba(e,n)}}function ba(e,t,i){i===void 0&&(i=!1),!e.l&&e.h.D&&e.m&&ed(t,i)}function Ll(e,t){var i=e[qt];return(i?Mr(i):e)[t]}function Xh(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var r=Object.getOwnPropertyDescriptor(i,t);if(r)return r;i=Object.getPrototypeOf(i)}}function Bu(e){e.P||(e.P=!0,e.l&&Bu(e.l))}function Dl(e){e.o||(e.o=Zc(e.t))}function ju(e,t,i){var r=Yc(t)?_i("MapSet").F(t,i):Xc(t)?_i("MapSet").T(t,i):e.O?function(n,s){var o=Array.isArray(n),a={i:o?1:0,A:s?s.A:Jh(),P:!1,I:!1,R:{},l:s,t:n,k:null,o:null,j:null,C:!1},l=a,u=Gu;o&&(l=[a],u=cs);var c=Proxy.revocable(l,u),h=c.revoke,p=c.proxy;return a.k=p,a.j=h,p}(t,i):_i("ES5").J(t,i);return(i?i.A:Jh()).p.push(r),r}function g0(e){return On(e)||vi(22,e),function t(i){if(!Hr(i))return i;var r,n=i[qt],s=jn(i);if(n){if(!n.P&&(n.i<4||!_i("ES5").K(n)))return n.t;n.I=!0,r=Zh(i,s),n.I=!1}else r=Zh(i,s);return Us(r,function(o,a){n&&p0(n.t,o)===a||_m(r,o,t(a))}),s===3?new Set(r):r}(e)}function Zh(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Zc(e)}var ep,Fs,id=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",y0=typeof Map<"u",S0=typeof Set<"u",tp=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Im=id?Symbol.for("immer-nothing"):((ep={})["immer-nothing"]=!0,ep),ip=id?Symbol.for("immer-draftable"):"__$immer_draftable",qt=id?Symbol.for("immer-state"):"__$immer_state",k0=""+Object.prototype.constructor,rd=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,T0=Object.getOwnPropertyDescriptors||function(e){var t={};return rd(e).forEach(function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)}),t},b0={},Gu={get:function(e,t){if(t===qt)return e;var i=Mr(e);if(!Fu(i,t))return function(n,s,o){var a,l=Xh(s,o);return l?"value"in l?l.value:(a=l.get)===null||a===void 0?void 0:a.call(n.k):void 0}(e,i,t);var r=i[t];return e.I||!Hr(r)?r:r===Ll(e.t,t)?(Dl(e),e.o[t]=ju(e.A.h,r,e)):r},has:function(e,t){return t in Mr(e)},ownKeys:function(e){return Reflect.ownKeys(Mr(e))},set:function(e,t,i){var r=Xh(Mr(e),t);if(r!=null&&r.set)return r.set.call(e.k,i),!0;if(!e.P){var n=Ll(Mr(e),t),s=n==null?void 0:n[qt];if(s&&s.t===i)return e.o[t]=i,e.R[t]=!1,!0;if(f0(i,n)&&(i!==void 0||Fu(e.t,t)))return!0;Dl(e),Bu(e)}return e.o[t]===i&&(i!==void 0||t in e.o)||Number.isNaN(i)&&Number.isNaN(e.o[t])||(e.o[t]=i,e.R[t]=!0),!0},deleteProperty:function(e,t){return Ll(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,Dl(e),Bu(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=Mr(e),r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:r.enumerable,value:i[t]}},defineProperty:function(){vi(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){vi(12)}},cs={};Us(Gu,function(e,t){cs[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),cs.deleteProperty=function(e,t){return cs.set.call(this,e,t,void 0)},cs.set=function(e,t,i){return Gu.set.call(this,e[0],t,i,e[0])};var C0=function(){function e(i){var r=this;this.O=tp,this.D=!0,this.produce=function(n,s,o){if(typeof n=="function"&&typeof s!="function"){var a=s;s=n;var l=r;return function(E){var O=this;E===void 0&&(E=a);for(var I=arguments.length,R=Array(I>1?I-1:0),A=1;A<I;A++)R[A-1]=arguments[A];return l.produce(E,function(M){var W;return(W=s).call.apply(W,[O,M].concat(R))})}}var u;if(typeof s!="function"&&vi(6),o!==void 0&&typeof o!="function"&&vi(7),Hr(n)){var c=Qh(r),h=ju(r,n,void 0),p=!0;try{u=s(h),p=!1}finally{p?ka(c):$u(c)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(E){return _l(c,o),Il(E,c)},function(E){throw ka(c),E}):(_l(c,o),Il(u,c))}if(!n||typeof n!="object"){if((u=s(n))===void 0&&(u=n),u===Im&&(u=void 0),r.D&&ed(u,!0),o){var S=[],k=[];_i("Patches").M(n,u,S,k),o(S,k)}return u}vi(21,n)},this.produceWithPatches=function(n,s){if(typeof n=="function")return function(u){for(var c=arguments.length,h=Array(c>1?c-1:0),p=1;p<c;p++)h[p-1]=arguments[p];return r.produceWithPatches(u,function(S){return n.apply(void 0,[S].concat(h))})};var o,a,l=r.produce(n,s,function(u,c){o=u,a=c});return typeof Promise<"u"&&l instanceof Promise?l.then(function(u){return[u,o,a]}):[l,o,a]},typeof(i==null?void 0:i.useProxies)=="boolean"&&this.setUseProxies(i.useProxies),typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze)}var t=e.prototype;return t.createDraft=function(i){Hr(i)||vi(8),On(i)&&(i=g0(i));var r=Qh(this),n=ju(this,i,void 0);return n[qt].C=!0,$u(r),n},t.finishDraft=function(i,r){var n=i&&i[qt],s=n.A;return _l(s,r),Il(void 0,s)},t.setAutoFreeze=function(i){this.D=i},t.setUseProxies=function(i){i&&!tp&&vi(20),this.O=i},t.applyPatches=function(i,r){var n;for(n=r.length-1;n>=0;n--){var s=r[n];if(s.path.length===0&&s.op==="replace"){i=s.value;break}}n>-1&&(r=r.slice(n+1));var o=_i("Patches").$;return On(i)?o(i,r):this.produce(i,function(a){return o(a,r)})},e}(),Kt=new C0,E0=Kt.produce;Kt.produceWithPatches.bind(Kt);Kt.setAutoFreeze.bind(Kt);Kt.setUseProxies.bind(Kt);Kt.applyPatches.bind(Kt);Kt.createDraft.bind(Kt);Kt.finishDraft.bind(Kt);function w0(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let r=0;r<i.length;r++)if(!Object.prototype.hasOwnProperty.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0}function P0(e){let t;const i=new Set,r=(u,c)=>{const h=typeof u=="function"?u(t):u;if(h!==t){const p=t;t=c?h:Object.assign({},t,h),i.forEach(S=>S(t,p))}},n=()=>t,s=(u,c=n,h=Object.is)=>{let p=c(t);function S(){const k=c(t);if(!h(p,k)){const E=p;u(p=k,E)}}return i.add(S),()=>i.delete(S)},l={setState:r,getState:n,subscribe:(u,c,h)=>c||h?s(u,c,h):(i.add(u),()=>i.delete(u)),destroy:()=>i.clear()};return t=e(r,n,l),l}var Lm={},Dm={exports:{}},rp=Dm.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(rp).forEach(function(e){var t=rp[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});var Mm=Dm.exports;(function(e){var t=function(a){return String(Number(a))===a?Number(a):a},i=function(a,l,u,c){if(c&&!u)l[c]=t(a[1]);else for(var h=0;h<u.length;h+=1)a[h+1]!=null&&(l[u[h]]=t(a[h+1]))},r=function(a,l,u){var c=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:c&&!l[a.name]&&(l[a.name]={});var h=a.push?{}:c?l[a.name]:l;i(u.match(a.reg),h,a.names,a.name),a.push&&l[a.push].push(h)},n=Mm,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(a){var l={},u=[],c=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var p=h[0],S=h.slice(2);p==="m"&&(u.push({rtp:[],fmtp:[]}),c=u[u.length-1]);for(var k=0;k<(n[p]||[]).length;k+=1){var E=n[p][k];if(E.reg.test(S))return r(E,c,S)}}),l.media=u,l};var o=function(a,l){var u=l.split(/=(.+)/,2);return u.length===2?a[u[0]]=t(u[1]):u.length===1&&l.length>1&&(a[u[0]]=void 0),a};e.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(a){return a.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(a){for(var l=[],u=a.split(" ").map(t),c=0;c<u.length;c+=3)l.push({component:u[c],ip:u[c+1],port:u[c+2]});return l},e.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(u){var c,h=!1;return u[0]!=="~"?c=t(u):(c=t(u.substring(1,u.length)),h=!0),{scid:c,paused:h}})})}})(Lm);var Ml=Mm,R0=/%[sdv%]/g,A0=function(e){var t=1,i=arguments,r=i.length;return e.replace(R0,function(n){if(t>=r)return n;var s=i[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},is=function(e,t,i){var r=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,n=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var o=t.names[s];t.name?n.push(i[t.name][o]):n.push(i[t.names[s]])}else n.push(i[t.name]);return A0.apply(null,n)},_0=["v","o","s","i","u","e","p","c","b","t","r","z","a"],I0=["i","c","b","a"],L0=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var i=t.outerOrder||_0,r=t.innerOrder||I0,n=[];return i.forEach(function(s){Ml[s].forEach(function(o){o.name in e&&e[o.name]!=null?n.push(is(s,o,e)):o.push in e&&e[o.push]!=null&&e[o.push].forEach(function(a){n.push(is(s,o,a))})})}),e.media.forEach(function(s){n.push(is("m",Ml.m[0],s)),r.forEach(function(o){Ml[o].forEach(function(a){a.name in s&&s[a.name]!=null?n.push(is(o,a,s)):a.push in s&&s[a.push]!=null&&s[a.push].forEach(function(l){n.push(is(o,a,l))})})})}),n.join(`\r
`)+`\r
`},Qr=Lm,D0=L0,M0=D0,Om=Qr.parse;Qr.parseParams;Qr.parseFmtpConfig;Qr.parsePayloads;Qr.parseRemoteCandidates;Qr.parseImageAttributes;Qr.parseSimulcastStreamList;var O0=Object.defineProperty,x0=Object.defineProperties,N0=Object.getOwnPropertyDescriptors,Ca=Object.getOwnPropertySymbols,U0=Object.getPrototypeOf,xm=Object.prototype.hasOwnProperty,Nm=Object.prototype.propertyIsEnumerable,F0=Reflect.get,np=(e,t,i)=>t in e?O0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,H=(e,t)=>{for(var i in t||(t={}))xm.call(t,i)&&np(e,i,t[i]);if(Ca)for(var i of Ca(t))Nm.call(t,i)&&np(e,i,t[i]);return e},Ee=(e,t)=>x0(e,N0(t)),sp=(e,t)=>{var i={};for(var r in e)xm.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&Ca)for(var r of Ca(e))t.indexOf(r)<0&&Nm.call(e,r)&&(i[r]=e[r]);return i},$0=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Gi=(e,t,i)=>F0(U0(e),i,t),f=(e,t,i)=>new Promise((r,n)=>{var s=l=>{try{a(i.next(l))}catch(u){n(u)}},o=l=>{try{a(i.throw(l))}catch(u){n(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((i=i.apply(e,t)).next())}),Um=$0((e,t)=>{t.exports={version:"0.12.8",license:"MIT",repository:{type:"git",url:"https://github.com/100mslive/web-sdks.git",directory:"packages/hms-video-store"},main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},sideEffects:!1,scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",dependencies:{eventemitter2:"^6.4.9",immer:"^9.0.6","lodash.isequal":"^4.5.0",reselect:"4.0.0","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0",zustand:"3.5.7"},devDependencies:{"@types/dom-screen-wake-lock":"^1.0.1","@types/lodash.isequal":"^4.5.8","@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1","jsdom-worker":"^0.3.0",tslib:"^2.2.0"},description:"@100mslive Core SDK which abstracts the complexities of webRTC while providing a reactive store for data management with a unidirectional data flow",keywords:["video","webrtc","conferencing","100ms"],gitHead:"51bc21610e944d2fb99f12c8f315577d5bc2ca43"}}),B0=(e=>(e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e))(B0||{}),Fm=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:"Disconnected",recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{},polls:{},whiteboards:{},hideLocalPeer:!1}),$m=()=>({peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}),j0=(e=>(e.CHAT="chat",e))(j0||{}),G0=(e=>(e.INFO="info",e.ERROR="error",e))(G0||{}),Bm=(e=>(e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED",e.POLL_CREATED="POLL_CREATED",e.POLL_STARTED="POLL_STARTED",e.POLL_STOPPED="POLL_STOPPED",e.POLL_VOTES_UPDATED="POLL_VOTES_UPDATED",e.POLLS_LIST="POLLS_LIST",e.HAND_RAISE_CHANGED="HAND_RAISE_CHANGED",e))(Bm||{}),z0=(e=>(e.audio="audio",e.video="video",e))(z0||{});function qs(e,t){let i,r;if(t)for(let n of t.auxiliaryTracks){let s=e[n];V0(s)&&(r=nd(s)?s:r,i=sd(s)?s:i)}return{video:i,audio:r}}function nd(e){return e&&e.type==="audio"}function sd(e){return e&&e.type==="video"}function V0(e){return e&&e.source==="screen"}function jm(e){return e&&e.source==="audioplaylist"}function od(e){return e&&e.source==="videoplaylist"}function W0(e){return e?!!(e!=null&&e.degraded):!1}function H0(e,t){return t&&e.tracks[t]?e.tracks[t].enabled:!1}function q0(e,t){return t&&e.tracks[t]?e.tracks[t].displayEnabled:!1}function Gm(e){var t;let i=!1,r=!1,n=!1;return(t=e==null?void 0:e.publishParams)!=null&&t.allowed&&(i=e.publishParams.allowed.includes("video"),r=e.publishParams.allowed.includes("audio"),n=e.publishParams.allowed.includes("screen")),{video:i,audio:r,screen:n}}var K0=(e=>(e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE",e))(K0||{}),J0=typeof window<"u"&&typeof window.expect<"u",y=class{static v(t,...i){this.log(0,t,...i)}static d(t,...i){this.log(1,t,...i)}static i(t,...i){this.log(2,t,...i)}static w(t,...i){this.log(3,t,...i)}static e(t,...i){this.log(6,t,...i)}static time(t){this.log(4,"[HMSPerformanceTiming]",t)}static timeEnd(t){this.log(5,"[HMSPerformanceTiming]",t,t)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(t,i,...r){if(!(this.level.valueOf()>t.valueOf()))switch(t){case 0:{console.log(i,...r);break}case 1:{console.debug(i,...r);break}case 2:{console.info(i,...r);break}case 3:{console.warn(i,...r);break}case 6:{console.error(i,...r);break}case 4:{performance.mark(r[0]);break}case 5:{let n=r[0];try{let s=performance.measure(n,n);this.log(1,i,n,s==null?void 0:s.duration),performance.clearMarks(n),performance.clearMeasures(n)}catch(s){this.log(1,i,n,s)}break}}}};y.level=J0?7:0;var zm=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}updateId(e){this.id=e}},Br=new Yk.UAParser,jt=typeof window<"u",op,ad=typeof window>"u"&&!((op=Br.getBrowser().name)!=null&&op.toLowerCase().includes("electron")),Ea=()=>Br.getDevice().type==="mobile",Q0=()=>typeof document<"u"&&document.hidden,ap=()=>{var e;return((e=Br.getOS().name)==null?void 0:e.toLowerCase())==="ios"},lp,up,Y0=((up=(lp=Br.getBrowser())==null?void 0:lp.name)==null?void 0:up.toLowerCase())==="firefox",Vm=e=>e?`{
    trackId: ${e.id};
    kind: ${e.kind};
    enabled: ${e.enabled};
    muted: ${e.muted};
    readyState: ${e.readyState};
  }`:"",ld=class{constructor(e,t,i){this.logIdentifier="",this.stream=e,this.nativeTrack=t,this.source=i}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return f(this,null,function*(){this.nativeTrack.enabled=e})}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}cleanup(){var e;y.d("[HMSTrack]","Stopping track",this.toString()),(e=this.nativeTrack)==null||e.stop()}toString(){var e;return`{
      streamId: ${this.stream.id};
      peerId: ${this.peerId};
      trackId: ${this.trackId};
      mid: ${((e=this.transceiver)==null?void 0:e.mid)||"-"};
      logIdentifier: ${this.logIdentifier};
      source: ${this.source};
      enabled: ${this.enabled};
      nativeTrack: ${Vm(this.nativeTrack)};
    }`}},ud=class extends ld{constructor(e,t,i){if(super(e,t,i),this.type="audio",this.audioElement=null,t.kind!=="audio")throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?this.audioElement.volume*100:null}setVolume(e){return f(this,null,function*(){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");yield this.subscribeToAudio(e===0?!1:this.enabled),this.audioElement&&(this.audioElement.volume=e/100)})}setAudioElement(e){y.d("[HMSAudioTrack]",this.logIdentifier,"adding audio element",`${this}`,e),this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return f(this,null,function*(){var t;if(!e){y.d("[HMSAudioTrack]",this.logIdentifier,"device is null",`${this}`);return}if(!this.audioElement){y.d("[HMSAudioTrack]",this.logIdentifier,"no audio element to set output",`${this}`),this.outputDevice=e;return}try{typeof this.audioElement.setSinkId=="function"&&(Y0||(yield(t=this.audioElement)==null?void 0:t.setSinkId(e.deviceId)),this.outputDevice=e)}catch(i){y.d("[HMSAudioTrack]","error in setSinkId",i)}})}subscribeToAudio(e){return f(this,null,function*(){this.stream instanceof pd&&(yield this.stream.setAudio(e,this.trackId,this.logIdentifier))})}},X0=(e=>(e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS",e))(X0||{});function Z0(){if(jt&&window){let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"?"LOCAL":e.includes("app.100ms.live")?"HMS":"CUSTOM"}return"CUSTOM"}var Ho=Z0(),he={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},APIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3004,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013,SELECTED_DEVICE_MISSING:3014},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006,STATS_FAILED:4007},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011,LOCAL_STORAGE_ACCESS_DENIED:6012,VALIDATION_FAILED:6013},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},ue=class Wm extends Error{constructor(t,i,r,n,s,o=!1){super(n),this.code=t,this.name=i,this.message=n,this.description=s,this.isTerminal=o,Object.setPrototypeOf(this,Wm.prototype),this.action=r.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(t){this.nativeError=t}toString(){var t;return`{
      code: ${this.code};
      name: ${this.name};
      action: ${this.action};
      message: ${this.message};
      description: ${this.description};
      isTerminal: ${this.isTerminal};
      nativeError: ${(t=this.nativeError)==null?void 0:t.message};
    }`}};function cp(e){switch(e){case"join":return"JOIN";case"offer":return"PUBLISH";case"answer":return"SUBSCRIBE";case"track-update":return"TRACK";default:return"NONE"}}var eT=["join","offer","answer","trickle","on-error","JOIN"],G={WebSocketConnectionErrors:{FailedToConnect(e,t=""){return new ue(he.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`)},WebSocketConnectionLost(e,t=""){return new ue(he.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost",t)},AbnormalClose(e,t=""){return new ue(he.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},APIErrors:{ServerErrors(e,t,i="",r=!0){return new ue(e,"ServerErrors",t,`[${t}]: Server error ${i}`,i,r)},EndpointUnreachable(e,t=""){return new ue(he.APIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t)},InvalidTokenFormat(e,t=""){return new ue(he.APIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0)},InitConfigNotAvailable(e,t=""){return new ue(he.APIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)}},TracksErrors:{GenericTrack(e,t=""){return new ue(he.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`)},CantAccessCaptureDevice(e,t,i=""){return new ue(he.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,i)},DeviceNotAvailable(e,t,i=""){return new ue(he.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,i)},DeviceInUse(e,t,i=""){return new ue(he.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,i)},DeviceLostMidway(e,t,i=""){return new ue(he.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,i)},NothingToReturn(e,t="",i="There is no media to return. Please select either video or audio or both."){return new ue(he.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,i,t)},InvalidVideoSettings(e,t=""){return new ue(he.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked(e,t=""){return new ue(he.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted(e,t=""){return new ue(he.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained(e,t,i=""){return new ue(he.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,i)},NoAudioDetected(e,t="Please check the mic or use another audio input"){return new ue(he.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission(e,t,i=""){return new ue(he.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,i)},CurrentTabNotShared(){return new ue(he.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared","TRACK","The app requires you to share the current tab","You must screen share the current tab in order to proceed")},AudioPlaybackError(e){return new ue(he.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error","TRACK",e,e)},SelectedDeviceMissing(e){return new ue(he.TracksErrors.SELECTED_DEVICE_MISSING,"SelectedDeviceMissing","TRACK",`Could not detect selected ${e} device`,`Please check connection to the ${e} device`,!1)}},WebrtcErrors:{CreateOfferFailed(e,t=""){return new ue(he.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t)},CreateAnswerFailed(e,t=""){return new ue(he.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t)},SetLocalDescriptionFailed(e,t=""){return new ue(he.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t)},SetRemoteDescriptionFailed(e,t=""){return new ue(he.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t,!0)},ICEFailure(e,t="",i=!1){return new ue(he.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t,i)},ICEDisconnected(e,t=""){return new ue(he.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,`[${e.toString()}]: Ice connection state DISCONNECTED`,t)},StatsFailed(e,t=""){return new ue(he.WebrtcErrors.STATS_FAILED,"StatsFailed",e,`Failed to WebRTC get stats - ${t}`,t)}},WebsocketMethodErrors:{ServerErrors(e,t,i){return new ue(e,"ServerErrors",t,i,i,eT.includes(t))},AlreadyJoined(e,t=""){return new ue(he.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e,t=""){return new ue(he.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e,t=""){return new ue(he.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling(e,t){return new ue(he.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t)},Unknown(e,t){return new ue(he.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t)},NotReady(e,t=""){return new ue(he.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t,i=""){return new ue(he.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,i)},TrackMetadataMissing(e,t=""){return new ue(he.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e,t=""){return new ue(he.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e,t=""){return new ue(he.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed(e,t){return new ue(he.GenericErrors.VALIDATION_FAILED,"ValidationFailed","VALIDATION",e,t?JSON.stringify(t):"")},InvalidRole(e,t){return new ue(he.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress(e,t=""){return new ue(he.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},LocalStorageAccessDenied(e="Access to localStorage has been denied"){return new ue(he.GenericErrors.LOCAL_STORAGE_ACCESS_DENIED,"LocalStorageAccessDenied","NONE","LocalStorageAccessDenied",e)},MissingMediaDevices(){return new ue(he.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices","JOIN","navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection(){return new ue(he.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection","JOIN","RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported(e,t=""){return new ue(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed(e,t=""){return new ue(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed(e,t=""){return new ue(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress(e,t=""){return new ue(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported(e,t=""){return new ue(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay(e,t){return new ue(he.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying(e,t){return new ue(he.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},tT=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(arguments.length===0)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},iT=()=>{try{jt&&!localStorage&&(window.localStorage=new tT)}catch{y.e("Error initialising localStorage",G.GenericErrors.LocalStorageAccessDenied())}},Ha=class{constructor(e){this.key=e,this.storage=null}getStorage(){try{return jt&&!this.storage&&(iT(),this.storage=window.localStorage),this.storage}catch{return y.e("Error initialising localStorage",G.GenericErrors.LocalStorageAccessDenied()),null}}get(){var e;let t=(e=this.getStorage())==null?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);(t=this.getStorage())==null||t.setItem(this.key,i)}clear(){var e;(e=this.getStorage())==null||e.removeItem(this.key)}},rT=()=>{let e,t=new Ha("hms-analytics-deviceId"),i=t.get();return i?e=i:(e=Cr(),t.set(e)),e},Hm="[VALIDATIONS]";function Sr(e){return e!=null}var dp=()=>{if(!Sr(RTCPeerConnection)){let e=G.GenericErrors.MissingRTCPeerConnection();throw y.e(Hm,e),e}},hp=()=>{if(!Sr(navigator.mediaDevices)){let e=G.GenericErrors.MissingMediaDevices();throw y.e(Hm,e),e}},pp=Um().version;function zu(e="prod",t){let i="web",r=Ho!=="LOCAL"&&e==="prod"?"prod":"debug";if(ad)return fp({os:"web_nodejs",os_version:process.version,sdk:i,sdk_version:pp,env:r,domain:Ho,is_prebuilt:!!(t!=null&&t.isPrebuilt),framework:"node",framework_version:process.version,framework_sdk_version:t==null?void 0:t.sdkVersion});let n=Br.getOS(),s=Br.getDevice(),o=Br.getBrowser(),a=Ol(`web_${n.name}`),l=n.version||"",u=Ol(`${o.name}_${o.version}`),c=u;return s.type&&(c=`${Ol(`${s.vendor}_${s.type}`)}/${u}`),fp({os:a,os_version:l,sdk:i,sdk_version:pp,device_model:c,env:r,domain:Ho,is_prebuilt:!!(t!=null&&t.isPrebuilt),framework:t==null?void 0:t.type,framework_version:t==null?void 0:t.version,framework_sdk_version:t==null?void 0:t.sdkVersion})}function Ol(e){return e.replace(/ /g,"_")}var fp=(e,t=",")=>Object.keys(e).filter(i=>Sr(e[i])).map(i=>`${i}:${e[i]}`).join(t),De=class{constructor({name:e,level:t,properties:i,includesPII:r,timestamp:n}){this.metadata={peer:{},userAgent:zu()},this.name=e,this.level=t,this.includesPII=r||!1,this.properties=i||{},this.timestamp=n||new Date().getTime(),this.event_id=Cr(),this.device_id=rT()}toSignalParams(){return{name:this.name,info:Ee(H({},this.properties),{timestamp:this.timestamp,domain:Ho}),timestamp:new Date().getTime()}}},ke=class{static connect(e,t,i=new Date,r=new Date,n){let s=this.eventNameFor("connect",e===void 0),o=e?2:1,a=this.getPropertiesWithError(Ee(H({},t),{[this.KEY_REQUESTED_AT]:i==null?void 0:i.getTime(),[this.KEY_RESPONDED_AT]:r==null?void 0:r.getTime(),endpoint:n}),e);return new De({name:s,level:o,properties:a})}static disconnect(e,t){let i="disconnected",r=e?2:1,n=this.getPropertiesWithError(t,e);return new De({name:i,level:r,properties:n})}static preview(e){var t=e,{error:i}=t,r=sp(t,["error"]);let n=this.eventNameFor("preview",i===void 0),s=i?2:1,o=this.getPropertiesWithError(r,i);return new De({name:n,level:s,properties:o})}static join(e){var t=e,{error:i}=t,r=sp(t,["error"]);let n=this.eventNameFor("join",i===void 0),s=i?2:1,o=this.getPropertiesWithError(Ee(H({},r),{is_preview_called:!!r.is_preview_called}),i);return new De({name:n,level:s,properties:o})}static publish({devices:e,settings:t,error:i}){let r=this.eventNameFor("publish",i===void 0),n=i?2:1,s=this.getPropertiesWithError({devices:e,audio:t==null?void 0:t.audio,video:t==null?void 0:t.video},i);return new De({name:r,level:n,properties:s})}static hlsPlayerError(e){return new De({name:"hlsPlayerError",level:2,properties:this.getErrorProperties(e)})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=2,r=this.getErrorProperties(e);return new De({name:t,level:i,properties:r})}static leave(){return new De({name:"leave",level:1})}static autoplayError(){return new De({name:"autoplayError",level:2})}static audioPlaybackError(e){return new De({name:"audioPlaybackError",level:2,properties:this.getErrorProperties(e)})}static deviceChange({isUserSelection:e,selection:t,type:i,devices:r,error:n}){let s=this.eventNameFor(n?"publish":`device.${i}`,n===void 0),o=n?2:1,a=this.getPropertiesWithError({selection:t,devices:r,isUserSelection:e},n);return new De({name:s,level:o,properties:a})}static performance(e){let t="perf.stats",i=1,r=e.toAnalyticsProperties();return new De({name:t,level:i,properties:r})}static rtcStats(e){let t="rtc.stats",i=1,r=e.toAnalyticsProperties();return new De({name:t,level:i,properties:r})}static rtcStatsFailed(e){let t="rtc.stats.failed",i=2;return new De({name:t,level:i,properties:this.getErrorProperties(e)})}static degradationStats(e,t){let i="video.degradation.stats",r=1,n={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let s=new Date,o=s.valueOf()-e.degradedAt.valueOf();n=Ee(H({},n),{duration:o,restoredAt:s})}return new De({name:i,level:r,properties:n})}static audioDetectionFail(e,t){let i=this.getPropertiesWithError({device:t},e),r=2,n="audiopresence.failed";return new De({name:n,level:r,properties:i})}static previewNetworkQuality(e){return new De({name:"perf.networkquality.preview",level:e.error?2:1,properties:e})}static publishStats(e){return new De({name:"publisher.stats",level:1,properties:e})}static subscribeStats(e){return new De({name:"subscriber.stats",level:1,properties:e})}static getKrispUsage(e){return new De({name:"krisp.usage",level:1,properties:{duration:e}})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let i=this.getErrorProperties(t);return e=H(H({},i),e),e}static getErrorProperties(e){return e?e instanceof ue?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};ke.KEY_REQUESTED_AT="requested_at",ke.KEY_RESPONDED_AT="responded_at";var nT=class{constructor(){this.storage=new Ha("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:i}){if(!this.devices||!this.remember)return;let r=this.devices[e].find(s=>this.isSame({deviceId:t,groupId:i},s));if(!r){y.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${i}`);return}let n=this.storage.get()||{};n[e]=r,this.storage.set(n)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},qi=new nT,sT=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(sT||{}),oT=(e=>(e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED",e))(oT||{}),bn=class{static failure(e,t){let i="mediaPlugin.failed",r=2,n=H({plugin_name:e},t.toAnalyticsProperties());return new De({name:i,level:r,properties:n})}static audioPluginFailure(e,t,i){let r="mediaPlugin.failed",n=2,s=H({plugin_name:e,sampleRate:t},i.toAnalyticsProperties());return new De({name:r,level:n,properties:s})}static audioPluginStats({pluginName:e,duration:t,loadTime:i,sampleRate:r}){let n="mediaPlugin.stats",s=1,o={plugin_name:e,duration:t,load_time:i,sampleRate:r};return new De({name:n,level:s,properties:o})}static added(e,t){let i="mediaPlugin.added",r=1,n={plugin_name:e,added_at:t};return new De({name:i,level:r,properties:n})}static stats({pluginName:e,duration:t,loadTime:i,avgPreProcessingTime:r,avgProcessingTime:n,inputFrameRate:s,pluginFrameRate:o}){let a="mediaPlugin.stats",l=1,u={plugin_name:e,duration:t,load_time:i,avg_preprocessing_time:r,avg_processing_time:n,input_frame_rate:s,plugin_frame_rate:o};return new De({name:a,level:l,properties:u})}},aT=class{constructor(e){this.eventBus=e,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t,this.eventBus.analytics.publish(bn.added(e,this.addedTimestamps[e]))}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(bn.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(bn.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return f(this,null,function*(){if(this.initTime[e]){y.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),y.i(this.TAG,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=G.MediaPluginErrors.InitFailed("AUDIO_PLUGINS",`failed during initialization of plugin${r.message||r}`);throw y.e(this.TAG,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}timeInMs(e){return f(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},lT=48e3,uT=()=>navigator.userAgent.indexOf("Firefox")!==-1,cT=class{constructor(e,t){this.eventBus=t,this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new aT(t),this.createAudioContext()}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return f(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!i){y.w("no name provided by the plugin");return}if(this.pluginAddInProgress){let r=G.MediaPluginErrors.AddAlreadyInProgress("AUDIO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.added(i,this.audioContext.sampleRate),this.analytics.failure(i,r),y.w("can't add another plugin when previous add is in progress"),r}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e){return f(this,null,function*(){var t,i;let r=(t=e.getName)==null?void 0:t.call(e);if(this.pluginsMap.get(r)){y.w(this.TAG,`plugin - ${r} already added.`);return}yield this.validateAndThrow(r,e),(i=e.setEventBus)==null||i.call(e,this.eventBus);try{this.pluginsMap.size===0?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(r,this.audioContext.sampleRate),yield this.analytics.initWithTime(r,()=>f(this,null,function*(){return e.init()})),this.pluginsMap.set(r,e),yield this.processPlugin(e),yield this.connectToDestination()}catch(n){throw y.e(this.TAG,"failed to add plugin",n),n}})}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return f(this,null,function*(){let i=this.validatePlugin(t);if(i.isSupported)y.i(this.TAG,`plugin is supported,- ${t.getName()}`);else if(this.analytics.added(e,this.audioContext.sampleRate),i.errType==="PLATFORM_NOT_SUPPORTED"){let r=G.MediaPluginErrors.PlatformNotSupported("AUDIO_PLUGINS","platform not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}else if(i.errType==="DEVICE_NOT_SUPPORTED"){let r=G.MediaPluginErrors.DeviceNotSupported("AUDIO_PLUGINS","audio device not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}})}removePlugin(e){return f(this,null,function*(){yield this.removePluginInternal(e),this.pluginsMap.size===0?(yield this.cleanup(),y.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()})}cleanup(){return f(this,null,function*(){var e,t,i;for(let r of this.pluginsMap.values())yield this.removePluginInternal(r);yield this.hmsTrack.setProcessedTrack(void 0),(e=this.sourceNode)==null||e.disconnect(),(t=this.prevAudioNode)==null||t.disconnect(),(i=this.outputTrack)==null||i.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0})}closeContext(){return f(this,null,function*(){var e;(e=this.audioContext)==null||e.close(),this.audioContext=void 0})}reprocessPlugins(){return f(this,null,function*(){if(this.pluginsMap.size===0||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t)})}initAudioNodes(){return f(this,null,function*(){if(this.audioContext){if(!this.sourceNode){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e)}if(!this.destinationNode){this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0];try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw y.e(this.TAG,"error in setting processed track",e),e}}}})}processPlugin(e){return f(this,null,function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let i=e.getName();y.e(this.TAG,`error in processing plugin ${i}`,t),yield this.removePluginInternal(e)}})}connectToDestination(){return f(this,null,function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){y.e(this.TAG,"error in connecting to destination node",e)}})}removePluginInternal(e){return f(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!this.pluginsMap.get(i)){y.w(this.TAG,`plugin - ${i} not found to remove.`);return}y.i(this.TAG,`removing plugin ${i}`),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)})}createAudioContext(){this.audioContext||(uT()?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:lT}))}};function dT(e,t){let i=e.toLowerCase();return i.includes("device not found")?G.TracksErrors.DeviceNotAvailable("TRACK",t,e):i.includes("permission denied")?G.TracksErrors.CantAccessCaptureDevice("TRACK",t,e):G.TracksErrors.GenericTrack("TRACK",e)}function hT(e,t=""){if(Kh.browserDetails.browser==="chrome"&&e.name==="NotAllowedError"&&e.message.includes("denied by system"))return G.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);if(Kh.browserDetails.browser==="firefox"&&e.name==="NotFoundError"){let i=G.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);return i.description=`Capture device is either blocked at Operating System level or not available - ${t}`,i}switch(e.name){case"OverconstrainedError":return G.TracksErrors.OverConstrained("TRACK",t,e.constraint);case"NotAllowedError":return G.TracksErrors.CantAccessCaptureDevice("TRACK",t,e.message);case"NotFoundError":return G.TracksErrors.DeviceNotAvailable("TRACK",t,e.message);case"NotReadableError":return G.TracksErrors.DeviceInUse("TRACK",t,e.message);case"TypeError":return G.TracksErrors.NothingToReturn("TRACK",e.message);default:return dT(e.message,t)}}function wa(e,t){let i=hT(e,t);return i.addNativeError(e),i}function pT(e){return f(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:e?e.toConstraints():!1})).getAudioTracks()[0]}catch(t){throw wa(t,"audio")}})}function fT(e){return f(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:e?e.toConstraints():!1})).getVideoTracks()[0]}catch(t){throw wa(t,"video")}})}function Cn(e){return"canvas"in e||e.label==="MediaStreamAudioDestinationNode"||e.label===""}var qa={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext(){return f(this,null,function*(){try{return yield this.getAudioContext().resume()}catch(e){y.e("AudioContext",e)}})}},cd=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}},qm=`(function workerSetup() {
  function ticker() {
    self.postMessage('tick');
  }
  self.onmessage = function (event) {
    const [data, time] = event.data;
    switch (data) {
      case 'start':
        setTimeout(ticker, time);
        break;
      default:
        break;
    }
  };
})()`;function Ki(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(t=>{setTimeout(t,e)})}function Ka(e){if(e<0)throw Error("`ms` should be a positive integer");if(typeof Worker>"u")return Ki(e);let t=new Worker(URL.createObjectURL(new Blob([qm],{type:"application/javascript"})));return t.postMessage(["start",e]),new Promise(i=>{t.onmessage=r=>{r.data==="tick"&&(i(),t.terminate())}})}function vT(){if(typeof Worker>"u")return{sleep:t=>Ki(t)};let e=new Worker(URL.createObjectURL(new Blob([qm],{type:"application/javascript"})));return{sleep:t=>(e.postMessage(["start",t]),new Promise(i=>{e.onmessage=r=>{r.data==="tick"&&i()}}))}}function Km(e,t=300){let i;return function(...r){clearTimeout(i),i=void 0;let n=this;i=setTimeout(()=>{e.apply(n,r)},t)}}var mT=35,gT=5,yT=class{constructor(e,t,i){this.track=e,this.audioLevelEvent=t,this.silenceEvent=i,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new cd(this.historyInterval/this.interval),this.detectSilence=()=>f(this,null,function*(){let r=0;for(;this.isMonitored;){if(this.track.enabled)if(this.isSilentThisInstant()){if(r++,r>50){this.silenceEvent.publish({track:this.track});break}}else break;yield Ki(20)}});try{let r=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(r)}catch(r){y.w(this.TAG,"Unable to initialize AudioContext",r)}}start(){this.stop(),this.isMonitored=!0,y.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then(()=>y.d(this.TAG,"Stopping track Monitor",`${this.track}`))}stop(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}this.sendAudioLevel(0),this.isMonitored=!1}loop(){return f(this,null,function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Ki(this.interval)})}sendAudioLevel(e=0){if(e=e>mT?e:0,Math.abs(this.audioLevel-e)>gT){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=this.calculateAudioLevel();return e!==void 0&&this.history.enqueue(e),this.history.aggregate(t=>Math.max(...t))}calculateAudioLevel(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);let t=.009,i=t;for(let n of e)i=Math.max(i,(n-128)/128);let r=(Math.log(t)-Math.log(i))/Math.log(t);return Math.ceil(Math.min(Math.max(r*100,0),100))}isSilentThisInstant(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some(t=>t!==128&&t!==0)}createAnalyserNodeForStream(e){let t=qa.getAudioContext(),i=t.createAnalyser();return t.createMediaStreamSource(e).connect(i),i}},ST=(e=>(e.SIP="sip",e.REGULAR="regular",e))(ST||{}),kT=(e=>(e.NONE="none",e.INITIALISED="initialised",e.STARTED="started",e.PAUSED="paused",e.RESUMED="resumed",e.STOPPED="stopped",e.FAILED="failed",e))(kT||{}),TT=(e=>(e.DVR="dvr",e.NO_DVR="no-dvr",e))(TT||{}),bT=(e=>(e.REGULAR="regular",e.SCREEN="screen",e.COMPOSITE="composite",e))(bT||{}),CT=(e=>(e.STARTED="started",e.STOPPED="stopped",e.FAILED="failed",e))(CT||{}),ET=(e=>(e.CAPTION="caption",e))(ET||{}),wT={f:"high",h:"medium",q:"low"},PT=(e=>(e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput",e))(PT||{}),$s=class{constructor(){this._volume=1,this._codec="opus",this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new dd(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}},dd=class{constructor(e,t,i,r,n){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=r,this.advanced=n}toConstraints(){return{deviceId:this.deviceId,advanced:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},xn=class{constructor(){this._width=320,this._height=180,this._codec="vp8",this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if(typeof e=="number"&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}facingMode(e){return this._facingMode=e,this}build(){return new hd(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate,this._facingMode)}},hd=class{constructor(e,t,i,r,n,s,o,a){this.width=e,this.height=t,this.codec=i,this.maxFramerate=r,this.maxBitrate=o,this.deviceId=n,this.advanced=s,this.facingMode=a}toConstraints(e){let t="ideal";e&&(t="max");let i=this.improviseConstraintsAspect();return{width:{[t]:i.width},height:{[t]:i.height},frameRate:this.maxFramerate,deviceId:this.deviceId,facingMode:this.facingMode}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec,facingMode:this.facingMode}}improviseConstraintsAspect(){return Ea()&&this.height&&this.width&&this.height>this.width?{width:this.height,height:this.width}:{width:this.width,height:this.height}}},vp=class{constructor(){this._video=new xn().build(),this._audio=new $s().build(),this._screen=new xn().build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(this._audio===null&&this._video===null)throw G.TracksErrors.NothingToReturn("TRACK");if(this._video===null&&this._simulcast)throw G.TracksErrors.InvalidVideoSettings("TRACK","Cannot enable simulcast when no video settings are provided");return new Vu(this._video,this._audio,this._simulcast,this._screen||void 0)}},Vu=class{constructor(e,t,i,r=null){this.video=e,this.audio=t,this.simulcast=i,this.screen=r}toAnalyticsProperties(){let e={audio_enabled:this.audio!==null,video_enabled:this.video!==null};return this.audio&&(e=H(H({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=H(H({},this.video.toAnalyticsProperties()),e)),e}};function mp(e,t){return function(i){return!qv(e[i],t[i])}}var En=class Wu extends ud{constructor(t,i,r,n,s=new $s().build()){super(t,i,r),this.eventBus=n,this.TAG="[HMSLocalAudioTrack]",this.isPublished=!1,this.handleVisibilityChange=()=>f(this,null,function*(){document.visibilityState==="visible"&&(yield this.replaceTrackWith(this.settings))}),this.replaceSenderTrack=()=>f(this,null,function*(){if(!this.transceiver||this.transceiver.direction!=="sendonly"){y.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`);return}yield this.transceiver.sender.replaceTrack(this.processedTrack||this.nativeTrack)}),this.handleSettingsChange=o=>f(this,null,function*(){let a=this.stream,l=mp(o,this.settings);l("maxBitrate")&&o.maxBitrate&&(yield a.setMaxBitrateAndFramerate(this)),l("advanced")&&(yield this.replaceTrackWith(o))}),this.handleDeviceChange=(o,a=!1)=>f(this,null,function*(){if(mp(o,this.settings)("deviceId")){this.manuallySelectedDeviceId=a?this.manuallySelectedDeviceId:o.deviceId,y.d(this.TAG,"device change","manual selection:",this.manuallySelectedDeviceId,"new device:",o.deviceId),yield this.replaceTrackWith(o);let l=this.nativeTrack.getSettings().groupId;!a&&o.deviceId&&(qi.updateSelection("audioInput",{deviceId:o.deviceId,groupId:l}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"audioInput",selection:{deviceId:o.deviceId,groupId:l}}))}}),t.tracks.push(this),this.settings=s,s.deviceId!==i.getSettings().deviceId&&!Cn(i)&&(this.settings=this.buildNewSettings({deviceId:i.getSettings().deviceId})),this.pluginsManager=new cT(this,n),this.setFirstTrackId(i.id),ap()&&jt&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}getManuallySelectedDeviceId(){return this.manuallySelectedDeviceId}resetManuallySelectedDeviceId(){this.manuallySelectedDeviceId=void 0}replaceTrackWith(t){return f(this,null,function*(){let i=this.nativeTrack;i==null||i.stop();let r=!!this.audioLevelMonitor;try{let n=yield pT(t);n.enabled=this.enabled,y.d(this.TAG,"replaceTrack, Previous track stopped",i,"newTrack",n),yield this.stream.replaceStreamTrack(i,n),this.nativeTrack=n,yield this.replaceSenderTrack(),r&&this.initAudioLevelMonitor()}catch(n){throw this.isPublished&&this.eventBus.analytics.publish(ke.publish({error:n})),n}try{yield this.pluginsManager.reprocessPlugins()}catch(n){this.eventBus.audioPluginFailed.publish(n)}})}setEnabled(t){return f(this,null,function*(){t!==this.enabled&&(t&&Cn(this.nativeTrack)&&(yield this.replaceTrackWith(this.settings)),yield Gi(Wu.prototype,this,"setEnabled").call(this,t),t&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:t,track:this}))})}isPublishedTrackId(t){return this.publishedTrackId===t}setSettings(t,i=!1){return f(this,null,function*(){let r=this.buildNewSettings(t);if(Cn(this.nativeTrack)){this.settings=r;return}yield this.handleDeviceChange(r,i),yield this.handleSettingsChange(r),this.settings=r})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(t){return f(this,null,function*(){return this.pluginsManager.addPlugin(t)})}removePlugin(t){return f(this,null,function*(){return this.pluginsManager.removePlugin(t)})}validatePlugin(t){return this.pluginsManager.validatePlugin(t)}setProcessedTrack(t){return f(this,null,function*(){t?t!==this.processedTrack&&(this.processedTrack=t):this.processedTrack=void 0,yield this.replaceSenderTrack()})}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),y.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new yT(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var t;(t=this.audioLevelMonitor)==null||t.stop(),this.audioLevelMonitor=void 0}cleanup(){return f(this,null,function*(){var t;Gi(Wu.prototype,this,"cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),this.transceiver=void 0,(t=this.processedTrack)==null||t.stop(),this.isPublished=!1,this.destroyAudioLevelMonitor(),ap()&&jt&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}buildNewSettings(t){let{volume:i,codec:r,maxBitrate:n,deviceId:s,advanced:o}=H(H({},this.settings),t);return new dd(i,r,n,s,o)}},Ks=class Jm extends ud{setEnabled(t){return f(this,null,function*(){t!==this.enabled&&(yield Gi(Jm.prototype,this,"setEnabled").call(this,t),yield this.subscribeToAudio(t))})}},Qm=class extends ld{constructor(e,t,i){if(super(e,t,i),this.type="video",this.sinkCount=0,t.kind!=="video")throw new Error("Expected 'track' kind = 'video'")}setVideoHandler(e){this.videoHandler=e}hasSinks(){return this.sinkCount>0}getSinks(){return this.videoHandler.getVideoElements()||[]}attach(e){this.videoHandler.addVideoElement(e)}detach(e){this.videoHandler.removeVideoElement(e)}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){e.srcObject!==null&&(e.srcObject=null,this.reduceSinkCount())}cleanup(){super.cleanup(),this.videoHandler.cleanup()}addSinkInternal(e,t){let i=e.srcObject;if(i!==null&&i instanceof MediaStream){let r=i.getVideoTracks()[0];if((r==null?void 0:r.id)===t.id){if(!r.muted&&r.readyState==="live")return;this.reduceSinkCount()}else this.reduceSinkCount()}e.srcObject=new MediaStream([t]),this.sinkCount++}reduceSinkCount(){this.sinkCount>0&&this.sinkCount--}},Pa={none:-1,low:0,medium:1,high:2},RT=.5,AT=(e,t)=>{let i="high",r=t.width>t.height?"width":"height",n=[...e].sort((o,a)=>Pa[o.layer]-Pa[a.layer]),s=t[r]*((window==null?void 0:window.devicePixelRatio)||1);for(let o=0;o<n.length;o++){let{resolution:a,layer:l}=n[o],u=a[r];if(s<=u){i=l;break}else{let c=n[o+1],h=c?c.resolution[r]:Number.POSITIVE_INFINITY;if((s-u)/(h-u)<RT){i=l;break}}}return i},_T=class{constructor(){this.TAG="[HMSIntersectionObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t)=>{var i;this.createObserver(),this.unobserve(e),(i=this.intersectionObserver)==null||i.observe(e),this.listeners.set(e,t)},this.unobserve=e=>{var t;(t=this.intersectionObserver)==null||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.intersectionObserver&&(this.intersectionObserver=new IntersectionObserver(this.handleIntersection))},this.handleIntersection=e=>{var t;for(let i of e)(t=this.listeners.get(i.target))==null||t(i)},this.createObserver()}isSupported(){let e=jt&&typeof window.IntersectionObserver<"u";return e||y.w(this.TAG,"IntersectionObserver is not supported, fallback will be used instead"),e}},IT=new _T,LT=class{constructor(){this.TAG="[HMSResizeObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t,i={box:"border-box"})=>{var r;this.createObserver(),this.unobserve(e),(r=this.resizeObserver)==null||r.observe(e,i),this.listeners.set(e,t)},this.unobserve=e=>{var t;(t=this.resizeObserver)==null||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.resizeObserver&&(this.resizeObserver=new ResizeObserver(Km(this.handleResize,300)))},this.handleResize=e=>{var t;for(let i of e)(t=this.listeners.get(i.target))==null||t(i)},this.createObserver()}isSupported(){let e=jt&&typeof window.ResizeObserver<"u";return e||y.w(this.TAG,"Resize Observer is not supported"),e}},DT=new LT,Ym=class{constructor(e){this.track=e,this.TAG="[VideoElementManager]",this.videoElements=new Set,this.entries=new WeakMap,this.handleIntersection=t=>f(this,null,function*(){let i=getComputedStyle(t.target).visibility==="visible";this.track.enabled&&(t.isIntersecting&&i||!document.contains(t.target))?(y.d(this.TAG,"add sink intersection",`${this.track}`,this.id),this.entries.set(t.target,t.boundingClientRect),yield this.selectMaxLayer(),yield this.track.addSink(t.target)):(y.d(this.TAG,"remove sink intersection",`${this.track}`,this.id),yield this.track.removeSink(t.target))}),this.handleResize=t=>f(this,null,function*(){!this.track.enabled||!(this.track instanceof ni)||(this.entries.set(t.target,t.contentRect),yield this.selectMaxLayer())}),this.cleanup=()=>{this.videoElements.forEach(t=>{var i,r;t.srcObject=null,(i=this.resizeObserver)==null||i.unobserve(t),(r=this.intersectionObserver)==null||r.unobserve(t)}),this.videoElements.clear(),this.resizeObserver=void 0,this.intersectionObserver=void 0},this.init(),this.id=Cr()}updateSinks(e=!1){for(let t of this.videoElements)this.track.enabled?this.track.addSink(t,e):this.track.removeSink(t,e)}addVideoElement(e){return f(this,null,function*(){var t;this.videoElements.has(e)||(this.init(),y.d(this.TAG,`Adding video element for ${this.track}`,this.id),this.videoElements.add(e),this.videoElements.size>=10&&y.w(this.TAG,`${this.track}`,`the track is added to ${this.videoElements.size} video elements, while this may be intentional, it's likely that there is a bug leading to unnecessary creation of video elements in the UI`),(t=this.intersectionObserver)!=null&&t.isSupported()?this.intersectionObserver.observe(e,this.handleIntersection):jt&&(this.isElementInViewport(e)?this.track.addSink(e):this.track.removeSink(e)),this.resizeObserver?this.resizeObserver.observe(e,this.handleResize):this.track instanceof ni&&(yield this.track.setPreferredLayer(this.track.getPreferredLayer())))})}removeVideoElement(e){var t,i;this.track.removeSink(e),this.videoElements.delete(e),this.entries.delete(e),(t=this.resizeObserver)==null||t.unobserve(e),(i=this.intersectionObserver)==null||i.unobserve(e),y.d(this.TAG,`Removing video element for ${this.track}`)}getVideoElements(){return Array.from(this.videoElements)}init(){jt&&(this.resizeObserver=DT,this.intersectionObserver=IT)}isElementInViewport(e){let t=e.offsetTop,i=e.offsetLeft,r=e.offsetWidth,n=e.offsetHeight,{hidden:s}=e,{opacity:o,display:a}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop,i+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&t+n>window.pageYOffset&&i+r>window.pageXOffset&&!s&&(o!==""?parseFloat(o)>0:!0)&&a!=="none"}selectMaxLayer(){return f(this,null,function*(){if(!(this.track instanceof ni)||this.videoElements.size===0)return;let e;for(let t of this.videoElements){let i=this.entries.get(t);if(!i)continue;let{width:r,height:n}=i;if(r===0||n===0)continue;let s=AT(this.track.getSimulcastDefinitions(),{width:r,height:n});e?e=Pa[s]>Pa[e]?s:e:e=s}e&&(y.d(this.TAG,`selecting max layer ${e} for the track`,`${this.track}`),yield this.track.setPreferredLayer(e))})}},MT=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(MT||{}),OT=(e=>(e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2",e))(OT||{}),gp=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},Xm=class{constructor(e){this.eventBus=e,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new gp,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new gp,t&&(this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t),this.eventBus.analytics.publish(bn.added(e,this.addedTimestamps[e]))}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:(t=this.processingAvgs[e])==null?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(bn.stats(i)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(bn.failure(e,t)),this.clean(e))}initWithTime(e,t){return f(this,null,function*(){if(this.initTime[e]){y.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),y.i(this.TAG,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=G.MediaPluginErrors.InitFailed("VIDEO_PLUGINS",`failed during initialization of plugin${r.message||r}`);throw y.e(this.TAG,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}preProcessWithTime(e){return f(this,null,function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)})}processWithTime(e,t){return f(this,null,function*(){var i;let r;try{r=yield this.timeInMs(t)}catch(n){let s=G.MediaPluginErrors.ProcessingFailed("VIDEO_PLUGINS",`Failed during processing of plugin${n.message||n}`);throw y.e(this.TAG,s),this.failure(e,s),s}r&&((i=this.processingAvgs[e])==null||i.add(r))})}timeInMs(e){return f(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},yp=24,xT=320,NT=240,UT=class{constructor(e,t){this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.reusableWorker=vT(),this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new Xm(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return f(this,null,function*(){var i;if(this.pluginAddInProgress){let r=(i=e.getName)==null?void 0:i.call(e);if(!r||r===""){y.w("no name provided by the plugin");return}let n=G.MediaPluginErrors.AddAlreadyInProgress("VIDEO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.failure(r,n),y.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e,t){return f(this,null,function*(){var i,r;let n=(i=e.getName)==null?void 0:i.call(e);if(!n||n===""){y.w("no name provided by the plugin");return}if(this.pluginsMap.has(n)){y.w(this.TAG,`plugin - ${e.getName()} already added.`);return}let s=this.hmsTrack.getMediaTrackSettings().frameRate||yp,o=0;t&&t>0?(y.i(this.TAG,`adding plugin ${e.getName()} with framerate ${t}`),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(n,s,t)):(y.i(this.TAG,`adding plugin ${e.getName()}`),this.analytics.added(n,s)),y.i(this.TAG,"numFrames to skip processing",o),this.pluginNumFramesToSkip[n]=o,this.pluginNumFramesSkipped[n]=o,this.validateAndThrow(n,e);try{if(yield this.analytics.initWithTime(n,()=>f(this,null,function*(){return yield e.init()})),this.pluginsMap.set(n,e),this.pluginsMap.size+1>this.canvases.length)for(let a=this.canvases.length;a<=this.pluginsMap.size;a++)this.canvases[a]=document.createElement("canvas");yield this.startPluginsLoop((r=e.getContextType)==null?void 0:r.call(e))}catch(a){throw y.e(this.TAG,"failed to add plugin",a),yield this.removePlugin(e),a}})}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let i=this.validatePlugin(t);if(i.isSupported)y.i(this.TAG,`plugin is supported,- ${t.getName()}`);else{let r;switch(i.errType){case"PLATFORM_NOT_SUPPORTED":throw r=G.MediaPluginErrors.PlatformNotSupported("VIDEO_PLUGINS","platform not supported, see docs"),this.analytics.failure(e,r),r;case"DEVICE_NOT_SUPPORTED":throw r=G.MediaPluginErrors.DeviceNotSupported("VIDEO_PLUGINS","video device not supported, see docs"),this.analytics.failure(e,r),r}}}removePlugin(e){return f(this,null,function*(){let t=e.getName();if(!this.pluginsMap.get(t)){y.w(this.TAG,`plugin - ${t} not found to remove.`);return}y.i(this.TAG,`removing plugin ${t}`),this.removePluginEntry(t),this.pluginsMap.size===0&&(y.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)})}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return f(this,null,function*(){if(!(!this.pluginsLoopRunning||this.pluginsLoopState==="running"))for(;this.pluginsLoopState==="paused";)yield Ka(100)})}cleanup(){return f(this,null,function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);(e=this.outputTrack)==null||e.stop()})}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||"2d");let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return f(this,null,function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(t){throw this.pluginsLoopRunning=!1,y.e(this.TAG,"error in setting processed track",t),t}this.pluginsLoop().then(()=>{y.d(this.TAG,"processLoop stopped")})}})}stopPluginsLoop(){return f(this,null,function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),(e=this.outputTrack)==null||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)})}pluginsLoop(){return f(this,null,function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||yp,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||this.hmsTrack.nativeTrack.readyState==="ended"){this.pluginsLoopState==="running"&&this.resetCanvases(),this.pluginsLoopState="paused",yield this.reusableWorker.sleep(t);continue}let i=0;try{yield this.analytics.preProcessWithTime(()=>f(this,null,function*(){return yield this.doPreProcessing()}));let r=Date.now();yield this.processFramesThroughPlugins(),i=Math.floor(Date.now()-r),i>t&&(i=t)}catch(r){y.e(this.TAG,"error in plugins loop",r)}this.pluginsLoopState="running",yield this.reusableWorker.sleep(t-i)}})}doPreProcessing(){return f(this,null,function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()})}processFramesThroughPlugins(){return f(this,null,function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let i=t.getName();if(t){try{let r=this.checkIfSkipRequired(i);if(t.getPluginType()==="TRANSFORM"){let n=(s,o)=>f(this,null,function*(){try{yield t.processVideoFrame(s,o,r)}catch(a){y.e(this.TAG,`error in processing plugin ${i}`,a)}});if(r)e===this.pluginsMap.size-1?yield n(this.canvases[e],this.outputCanvas):yield n(this.canvases[e],this.canvases[e+1]);else{let s=this.canvases[e],o=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(i,()=>f(this,null,function*(){return n(s,this.outputCanvas)})):yield this.analytics.processWithTime(i,()=>f(this,null,function*(){return n(s,o)}))}}else t.getPluginType()==="ANALYZE"&&!r&&(yield this.analytics.processWithTime(i,()=>f(this,null,function*(){return yield t.processVideoFrame(this.inputCanvas)})))}catch(r){y.e(this.TAG,`error in processing plugin ${i}`,r),yield this.removePlugin(t)}e++}}})}addTrackToVideo(){return f(this,null,function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;t!==null&&t instanceof MediaStream&&((e=t.getVideoTracks()[0])==null?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())})}updateInputCanvas(){return f(this,null,function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=xT,height:t=NT}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)})}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}},FT=class{constructor(e){this.plugins=new Set,this.analytics=new Xm(e)}addPlugins(e){e.forEach(t=>this.plugins.add(t))}removePlugins(e){e.forEach(t=>{t.stop(),this.analytics.removed(t.getName()),this.plugins.delete(t)})}applyPlugins(e){let t=e;for(let i of this.plugins){let r=i.getName();try{t=i.apply(t),this.analytics.added(r)}catch(n){this.analytics.failure(r,n),y.e("Could not apply plugin",n,r)}}return t}getPlugins(){return Array.from(this.plugins).map(e=>e.getName())}},$T=["init_response_time","ws_connect_time","on_policy_change_time","local_audio_track_time","local_video_track_time","peer_list_time","room_state_time","join_response_time"],BT=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),y.d("[HMSPerformanceTiming]",e,(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration)}catch(i){y.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:i})}}getTimeTaken(e){var t;return(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration}getTimes(...e){return[...$T,...e].reduce((t,i)=>Ee(H({},t),{[i]:this.getTimeTaken(i)}),{})}cleanup(){this.eventPerformanceMeasures={}}},xl={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Mi,wo,Ra=class Hu{constructor(t,i,r,n,s){this.store=t,this.observer=i,this.deviceManager=r,this.eventBus=n,this.analyticsTimer=s,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(){return f(this,arguments,function*(t=xl){let i=this.getAVTrackSettings(t);if(!i)return[];let r=!!i.audio,n=!!i.video,s=[],{videoTrack:o,audioTrack:a}=yield this.updateCurrentLocalTrackSettings(i),l=(o==null?void 0:o.stream)||(a==null?void 0:a.stream),u=!!(o&&this.store.getTrackById(o.trackId)),c=!!(a&&this.store.getTrackById(a.trackId));if(u&&c)return[];let h={audio:r&&!a&&(t.isAudioMuted?"empty":!0),video:n&&!o&&(t.isVideoMuted?"empty":!0)};h.audio&&this.analyticsTimer.start("local_audio_track_time"),h.video&&this.analyticsTimer.start("local_video_track_time");try{y.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:h}),s=yield this.getLocalTracks(h,i,l)}catch(p){s=yield this.retryGetLocalTracks(p,i,h,l)}return h.audio&&this.analyticsTimer.end("local_audio_track_time"),h.video&&this.analyticsTimer.end("local_video_track_time"),o&&n&&!u&&s.push(o),a&&r&&!c&&s.push(a),s})}getLocalTracks(){return f(this,arguments,function*(t={audio:!0,video:!0},i,r){try{let n=yield this.getNativeLocalTracks(t,i);return this.createHMSLocalTracks(n,i,r)}catch(n){throw this.eventBus.analytics.publish(ke.publish({devices:this.deviceManager.getDevices(),error:n,settings:i})),n}})}getNativeLocalTracks(){return f(this,arguments,function*(t={audio:!1,video:!1},i){let r=new Vu(t.video===!0?i.video:null,t.audio===!0?i.audio:null,i.simulcast),n=[];return(r.audio||r.video)&&n.push(...yield this.getAVTracks(r)),n.push(...this.getEmptyTracks(t)),n})}optimizeScreenShareConstraint(t,i){return f(this,null,function*(){var r,n,s;if(typeof i.video=="boolean"||!((r=i.video)!=null&&r.width)||!((n=i.video)!=null&&n.height))return;let o=this.store.getPublishParams();if(!o||!((s=o.allowed)!=null&&s.includes("screen")))return;let a=document.createElement("video");a.srcObject=t,a.addEventListener("loadedmetadata",()=>f(this,null,function*(){let{videoWidth:l,videoHeight:u}=a,c=o.screen,h=c.width*c.height,p=l/u,S=c.width/c.height;if(p>S){let k=i.video,E=p/S,O=Math.sqrt(E);l*u>h?(k.width=l/O,k.height=u/O):(k.height=u*O,k.width=l*O),yield t.getVideoTracks()[0].applyConstraints(k)}}))})}getLocalScreen(t,i=!1){return f(this,null,function*(){var r;let n=yield this.getOrDefaultScreenshareConfig(t),s=this.getScreenshareSettings(n.videoOnly),o={video:Ee(H({},s==null?void 0:s.video.toConstraints(!0)),{displaySurface:n.displaySurface}),preferCurrentTab:n.preferCurrentTab,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio};if(s!=null&&s.audio){let S=(r=s==null?void 0:s.audio)==null?void 0:r.toConstraints();delete S.advanced,o.audio=Ee(H({},S),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}let a;try{y.d("retrieving screenshare with ",{config:n},{constraints:o}),a=yield navigator.mediaDevices.getDisplayMedia(o),i&&(yield this.optimizeScreenShareConstraint(a,o))}catch(S){y.w(this.TAG,"error in getting screenshare - ",S);let k=wa(S,"screen");throw this.eventBus.analytics.publish(ke.publish({error:k,devices:this.deviceManager.getDevices(),settings:new Vu(s==null?void 0:s.video,s==null?void 0:s.audio,!1)})),k}let l=[],u=new Ku(a),c=a.getVideoTracks()[0],h=new mi(u,c,"screen",this.eventBus,s==null?void 0:s.video);h.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen"));try{let S=this.validateCurrentTabCapture(h,n.forceCurrentTab);h.isCurrentTab=S,yield h.cropTo(n.cropTarget)}catch(S){throw a.getTracks().forEach(k=>k.stop()),S}l.push(h);let p=a.getAudioTracks()[0];if(p){let S=new En(u,p,"screen",this.eventBus,s==null?void 0:s.audio);l.push(S)}return y.v(this.TAG,"getLocalScreen",l),l})}setScreenCaptureHandleConfig(t){var i;!((i=navigator.mediaDevices)!=null&&i.setCaptureHandleConfig)||this.isInIframe()||(t=t||{},Object.assign(t,{handle:Cr(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),y.d("setting capture handle - ",t.handle),navigator.mediaDevices.setCaptureHandleConfig(t),this.captureHandleIdentifier=t.handle)}validateCurrentTabCapture(t,i){let r=t.getCaptureHandle(),n=!!(this.captureHandleIdentifier&&(r==null?void 0:r.handle)===this.captureHandleIdentifier);if(i&&!n)throw y.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),G.TracksErrors.CurrentTabNotShared();return n}requestPermissions(){return f(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(t=>t.stop())}catch(t){y.e(this.TAG,t)}})}static getEmptyVideoTrack(t){var i,r,n;let s=((i=t==null?void 0:t.getSettings())==null?void 0:i.width)||320,o=((r=t==null?void 0:t.getSettings())==null?void 0:r.height)||240,a=1;Mi||(Mi=document.createElement("canvas"),Mi.width=s,Mi.height=o,(n=Mi.getContext("2d"))==null||n.fillRect(0,0,s,o)),wo||(wo=setInterval(()=>{let u=Mi==null?void 0:Mi.getContext("2d");u&&u.fillRect(0,0,1,1)},1e3/a));let l=Mi.captureStream(a).getVideoTracks()[0];return l.enabled=!1,l}static getEmptyAudioTrack(){let t=qa.getAudioContext(),i=t.createOscillator(),r=t.createMediaStreamDestination();i.connect(r),i.start();let n=r.stream.getAudioTracks()[0];return n.enabled=!1,n}static cleanup(){clearInterval(wo),wo=void 0,Mi=void 0}getAVTracks(t){return f(this,null,function*(){try{let i=yield navigator.mediaDevices.getUserMedia({audio:t.audio?t.audio.toConstraints():!1,video:t.video?t.video.toConstraints():!1});return i.getVideoTracks().concat(i.getAudioTracks())}catch(i){yield this.deviceManager.init();let r=!!(!this.deviceManager.hasWebcamPermission&&t.video),n=!!(!this.deviceManager.hasMicrophonePermission&&t.audio),s=this.getErrorType(r,n);throw wa(i,s)}})}getAVTrackSettings(t){let i=this.getAudioSettings(t),r=this.getVideoSettings(t);return!i&&!r?null:new vp().video(r).audio(i).build()}isInIframe(){try{return window.self!==window.top}catch{return!0}}retryGetLocalTracks(t,i,r,n){return f(this,null,function*(){if(t instanceof ue&&t.action==="TRACK"){this.observer.onFailure(t);let s=t.code===he.TracksErrors.OVER_CONSTRAINED,o=t.message.includes("audio"),a=t.message.includes("video");if(s){let l=new vp().video(new hd).audio(new dd).build();y.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:r},{error:t});try{return yield this.getLocalTracks(r,l,n)}catch(u){let c=u instanceof ue?u.nativeError:u,h=u;if((c==null?void 0:c.name)==="OverconstrainedError"){let p=G.TracksErrors.GenericTrack("TRACK","Overconstrained error after dropping all constraints");p.addNativeError(c),h=p}return yield this.retryGetLocalTracks(h,i,r,n)}}r.audio=o?"empty":r.audio,r.video=a?"empty":r.video,y.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:r},t);try{return yield this.getLocalTracks(r,i,n)}catch(l){return y.w(this.TAG,"Fetch empty tacks failed",l),r.audio=r.audio&&"empty",r.video=r.video&&"empty",this.observer.onFailure(l),yield this.getLocalTracks(r,i,n)}}else return y.w(this.TAG,"Fetch AV Tracks failed - unknown exception",t),this.observer.onFailure(t),[]})}getErrorType(t,i){return t&&i?"audio, video":t?"video":i?"audio":"unknown(video or audio)"}getEmptyTracks(t){let i=[];return t.audio==="empty"&&i.push(Hu.getEmptyAudioTrack()),t.video==="empty"&&i.push(Hu.getEmptyVideoTrack()),i}updateCurrentLocalTrackSettings(t){return f(this,null,function*(){let i=this.store.getLocalPeerTracks(),r=i.find(a=>a.type==="video"&&a.source==="regular"),n=i.find(a=>a.type==="audio"&&a.source==="regular"),s=i.find(a=>a.type==="video"&&a.source==="screen");t!=null&&t.video&&(yield r==null?void 0:r.setSettings(t.video)),t!=null&&t.audio&&(yield n==null?void 0:n.setSettings(t.audio));let o=this.getScreenshareSettings(!0);return o!=null&&o.video&&(yield s==null?void 0:s.setSettings(o==null?void 0:o.video)),{videoTrack:r,audioTrack:n}})}getAudioSettings(t){var i;let r=this.store.getPublishParams();if(!r||!((i=r.allowed)!=null&&i.includes("audio")))return null;let n=this.store.getLocalPeer(),s=n==null?void 0:n.audioTrack,o=(s==null?void 0:s.settings.deviceId)||t.audioInputDeviceId;return new $s().codec(r.audio.codec).maxBitrate(r.audio.bitRate).deviceId(o||xl.audioInputDeviceId).build()}getVideoSettings(t){var i;let r=this.store.getPublishParams();if(!r||!((i=r.allowed)!=null&&i.includes("video")))return null;let n=this.store.getLocalPeer(),s=n==null?void 0:n.videoTrack,o=(s==null?void 0:s.settings.deviceId)||t.videoDeviceId,a=r.video;return new xn().codec(a.codec).maxBitrate(a.bitRate).maxFramerate(a.frameRate).setWidth(a.width).setHeight(a.height).deviceId(o||xl.videoDeviceId).build()}getScreenshareSettings(t=!1){var i;let r=this.store.getPublishParams();if(!r||!((i=r.allowed)!=null&&i.includes("screen")))return null;let n=r.screen;return{video:new xn().maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth(n.width).setHeight(n.height).build(),audio:t?void 0:new $s().build()}}getOrDefaultScreenshareConfig(t){return f(this,null,function*(){var i;let r=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},t||{});return r.forceCurrentTab&&(r.videoOnly=!0,r.preferCurrentTab=!0,r.selfBrowserSurface="include",r.surfaceSwitching="exclude"),r.preferCurrentTab&&(r.selfBrowserSurface="include",r.displaySurface=void 0),r.cropElement&&(i=window.CropTarget)!=null&&i.fromElement&&(r.cropTarget=yield window.CropTarget.fromElement(r.cropElement)),r})}createHMSLocalTracks(t,i,r){let n=t.find(a=>a.kind==="video"),s=t.find(a=>a.kind==="audio");r?t.forEach(a=>r==null?void 0:r.nativeStream.addTrack(a)):r=new Ku(new MediaStream(t));let o=[];if(s&&i!=null&&i.audio){let a=new En(r,s,"regular",this.eventBus,i.audio);o.push(a)}if(n&&i!=null&&i.video){let a=new mi(r,n,"regular",this.eventBus,i.video);a.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),o.push(a)}return o}};function Sp(e,t){return function(i){return!qv(e[i],t[i])}}var mi=class qu extends Qm{constructor(t,i,r,n,s=new xn().build()){super(t,i,r),this.eventBus=n,this._layerDefinitions=[],this.TAG="[HMSLocalVideoTrack]",this.enabledStateBeforeBackground=!1,this.isCurrentTab=!1,this.isPublished=!1,this.replaceSenderTrack=o=>f(this,null,function*(){if(!this.transceiver||this.transceiver.direction!=="sendonly"){y.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`);return}yield this.transceiver.sender.replaceTrack(o)}),this.buildNewSettings=o=>{let{width:a,height:l,codec:u,maxFramerate:c,maxBitrate:h,deviceId:p,advanced:S,facingMode:k}=H(H({},this.settings),o);return new hd(a,l,u,c,p,S,h,k)},this.handleSettingsChange=o=>f(this,null,function*(){let a=this.stream,l=Sp(o,this.settings);if(l("maxBitrate")&&o.maxBitrate&&(yield a.setMaxBitrateAndFramerate(this)),l("width")||l("height")||l("advanced"))if(this.source==="video"){let u=yield this.replaceTrackWith(o);yield this.replaceSender(u,this.enabled),this.nativeTrack=u,yield this.processPlugins(),this.videoHandler.updateSinks()}else yield this.nativeTrack.applyConstraints(o.toConstraints())}),this.handleDeviceChange=(o,a=!1)=>f(this,null,function*(){if(Sp(o,this.settings)("deviceId")&&this.source==="regular"){if(this.enabled){delete o.facingMode;let u=yield this.replaceTrackWith(o);yield this.replaceSender(u,this.enabled),this.nativeTrack=u,yield this.processPlugins(),this.videoHandler.updateSinks()}let l=this.nativeTrack.getSettings().groupId;!a&&o.deviceId&&(qi.updateSelection("videoInput",{deviceId:o.deviceId,groupId:l}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"video",selection:{deviceId:o.deviceId,groupId:l}}))}}),this.removeOrReplaceProcessedTrack=o=>f(this,null,function*(){o?o!==this.processedTrack&&(this.processedTrack=o):this.processedTrack=void 0,yield this.replaceSenderTrack(this.processedTrack||this.nativeTrack)}),this.handleVisibilityChange=()=>f(this,null,function*(){document.visibilityState==="hidden"&&this.source==="regular"?(this.enabledStateBeforeBackground=this.enabled,this.nativeTrack.enabled=!1,this.replaceSenderTrack(this.nativeTrack)):(this.nativeTrack.enabled=this.enabledStateBeforeBackground,this.replaceSenderTrack(this.nativeTrack)),this.eventBus.localVideoEnabled.publish({enabled:this.nativeTrack.enabled,track:this})}),t.tracks.push(this),this.setVideoHandler(new Ym(this)),this.settings=s,s.deviceId!==i.getSettings().deviceId&&i.enabled&&(this.settings=this.buildNewSettings({deviceId:i.getSettings().deviceId})),this.pluginsManager=new UT(this,n),this.mediaStreamPluginsManager=new FT(n),this.setFirstTrackId(this.trackId),jt&&Ea()&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}setSimulcastDefinitons(t){this._layerDefinitions=t}getSimulcastDefinitions(){return this._layerDefinitions}setEnabled(t){return f(this,null,function*(){var i;if(t!==this.enabled){if(this.source==="regular"){let r;t?r=yield this.replaceTrackWith(this.settings):r=yield this.replaceTrackWithBlank(),yield this.replaceSender(r,t),(i=this.nativeTrack)==null||i.stop(),this.nativeTrack=r,yield Gi(qu.prototype,this,"setEnabled").call(this,t),t&&(yield this.pluginsManager.waitForRestart(),yield this.processPlugins(),this.settings=this.buildNewSettings({deviceId:r.getSettings().deviceId})),this.videoHandler.updateSinks()}this.eventBus.localVideoEnabled.publish({enabled:t,track:this})}})}processPlugins(){return f(this,null,function*(){try{if(this.pluginsManager.getPlugins().length>0)return;if(this.mediaStreamPluginsManager.getPlugins().length>0){let t=this.mediaStreamPluginsManager.applyPlugins(new MediaStream([this.nativeTrack])).getVideoTracks()[0];yield this.setProcessedTrack(t)}else yield this.setProcessedTrack()}catch(t){console.error("error in processing plugin(s)",t)}})}addStreamPlugins(t){return f(this,null,function*(){if(this.pluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSMediaStreamPlugin and HMSVideoPlugin cannot be used together");this.mediaStreamPluginsManager.addPlugins(t),yield this.processPlugins()})}removeStreamPlugins(t){return f(this,null,function*(){this.mediaStreamPluginsManager.removePlugins(t),yield this.processPlugins()})}isPublishedTrackId(t){return this.publishedTrackId===t}addSink(t){this.addSinkInternal(t,this.processedTrack||this.nativeTrack)}setSettings(t,i=!1){return f(this,null,function*(){let r=this.buildNewSettings(t);if(yield this.handleDeviceChange(r,i),!this.enabled||Cn(this.nativeTrack)){this.settings=r;return}else yield this.pluginsManager.waitForRestart();yield this.handleSettingsChange(r),this.settings=r})}getPlugins(){return this.mediaStreamPluginsManager.getPlugins().length>0?this.mediaStreamPluginsManager.getPlugins():this.pluginsManager.getPlugins()}addPlugin(t,i){return f(this,null,function*(){if(this.mediaStreamPluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSVideoPlugin and HMSMediaStreamPlugin cannot be used together");return this.pluginsManager.addPlugin(t,i)})}removePlugin(t){return f(this,null,function*(){return this.pluginsManager.removePlugin(t)})}validatePlugin(t){return this.pluginsManager.validatePlugin(t)}cleanup(){return f(this,null,function*(){var t;Gi(qu.prototype,this,"cleanup").call(this),this.transceiver=void 0,yield this.pluginsManager.cleanup(),(t=this.processedTrack)==null||t.stop(),this.isPublished=!1,jt&&Ea()&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}cropTo(t){return f(this,null,function*(){if(t&&this.source==="screen")try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(t))}catch(i){throw y.e(this.TAG,"failed to crop screenshare capture - ",i),G.TracksErrors.GenericTrack("TRACK","failed to crop screenshare capture")}})}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(t){return f(this,null,function*(){if(!this.nativeTrack.enabled){this.processedTrack=t;return}yield this.removeOrReplaceProcessedTrack(t),this.videoHandler.updateSinks()})}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled?this.processedTrack||this.nativeTrack:this.nativeTrack}switchCamera(){return f(this,null,function*(){var t;let i=this.getMediaTrackSettings().facingMode;if(!i||this.source!=="regular"){y.d(this.TAG,"facingMode not supported");return}let r=i==="environment"?"user":"environment";(t=this.nativeTrack)==null||t.stop();let n=yield this.replaceTrackWith(this.buildNewSettings({facingMode:r,deviceId:void 0}));yield this.replaceSender(n,this.enabled),this.nativeTrack=n,yield this.processPlugins(),this.videoHandler.updateSinks(),this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId,facingMode:r}),qi.updateSelection("videoInput",{deviceId:this.settings.deviceId,groupId:this.nativeTrack.getSettings().groupId})})}replaceTrackWith(t){return f(this,null,function*(){let i=this.nativeTrack;i==null||i.stop();try{let r=yield fT(t);return y.d(this.TAG,"replaceTrack, Previous track stopped",i,"newTrack",r),this.settings.deviceId==="default"&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),r}catch(r){throw this.isPublished&&this.eventBus.analytics.publish(ke.publish({error:r})),r}})}replaceTrackWithBlank(){return f(this,null,function*(){let t=this.nativeTrack,i=Ra.getEmptyVideoTrack(t);return t==null||t.stop(),y.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",t,"newTrack",i),i})}replaceSender(t,i){return f(this,null,function*(){i?yield this.replaceSenderTrack(this.processedTrack||t):yield this.replaceSenderTrack(t),this.stream.replaceStreamTrack(this.nativeTrack,t)})}},rs="renegotiation-callback-id",Zm="ion-sfu",ns="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",jT="https://event.100ms.live/v2/client/report",GT="https://event-nonprod.100ms.live/v2/client/report",Aa=Math.pow(2,31)-1,ft={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error",LEAVE:"leave"},zT="2.5",VT="20240417",fn="_handraise",kp=1e3,Tp=64,WT="https://whiteboard.100ms.live",HT="https://whiteboard-qa.100ms.live",ni=class qo extends Qm{constructor(t,i,r){super(t,i,r),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new qT,this.preferredLayer="high",this.setVideoHandler(new Ym(this))}setTrackId(t){this.bizTrackId=t}get trackId(){return this.bizTrackId||super.trackId}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(t){return f(this,null,function*(){t!==this.enabled&&(Gi(qo.prototype,this,"setEnabled").call(this,t),this.videoHandler.updateSinks(!0))})}setPreferredLayer(t){return f(this,null,function*(){if(t==="none"){y.w("layer none will be ignored");return}if(this.preferredLayer=t,!!this.shouldSendVideoLayer(t,"preferLayer")){if(!this.hasSinks()){y.d(`[Remote Track] ${this.logIdentifier}
        streamId=${this.stream.id} 
        trackId=${this.trackId}
        saving ${t}, source=${this.source}
        Track does not have any sink`);return}yield this.requestLayer(t,"preferLayer"),this.pushInHistory(`uiPreferLayer-${t}`)}})}getSimulcastLayer(){return this.stream.getSimulcastLayer()}getLayer(){return this.stream.getVideoLayer()}getPreferredLayer(){return this.preferredLayer}getPreferredLayerDefinition(){return this._layerDefinitions.find(t=>t.layer===this.preferredLayer)}replaceTrack(t){this.nativeTrack=t.nativeTrack,t.transceiver&&(this.transceiver=t.transceiver,this.stream.updateId(t.stream.id)),this.videoHandler.updateSinks()}addSink(t,i=!0){return f(this,null,function*(){Cn(this.nativeTrack)?yield this.requestLayer(this.preferredLayer,"addSink"):(Gi(qo.prototype,this,"addSink").call(this,t),i&&(yield this.updateLayer("addSink"))),this.pushInHistory("uiSetLayer-high")})}removeSink(t,i=!0){return f(this,null,function*(){Gi(qo.prototype,this,"removeSink").call(this,t),i&&(yield this.updateLayer("removeSink")),this._degraded=!1,this.pushInHistory("uiSetLayer-none")})}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(t){this._layerDefinitions=t}setLayerFromServer(t){this._degraded=this.enabled&&(t.publisher_degraded||t.subscriber_degraded)&&t.current_layer==="none",this._degradedAt=this._degraded?new Date:this._degradedAt;let i=t.current_layer;return y.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id} 
      trackId=${this.trackId}
      layer update from sfu
      currLayer=${t.current_layer}
      preferredLayer=${t.expected_layer}
      sub_degraded=${t.subscriber_degraded}
      pub_degraded=${t.publisher_degraded}
      isDegraded=${this._degraded}`),this.stream.setVideoLayerLocally(i,this.logIdentifier,"setLayerFromServer"),this.pushInHistory(`sfuLayerUpdate-${i}`),this._degraded}updateLayer(t){return f(this,null,function*(){let i=this.degraded||!this.enabled||!this.hasSinks()?"none":this.preferredLayer;this.shouldSendVideoLayer(i,t)&&(yield this.requestLayer(i,t))})}pushInHistory(t){}requestLayer(t,i){return f(this,null,function*(){try{let r=yield this.stream.setVideoLayer(t,this.trackId,this.logIdentifier,i);return y.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id}
      trackId=${this.trackId}
      Requested layer ${t}, source=${i}`),r}catch(r){throw y.d(`[Remote Track] ${this.logIdentifier} 
      streamId=${this.stream.id}
      trackId=${this.trackId}
      Failed to set layer ${t}, source=${i}
      error=${r.message}`),r}})}shouldSendVideoLayer(t,i){let r=this.getLayer();return this.degraded&&t==="none"?!0:r===t?(y.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${t}, source=${i}`),!1):!0}},qT=class{constructor(){this.history=[]}push(e){e.time=new Date().toISOString().split("T")[1],this.history.push(e)}},Ku=class extends zm{constructor(){super(...arguments),this.TAG="[HMSLocalStream]",this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:this.getTrackEncodings(e,t)});return this.setPreferredCodec(i,e.nativeTrack.kind),e.transceiver=i,i}setMaxBitrateAndFramerate(e){return f(this,null,function*(){var t;yield(t=this.connection)==null?void 0:t.setMaxBitrateAndFramerate(e)})}setPreferredCodec(e,t){}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}removeSender(e){var t,i;if(!this.connection||this.connection.connectionState==="closed"){y.d(this.TAG,"publish connection is not initialised or closed");return}let r=(t=e.transceiver)==null?void 0:t.sender;if(!r){y.w(this.TAG,`No sender found for trackId=${e.trackId}`);return}(i=this.connection)==null||i.removeTrack(r);let n=this.tracks.indexOf(e);n!==-1?this.tracks.splice(n,1):y.w(this.TAG,`Cannot find ${e.trackId} in locally stored tracks`)}getTrackEncodings(e,t){let i=[];if(e instanceof mi)if(t.length>0)y.d(this.TAG,"Simulcast enabled with layers",t),i.push(...t);else{let r={active:this.nativeStream.active};e.settings.maxBitrate&&!ad&&(r.maxBitrate=e.settings.maxBitrate),i.push(r)}return i}},pd=class extends zm{constructor(e,t){super(e),this.audio=!0,this.video="none",this.connection=t}setAudio(e,t,i){return f(this,null,function*(){this.audio!==e&&(this.audio=e,y.d(`[Remote stream] ${i||""} 
    streamId=${this.id}
    trackId=${t}
    subscribing audio - ${this.audio}`),yield this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"}))})}setVideoLayerLocally(e,t,i){this.video=e,y.d(`[Remote stream] ${t}
    streamId=${this.id}
    source: ${i}
    Setting layer field to=${e}`)}setVideoLayer(e,t,i,r){return y.d(`[Remote stream] ${i} 
      streamId=${this.id}
      trackId=${t} 
      source: ${r} request ${e} layer`),this.setVideoLayerLocally(e,i,r),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}getSimulcastLayer(){return this.video}getVideoLayer(){return this.video}isAudioSubscribed(){return this.audio}},KT=(e,t,i,r)=>f(void 0,null,function*(){var n;let s,o={};if((n=t.transceiver)!=null&&n.sender.track){try{s=yield t.transceiver.sender.getStats();let a={},l={},u={};s==null||s.forEach(c=>{switch(c.type){case"outbound-rtp":l[c.id]=c;break;case"remote-inbound-rtp":u[c.ssrc]=c;break;case"codec":a[c.id]=c.mimeType;break;default:break}}),Object.keys(H({},l)).forEach(c=>{var h,p;let S=(h=l[c])==null?void 0:h.codecId,k=S?a[S]:void 0,E;k&&(E=k.substring(k.indexOf("/")+1));let O=Ee(H({},l[c]),{rid:(p=l[c])==null?void 0:p.rid}),I=u[O.ssrc];o[c]=Ee(H({},O),{bitrate:fd("bytesSent",O,r==null?void 0:r[c]),packetsLost:I==null?void 0:I.packetsLost,jitter:I==null?void 0:I.jitter,roundTripTime:I==null?void 0:I.roundTripTime,totalRoundTripTime:I==null?void 0:I.totalRoundTripTime,peerName:i,peerID:t.peerId,enabled:t.enabled,codec:E})})}catch(a){e.analytics.publish(ke.rtcStatsFailed(G.WebrtcErrors.StatsFailed("TRACK",`Error getting local track stats ${t.trackId} - ${a.message}`))),y.w("[HMSWebrtcStats]","Error in getting local track stats",t,a,a.name)}return o}}),JT=(e,t,i,r)=>f(void 0,null,function*(){var n;let s;try{s=yield(n=t.transceiver)==null?void 0:n.receiver.getStats()}catch(u){e.analytics.publish(ke.rtcStatsFailed(G.WebrtcErrors.StatsFailed("TRACK",`Error getting remote track stats ${t.trackId} - ${u.message}`))),y.w("[HMSWebrtcStats]","Error in getting remote track stats",t,u)}let o=QT(s),a=fd("bytesReceived",o,r),l=Ju("packetsLost",o,r);return o!=null&&o.remote&&Object.assign(o.remote,{packetsLostRate:Ju("packetsLost",o.remote,r==null?void 0:r.remote)}),o&&Ee(H({},o),{bitrate:a,packetsLostRate:l,peerID:t.peerId,enabled:t.enabled,peerName:i,codec:o.codec})}),QT=e=>{let t,i,r={};e==null||e.forEach(o=>{switch(o.type){case"inbound-rtp":t=o;break;case"outbound-rtp":t=o;break;case"remote-inbound-rtp":i=o;break;case"codec":r[o.id]=o.mimeType;break}});let n=t!=null&&t.codecId?r[t.codecId]:void 0,s;return n&&(s=n.substring(n.indexOf("/")+1)),t&&Object.assign(t,{remote:i,codec:s})},bp=(e,t,i)=>{let r=YT(t),n=fd(e==="publish"?"bytesSent":"bytesReceived",r,i&&i[e]);return r&&Object.assign(r,{bitrate:n})},YT=e=>{let t;return e==null||e.forEach(i=>{i.type==="transport"&&(t=e==null?void 0:e.get(i.selectedCandidatePairId))}),t||e==null||e.forEach(i=>{i.type==="candidate-pair"&&i.selected&&(t=i)}),t},XT=e=>{let t={packetsLost:0,jitter:0};return e==null||e.forEach(i=>{i.packetsLost&&(t.packetsLost+=i.packetsLost),i.jitter>t.jitter&&(t.jitter=i.jitter)}),t},ZT=(e,t)=>Array.from(new Set(e.concat(t))),fd=(e,t,i)=>Ju(e,t,i)*8,Ju=(e,t,i)=>{let r=t&&t[e],n=i?i[e]:null;return[t,i,Sr(r),Sr(n)].every(s=>!!s)?eg(r,n,t==null?void 0:t.timestamp,i==null?void 0:i.timestamp)*1e3:0},eg=(e,t,i,r)=>Sr(e)&&Sr(t)&&i&&r?(e-t)/(i-r):0,eb=class{constructor(e,t,i){this.getStats=e,this.store=t,this.eventBus=i,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.getLocalPeerStats=()=>this.peerStats[this.localPeerID],this.getRemoteTrackStats=n=>this.remoteTrackStats[n],this.getAllRemoteTracksStats=()=>this.remoteTrackStats,this.getLocalTrackStats=()=>this.localTrackStats,this.updateStats=()=>f(this,null,function*(){yield this.updateLocalPeerStats(),yield this.updateLocalTrackStats(),yield this.updateRemoteTrackStats()}),this.updateLocalPeerStats=()=>f(this,null,function*(){var n,s,o,a,l,u;let c=this.getLocalPeerStats(),h;try{h=yield(s=(n=this.getStats).publish)==null?void 0:s.call(n)}catch(A){this.eventBus.analytics.publish(ke.rtcStatsFailed(G.WebrtcErrors.StatsFailed("PUBLISH",A.message))),y.w(this.TAG,"Error in getting publish stats",A)}let p=h&&bp("publish",h,c),S;try{S=yield(a=(o=this.getStats).subscribe)==null?void 0:a.call(o)}catch(A){this.eventBus.analytics.publish(ke.rtcStatsFailed(G.WebrtcErrors.StatsFailed("SUBSCRIBE",A.message))),y.w(this.TAG,"Error in getting subscribe stats",A)}let k=S&&bp("subscribe",S,c),{packetsLost:E,jitter:O}=XT(S),I=eg(E,(l=c==null?void 0:c.subscribe)==null?void 0:l.packetsLost,k==null?void 0:k.timestamp,(u=c==null?void 0:c.subscribe)==null?void 0:u.timestamp),R=k&&Object.assign(k,{packetsLostRate:I,jitter:O,packetsLost:E});this.peerStats[this.localPeerID]={publish:p,subscribe:R}}),this.updateRemoteTrackStats=()=>f(this,null,function*(){var n;let s=Array.from(this.store.getTracksMap().values()).filter(a=>a instanceof ni||a instanceof Ks),o=s.map(a=>a.trackId);Object.keys(this.remoteTrackStats).forEach(a=>{o.includes(a)||delete this.remoteTrackStats[a]});for(let a of s){let l=a.peerId&&((n=this.store.getPeerById(a.peerId))==null?void 0:n.name),u=this.getRemoteTrackStats(a.trackId),c=yield JT(this.eventBus,a,l,u);c&&(this.remoteTrackStats[a.trackId]=c)}}),this.updateLocalTrackStats=()=>f(this,null,function*(){var n;let s=this.store.getLocalPeerTracks().reduce((a,l)=>(a[l.getTrackIDBeingSent()]=l,a),{}),o=ZT(Object.keys(this.localTrackStats),Object.keys(s));for(let a of o){let l=s[a];if(l){let u=(n=this.store.getLocalPeer())==null?void 0:n.name,c=yield KT(this.eventBus,l,u,this.localTrackStats[a]);c&&(this.localTrackStats[a]=c)}else delete this.localTrackStats[a]}});var r;this.localPeerID=(r=this.store.getLocalPeer())==null?void 0:r.peerId}},tb=class{constructor(e,t,i,r){this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=r,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>f(this,null,function*(){var n;yield(n=this.hmsStats)==null?void 0:n.updateStats(),this.eventBus.statsUpdate.publish(this.hmsStats)})}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}getCurrentStats(){return this.hmsStats}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){var i,r;this.publishConnection=e,this.subscribeConnection=t,this.hmsStats=new eb({publish:(i=this.publishConnection)==null?void 0:i.getStats.bind(this.publishConnection),subscribe:(r=this.subscribeConnection)==null?void 0:r.getStats.bind(this.subscribeConnection)},this.store,this.eventBus)}start(){return f(this,null,function*(){if(this.isMonitored){y.d(this.TAG,"Already started");return}this.stop(),this.isMonitored=!0,y.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(()=>y.d(this.TAG,"Stopping Webrtc Stats Monitor")).catch(e=>{this.eventBus.analytics.publish(ke.rtcStatsFailed(G.WebrtcErrors.StatsFailed("PUBLISH",e.message))),y.e(this.TAG,e.message)})})}stop(){this.isMonitored=!1}startLoop(){return f(this,null,function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Ki(this.interval)})}cleanup(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},tg=class{constructor({peerId:e,name:t,isLocal:i,customerUserId:r,metadata:n,role:s,joinedAt:o,groups:a,realtime:l,type:u}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=i,this.customerUserId=r,this.metadata=n,this.joinedAt=o,this.groups=a,this.realtime=l,this.type=u,s&&(this.role=s)}get isHandRaised(){var e;return!!((e=this.groups)!=null&&e.includes(fn))}updateRole(e){this.role=e}updateName(e){this.name=e}updateNetworkQuality(e){this.networkQuality=e}updateMetadata(e){this.metadata=e}updateGroups(e){this.groups=e}toString(){var e,t,i,r;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
      ${this.audioTrack?`audioTrack: ${(t=this.audioTrack)==null?void 0:t.trackId};`:""}
      ${this.videoTrack?`videoTrack: ${(i=this.videoTrack)==null?void 0:i.trackId};`:""}
      groups: ${(r=this.groups)==null?void 0:r.join()}
    }`}},ig=class{};ig.makePeerId=()=>Cr();var ib=class extends tg{constructor(e){super(Ee(H({},e),{peerId:ig.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[],this.asRole=e.asRole}isInPreview(){return!!this.asRole}toString(){var e,t,i;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
      ${this.asRole?`asRole: ${this.asRole.name};`:""}
      ${this.audioTrack?`audioTrack: ${(t=this.audioTrack)==null?void 0:t.trackId};`:""}
      ${this.videoTrack?`videoTrack: ${(i=this.videoTrack)==null?void 0:i.trackId};`:""}
    }`}},rb=class extends tg{constructor(e){super(Ee(H({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},Ja=(e,t)=>new rb({peerId:e.peer_id,name:e.info.name,role:t.getPolicyForRole(e.role),customerUserId:e.info.user_id,metadata:e.info.data,groups:e.groups,type:e.info.type}),nb=class{constructor(e,t,i){this.transport=e,this.store=t,this.options=i,this.isEnd=!1,this.iterator=null,this.total=0,this.defaultPaginationLimit=10}validateConnection(){if(!this.transport||!this.store)throw Error("Use usePaginatedParticipants or hmsActions.getPeerListIterator after preview or join has happened")}hasNext(){return!this.isEnd}getTotal(){return this.total}findPeers(){return f(this,null,function*(){var e;this.validateConnection();let t=yield this.transport.signal.findPeers(Ee(H({},this.options||{}),{limit:((e=this.options)==null?void 0:e.limit)||this.defaultPaginationLimit}));return this.updateState(t),this.processPeers(t.peers)})}next(){return f(this,null,function*(){var e;this.validateConnection();let t;return!this.iterator&&!this.isEnd?yield this.findPeers():this.iterator?(t=yield this.transport.signal.peerIterNext({iterator:this.iterator,limit:((e=this.options)==null?void 0:e.limit)||this.defaultPaginationLimit}),this.updateState(t),this.processPeers(t.peers)):[]})}processPeers(e){let t=[];return e.forEach(i=>{let r=Ja(i,this.store);t.push(r)}),t}updateState(e){this.isEnd=e.eof,this.total=e.total,e.iterator&&(this.iterator=e.iterator)}},rg=class{constructor(e){this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){return f(this,null,function*(){this.audioContext.state==="suspended"&&(yield this.audioContext.resume(),y.d(this.TAG,"AudioContext is resumed"))})}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){this.audioContext.state!=="closed"&&this.audioContext.close().catch(e=>{y.d(this.TAG,"AudioContext close error",e.message)})}},vd=class extends Wa.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},sb=class extends vd{constructor(){super(...arguments),this.audioElement=null,this.TAG="[PlaylistAudioManager]",this.seeked=!1}play(e){return f(this,null,function*(){return this.audioElement=this.getAudioElement(),new Promise((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let r=`Error loading ${e}`;y.e(this.TAG,r),this.stop(),i(r)},this.audioElement.oncanplaythrough=()=>f(this,null,function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let r=this.audioContextManager.getAudioTrack();this.track=r,t([r])}}catch(r){y.e(this.TAG,"Error playing audio",e,r.message),i(r)}}),this.audioElement.onseeked=()=>{this.seeked=!0}})})}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement||(this.audioElement=this.getAudioElement()),this.audioElement}stop(){var e,t,i;(e=this.audioElement)==null||e.pause(),(t=this.audioElement)==null||t.removeAttribute("src"),this.audioElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new rg(e),e}},ob=class extends vd{constructor(){super(...arguments),this.TAG="[PlaylistVideoManager]",this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&((i=this.canvasContext)==null||i.drawImage(this.videoElement,0,0,(e=this.canvas)==null?void 0:e.width,(t=this.canvas)==null?void 0:t.height),this.timer=setTimeout(()=>{this.drawImage()},1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let r=`Error loading ${e}`;y.e(this.TAG,r),this.stop(),i(r)},this.videoElement.oncanplaythrough=()=>f(this,null,function*(){var r,n,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,this.tracks.length===0){this.clearCanvasAndTracks();let o=this.canvas.captureStream();if(!o){y.e(this.TAG,"Browser does not support captureStream");return}this.videoElement.onplay=this.drawImage,yield this.audioContextManager.resumeContext(),yield this.videoElement.play();let a=this.audioContextManager.getAudioTrack();o.addTrack(a),o.getTracks().forEach(l=>{this.tracks.push(l)}),t(this.tracks)}else this.seeked?(this.seeked=!1,(s=this.canvasContext)==null||s.drawImage(this.videoElement,0,0,(r=this.canvas)==null?void 0:r.width,(n=this.canvas)==null?void 0:n.height)):(yield this.videoElement.play(),t(this.tracks))}catch(o){y.e(this.TAG,"Error playing video",e,o.message),i(o)}}),this.videoElement.onseeked=()=>{this.seeked=!0}})}getTracks(){return this.tracks.map(e=>e.id)}getElement(){return this.videoElement||(this.videoElement=this.getVideoElement()),this.videoElement}stop(){var e,t,i;(e=this.videoElement)==null||e.pause(),(t=this.videoElement)==null||t.removeAttribute("src"),this.videoElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],(e=this.canvasContext)==null||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new rg(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}},Po={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},ab=class extends vd{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:H({},Po.audio),video:H({},Po.video)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=i=>f(this,[i],function*({enabled:r,track:n}){var s;if(r)return;let o;n.source==="audioplaylist"&&(o="audio"),n.source==="videoplaylist"&&(o="video"),o&&((s=this.getElement(o))==null||s.pause())}),this.addTrack=(i,r)=>f(this,null,function*(){yield this.sdk.addTrack(i,r),y.d(this.TAG,"Playlist track added",Vm(i))}),this.removeTrack=i=>f(this,null,function*(){yield this.sdk.removeTrack(i,!0),y.d(this.TAG,"Playlist track removed",i)}),this.audioManager=new sb,this.videoManager=new ob,this.addListeners()}getList(e="audio"){return this.state[e].list}setList(e){if(!e||e.length===0){y.w(this.TAG,"Please pass in a list of HMSPlaylistItem's");return}e.forEach(t=>{this.state[t.type].list.find(i=>i.id===t.id)||this.state[t.type].list.push(t)})}clearList(e){return f(this,null,function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]})}removeItem(e,t){return f(this,null,function*(){let{list:i,currentIndex:r}=this.state[t],n=i.findIndex(s=>e===s.id);return n>-1?(r===n&&this.isPlaying(t)&&(yield this.stop(t)),i.splice(n,1),!0):!1})}seek(e,t="audio"){let{currentIndex:i}=this.state[t];if(i===-1)throw G.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");let r=this.getElement(t);if(r){let n=Math.max(r.currentTime+e,0);r.currentTime=Math.min(n,r.duration)}}seekTo(e,t="audio"){let{currentIndex:i}=this.state[t];if(i===-1)throw G.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");if(e<0)throw Error("value cannot be negative");let r=this.getElement(t);r&&(r.currentTime=Math.min(e,r.duration))}setVolume(e,t="audio"){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=e*.01)}getVolume(e="audio"){let t=this.getElement(e);return t?Math.floor(t.volume*100):0}getCurrentTime(e="audio"){let t=this.getElement(e);return(t==null?void 0:t.currentTime)||0}getCurrentIndex(e="audio"){return this.state[e].currentIndex}getCurrentProgress(e="audio"){var t;let{list:i,currentIndex:r}=this.state[e],n=(t=i[r])==null?void 0:t.url,s=this.getElement(e);return!n||!s?0:Math.floor(100*(s.currentTime/s.duration))}getCurrentSelection(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(i!==-1)return t[i]}isPlaying(e="audio"){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e="audio",t){this.state[e].isAutoplayOn=t}getPlaybackRate(e="audio"){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e="audio",t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return f(this,arguments,function*(i,{id:r,type:n="audio"}){let s=this.state[n].list.findIndex(a=>a.id===r);if(!r||s===-1){y.w(this.TAG,"Pass a valid id");return}let o=this.state[n].list[s].url;i?yield this.play(o,n):yield this.pause(o,n),this.state[n].currentIndex=s,this.setDuration(n)})}playNext(){return f(this,arguments,function*(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(i>=t.length-1)throw G.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached end of playlist");yield this.play(t[i+1].url,e),this.state[e].currentIndex=i+1,this.setDuration(e)})}playPrevious(){return f(this,arguments,function*(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(i<=0)throw G.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached start of playlist");yield this.play(t[i-1].url,e),this.state[e].currentIndex=i-1,this.setDuration(e)})}stop(){return f(this,arguments,function*(e="audio"){var t;let i=e==="audio"?this.audioManager:this.videoManager;(t=i.getElement())==null||t.pause(),yield this.removeTracks(e),i.stop(),this.state[e].currentIndex=-1})}cleanup(){this.state={audio:H({},Po.audio),video:H({},Po.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",()=>{try{e({type:"video",progress:this.getCurrentProgress("video")})}catch{y.e(this.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",()=>{try{e({type:"audio",progress:this.getCurrentProgress("audio")})}catch{y.e(this.TAG,"Error in onProgress callback")}})}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e="audio"){return e==="audio"?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return f(this,arguments,function*(e="audio"){let t=(e==="audio"?this.audioManager:this.videoManager).getTracks();for(let i of t)yield this.removeTrack(i)})}play(e){return f(this,arguments,function*(t,i="audio"){let r=i==="audio"?this.audioManager:this.videoManager,n=r.getElement();if(this.isItemCurrentlyPlaying(t,i)){y.w(this.TAG,`The ${i} is currently playing`);return}if(n!=null&&n.src.includes(t))yield n.play();else{n==null||n.pause();let s=yield r.play(t);for(let o of s)yield this.addTrack(o,i==="audio"?"audioplaylist":"videoplaylist")}})}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!!(i&&!i.paused&&i.src.includes(e))}setDuration(e="audio"){let t=this.getElement(e),{list:i,currentIndex:r}=this.state[e];i[r]&&(i[r].duration=(t==null?void 0:t.duration)||0),this.emit("newTrackStart",i[r])}pause(e){return f(this,arguments,function*(t,i="audio"){let r=this.getElement(i);r&&!r.paused&&r.src.includes(t)?(r.pause(),y.d(this.TAG,"paused url",t)):y.w(this.TAG,"The passed in url is not currently playing")})}addListeners(){this.audioManager.on("ended",()=>this.handleEnded("audio")),this.videoManager.on("ended",()=>this.handleEnded("video")),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return f(this,arguments,function*(e="audio"){let{list:t,currentIndex:i,isAutoplayOn:r}=this.state[e];i===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):r?this.playNext(e):yield this.pause(t[i].url,e),this.emit("currentTrackEnded",t[i])})}},kt=e=>e.room,lb=e=>e.errors;K(lb,e=>e.length===0?null:e.at(-1));K(kt,e=>e.id);var ai=e=>e.peers,ng=e=>e.messages.byID,sg=e=>e.messages.allIDs,Xe=e=>e.tracks,ub=e=>e.settings,cb=e=>e.appData,db=e=>e.speakers,wn=K([kt],e=>e&&e.isConnected);K([wn,kt],(e,t)=>e?t.peerCount!==void 0?t.peerCount||1:t.peers.length:Math.max(t.peerCount!==void 0?t.peerCount:t.peers.length-1,0));var hb=e=>e.hideLocalPeer,md=K([kt,ai,hb],(e,t,i)=>i?e.peers.filter(r=>e.localPeer!==r).map(r=>t[r]):e.peers.map(r=>t[r])),pb=K(Xe,e=>Object.values(e)),Ti=K(kt,ai,(e,t)=>t[e.localPeer]),Pn=K(kt,e=>e.localPeer);K(Ti,e=>e==null?void 0:e.name);K(Ti,e=>e==null?void 0:e.roleName);var Bi=K(Ti,e=>e==null?void 0:e.audioTrack),fi=K(Ti,e=>e==null?void 0:e.videoTrack),fb=K(Ti,e=>e==null?void 0:e.auxiliaryTracks),vb=K([Bi,fi,fb],(e,t,i)=>{let r=i?[...i]:[];return e&&r.unshift(e),t&&r.unshift(t),r});K(md,e=>e.filter(t=>!t.isLocal));K(ai,db,(e,t)=>{let i=Object.entries(t).sort((r,n)=>{var s,o;let a=((s=r[1])==null?void 0:s.audioLevel)||0;return(((o=n[1])==null?void 0:o.audioLevel)||0)>a?1:-1});if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let r=i[0][1].peerID;if(r in e)return e[r]}return null});var Cp=e=>{let t=Ti(e);return H0(e,t==null?void 0:t.videoTrack)},mb=e=>{let t=Ti(e);return q0(e,t==null?void 0:t.videoTrack)},Ep=K(Ti,Xe,(e,t)=>{let{video:i,audio:r}=qs(t,e);return!!(i||r)}),gb=K(ai,Xe,(e,t)=>{let i;for(let r in e){let n=e[r],{video:s,audio:o}=qs(t,n);if(s)return n;o&&!i&&(i=n)}return i});K(gb,e=>!!e);K(ai,Xe,(e,t)=>{for(let i in e){let r=e[i],{audio:n,video:s}=qs(t,r);if(!s&&n)return r}});K(ai,Xe,(e,t)=>{let i=[],r=[];for(let n in e){let s=e[n],{video:o,audio:a}=qs(t,s);o?i.push(s):a&&r.push(s)}return i.concat(r)});K(ai,Xe,(e,t)=>{for(let i in t){let r=t[i];if(od(r)&&sd(r)&&r.peerId)return e[r.peerId]}});K(ai,Xe,(e,t)=>{for(let i in t){let r=t[i];if(jm(r)&&r.peerId)return e[r.peerId]}});K(pb,e=>e.filter(W0));K(sg,e=>e.length);K(ng,e=>Object.values(e).filter(t=>!t.read).length);var Qa=K(sg,ng,(e,t)=>{let i=[];return e.forEach(r=>{i.push(t[r])}),i}),yb=K(Qa,e=>e.filter(t=>{var i;return!t.recipientPeer&&!(t.recipientRoles&&((i=t.recipientRoles)==null?void 0:i.length)>0)}));K(yb,e=>e.filter(t=>!t.read).length);var Pi=K([kt],e=>e&&e.roomState),Sb=K(Pi,e=>e==="Preview");K(kt,e=>e.roomState!=="Disconnected");K(kt,e=>!e.transcriptions||e.transcriptions.length<=0?!1:e.transcriptions.some(t=>t.mode==="caption"&&t.state==="started"));var Nn=e=>e.roles;K([Nn],e=>Object.keys(e));var gd=K([Ti,Nn],(e,t)=>e!=null&&e.roleName?t[e.roleName]:null),kb=e=>{var t;return(t=e.preview)==null?void 0:t.asRole},Tb=K([kb,Nn],(e,t)=>e?t[e]:null);K([gd],e=>{var t;return(t=e==null?void 0:e.subscribeParams)!=null&&t.subscribeToRoles?e.subscribeParams.subscribeToRoles.length>0:!1});var bb=K(gd,e=>e==null?void 0:e.permissions);K(kt,e=>e.recording);K(kt,e=>e.rtmp);K(kt,e=>e.hls);K(kt,e=>e.sessionId);K(kt,e=>e.startedAt);K(kt,e=>!!e.isLargeRoom);K(kt,e=>!!e.isEffectsEnabled);K(kt,e=>e.effectsKey);var Cb=e=>e.polls;K(md,e=>e.filter(t=>t.isHandRaised));var Eb=e=>e.whiteboards;K(Eb,e=>Object.values(e)[0]);var og=(e="audio")=>t=>t.playlist[e].list,yd=(e="audio")=>t=>t.playlist[e].selection,ag=(e="audio")=>t=>t.playlist[e].progress,lg=(e="audio")=>t=>t.playlist[e].currentTime,ug=(e="audio")=>t=>t.playlist[e].playbackRate,cg=(e="audio")=>t=>t.playlist[e].volume,dg=(e="audio")=>K(og(e),t=>Object.values(t)),hg=(e="audio")=>K(og(e),yd(e),(t,i)=>{if(i.id)return t[i.id]}),wb={selection:yd("audio"),progress:ag("audio"),currentTime:lg("audio"),playbackRate:ug("audio"),volume:cg("audio"),list:dg("audio"),selectedItem:hg("audio")},Pb={selection:yd("video"),progress:ag("video"),currentTime:lg("video"),playbackRate:ug("video"),volume:cg("video"),list:dg("video"),selectedItem:hg("video")};function Rt(e){return t=>i=>e(i,t)}var ss="HMS-Store:",Se=class{static v(e,...t){this.log(0,e,...t)}static d(...e){this.log(1,...e)}static i(...e){this.log(2,...e)}static w(...e){this.log(3,...e)}static e(...e){this.log(6,...e)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:{console.log(ss,...t);break}case 1:{console.debug(ss,...t);break}case 2:{console.info(ss,...t);break}case 3:{console.warn(ss,...t);break}case 6:{console.error(ss,...t);break}case 4:{performance.mark(t[1]);break}case 5:{let i=t[0],r=t[1];try{let n=performance.measure(r,r);this.log(1,i,r,n==null?void 0:n.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(n){this.log(1,i,r,n)}break}}}};Se.level=0;var Sd=(e,t)=>t,Js=(e,t)=>t,pg=(e,t)=>t,Rb=(e,t)=>t,Ab=(e,t)=>t,Er=K([ai,Sd],(e,t)=>t?e[t]:null),_b=K([Xe,Js],(e,t)=>t?e[t]:null),Ib=K([Xe,Js],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"?i:null});K([Xe,Js],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"?i:null});K([Xe,Js],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"&&(i==null?void 0:i.source)==="screen"?i:null});K([Xe,Js],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"&&(i==null?void 0:i.source)==="screen"?i:null});var Lb=K([Cb,Ab],(e,t)=>t?e[t]:null),xi=Rt(Er);Rt(K([cb,Rb],(e,t)=>{if(e)return t?e[t]:e}));Rt(K(Er,e=>e==null?void 0:e.name));Rt(K(Er,e=>e==null?void 0:e.type));var fg=Rt(_b),Db=Rt(Ib),Mb=Rt((e,t)=>{let i=Er(e,t);if(i&&i.audioTrack&&i.audioTrack!=="")return e.tracks[i.audioTrack]}),vg=(e,t)=>t?e.speakers[t]:null;Rt(K(vg,e=>(e==null?void 0:e.audioLevel)||0));var Ob=(e,t)=>{let i=Mb(t)(e);return vg(e,i==null?void 0:i.id)};Rt(K(Ob,e=>(e==null?void 0:e.audioLevel)||0));Rt(K(Xe,Er,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return od(n)&&sd(n)});return i?e[i]:void 0}));Rt(K(Xe,Er,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return od(n)&&nd(n)});return i?e[i]:void 0}));Rt(K(Xe,Er,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return jm(n)&&nd(n)});return i?e[i]:void 0}));Rt(K(Xe,Er,(e,t)=>qs(e,t)));var xb=K([Qa,Pn,Sd],(e,t,i)=>{if(i)return e.filter(r=>{var n;return!r.recipientPeer&&!((n=r.recipientRoles)!=null&&n.length)||r.sender&&![t,i].includes(r.sender)?!1:[t,i].includes(r.recipientPeer)})}),Nb=K([Qa,pg],(e,t)=>{if(t)return e.filter(i=>{var r,n;return(r=i.recipientRoles)!=null&&r.length?(n=i.recipientRoles)==null?void 0:n.includes(t):!1})}),Ub=K(Qa,e=>e.filter(t=>{var i;return!t.recipientPeer&&!((i=t.recipientRoles)!=null&&i.length)}));K([Nb,pg],e=>e?e.filter(t=>!t.read).length:0);K([xb,Sd],e=>e?e.filter(t=>!t.read).length:0);K(Ub,e=>e.filter(t=>!t.read).length);var Fb=Rt(Lb);K([ai,Xe],(e,t)=>Object.values(e).map(i=>{var r;return{peer:i,isAudioEnabled:i.audioTrack?(r=t[i.audioTrack])==null?void 0:r.enabled:!1}}));var $b=e=>e.roleChangeRequests[0]||null;K([$b,ai,Nn],(e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null);K([gd],e=>Gm(e));K([Tb],e=>Gm(e));K([fi,Xe],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});K([Bi,Xe],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});var mg={0:"PEER_JOINED",1:"PEER_LEFT",8:"ROLE_UPDATED",10:"NAME_UPDATED",11:"METADATA_UPDATED",12:"HAND_RAISE_CHANGED"},Qu={0:"TRACK_ADDED",1:"TRACK_REMOVED",2:"TRACK_MUTED",3:"TRACK_UNMUTED",5:"TRACK_DEGRADED",6:"TRACK_RESTORED",4:"TRACK_DESCRIPTION_CHANGED"},gg={0:"POLL_CREATED",1:"POLL_STARTED",2:"POLL_STOPPED",4:"POLL_VOTES_UPDATED",3:"POLLS_LIST"},Nl="hmsNotification",Bb=class{constructor(e){this.id=0,this.onNotification=(t,i)=>{let r=n=>{if(i){let s;if(Array.isArray(i)?s=i.includes(n.type):s=i===n.type,!s)return}t(n)};return this.eventEmitter.addListener(Nl,r),()=>{this.eventEmitter.removeListener(Nl,r)}},this.store=e,this.eventEmitter=new Wa.EventEmitter2({maxListeners:Object.keys(Bm).length})}sendPlaylistTrackEnded(e){let t=this.createNotification("PLAYLIST_TRACK_ENDED",e,"info");this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification("DEVICE_CHANGE_UPDATE",e,e.error?"error":"info",`Selected ${e.type} device - ${(t=e.selection)==null?void 0:t.label}`);this.emitEvent(i)}sendLeaveRoom(e){var t;let i=(t=e.requestedBy)==null?void 0:t.name,r=this.createNotification(e.roomEnded||!i?"ROOM_ENDED":"REMOVED_FROM_ROOM",e,"info",`${e.roomEnded?"Room ended":"Removed from room"} ${i?`by ${i}`:""}`);this.emitEvent(r)}sendPeerList(e){if(e.length===0)return;let t=this.createNotification("PEER_LIST",e,"info");this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(xi(t==null?void 0:t.id))||t,r=mg[e];if(r&&i){let n=this.createNotification(r,i,"info");this.emitEvent(n)}}sendTrackUpdate(e,t){let i=this.store.getState(fg(t)),r=Qu[e];if(r){let n=this.createNotification(r,i,"info");this.emitEvent(n)}}sendMessageReceived(e){let t=this.createNotification("NEW_MESSAGE",e,"info");this.emitEvent(t)}sendError(e){let t=this.createNotification("ERROR",e,"error");this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification("RECONNECTING",e,"error");this.emitEvent(t)}sendReconnected(){let e=this.createNotification("RECONNECTED",null,"info");this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification("CHANGE_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification("CHANGE_MULTI_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendPollUpdate(e,t){let i=gg[e],r=this.store.getState(Fb(t));if(i){let n=this.createNotification(i,r,"info");this.emitEvent(n)}}emitEvent(e){this.eventEmitter.emit(Nl,e)}createNotification(e,t,i,r=""){return this.id++,{id:this.id,type:e,message:r,data:t,severity:i}}},jb=class{constructor(e){this.queuedUpdates={},this.timers={},this.DEFAULT_INTERVAL_MS=50,this.store=e}setState(e,t,i=this.DEFAULT_INTERVAL_MS){this.queuedUpdates[t]=this.queuedUpdates[t]||[],this.queuedUpdates[t].push(e),!this.timers[t]&&(window?this.timers[t]=window.setTimeout(()=>this.setStateBatched(t),i):this.setStateBatched(t))}setStateBatched(e){var t;if(((t=this.queuedUpdates[e])==null?void 0:t.length)>0){let i=r=>{this.queuedUpdates[e].forEach(n=>{try{n(r)}catch(s){Se.w("failed to update store",s)}})};console.time(`timed-${e}`),this.store.namedSetState(i,e),console.timeEnd(`timed-${e}`)}delete this.queuedUpdates[e],window&&this.timers[e]&&(window.clearTimeout(this.timers[e]),delete this.timers[e])}};function Gb(e){return e instanceof Ks||e instanceof ni}var zb=(e,t)=>{let i=Qs(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];Un(n,s)?(gi(n.auxiliaryTracks,s.auxiliaryTracks)&&(s.auxiliaryTracks=n.auxiliaryTracks),n.groups&&gi(n.groups,s.groups)&&(s.groups=n.groups),Object.assign(n,s)):kd(n,s)?delete e[r]:Ya(n,s)&&(e[r]=s)}},Vb=(e,t)=>{let i=Qs(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];Un(n,s)?(yg(n,s),Object.assign(n,s)):kd(n,s)?delete e[r]:Ya(n,s)&&(e[r]=s)}},Wb=(e,t)=>{let i=Qs(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];Un(n,s)?(n.questions&&gi(n.questions,s.questions)&&(s.questions=n.questions),Object.assign(n,s)):Ya(n,s)&&(e[r]=s)}},wp=(e,t)=>{let i=Qs(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];Un(n,s)?Object.assign(n,s):kd(n,s)?delete e[r]:Ya(n,s)&&(e[r]=s)}},Hb=(e,t,i)=>{let r=i.reduce((s,o)=>(s[o.firstTrackId]=Object.values(t[o.getTrackIDBeingSent()]||{}).sort((a,l)=>!a.rid||!l.rid?0:a.rid<l.rid?-1:1),s),{}),n=Qs(Object.keys(e),Object.keys(r));for(let s of n){if(!r[s]){delete e[s];continue}e[s]=r[s]}},yg=(e,t)=>{e.plugins&&gi(e.plugins,t.plugins)&&(t.plugins=e.plugins),e.type==="video"&&e.layerDefinitions&&gi(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},Un=(e,t)=>e&&t,kd=(e,t)=>e&&!t,Ya=(e,t)=>!e&&t,gi=(e,t)=>{if(e===t||e.length===0&&(t==null?void 0:t.length)===0)return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Qs=(e,t)=>{let i=new Set;for(let r of e)i.add(r);for(let r of t)i.add(r);return Array.from(i)},Ke=class ir{static convertPeer(t){var i,r,n;return{id:t.peerId,name:t.name,roleName:(i=t.role)==null?void 0:i.name,isLocal:t.isLocal,videoTrack:(r=t.videoTrack)==null?void 0:r.trackId,audioTrack:(n=t.audioTrack)==null?void 0:n.trackId,auxiliaryTracks:t.auxiliaryTracks.map(s=>s.trackId),customerUserId:t.customerUserId,metadata:t.metadata,joinedAt:t.joinedAt,groups:t.groups,isHandRaised:t.isHandRaised,type:t.type}}static convertTrack(t,i){let r={id:t.trackId,source:t.source,type:t.type,enabled:t.enabled,displayEnabled:t.enabled,peerId:t.peerId||i};return this.enrichTrack(r,t),r}static enrichTrack(t,i){let r=i.getMediaTrackSettings();i instanceof Ks&&(t.volume=i.getVolume()||0),ir.updateDeviceID(t,i),ir.enrichLocalTrack(t,i),t.type==="video"&&(t.source==="screen"?(t.displaySurface=r.displaySurface,ir.enrichScreenTrack(t,i)):t.source==="regular"&&(t.facingMode=r.facingMode),t.height=r.height,t.width=r.width,ir.enrichVideoTrack(t,i)),ir.enrichPluginsDetails(t,i)}static enrichLocalTrack(t,i){(i instanceof mi||i instanceof En)&&(t.isPublished=i.isPublished)}static updateDeviceID(t,i){var r;i instanceof mi||i instanceof En?t.deviceID=i.settings.deviceId:t.deviceID=(r=i.getMediaTrackSettings())==null?void 0:r.deviceId}static enrichVideoTrack(t,i){i instanceof ni&&(t.layer=i.getLayer(),t.preferredLayer=i.getPreferredLayer(),t.degraded=i.degraded),(i instanceof ni||i instanceof mi)&&(gi(i.getSimulcastDefinitions(),t.layerDefinitions)||(t.layerDefinitions=i.getSimulcastDefinitions()))}static enrichScreenTrack(t,i){var r,n;if(i instanceof mi){let s=(r=i.getCaptureHandle)==null?void 0:r.call(i);(s==null?void 0:s.handle)!==((n=t.captureHandle)==null?void 0:n.handle)&&(t.captureHandle=s),i.isCurrentTab&&(t.displaySurface="selfBrowser")}}static enrichPluginsDetails(t,i){(i instanceof mi||i instanceof En)&&(gi(i.getPlugins(),t.plugins)||(t.plugins=i.getPlugins()))}static convertRoom(t,i){let{recording:r,rtmp:n,hls:s}=ir.convertRecordingStreamingState(t==null?void 0:t.recording,t==null?void 0:t.rtmp,t==null?void 0:t.hls);return{id:t.id,name:t.name,localPeer:i,recording:r,rtmp:n,hls:s,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount,isLargeRoom:t.large_room_optimization,isEffectsEnabled:t.isEffectsEnabled,effectsKey:t.effectsKey,isHipaaEnabled:t.isHipaaEnabled,isNoiseCancellationEnabled:t.isNoiseCancellationEnabled}}static convertMessage(t,i){var r,n,s,o;return{sender:(r=t.peer)==null?void 0:r.peer_id,senderName:(n=t.peer)==null?void 0:n.info.name,senderRole:(s=t.peer)==null?void 0:s.role,senderUserId:(o=t.peer)==null?void 0:o.info.user_id,recipientPeer:t.private?i:void 0,recipientRoles:t.roles,time:new Date(t.timestamp),type:t.info.type,message:t.info.message,id:t.message_id}}static convertRoles(t){let i={};return t&&t.forEach(r=>{i[r.name]=r}),i}static convertRoleChangeRequest(t){var i;return{requestedBy:(i=t.requestedBy)==null?void 0:i.peerId,roleName:t.role.name,token:t.token}}static convertException(t){return{code:t.code,action:t.action,name:t.name,message:t.message,description:t.description,isTerminal:t.isTerminal,nativeError:t.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(t){let i={devices:t.devices,selection:t.selection,type:t.type};return t.error&&(i.error=this.convertException(t.error)),i}static convertPlaylist(t){let i=this.getConvertedPlaylistType(t,"audio"),r=this.getConvertedPlaylistType(t,"video");return{audio:i,video:r}}static convertPlaylistItem(t,i){let r=i.type,n=t.getCurrentSelection(r),s=t.isPlaying(r),o=i.url===(n==null?void 0:n.url);return Ee(H({},i),{type:i.type,selected:o,playing:o&&s})}static getConvertedPlaylistType(t,i){let r={},n=t.getCurrentSelection(i),s=t.getCurrentProgress(i),o=t.getVolume(i),a=t.getList(i),l=t.getCurrentIndex(i);return t.getList(i).forEach(u=>{r[u.id]=ir.convertPlaylistItem(t,u)}),{list:r,selection:{id:n==null?void 0:n.id,hasPrevious:l>0,hasNext:l<a.length-1},progress:s,volume:o,currentTime:t.getCurrentTime(i),playbackRate:t.getPlaybackRate(i)}}static convertRecordingStreamingState(t,i,r,n){var s;return{recording:{browser:H({running:!1},t==null?void 0:t.browser),server:H({running:!1},t==null?void 0:t.server),hls:H({running:!1},t==null?void 0:t.hls)},rtmp:H({running:!1},i),hls:{variants:((s=r==null?void 0:r.variants)==null?void 0:s.map(o=>o))||[],running:!!(r!=null&&r.running),error:r==null?void 0:r.error},transcriptions:n||[]}}},Pp=class{constructor(e,t,i,r){this.playlistManager=e,this.syncPlaylistState=i,this.store=r,this.type=t}play(e){return f(this,null,function*(){if(!e){Se.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return f(this,null,function*(){let e=this.type==="audio"?wb:Pb,t=this.store.getState(e.selection);if(!t.id){Se.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return f(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return f(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return f(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return f(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t})}clearList(){return f(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)})}},qb=class{constructor(e,t){this.sdk=e,this.setLocally=t}get sdkSessionStore(){return this.sdk.getSessionStore()}set(e,t){return f(this,null,function*(){let{value:i}=yield this.sdkSessionStore.set(String(e),t);this.setLocally({key:e,value:i})})}observe(e){return f(this,null,function*(){let t=Array.isArray(e)?e.map(i=>String(i)):[String(e)];yield this.sdkSessionStore.observe(t)})}unobserve(e){return f(this,null,function*(){let t=Array.isArray(e)?e.map(i=>String(i)):[String(e)];yield this.sdkSessionStore.unobserve(t)})}},Kb=class{constructor(e,t){this.intervalMs=100,this.shouldMonitor=!1,this.hasStarted=!1,this.unsubs=[],this.analysers={},this.store=e,this.actions=t}start(){return f(this,null,function*(){if(this.hasStarted)return;this.hasStarted=!0,Se.d("starting audio level monitor for remote peers",this.store);let e=this.store.getState(wn);Se.d("starting audio levels is connected to room",e),e&&(yield this.monitorAudioLevels());let t=this.store.subscribe(this.monitorAudioLevels.bind(this),wn);this.unsubs.push(t)})}stop(){return f(this,null,function*(){this.hasStarted&&(this.hasStarted=!1,this.shouldMonitor=!1,this.unsubs.forEach(e=>e()),Se.d("stopped audio level monitor for remote peers"))})}monitorAudioLevels(){return f(this,null,function*(){if(!this.store.getState(wn)){this.shouldMonitor&&(Se.i("room no longer connected, stopping audio level monitoring for remote"),this.shouldMonitor=!1);return}if(this.shouldMonitor)return;Se.i("monitoring audio levels"),this.shouldMonitor=!0;let e=()=>{this.shouldMonitor?(this.logAllPeersAudioLevels(),setTimeout(e,this.intervalMs)):Se.i("stopped monitoring audio levels")};setTimeout(e,1e3)})}logAllPeersAudioLevels(){return f(this,null,function*(){var e;if(!window.__triggerBeamEvent__)return;let t=this.store.getState(md).filter(r=>!!r.audioTrack),i=[];for(let r of t){let n=this.actions.getTrackById(r.audioTrack||""),s=(e=n==null?void 0:n.stream)==null?void 0:e.nativeStream;if(r.joinedAt&&s){let o=yield this.getAudioLevel(r,s);o.level>0&&i.push(o)}}if(i.length>0){let r={event:"app-audio-level",data:i};Se.d("logging audio levels",i),window.__triggerBeamEvent__(JSON.stringify(r))}})}getAudioLevel(e,t){return f(this,null,function*(){this.analysers[t.id]||(this.analysers[t.id]=this.createAnalyserNode(t));let i=this.analysers[t.id],r=this.calculateAudioLevel(i);return{peerId:e.id,peerName:e.name,level:r}})}createAnalyserNode(e){this.audioContext||(this.audioContext=new AudioContext);let t=this.audioContext.createAnalyser();return this.audioContext.createMediaStreamSource(e).connect(t),t}calculateAudioLevel(e){let t=new Uint8Array(e.fftSize);e.getByteTimeDomainData(t);let i=.009,r=i;for(let s of t)r=Math.max(r,(s-128)/128);let n=(Math.log(i)-Math.log(r))/Math.log(i);return Math.ceil(Math.min(Math.max(n*100,0),100))}},Jb=class{constructor(e,t,i){this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:r,progress:n})=>{this.setState(s=>{s.playlist[r].progress=n,s.playlist[r].currentTime=this.sdk.getPlaylistManager().getCurrentTime(r)},"playlistProgress")},this.syncPlaylistState=r=>{this.setState(n=>{Object.assign(n.playlist,Ke.convertPlaylist(this.sdk.getPlaylistManager()))},r)},this.sendPeerUpdateNotification=(r,n)=>{let s=this.store.getState(xi(n.peerId)),o=mg[r]||"peerUpdate";if(r===8)this.syncRoomState(o),this.updateMidCallPreviewRoomState(r,n);else if([0,1].includes(r))this.syncRoomState(o),s||(s=this.store.getState(xi(n.peerId)));else if([12,13,14].includes(r))this.syncRoomState(o),s||(s=this.store.getState(xi(n.peerId)));else{let a=Ke.convertPeer(n);this.setState(l=>{let u=l.peers[a.id];Un(u,a)&&(gi(u.auxiliaryTracks,a.auxiliaryTracks)&&(u.auxiliaryTracks=a.auxiliaryTracks),Object.assign(u,a)),s=a},o)}this.hmsNotifications.sendPeerUpdate(r,s)},this.getSDKHMSPeer=r=>this.sdk.getPeerMap()[r],this.setState=(r,n)=>this.store.namedSetState(r,n),this.store=e,this.sdk=t,this.hmsNotifications=i,this.sessionStore=new qb(this.sdk,this.setSessionStoreValueLocally.bind(this)),this.actionBatcher=new jb(e)}getLocalTrack(e){return this.sdk.store.getLocalPeerTracks().find(t=>t.trackId===e)}get interactivityCenter(){return this.sdk.getInteractivityCenter()}setPlaylistSettings(e){this.sdk.updatePlaylistSettings(e)}refreshDevices(){return f(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return f(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){return f(this,null,function*(){t?yield this.setTrackVolume(e,t):(yield this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))})}setAudioOutputDevice(e){return f(this,null,function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState(t=>{t.settings.audioOutputDeviceId=e},"setAudioOutputDevice")})}setPreferredLayer(e,t){return f(this,null,function*(){var i;let r=this.getTrackById(e);if(r)if(r instanceof ni){if(t==="none"){Se.d("layer none will be ignored");return}if(((i=this.store.getState(Db(e)))==null?void 0:i.preferredLayer)===t){Se.d(`preferred layer is already ${t}`);return}this.setState(n=>{let s=n.tracks[e];s&&(s.preferredLayer=t)},"setPreferredLayer"),yield r.setPreferredLayer(t)}else Se.d(`track ${e} is not a remote video track`);else this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)})}getNativeTrackById(e){var t;return(t=this.sdk.store.getTrackById(e))==null?void 0:t.nativeTrack}getTrackById(e){return this.sdk.store.getTrackById(e)}getAuthTokenByRoomCode(e,t){return this.sdk.getAuthTokenByRoomCode(e,t)}preview(e){return f(this,null,function*(){let t=this.store.getState(Pi);if(t==="Preview"||t==="Connecting"){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{t!=="Connected"&&this.setState(i=>{i.room.roomState="Connecting"},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(i){throw Se.e("Cannot show preview. Failed to connect to room - ",i),i}})}cancelMidCallPreview(){return f(this,null,function*(){return this.sdk.cancelMidCallPreview()})}join(e){return f(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState="Connecting"},"join"),yield this.sdkJoinWithListeners(e)}catch(t){throw this.isRoomJoinCalled=!1,Se.e("Failed to connect to room - ",t),t}})}leave(){return f(this,null,function*(){let e=this.store.getState(wn),t=!0;e||(t=!1,this.logPossibleInconsistency("room leave is called when no room is connected"));let i=this.store.getState(Pi);return this.setState(r=>{r.room.roomState="Disconnecting"},"leaving"),this.sdk.leave(t).then(()=>{this.resetState("leave"),this.beamSpeakerLabelsLogger&&this.beamSpeakerLabelsLogger.stop().catch(Se.e),Se.i("left room")}).catch(r=>{Se.e("error in leaving room - ",r),this.setState(n=>{n.room.roomState=i},"revertLeave")})})}setScreenShareEnabled(e,t){return f(this,null,function*(){typeof t=="boolean"&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(i){throw this.hmsNotifications.sendError(Ke.convertException(i)),i}})}addTrack(e,t="regular"){return f(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return f(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return f(this,null,function*(){let t=this.store.getState(Bi);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return f(this,null,function*(){let t=this.store.getState(fi);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return f(this,null,function*(){var i;if(((i=this.store.getState().tracks[e])==null?void 0:i.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(n=>{n.tracks[e]?n.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(n){throw this.setState(s=>{s.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Ke.convertException(n)),n}let r=t?3:2;this.hmsNotifications.sendTrackUpdate(r,e)})}setAudioSettings(e){return f(this,null,function*(){let t=this.store.getState(Bi);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return f(this,null,function*(){let t=this.store.getState(fi);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}switchCamera(){return f(this,null,function*(){let e=this.store.getState(fi);if(e){let t=this.sdk.store.getLocalPeerTracks().find(i=>i.trackId===e);t&&(yield t.switchCamera(),this.syncRoomState("switchCamera"))}})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return f(this,null,function*(){let{message_id:i,timestamp:r}=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore({message:e,type:t,id:i,time:r})})}sendGroupMessage(e,t,i){return f(this,null,function*(){let r=this.store.getState(Nn),n=t.map(a=>r[a]),{message_id:s,timestamp:o}=yield this.sdk.sendGroupMessage(e,n,i);this.updateMessageInStore({message:e,recipientRoles:t,type:i,id:s,time:o})})}sendDirectMessage(e,t,i){return f(this,null,function*(){let{message_id:r,timestamp:n}=yield this.sdk.sendDirectMessage(e,t,i);this.updateMessageInStore({message:e,recipientPeer:t,type:i,id:r,time:n})})}updateMessageInStore(e){var t;if(!e.message)throw Se.w("sendMessage","Failed to send message",e),Error(`sendMessage Failed - ${JSON.stringify(e)}`);if(e.type&&this.ignoredMessageTypes.includes(e.type))return;let i=this.sdk.getLocalPeer(),r={read:!0,id:e.id,time:new Date(e.time),message:e.message,type:e.type||"chat",recipientPeer:e.recipientPeer,recipientRoles:e.recipientRoles,senderName:i==null?void 0:i.name,sender:i==null?void 0:i.peerId,senderRole:(t=i==null?void 0:i.role)==null?void 0:t.name,ignored:!1};this.setState(n=>{n.messages.byID[r.id]=r,n.messages.allIDs.push(r.id)},"newMessage")}setMessageRead(e,t){this.setState(i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach(r=>{i.messages.byID[r].read=e})},"setMessageRead")}attachVideo(e,t){return f(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(i=>{let r=this.store.subscribe(n=>f(this,null,function*(){n&&(yield this.attachVideoInternal(e,t),r(),i())}),Cp)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return f(this,null,function*(){let i=this.getTrackById(e);(i==null?void 0:i.type)==="video"?yield this.sdk.detachVideo(i,t):(t&&(t.srcObject=null),Se.d("possible inconsistency detected - no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return f(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginsToVideoStream(e){return f(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"add")})}removePluginsFromVideoStream(e){return f(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"remove")})}addPluginToAudioTrack(e){return f(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Se.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(fi);if(!i)return Se.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let r=this.getTrackById(i);return r?t=r.validatePlugin(e):(Se.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Se.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(Bi);if(!i)return Se.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let r=this.getTrackById(i);return r?t=r.validatePlugin(e):(Se.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return f(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return f(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,i=!1){return f(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,i)})}changeRoleOfPeer(e,t,i=!1){return f(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,i)})}changeRoleOfPeersWithRoles(e,t){return f(this,null,function*(){let i=this.sdk.getRoles().filter(r=>e.includes(r.name));yield this.sdk.changeRoleOfPeersWithRoles(i,t)})}acceptChangeRole(e){return f(this,null,function*(){let t=e.requestedBy?this.getSDKHMSPeer(e.requestedBy.id):void 0;t||Se.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)})}raiseLocalPeerHand(){return f(this,null,function*(){yield this.sdk.raiseLocalPeerHand()})}lowerLocalPeerHand(){return f(this,null,function*(){yield this.sdk.lowerLocalPeerHand()})}raiseRemotePeerHand(e){return f(this,null,function*(){yield this.sdk.raiseRemotePeerHand(e)})}lowerRemotePeerHand(e){return f(this,null,function*(){yield this.sdk.lowerRemotePeerHand(e)})}getPeerListIterator(e){let t=this.sdk.getPeerListIterator(e);return{hasNext:()=>t.hasNext(),next:()=>f(this,null,function*(){return(yield t.next()).map(i=>Ke.convertPeer(i))}),findPeers:()=>f(this,null,function*(){return(yield t.findPeers()).map(i=>Ke.convertPeer(i))}),getTotal:()=>t.getTotal()}}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,i){let r=(t==null?void 0:t.constructor.name)==="Object";this.setState(n=>{if(n.appData)i&&r?Object.assign(n.appData[e],t):n.appData[e]=t;else{let s={[e]:t};n.appData=s}},`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return f(this,null,function*(){let i=this.store.getState(bb);if(!(i!=null&&i.endRoom)){Se.w("You are not allowed to perform this action - endRoom");return}let r=this.store.getState(Pi);this.setState(n=>{n.room.roomState="Disconnecting"},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(n){Se.e("error in ending room - ",n),this.setState(s=>{s.room.roomState=r},"revertEndRoom")}})}removePeer(e,t){return f(this,null,function*(){var i;let r=(i=this.sdk.getLocalPeer())==null?void 0:i.peerId;e!==r&&(yield this.sdk.removePeer(e,t))})}startRTMPOrRecording(e){return f(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return f(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return f(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return f(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return f(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return f(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return f(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setSessionMetadata(e){return f(this,null,function*(){yield this.sdk.setSessionMetadata(e),this.setState(t=>{t.sessionMetadata=e},"setSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"setSessionMetadata")})}populateSessionMetadata(){return f(this,null,function*(){let e=yield this.sdk.getSessionMetadata();this.setState(t=>{t.sessionMetadata=e},"populateSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"populateSessionmetadata")})}setRemoteTrackEnabled(e,t){return f(this,null,function*(){if(typeof e=="string"){let i=this.getTrackById(e);i&&Gb(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(i=>this.setRemoteTrackEnabled(i,t))})}setRemoteTracksEnabled(e){return f(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(Nn);t.roles=e.roles.map(r=>i[r])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){Se.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let i of e)this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}enableBeamSpeakerLabelsLogging(){return f(this,null,function*(){this.beamSpeakerLabelsLogger||(Se.i("enabling beam speaker labels logging"),this.beamSpeakerLabelsLogger=new Kb(this.store,this),yield this.beamSpeakerLabelsLogger.start())})}resetState(e="resetState"){this.isRoomJoinCalled=!1,Se.cleanup(),this.setState(t=>{Object.assign(t,Fm())},e)}sdkJoinWithListeners(e){return f(this,null,function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})})}onRemovedFromRoom(e){var t;let i=this.store.getState(xi((t=e.requestedBy)==null?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Ee(H({},e),{requestedBy:i||void 0}));let r=e.roomEnded||!i?"roomEnded":"removedFromRoom";Se.i(`resetting state after peer removed ${r}`,e),this.resetState(r)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(Ti);if(this.setState(r=>{gi(r.devices.audioInput,t.audioInput)||(r.devices.audioInput=t.audioInput),gi(r.devices.videoInput,t.videoInput)||(r.devices.videoInput=t.videoInput),gi(r.devices.audioOutput,t.audioOutput)||(r.devices.audioOutput=t.audioOutput);let n=this.sdk.getLocalPeer();i!=null&&i.id&&n&&Object.assign(r.settings,this.getMediaSettings(n))},"deviceChange"),e.selection){let r=Ke.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(r)}}sdkPreviewWithListeners(e){return f(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var i;let r=t.room.localPeer||((i=this.sdk.getLocalPeer())==null?void 0:i.peerId);r&&(t.connectionQualities[r]={peerID:r,downlinkQuality:e})},"ConnectionQuality")}onSessionStoreUpdate(e){this.setSessionStoreValueLocally(e,"sessionStoreUpdate")}onPollsUpdate(e,t){let i=gg[e];this.setState(r=>{let n=t.reduce((s,o)=>{var a;return s[o.id]=Ee(H({},o),{questions:(a=o.questions)==null?void 0:a.map(l=>{var u,c;return Ee(H({},l),{answer:l.answer?H({},l.answer):void 0,options:(u=l.options)==null?void 0:u.map(h=>H({},h)),responses:(c=l.responses)==null?void 0:c.map(h=>H({},h))})})}),s},{});Wb(r.polls,n)},i),t.forEach(r=>this.hmsNotifications.sendPollUpdate(e,r.id))}onWhiteboardUpdate(e){this.setState(t=>{t.whiteboards[e.id]=e},"whiteboardUpdate")}startScreenShare(e){return f(this,null,function*(){this.store.getState(Ep)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return f(this,null,function*(){this.store.getState(Ep)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return f(this,null,function*(){let i=this.getTrackById(e);i||(i=this.getLocalTrack(e)),i&&i.type==="video"?yield this.sdk.attachVideo(i,t):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e=`${e}_fullSync`,Se.time(`store-sync-${e}`);let t={},i=[],r={},n={},s={},o,a=this.sdk.getPeers();for(let p of a){let S=Ke.convertPeer(p);t[S.id]=S,i.push(S.id),s[S.id]={peerID:S.id,downlinkQuality:p.networkQuality||-1};let k=[p.audioTrack,p.videoTrack,...p.auxiliaryTracks];for(let E of k){if(!E)continue;let O=Ke.convertTrack(E);r[O.id]=O}if(p.isLocal){let E=p;o=this.getPreviewFields(E),Object.assign(n,this.getMediaSettings(E))}}let l=this.sdk.getRecordingState(),u=this.sdk.getRTMPState(),c=this.sdk.getHLSState(),h=this.sdk.getTranscriptionState();this.setState(p=>{var S;p.room.peers=i;let k=p.peers,E=p.tracks;zb(k,t),Vb(E,r),Object.assign(p.settings,n),p.room.isConnected&&Object.assign(p.connectionQualities,s),(S=p.preview)!=null&&S.localPeer&&o!=null&&o.localPeer?Object.assign(p.preview,o):p.preview=o,Object.assign(p.roles,Ke.convertRoles(this.sdk.getRoles())),Object.assign(p.playlist,Ke.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(p.room,Ke.convertRecordingStreamingState(l,u,c,h)),Object.assign(p.templateAppData,this.sdk.getTemplateAppData())},e),Se.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{var i;Object.assign(t.room,Ke.convertRoom(e,(i=this.sdk.getLocalPeer())==null?void 0:i.peerId)),t.room.roomState="Preview"},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new Pp(t,"audio",this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new Pp(t,"video",this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(i=>{var r;Object.assign(i.room,Ke.convertRoom(e,(r=this.sdk.getLocalPeer())==null?void 0:r.peerId)),i.room.isConnected=!0,i.room.roomState="Connected"},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(i=>{this.syncPlaylistState(`${i.type}PlaylistUpdate`)}),t.onPlaylistEnded(i=>{this.syncPlaylistState(`${i}PlaylistEnded`)}),t.onCurrentTrackEnded(i=>{this.hmsNotifications.sendPlaylistTrackEnded(Ke.convertPlaylistItem(t,i)),this.syncPlaylistState(`${i.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(i=>{var r;Object.assign(i.room,Ke.convertRoom(t,(r=this.sdk.getLocalPeer())==null?void 0:r.peerId))},e)}onPeerUpdate(e,t){if(![4,5].includes(e)){if(Array.isArray(t)){let i=this.store.getState(ai),r=t.filter(n=>!i[n.peerId]);if(this.syncRoomState("peersJoined"),this.store.getState(wn)){let n=[];for(let s of t){let o=this.store.getState(xi(s.peerId));o&&n.push(o)}this.hmsNotifications.sendPeerList(n)}else r.forEach(n=>{let s=this.store.getState(xi(n.peerId));s&&this.hmsNotifications.sendPeerUpdate(0,s)});return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(e===1)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else if([0,1].includes(e)){let r=Qu[e];this.syncRoomState(r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}else{let r=Qu[e]||"trackUpdate",n=Ke.convertTrack(t);this.setState(s=>{let o=s.tracks[n.id];Un(o,n)&&(yg(o,n),Object.assign(o,n))},r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=Ke.convertMessage(e,this.store.getState(Pn));t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),t.type==="hms_transcript"&&(t.ignored=!0),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.actionBatcher.setState(t=>{t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage",150)}onAudioLevelUpdate(e){this.setState(t=>{let i={};e.forEach(n=>{if(!n.track||!n.peer)return;let s=n.track.trackId;i[s]=n.audioLevel,t.speakers[s]||(t.speakers[s]={audioLevel:n.audioLevel,peerID:n.peer.peerId,trackID:s})});let r=Object.entries(t.speakers);for(let[n,s]of r)s.audioLevel=i[n]||0,s.audioLevel===0&&delete t.speakers[n]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{e.forEach(i=>{let r=i.peerID;r&&(t.connectionQualities[r]?Object.assign(t.connectionQualities[r],i):t.connectionQualities[r]=i)})},"connectionQuality")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(xi((t=e.requestedBy)==null?void 0:t.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),n=this.store.getState(fg(r));if(!n)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:n,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(xi((t=e.requestedBy)==null?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let r=[],n=this.store.getState(Xe);for(let s of e.tracks){let o=this.getStoreLocalTrackIDfromSDKTrack(s);o&&n[o]&&r.push(n[o])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:r,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?"Connected":"Preview"},"reconnected")}onReconnecting(e){let t=Ke.convertException(e);Se.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(i=>{i.room.roomState="Reconnecting",i.errors.push(t)},"reconnecting")}onError(e){let t=Ke.convertException(e);t.isTerminal?(this.leave().then(()=>Se.e("error from SDK, left room.")),this.setState(i=>{i.room.roomState="Failed",i.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(i=>{i.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Se.e("received error from sdk",t instanceof ue?`${t}`:t)}handleTrackRemove(e,t){this.setState(i=>{let r=i.peers[t.peerId],n=i.tracks,s=e.trackId;if(r)if(s===r.audioTrack)delete r.audioTrack;else if(s===r.videoTrack)delete r.videoTrack;else{let o=r.auxiliaryTracks.indexOf(s);o>-1&&r.auxiliaryTracks.splice(o,1)}delete n[s]},"trackRemoved")}setEnabledSDKTrack(e,t){return f(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return f(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return f(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var t;let i=this.store.getState(ub),r=e.audioTrack,n=e.videoTrack;return{audioInputDeviceId:(r==null?void 0:r.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(n==null?void 0:n.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:(t=this.sdk.getAudioOutput().getDevice())==null?void 0:t.deviceId}}getPreviewFields(e){var t,i;if(!e.isInPreview())return;let r=Ke.convertPeer(e);return{localPeer:r.id,audioTrack:r.audioTrack,videoTrack:r.videoTrack,asRole:((t=e.asRole)==null?void 0:t.name)||((i=e.role)==null?void 0:i.name)}}setTrackVolume(e,t){return f(this,null,function*(){let i=this.getTrackById(t);i?i instanceof ud?(yield i.setVolume(e),this.setState(r=>{let n=r.tracks[t];n&&n.type==="audio"&&(n.volume=e)},"trackVolume")):Se.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)})}localAndVideoUnmuting(e){let t=this.store.getState(Ti);if((t==null?void 0:t.videoTrack)!==e)return!1;let i=this.store.getState(mb),r=this.store.getState(Cp);return i&&!r}logPossibleInconsistency(e){Se.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return f(this,null,function*(){if(!e){Se.w("Invalid plugin received in store");return}let r=this.store.getState(fi);if(r){let n=this.getLocalTrack(r);n?(t==="add"?yield n.addPlugin(e,i):t==="remove"&&(yield n.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${r} not present, unable to ${t} plugin`)}})}addRemoveMediaStreamVideoPlugins(e,t){return f(this,null,function*(){if(e.length===0){Se.w("Invalid plugin received in store");return}let i=this.store.getState(fi);if(i){let r=this.getLocalTrack(i);r?(t==="add"?yield r.addStreamPlugins(e):t==="remove"&&(yield r.removeStreamPlugins(e)),this.syncRoomState(`${t}MediaStreamPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to ${t} plugin`)}})}addRemoveAudioPlugin(e,t){return f(this,null,function*(){if(!e){Se.w("Invalid plugin received in store");return}let i=this.store.getState(Bi);if(i){let r=this.getLocalTrack(i);r?(t==="add"?yield r.addPlugin(e):t==="remove"&&(yield r.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to ${t} plugin`)}})}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push(Ke.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let i=t.roleChangeRequests.findIndex(r=>r.token===e.token);i!==-1&&t.roleChangeRequests.splice(i,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(vb).find(t=>{var i;return((i=this.getTrackById(t))==null?void 0:i.trackId)===e.trackId})}updateMidCallPreviewRoomState(e,t){t.isLocal&&e===8&&this.store.getState(Sb)&&this.setState(i=>{i.room.roomState="Connected"},"midCallPreviewCompleted")}setSessionStoreValueLocally(e,t="setSessionStore"){let i=Array.isArray(e)?e:[e];this.setState(r=>{i.forEach(n=>{r.sessionStore[n.key]=n.value})},t)}},Sg=e=>jt?`${e} ${document.title}`:e,Qb=class{constructor(e){this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]},this.transcriptions=[],this.id=e}},Yb=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=i=>f(this,null,function*(){var r;if(!i)return;let{url:n,timeout:s,scoreMap:o}=i,a=this.controller.signal,l=Date.now(),u=0,c=Ki(s).then(()=>{this.controller.abort()});try{let h=(r=(yield fetch(`${n}?${Date.now()}`,{signal:a})).body)==null?void 0:r.getReader();if(!h)throw Error("unable to process request");let p=()=>f(this,null,function*(){if(h)try{let S=!1;for(;!S;){let{value:k,done:E}=yield h.read();S=E,k&&(u+=k.byteLength,this.sendScore({scoreMap:o,downloadedSize:u,startTime:l}))}}catch(S){S.name!=="AbortError"&&y.d(this.TAG,S)}});return Promise.race([p(),c]).then(()=>{this.sendScore({scoreMap:o,downloadedSize:u,startTime:l,finished:!0})}).catch(S=>{y.d(this.TAG,S),this.updateScoreToListener(0),this.eventBus.analytics.publish(ke.previewNetworkQuality({error:S.message}))})}catch(h){h.name!=="AbortError"?(y.d(this.TAG,h),this.updateScoreToListener(0),this.eventBus.analytics.publish(ke.previewNetworkQuality({error:h.message}))):y.d(this.TAG,h)}}),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:i,downloadedSize:r,startTime:n,finished:s=!1})=>{let o=(Date.now()-n)/1e3,a=r/1024/o*8,l=-1;for(let u in i){let c=i[u];a>=c.low&&(!c.high||a<=c.high)&&(l=Number(u))}this.updateScoreToListener(l),s&&this.eventBus.analytics.publish(ke.previewNetworkQuality({score:l,downLink:a.toFixed(2)}))}}updateScoreToListener(e){var t,i;e!==this.score&&(this.score=e,(i=(t=this.listener)==null?void 0:t.onNetworkQuality)==null||i.call(t,e))}},Xb=class{constructor(e,t,i,r,n,s){this.store=e,this.transport=t,this.deviceManager=i,this.publish=r,this.removeAuxiliaryTrack=n,this.listener=s,this.handleLocalPeerRoleUpdate=o=>f(this,[o],function*({oldRole:a,newRole:l}){var u;let c=this.store.getLocalPeer();c&&(yield this.diffRolesAndPublishTracks({oldRole:a,newRole:l}),(u=this.listener)==null||u.onPeerUpdate(8,c))}),this.diffRolesAndPublishTracks=o=>f(this,[o],function*({oldRole:a,newRole:l}){var u,c,h,p,S,k;let E=new Set(a.publishParams.allowed),O=new Set(l.publishParams.allowed),I=this.removeTrack(E,O,"video"),R=this.removeTrack(E,O,"audio"),A=this.removeTrack(E,O,"screen"),M=this.hasSimulcastDifference((u=a.publishParams.simulcast)==null?void 0:u.video,(c=l.publishParams.simulcast)==null?void 0:c.video),W=this.hasSimulcastDifference((h=a.publishParams.simulcast)==null?void 0:h.screen,(p=l.publishParams.simulcast)==null?void 0:p.screen),Z=(k=(S=this.store.getLocalPeer())==null?void 0:S.videoTrack)==null?void 0:k.enabled;yield this.removeAudioTrack(R),yield this.removeVideoTracks(I||M),yield this.removeScreenTracks(A||W);let X=this.getSettings();M&&(X.isVideoMuted=!Z),yield this.publish(X),yield this.syncDevices(X,l)})}syncDevices(e,t){return f(this,null,function*(){(!e.isAudioMuted||!e.isVideoMuted)&&t.publishParams.allowed.length>0&&(yield this.deviceManager.init(!0))})}removeVideoTracks(e){return f(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.videoTrack&&(i.videoTrack.isPublished?yield this.transport.unpublish([i.videoTrack]):yield i.videoTrack.cleanup(),(t=this.listener)==null||t.onTrackUpdate(1,i.videoTrack,i),i.videoTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="video")})}removeAudioTrack(e){return f(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.audioTrack&&(i.audioTrack.isPublished?yield this.transport.unpublish([i.audioTrack]):yield i.audioTrack.cleanup(),(t=this.listener)==null||t.onTrackUpdate(1,i.audioTrack,i),i.audioTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="audio")})}removeScreenTracks(e){return f(this,null,function*(){e&&(yield this.removeAuxTracks(t=>t.source==="screen"))})}removeAuxTracks(e){return f(this,null,function*(){let t=this.store.getLocalPeer();if(t!=null&&t.auxiliaryTracks){let i=[...t.auxiliaryTracks];for(let r of i)e(r)&&(yield this.removeAuxiliaryTrack(r.trackId))}})}removeTrack(e,t,i){return e.has(i)&&!t.has(i)}hasSimulcastDifference(e,t){var i,r,n;return!e&&!t?!1:((i=e==null?void 0:e.layers)==null?void 0:i.length)!==((r=t==null?void 0:t.layers)==null?void 0:r.length)?!0:!!((n=e==null?void 0:e.layers)!=null&&n.some(s=>{var o;let a=(o=t==null?void 0:t.layers)==null?void 0:o.find(l=>l.rid===s.rid);return(a==null?void 0:a.maxBitrate)!==s.maxBitrate||(a==null?void 0:a.maxFramerate)!==s.maxFramerate}))}getSettings(){var e,t,i;let r=(e=this.store.getConfig())==null?void 0:e.settings;return{isAudioMuted:(t=r==null?void 0:r.isAudioMuted)!=null?t:!0,isVideoMuted:(i=r==null?void 0:r.isVideoMuted)!=null?i:!0,audioInputDeviceId:(r==null?void 0:r.audioInputDeviceId)||"default",audioOutputDeviceId:(r==null?void 0:r.audioOutputDeviceId)||"default",videoDeviceId:(r==null?void 0:r.videoDeviceId)||"default"}}},Zb=class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new Ha("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}setEnv(e){this.env=e,this.flushFailedEvents()}setWebsocketEndpoint(e){this.websocketURL=e}sendEvent(e){if(!this.env){this.addEventToStorage(e);return}let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},i=this.env==="prod"?jT:GT;fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then(r=>{if(r.status===401){this.removeFromStorage(e);return}if(r.status!==200)throw Error(r.statusText);this.removeFromStorage(e)}).catch(r=>{y.v(this.TAG,"Failed to send event",r,e),this.addEventToStorage(e)})}flushFailedEvents(){let e=this.failedEvents.get();e==null||e.forEach(t=>this.sendEvent(t))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find(i=>i.timestamp===e.timestamp)||(t.length===100&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],i=t.findIndex(r=>r.timestamp===e.timestamp);i>-1&&(t.splice(i,1),this.failedEvents.set(t))}},Bs=new Zb,eC=class{constructor(){this.TAG="[Store]:",this.knownRoles={},this.peers={},this.tracks=new Map,this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env="prod",this.simulcastEnabled=!1,this.userAgent=zu(this.env),this.polls=new Map,this.whiteboards=new Map}getConfig(){return this.config}setSimulcastEnabled(e){this.simulcastEnabled=e}getEnv(){return this.env}getPublishParams(){let e=this.getLocalPeer(),t=(e==null?void 0:e.asRole)||(e==null?void 0:e.role);return t==null?void 0:t.publishParams}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getTemplateAppData(){return this.templateAppData}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter(e=>!e.isLocal)}getPeers(){return Object.values(this.peers)}getPeerMap(){return this.peers}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Array.from(this.tracks.values())}getVideoTracks(){return this.getTracks().filter(e=>e.type==="video")}getRemoteVideoTracks(){return this.getTracks().filter(e=>e instanceof ni)}getAudioTracks(){return this.getTracks().filter(e=>e.type==="audio")}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return t!=null&&t.videoTrack&&i.push(t.videoTrack),t!=null&&t.audioTrack&&i.push(t.audioTrack),i.concat((t==null?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}hasTrack(e){return this.tracks.has(e)}getTrackById(e){var t,i;let r=Array.from(this.tracks.values()).find(s=>s.trackId===e);if(r)return r;let n=this.getLocalPeer();if(n){if((t=n.audioTrack)!=null&&t.isPublishedTrackId(e))return n.audioTrack;if((i=n.videoTrack)!=null&&i.isPublishedTrackId(e))return n.videoTrack}}getPeerByTrackId(e){let t=Array.from(this.tracks.values()).find(i=>i.trackId===e);return t!=null&&t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map(e=>e.peer)}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=zu(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){var t,i;if(this.knownRoles=e.known_roles,this.addPluginsToRoles(e.plugins),this.roleDetailsArrived=!0,this.templateAppData=e.app_data,!this.simulcastEnabled)return;let r=(t=this.knownRoles[e.name])==null?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers((i=r.simulcast)==null?void 0:i.video),this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,i,r;if(qi.rememberDevices(!!e.rememberDeviceSelection),e.rememberDeviceSelection){let n=qi.getSelection();n&&(e.settings||(e.settings={}),(t=n.audioInput)!=null&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||n.audioInput.deviceId),(i=n.audioOutput)!=null&&i.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||n.audioOutput.deviceId),(r=n.videoInput)!=null&&r.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||n.videoInput.deviceId))}e.autoManageVideo=e.autoManageVideo!==!1,e.autoManageWakeLock=e.autoManageWakeLock!==!1,this.config=e,this.setEnv()}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks.set(e,e)}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){this.tracks.delete(e)}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){return f(this,null,function*(){for(let t of this.getAudioTracks())yield t.setVolume(e)})}updateAudioOutputDevice(e){return f(this,null,function*(){let t=[];this.getAudioTracks().forEach(i=>{i instanceof Ks&&t.push(i.setOutputDevice(e))}),yield Promise.all(t)})}getSimulcastLayers(e){var t;return!this.simulcastEnabled||!["screen","regular"].includes(e)?[]:e==="screen"?[]:((t=this.videoLayers)==null?void 0:t.layers)||[]}convertSimulcastLayers(e){if(e)return Ee(H({},e),{layers:(e.layers||[]).map(t=>Ee(H({},t),{maxBitrate:t.maxBitrate*1e3}))})}getSimulcastDefinitionsForPeer(e,t){var i,r,n;if([!e||!e.role,t==="screen",!this.simulcastEnabled].some(u=>!!u))return[];let s=this.getPolicyForRole(e.role.name).publishParams,o,a,l;return t==="regular"?(o=(i=s.simulcast)==null?void 0:i.video,a=s.video.width,l=s.video.height):t==="screen"&&(o=(r=s.simulcast)==null?void 0:r.screen,a=s.screen.width,l=s.screen.height),((n=o==null?void 0:o.layers)==null?void 0:n.map(u=>{let c=wT[u.rid],h={width:Math.floor(a/u.scaleResolutionDownBy),height:Math.floor(l/u.scaleResolutionDownBy)};return{layer:c,resolution:h}}))||[]}setPoll(e){this.polls.set(e.id,e)}getPoll(e){return this.polls.get(e)}setWhiteboard(e){this.whiteboards.set(e.id,e)}getWhiteboards(){return this.whiteboards}getWhiteboard(e){return e?this.whiteboards.get(e):this.whiteboards.values().next().value}getErrorListener(){return this.errorListener}cleanup(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach(e=>{var t;if(!e.role){(t=this.errorListener)==null||t.onError(G.GenericErrors.InvalidRole("VALIDATION",""));return}e.role=this.getPolicyForRole(e.role.name)})}addPluginsToRoles(e){if(!e)return;let t=(i,r,n)=>{var s;if(!this.knownRoles[i]){y.d(this.TAG,`role ${i} is not present in given roles`,this.knownRoles);return}let o=this.knownRoles[i].permissions;o[r]||(o[r]=[]),(s=o[r])==null||s.push(n)};Object.keys(e).forEach(i=>{var r,n,s;let o=i;if(!e[o])return;let a=e[o].permissions;(r=a==null?void 0:a.admin)==null||r.forEach(l=>t(l,o,"admin")),(n=a==null?void 0:a.reader)==null||n.forEach(l=>t(l,o,"read")),(s=a==null?void 0:a.writer)==null||s.forEach(l=>t(l,o,"write"))})}setEnv(){var e;let t=((e=this.config)==null?void 0:e.initEndpoint).split("https://")[1],i="prod";t.startsWith("prod")?i="prod":t.startsWith("qa")?i="qa":t.startsWith("dev")&&(i="dev"),this.env=i,Bs.setEnv(i)}},tC=class{constructor(){this.TAG="[WakeLockManager]",this.wakeLock=null,this.acquireLock=()=>f(this,null,function*(){yield this.requestWakeLock(),document==null||document.addEventListener("visibilitychange",this.visibilityHandler)}),this.cleanup=()=>f(this,null,function*(){if(this.wakeLock&&!this.wakeLock.released)try{yield this.wakeLock.release(),y.d(this.TAG,"Wake lock released")}catch(e){let t=e;y.w(this.TAG,"Error while releasing wake lock",`name=${t.name}, message=${t.message}`)}this.wakeLock=null}),this.visibilityHandler=()=>f(this,null,function*(){(document==null?void 0:document.visibilityState)==="visible"&&(!this.wakeLock||this.wakeLock.released)&&(y.d(this.TAG,"Re-acquiring wake lock due to visibility change"),yield this.requestWakeLock())}),this.requestWakeLock=()=>f(this,null,function*(){try{if(!("wakeLock"in navigator)){y.d(this.TAG,"Wake lock feature not supported");return}this.wakeLock=yield navigator.wakeLock.request("screen"),y.d(this.TAG,"Wake lock acquired")}catch(e){let t=e;y.w(this.TAG,"Error acquiring wake lock",`name=${t.name}, message=${t.message}`)}})}},iC=class{constructor(e){this.store=e,this.bufferSize=100,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=1}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let t=this.pendingEvents.shift();y.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",t)}return this}flushFailedClientEvents(){Bs.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=(e=this.store.getLocalPeer())==null?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(t){y.w(this.TAG,"Flush Failed",t)}}sendClientEventOnHTTP(e){var t,i,r,n;let s=this.store.getRoom(),o=this.store.getLocalPeer();e.metadata.token=(t=this.store.getConfig())==null?void 0:t.authToken,e.metadata.peer={session_id:s==null?void 0:s.sessionId,room_id:s==null?void 0:s.id,room_name:s==null?void 0:s.name,template_id:s==null?void 0:s.templateId,joined_at:(i=s==null?void 0:s.joinedAt)==null?void 0:i.getTime(),session_started_at:(r=s==null?void 0:s.startedAt)==null?void 0:r.getTime(),role:(n=o==null?void 0:o.role)==null?void 0:n.name,user_name:o==null?void 0:o.name,user_data:o==null?void 0:o.metadata,peer_id:o==null?void 0:o.peerId},Bs.sendEvent(e)}},Rp={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},rC=class{constructor(e,t,i){this.store=e,this.deviceManager=t,this.eventBus=i,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=H({},Rp),this.timer=null,this.earpieceSelected=!1,this.handleAudioPaused=r=>f(this,null,function*(){var n;let s=(n=r.target.srcObject)==null?void 0:n.getAudioTracks()[0];if(!(s!=null&&s.enabled))return;y.d(this.TAG,"Audio Paused",r.target.id);let o=this.store.getTrackById(r.target.id);o&&(Ea()?(yield Ki(500),this.playAudioFor(o)):this.autoPausedTracks.add(o))}),this.handleTrackUpdate=({track:r})=>{y.d(this.TAG,"Track updated",`${r}`)},this.handleTrackAdd=r=>f(this,[r],function*({track:n,peer:s,callListener:o=!0}){var a,l;let u=document.createElement("audio");u.style.display="none",u.id=n.trackId,u.addEventListener("pause",this.handleAudioPaused),u.onerror=()=>f(this,null,function*(){var c,h;y.e(this.TAG,"error on audio element",u.error);let p=G.TracksErrors.AudioPlaybackError(`Audio playback error for track - ${n.trackId} code - ${(c=u==null?void 0:u.error)==null?void 0:c.code}`);this.eventBus.analytics.publish(ke.audioPlaybackError(p)),((h=u==null?void 0:u.error)==null?void 0:h.code)===MediaError.MEDIA_ERR_DECODE&&(this.removeAudioElement(u,n),yield Ki(500),yield this.handleTrackAdd({track:n,peer:s,callListener:!1}))}),n.setAudioElement(u),n.setVolume(this.volume),y.d(this.TAG,"Audio track added",`${n}`),this.init(),yield this.autoSelectAudioOutput(),(a=this.audioSink)==null||a.append(u),this.outputDevice&&(yield n.setOutputDevice(this.outputDevice)),u.srcObject=new MediaStream([n.nativeTrack]),o&&((l=this.listener)==null||l.onTrackUpdate(0,n,s)),yield this.handleAutoplayError(n)}),this.handleAutoplayError=r=>f(this,null,function*(){if(this.state.autoplayFailed===void 0&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(n=>{this.playAudioFor(r).then(n)})),yield this.state.autoplayCheckPromise),this.state.autoplayFailed){this.autoPausedTracks.add(r);return}yield this.playAudioFor(r)}),this.handleAudioDeviceChange=r=>{r.isUserSelection||r.error||!r.selection||r.type==="video"||this.unpauseAudioTracks()},this.handleTrackRemove=r=>{this.autoPausedTracks.delete(r);let n=document.getElementById(r.trackId);n&&this.removeAudioElement(n,r),this.audioSink&&this.audioSink.childElementCount===0&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),y.d(this.TAG,"Audio track removed",`${r}`)},this.unpauseAudioTracks=()=>f(this,null,function*(){let r=[];this.autoPausedTracks.forEach(n=>{r.push(this.playAudioFor(n))}),yield Promise.all(r)}),this.removeAudioElement=(r,n)=>{r&&(y.d(this.TAG,"removing audio element",`${n}`),r.removeEventListener("pause",this.handleAudioPaused),r.srcObject=null,r.remove(),n.setAudioElement(null))},this.startPollingForDevices=()=>{"ondevicechange"in navigator.mediaDevices||(this.timer=setInterval(()=>{f(this,null,function*(){yield this.deviceManager.init(!0,!1),yield this.autoSelectAudioOutput()})},5e3))},this.autoSelectAudioOutput=()=>f(this,null,function*(){var r,n;if(!((r=this.audioSink)!=null&&r.children.length)){y.d(this.TAG,"No remote audio added yet");return}let s=null,o=null,a=null,l=null;for(let c of this.deviceManager.audioInput){let h=c.label.toLowerCase();h.includes("speakerphone")?o=c:h.includes("wired")?a=c:h.includes("bluetooth")?s=c:h.includes("earpiece")&&(l=c)}let u=(n=this.store.getLocalPeer())==null?void 0:n.audioTrack;if(u&&l){let c=(s==null?void 0:s.deviceId)||(a==null?void 0:a.deviceId)||(o==null?void 0:o.deviceId);if(y.d(this.TAG,"externalDeviceID",c),u.settings.deviceId===c)return;this.earpieceSelected||(yield u.setSettings({deviceId:l==null?void 0:l.deviceId},!0),this.earpieceSelected=!0),yield u.setSettings({deviceId:c},!0)}}),this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange),this.startPollingForDevices()}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){return f(this,null,function*(){yield this.store.updateAudioOutputVolume(e),this.volume=e})}unblockAutoplay(){return f(this,null,function*(){this.autoPausedTracks.size>0&&this.unpauseAudioTracks()})}init(e){if(this.state.initialized||this.audioSink)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${Cr()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t,y.d(this.TAG,"audio sink created",this.audioSink)}cleanup(){var e;(e=this.audioSink)==null||e.remove(),this.audioSink=void 0,this.timer&&(clearInterval(this.timer),this.timer=null),this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=H({},Rp)}playAudioFor(e){return f(this,null,function*(){let t=e.getAudioElement();if(!t){y.w(this.TAG,"No audio element found on track",e.trackId);return}try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),y.d(this.TAG,"Played track",`${e}`)}catch(i){this.autoPausedTracks.add(e),y.w(this.TAG,"Failed to play track",`${e}`,i);let r=i;if(!this.state.autoplayFailed&&r.name==="NotAllowedError"){this.state.autoplayFailed=!0;let n=G.TracksErrors.AutoplayBlocked("AUTOPLAY","");n.addNativeError(r),this.eventBus.analytics.publish(ke.autoplayError()),this.eventBus.autoplayError.publish(n)}}})}},nC=class{constructor(e){this.eventBus=e,this.pluginUsage=new Map,this.pluginLastAddedAt=new Map,this.getPluginUsage=t=>{if(this.pluginUsage.has(t)||this.pluginUsage.set(t,0),this.pluginLastAddedAt.has(t)){let i=this.pluginLastAddedAt.get(t)||0,r=i?Date.now()-i:0;this.pluginUsage.set(t,(this.pluginUsage.get(t)||0)+r),this.pluginLastAddedAt.delete(t)}return this.pluginUsage.get(t)},this.updatePluginUsageData=t=>{var i;let r=((i=t.properties)==null?void 0:i.plugin_name)||"";switch(t.name){case"mediaPlugin.toggled.on":case"mediaPlugin.added":{let n=t.properties.added_at||Date.now();this.pluginLastAddedAt.set(r,n);break}case"mediaPlugin.toggled.off":case"mediaPlugin.stats":{if(this.pluginLastAddedAt.has(r)){let n=t.properties.duration||(Date.now()-(this.pluginLastAddedAt.get(r)||0))/1e3;this.pluginUsage.set(r,(this.pluginUsage.get(r)||0)+Math.max(n,0)*1e3),this.pluginLastAddedAt.delete(r)}break}}},this.cleanup=()=>{this.pluginLastAddedAt.clear(),this.pluginUsage.clear()},this.eventBus.analytics.subscribe(t=>this.updatePluginUsageData(t))}},sC=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=(r,n)=>f(this,null,function*(){let s=this.audioOutput.find(o=>o.deviceId===r);return s&&(this.outputDevice=s,yield this.store.updateAudioOutputDevice(s),this.eventBus.analytics.publish(ke.deviceChange({isUserSelection:n,selection:{audioOutput:s},devices:this.getDevices(),type:"audioOutput"})),qi.updateSelection("audioOutput",{deviceId:s.deviceId,groupId:s.groupId})),s}),this.getCurrentSelection=()=>{var r,n;let s=this.store.getLocalPeer(),o=this.createIdentifier((r=s==null?void 0:s.audioTrack)==null?void 0:r.getMediaTrackSettings()),a=this.createIdentifier((n=s==null?void 0:s.videoTrack)==null?void 0:n.getMediaTrackSettings()),l=this.audioInput.find(c=>this.createIdentifier(c)===o),u=this.videoInput.find(c=>this.createIdentifier(c)===a);return{audioInput:l,videoInput:u,audioOutput:this.outputDevice}},this.computeChange=(r,n)=>r.length!==n.length?!0:n.some(s=>!r.includes(this.createIdentifier(s))),this.enumerateDevices=()=>f(this,null,function*(){try{let r=yield navigator.mediaDevices.enumerateDevices(),n=this.videoInput.map(this.createIdentifier),s=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],r.forEach(o=>{o.kind==="audioinput"&&o.label?(this.hasMicrophonePermission=!0,this.audioInput.push(o)):o.kind==="audiooutput"?this.audioOutput.push(o):o.kind==="videoinput"&&o.label&&(this.hasWebcamPermission=!0,this.videoInput.push(o))}),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(s,this.audioInput),qi.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(r){y.e(this.TAG,"Failed enumerating devices",r)}}),this.handleDeviceChange=Km(()=>f(this,null,function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let r=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(r==null?void 0:r.audioTrack),yield this.handleVideoInputDeviceChange(r==null?void 0:r.videoTrack),this.eventBus.analytics.publish(ke.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}),500).bind(this),this.handleAudioInputDeviceChange=r=>f(this,null,function*(){if(!r){y.d(this.TAG,"No Audio track on local peer");return}if(!this.audioInputChanged){y.d(this.TAG,"No Change in AudioInput Device");return}let n=this.getNewAudioInputDevice();if(!n||!n.deviceId){this.eventBus.analytics.publish(ke.deviceChange({selection:{audioInput:n},error:G.TracksErrors.SelectedDeviceMissing("audio"),devices:this.getDevices(),type:"audioInput"})),y.e(this.TAG,"Audio device not found");return}let{settings:s}=r,o=new $s().codec(s.codec).maxBitrate(s.maxBitrate).deviceId(n.deviceId).build();try{yield r.setSettings(o,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(a){y.e(this.TAG,"[Audio Device Change]",a),this.eventBus.analytics.publish(ke.deviceChange({selection:{audioInput:n},devices:this.getDevices(),type:"audioInput",error:a})),this.eventBus.deviceChange.publish({error:a,selection:n,type:"audioInput",devices:this.getDevices()})}}),this.handleVideoInputDeviceChange=r=>f(this,null,function*(){if(!r){y.d(this.TAG,"No video track on local peer");return}if(!this.videoInputChanged){y.d(this.TAG,"No Change in VideoInput Device");return}let n=this.videoInput[0];if(!n||!n.deviceId){this.eventBus.analytics.publish(ke.deviceChange({selection:{videoInput:n},error:G.TracksErrors.SelectedDeviceMissing("video"),devices:this.getDevices(),type:"video"})),y.e(this.TAG,"Video device not found");return}let{settings:s}=r,o=new xn().codec(s.codec).maxBitrate(s.maxBitrate).maxFramerate(s.maxFramerate).setWidth(s.width).setHeight(s.height).deviceId(n.deviceId).build();try{yield r.setSettings(o,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success")}catch(a){y.e(this.TAG,"[Video Device Change]",a),this.eventBus.analytics.publish(ke.deviceChange({selection:{videoInput:n},devices:this.getDevices(),type:"video",error:a})),this.eventBus.deviceChange.publish({error:a,type:"video",selection:n,devices:this.getDevices()})}});let i=({enabled:r,track:n})=>r&&n.source==="regular";this.eventBus.localVideoEnabled.waitFor(i).then(()=>f(this,null,function*(){yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})),this.eventBus.localAudioEnabled.waitFor(i).then(()=>f(this,null,function*(){yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})),this.eventBus.deviceChange.subscribe(({type:r,isUserSelection:n,selection:s})=>{if(n){let o=r==="video"?"videoInput":r,a=this[o].find(l=>this.createIdentifier(l)===this.createIdentifier(s));this.eventBus.analytics.publish(ke.deviceChange({selection:{[o]:a},devices:this.getDevices(),type:r,isUserSelection:n}))}})}init(e=!1,t=!0){return f(this,null,function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),t&&this.eventBus.analytics.publish(ke.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))})}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanup(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){let e=this.store.getLocalPeer(),t=e==null?void 0:e.audioTrack,i=this.audioInput.find(n=>n.deviceId===(t==null?void 0:t.getManuallySelectedDeviceId()));if(i)return i;t==null||t.resetManuallySelectedDeviceId();let r=this.audioInput.find(n=>n.deviceId==="default");return r?this.audioInput.find(n=>n.deviceId!=="default"&&r.label.includes(n.label)):this.audioInput[0]}setOutputDevice(e=!1){return f(this,null,function*(){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>this.createIdentifier(r)===i),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>r.deviceId==="default")||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(ke.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))})}getAudioOutputDeviceMatchingInput(e){var t,i;let r=((i=(t=this.store.getConfig())==null?void 0:t.settings)==null?void 0:i.speakerAutoSelectionBlacklist)||[];if(r==="all"||!e)return;let n=e.label.toLowerCase()||"";if(r.some(a=>n.includes(a.toLowerCase())))return;let s=this.audioOutput.find(a=>e.deviceId!=="default"&&a.label===e.label);if(s)return s;let o=this.audioOutput.find(a=>a.groupId===e.groupId);if(o&&this.audioOutput[0].deviceId==="default"&&o.groupId===this.audioOutput[0].groupId)return o}logDevices(e=""){y.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},oC=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e,!0)}unblockAutoplay(){return f(this,null,function*(){yield this.audioSinkManager.unblockAutoplay(),yield qa.resumeContext()})}},vt=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=i=>{this.eventEmitter.emit(this.eventName,i)},this.subscribe=i=>{this.eventEmitter.on(this.eventName,i)},this.subscribeOnce=i=>{this.eventEmitter.once(this.eventName,i)},this.unsubscribe=i=>{this.eventEmitter.off(this.eventName,i)},this.waitFor=i=>this.eventEmitter.waitFor(this.eventName,{filter:i}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},aC=class{constructor(){this.eventEmitter=new Wa.EventEmitter2,this.deviceChange=new vt(ft.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new vt(ft.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new vt(ft.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.statsUpdate=new vt(ft.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new vt(ft.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new vt(ft.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new vt(ft.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new vt(ft.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new vt(ft.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.analytics=new vt(ft.ANALYTICS,this.eventEmitter),this.policyChange=new vt(ft.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new vt(ft.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new vt(ft.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new vt(ft.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new vt(ft.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new vt(ft.AUTOPLAY_ERROR,this.eventEmitter),this.leave=new vt(ft.LEAVE,this.eventEmitter)}},Ap=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof ld?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},lC=class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,r;let n=e["speaker-list"],s=n.map(a=>({audioLevel:a.level,peer:this.store.getPeerById(a.peer_id),track:this.store.getTrackById(a.track_id)}));(t=this.audioListener)==null||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let o=n[0];if(o){let a=this.store.getPeerById(o.peer_id);(i=this.listener)==null||i.onPeerUpdate(4,a)}else(r=this.listener)==null||r.onPeerUpdate(5,null)}},uC=class{constructor(e){this.listener=e,this.TAG="[BroadcastManager]"}handleNotification(e,t){e==="on-broadcast"&&this.handleBroadcast(t)}handleBroadcast(e){var t,i;y.d(this.TAG,`Received Message from sender=${(t=e==null?void 0:e.peer)==null?void 0:t.peer_id}: ${e}`),(i=this.listener)==null||i.onMessageReceived(e)}},cC=class{constructor(e,t){this.store=e,this.listener=t}handleQualityUpdate(e){var t;let i=e.peers.map(r=>{let n=this.store.getPeerById(r.peer_id);return n&&n.updateNetworkQuality(r.downlink_score),{peerID:r.peer_id,downlinkQuality:r.downlink_score}});(t=this.listener)==null||t.onConnectionQualityUpdate(i)}},kg=class{constructor(e,t,i){this.store=e,this.eventBus=t,this.listener=i,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=r=>{y.d(this.TAG,"ONTRACKADD",`${r}`),this.tracksToProcess.set(r.trackId,r),this.processPendingTracks()},this.handleTrackRemovedPermanently=r=>{y.d(this.TAG,"ONTRACKREMOVE",r),Object.keys(r.tracks).forEach(n=>{var s;let o=this.store.getTrackState(n);if(!o)return;let a=this.store.getTrackById(n);if(!a){y.d(this.TAG,"Track not found in store");return}a.type==="audio"&&this.eventBus.audioTrackRemoved.publish(a),this.store.removeTrack(a);let l=this.store.getPeerById(o.peerId);l&&(this.removePeerTracks(l,a),(s=this.listener)==null||s.onTrackUpdate(1,a,l))})},this.handleTrackLayerUpdate=r=>{for(let n in r.tracks){let s=r.tracks[n],o=this.store.getTrackById(n);!o||!this.store.getPeerByTrackId(n)||o instanceof ni&&this.setLayer(o,s)}},this.handleTrackUpdate=(r,n=!0)=>{var s,o;let a=this.store.getPeerById(r.peer.peer_id),l=r.peer;if(!a&&!l){y.d(this.TAG,"Track Update ignored - Peer not added to store");return}a||(a=Ja(l,this.store),this.store.addPeer(a));for(let u in r.tracks){let c=Object.assign({},(s=this.store.getTrackState(u))==null?void 0:s.trackInfo),h=r.tracks[u],p=this.store.getTrackById(u);if(this.store.setTrackState({peerId:r.peer.peer_id,trackInfo:H(H({},c),h)}),!p||this.tracksToProcess.has(u))this.processTrackInfo(h,r.peer.peer_id,n),this.processPendingTracks();else{p.setEnabled(!h.mute);let S=this.processTrackUpdate(p,c,h);S&&((o=this.listener)==null||o.onTrackUpdate(S,p,a))}}},this.processTrackInfo=(r,n,s)=>{},this.processPendingTracks=()=>{new Map(this.tracksToProcess).forEach(r=>{var n;let s=this.store.getTrackState(r.trackId);if(!s){y.d(this.TAG,"TrackState not added to store",`peerId - ${r.peerId}`,`trackId -${r.trackId}`);return}let o=this.store.getPeerById(s.peerId);if(!o){y.d(this.TAG,"Peer not added to store, peerId",s.peerId);return}r.source=s.trackInfo.source,r.peerId=o.peerId,r.logIdentifier=o.name,r.setEnabled(!s.trackInfo.mute),this.addAudioTrack(o,r),this.addVideoTrack(o,r),r.type==="audio"?this.eventBus.audioTrackAdded.publish({track:r,peer:o}):(n=this.listener)==null||n.onTrackUpdate(0,r,o),this.tracksToProcess.delete(r.trackId)})}}handleTrackMetadataAdd(e){y.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks){let i=e.tracks[t];this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:i})}this.processPendingTracks()}handleTrackRemove(e,t=!0){var i;y.d(this.TAG,"ONTRACKREMOVE",`${e}`);let r=this.store.getTrackState(e.trackId);if(r){if(!this.store.hasTrack(e)){y.d(this.TAG,"Track not found in store");return}if(t){this.store.removeTrack(e);let n=this.store.getPeerById(r.peerId);if(!n)return;this.removePeerTracks(n,e),(i=this.listener)==null||i.onTrackUpdate(1,e,n),e.type==="audio"&&this.eventBus.audioTrackRemoved.publish(e)}}}setLayer(e,t){var i,r;let n=this.store.getPeerByTrackId(e.trackId);n&&(e.setLayerFromServer(t)?(i=this.listener)==null||i.onTrackUpdate(5,e,n):(r=this.listener)==null||r.onTrackUpdate(6,e,n))}removePeerTracks(e,t){let i=e.auxiliaryTracks.indexOf(t);i>-1?(e.auxiliaryTracks.splice(i,1),y.d(this.TAG,"auxiliary track removed",`${t}`)):t.type==="audio"&&e.audioTrack===t?(e.audioTrack=void 0,y.d(this.TAG,"audio track removed",`${t}`)):t.type==="video"&&e.videoTrack===t&&(e.videoTrack=void 0,y.d(this.TAG,"video track removed",`${t}`))}addAudioTrack(e,t){var i;t.type==="audio"&&(t.source==="regular"&&(!e.audioTrack||((i=e.audioTrack)==null?void 0:i.trackId)===t.trackId)?e.audioTrack=t:e.auxiliaryTracks.push(t),this.store.addTrack(t),y.d(this.TAG,"audio track added",`${t}`))}addVideoTrack(e,t){if(t.type!=="video")return;let i=t,r=this.store.getSimulcastDefinitionsForPeer(e,i.source);if(i.setSimulcastDefinitons(r),this.addAsPrimaryVideoTrack(e,i))e.videoTrack?e.videoTrack.replaceTrack(i):e.videoTrack=i,this.store.addTrack(e.videoTrack);else{let n=e.auxiliaryTracks.findIndex(s=>s.trackId===i.trackId);n===-1?(e.auxiliaryTracks.push(i),this.store.addTrack(i)):(e.auxiliaryTracks[n].replaceTrack(i),this.store.addTrack(e.auxiliaryTracks[n]))}y.d(this.TAG,"video track added",`${t}`)}addAsPrimaryVideoTrack(e,t){var i;return t.source==="regular"&&(!e.videoTrack||((i=e.videoTrack)==null?void 0:i.trackId)===t.trackId)}processTrackUpdate(e,t,i){let r;return t.mute!==i.mute?(r=i.mute?2:3,e.type==="audio"&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!i.mute})):t.description!==i.description&&(r=4),r}},dC=class extends kg{constructor(e,t,i,r){super(e,t,r),this.transport=i,this.TAG="[OnDemandTrackManager]",this.processTrackInfo=(n,s,o=!0)=>{var a;if(n.type!=="video")return;let l=this.store.getPeerById(s);if(!l||!this.isPeerRoleSubscribed(s)){y.d(this.TAG,`no peer in store for peerId: ${s}`);return}let u=new pd(new MediaStream,this.transport.getSubscribeConnection()),c=Ra.getEmptyVideoTrack();c.enabled=!n.mute;let h=new ni(u,c,n.source);h.setTrackId(n.track_id),h.peerId=l.peerId,h.logIdentifier=l.name,this.addVideoTrack(l,h),o&&((a=this.listener)==null||a.onTrackUpdate(0,l.videoTrack,l))}}handleTrackMetadataAdd(e){super.handleTrackMetadataAdd(e);for(let t in e.tracks)e.tracks[t].type==="video"&&this.processTrackInfo(e.tracks[t],e.peer.peer_id)}handleTrackRemove(e){let t=e.type==="video"&&e.source==="regular";super.handleTrackRemove(e,!t),t&&this.processTrackInfo({track_id:e.trackId,mute:!e.enabled,type:e.type,source:e.source,stream_id:e.stream.id},e.peerId,!1)}addAsPrimaryVideoTrack(e,t){return t.source!=="regular"?!1:!e.videoTrack||e.videoTrack.trackId===t.trackId?!0:e.videoTrack.enabled&&Cn(e.videoTrack.nativeTrack)}isPeerRoleSubscribed(e){var t,i,r,n;if(!e)return!0;let s=this.store.getLocalPeer(),o=this.store.getPeerById(e);return o&&((n=(i=(t=s==null?void 0:s.role)==null?void 0:t.subscribeParams)==null?void 0:i.subscribeToRoles)==null?void 0:n.includes((r=o.role)==null?void 0:r.name))}},hC=class{constructor(e,t,i,r){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=r,this.TAG="[PeerListManager]",this.handleInitialPeerList=n=>{let s=Object.values(n.peers);this.peerManager.handlePeerList(s)},this.handleReconnectPeerList=n=>{this.handleRepeatedPeerList(n.peers)},this.handlePreviewRoomState=n=>{if(!this.store.hasRoleDetailsArrived())return;let s=n.peers;if(s==null){n.peer_count===0&&this.handleRepeatedPeerList({});return}Object.keys(s).forEach(o=>{s[o].tracks={},s[o].is_from_room_state=!0}),this.handleRepeatedPeerList(s)},this.handleRepeatedPeerList=n=>{let s=this.store.getRemotePeers(),o=Object.values(n),a=s.filter(u=>!n[u.peerId]);a.length>0&&y.d(this.TAG,`${a}`),a.forEach(u=>{var c;let h={peer_id:u.peerId,role:((c=u.role)==null?void 0:c.name)||"",info:{name:u.name,data:u.metadata||"",user_id:u.customerUserId||"",type:u.type},tracks:{},groups:[],realtime:u.realtime};this.peerManager.handlePeerLeave(h)});let l=[];o.forEach(u=>{let c=this.store.getPeerById(u.peer_id),h=Object.values(u.tracks);c&&(this.store.getPeerTracks(c.peerId).forEach(p=>{var S;u.tracks[p.trackId]||(this.removePeerTrack(c,p.trackId),(S=this.listener)==null||S.onTrackUpdate(1,p,c))}),h.forEach(p=>{this.store.getTrackById(p.track_id)||this.store.setTrackState({peerId:c.peerId,trackInfo:p})}),this.trackManager.handleTrackUpdate({peer:u,tracks:u.tracks},!1),this.peerManager.handlePeerUpdate(u)),l.push(u)}),l.length>0&&this.peerManager.handlePeerList(l)}}handleNotification(e,t,i){if(e==="peer-list"){let r=t;i?(y.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(y.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e==="room-state"){let r=t;this.handlePreviewRoomState(r)}}removePeerTrack(e,t){var i,r;if(y.d(this.TAG,`removing track - ${t} from ${e}`),((i=e.audioTrack)==null?void 0:i.trackId)===t)e.audioTrack=void 0;else if(((r=e.videoTrack)==null?void 0:r.trackId)===t)e.videoTrack=void 0;else{let n=e.auxiliaryTracks.findIndex(s=>s.trackId===t);n>=0&&e.auxiliaryTracks.splice(n,1)}}},Fe=e=>e?new Date(e):void 0,pC=class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.TAG="[PeerManager]",this.handlePeerList=r=>{var n,s;if(r.length===0){(n=this.listener)==null||n.onPeerUpdate(9,[]);return}let o=[],a=new Set(r.map(l=>l.peer_id));this.store.getRemotePeers().forEach(({peerId:l,fromRoomState:u})=>{!a.has(l)&&u&&this.store.removePeer(l)});for(let l of r)o.push(this.makePeer(l));(s=this.listener)==null||s.onPeerUpdate(9,o),this.trackManager.processPendingTracks()},this.handlePeerJoin=r=>{var n;let s=this.makePeer(r);(n=this.listener)==null||n.onPeerUpdate(0,s),this.trackManager.processPendingTracks()},this.handlePeerLeave=r=>{var n,s,o,a;let l=this.store.getPeerById(r.peer_id);this.store.removePeer(r.peer_id),y.d(this.TAG,"PEER_LEAVE",r.peer_id,`remainingPeers=${this.store.getPeers().length}`),l&&(l.audioTrack&&((n=this.listener)==null||n.onTrackUpdate(1,l.audioTrack,l)),l.videoTrack&&((s=this.listener)==null||s.onTrackUpdate(1,l.videoTrack,l)),(o=l.auxiliaryTracks)==null||o.forEach(u=>{var c;(c=this.listener)==null||c.onTrackUpdate(1,u,l)}),(a=this.listener)==null||a.onPeerUpdate(1,l))}}handleNotification(e,t){switch(e){case"on-peer-join":{let i=t;this.handlePeerJoin(i);break}case"on-peer-leave":{let i=t;this.handlePeerLeave(i);break}case"on-peer-update":this.handlePeerUpdate(t);break}}handlePeerUpdate(e){var t,i,r,n,s;let o=this.store.getPeerById(e.peer_id);if(!o&&e.realtime){o=this.makePeer(e),(t=this.listener)==null||t.onPeerUpdate(o.isHandRaised?12:14,o);return}if(o&&!o.isLocal&&!e.realtime){this.store.removePeer(o.peerId),(i=this.listener)==null||i.onPeerUpdate(13,o);return}if(!o){y.d(this.TAG,`peer ${e.peer_id} not found`);return}if(o.role&&o.role.name!==e.role){let u=this.store.getPolicyForRole(e.role);o.updateRole(u),this.updateSimulcastLayersForPeer(o),(r=this.listener)==null||r.onPeerUpdate(8,o)}let a=o.isHandRaised;o.updateGroups(e.groups);let l=(n=e.groups)==null?void 0:n.includes(fn);a!==l&&((s=this.listener)==null||s.onPeerUpdate(12,o)),this.handlePeerInfoUpdate(H({peer:o},e.info))}handlePeerInfoUpdate({peer:e,name:t,data:i}){var r,n;e&&(t&&e.name!==t&&(e.updateName(t),(r=this.listener)==null||r.onPeerUpdate(10,e)),i&&e.metadata!==i&&(e.updateMetadata(i),(n=this.listener)==null||n.onPeerUpdate(11,e)))}makePeer(e){let t=this.store.getPeerById(e.peer_id);t||(t=Ja(e,this.store),t.realtime=e.realtime,t.joinedAt=Fe(e.joined_at),t.fromRoomState=!!e.is_from_room_state,this.store.addPeer(t),y.d(this.TAG,"adding to the peerList",`${t}`));for(let i in e.tracks){let r=e.tracks[i];this.store.setTrackState({peerId:e.peer_id,trackInfo:r}),r.type==="video"&&this.trackManager.processTrackInfo(r,e.peer_id,!1)}return t}updateSimulcastLayersForPeer(e){this.store.getPeerTracks(e.peerId).forEach(t=>{if(t.type==="video"&&["regular","screen"].includes(t.source)){let i=t,r=this.store.getSimulcastDefinitionsForPeer(e,i.source);i.setSimulcastDefinitons(r)}})}},fC=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){let t=this.store.getLocalPeer();if(t&&!t.role){let r=e.known_roles[e.name];t.updateRole(r)}this.store.setKnownRoles(e);let i=this.store.getRoom();i?i.templateId=e.template_id:y.w("[PolicyChangeManager]","on policy change - room not present"),this.updateLocalPeerRole(e),this.eventBus.policyChange.publish(e)}updateLocalPeerRole(e){var t;let i=this.store.getLocalPeer();if(i!=null&&i.role&&i.role.name!==e.name){let r=this.store.getPolicyForRole(e.name),n=i.role;i.updateRole(r),r.name===((t=i.asRole)==null?void 0:t.name)&&delete i.asRole,this.eventBus.localRoleUpdate.publish({oldRole:n,newRole:r})}}},Yu=(e,t,i)=>{let r=i==="qa"?HT:WT,n=new URL(r);return n.searchParams.set("endpoint",`https://${t}`),n.searchParams.set("token",e),n.toString()},vC=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.TAG="[HMSWhiteboardInteractivityCenter]"}get isEnabled(){return this.transport.isFlagEnabled("whiteboardEnabled")}open(e){return f(this,null,function*(){var t;if(!this.isEnabled)return y.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(e==null?void 0:e.id),r=i==null?void 0:i.id;if(i||(r=(yield this.transport.signal.createWhiteboard(this.getCreateOptionsWithDefaults(e))).id),!r)throw new Error(`Whiteboard ID: ${r} not found`);let n=yield this.transport.signal.getWhiteboard({id:r}),s=Ee(H({},i),{title:e==null?void 0:e.title,attributes:e==null?void 0:e.attributes,id:n.id,url:Yu(n.token,n.addr,this.store.getEnv()),token:n.token,addr:n.addr,owner:n.owner,permissions:n.permissions||[],open:!0});this.store.setWhiteboard(s),(t=this.listener)==null||t.onWhiteboardUpdate(s)})}close(e){return f(this,null,function*(){var t;if(!this.isEnabled)return y.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(e);if(!i)throw new Error(`Whiteboard ID: ${e} not found`);let r={id:i.id,title:i.title,open:!1};this.store.setWhiteboard(r),(t=this.listener)==null||t.onWhiteboardUpdate(r)})}setListener(e){this.listener=e}handleLocalRoleUpdate(){return f(this,null,function*(){var e;let t=this.store.getWhiteboards();for(let i of t.values())if(i.url){let r=yield this.transport.signal.getWhiteboard({id:i.id}),n=Ee(H({},i),{id:r.id,url:Yu(r.token,r.addr,this.store.getEnv()),token:r.token,addr:r.addr,owner:r.owner,permissions:r.permissions,open:r.permissions.length>0});this.store.setWhiteboard(n),(e=this.listener)==null||e.onWhiteboardUpdate(n)}})}getCreateOptionsWithDefaults(e){var t;let i=Object.values(this.store.getKnownRoles()),r=[],n=[],s=[];return i.forEach(o=>{var a,l,u;(a=o.permissions.whiteboard)!=null&&a.includes("read")&&r.push(o.name),(l=o.permissions.whiteboard)!=null&&l.includes("write")&&n.push(o.name),(u=o.permissions.whiteboard)!=null&&u.includes("admin")&&s.push(o.name)}),{title:(e==null?void 0:e.title)||`${(t=this.store.getRoom())==null?void 0:t.id} Whiteboard`,reader:(e==null?void 0:e.reader)||r,writer:(e==null?void 0:e.writer)||n,admin:(e==null?void 0:e.admin)||s}}},mC=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.whiteboard=new vC(e,t,i)}setListener(e){this.listener=e,this.whiteboard.setListener(e)}createPoll(e){return f(this,null,function*(){var t,i;let r={customerID:"userid",peerID:"peerid",userName:"username"},{poll_id:n}=yield this.transport.signal.setPollInfo(Ee(H({},e),{mode:e.mode?r[e.mode]:void 0,poll_id:e.id,vote:e.rolesThatCanVote,responses:e.rolesThatCanViewResponses}));e.id||(e.id=n),Array.isArray(e.questions)&&(yield this.addQuestionsToPoll(e.id,e.questions));let s=yield this.transport.signal.getPollQuestions({poll_id:e.id,index:0,count:50}),o=Xu(Ee(H({},e),{poll_id:e.id,state:"created",created_by:(t=this.store.getLocalPeer())==null?void 0:t.peerId}));o.questions=s.questions.map(({question:a,options:l,answer:u})=>Ee(H({},a),{options:l,answer:u})),(i=this.listener)==null||i.onPollsUpdate(0,[o])})}startPoll(e){return f(this,null,function*(){typeof e=="string"?yield this.transport.signal.startPoll({poll_id:e}):(yield this.createPoll(e),yield this.transport.signal.startPoll({poll_id:e.id}))})}addQuestionsToPoll(e,t){return f(this,null,function*(){t.length>0&&(yield this.transport.signal.setPollQuestions({poll_id:e,questions:t.map((i,r)=>this.createQuestionSetParams(i,r))}))})}stopPoll(e){return f(this,null,function*(){yield this.transport.signal.stopPoll({poll_id:e})})}addResponsesToPoll(e,t){return f(this,null,function*(){let i=this.store.getPoll(e);if(!i)throw new Error("Invalid poll ID - Poll not found");let r=t.map(n=>{var s,o;let a=this.getQuestionInPoll(i,n.questionIndex);return a.type==="single-choice"?(n.option=n.option||((s=n.options)==null?void 0:s[0])||-1,delete n.text,delete n.options):a.type==="multiple-choice"?((o=n.options)==null||o.sort(),delete n.text,delete n.option):(delete n.option,delete n.options),n.skipped&&(delete n.option,delete n.options,delete n.text),H({duration:0,type:a.type,question:n.questionIndex},n)});yield this.transport.signal.setPollResponses({poll_id:e,responses:r})})}fetchLeaderboard(e,t,i){return f(this,null,function*(){var r,n;let s=this.store.getPoll(e);if(!s)throw new Error("Invalid poll ID - Poll not found");let o=(n=(r=this.store.getLocalPeer())==null?void 0:r.role)==null?void 0:n.permissions,a=!!(o!=null&&o.pollRead||o!=null&&o.pollWrite);if(s.anonymous||s.state!=="stopped"||!a)return{entries:[],hasNext:!1};let l=yield this.transport.signal.fetchPollLeaderboard({poll_id:s.id,count:i,offset:t}),u={avgScore:l.avg_score,avgTime:l.avg_time,votedUsers:l.voted_users,totalUsers:l.total_users,correctUsers:l.correct_users};return{entries:l.questions.map(c=>({position:c.position,totalResponses:c.total_responses,correctResponses:c.correct_responses,duration:c.duration,peer:c.peer,score:c.score})),hasNext:!l.last,summary:u}})}getPolls(){return f(this,null,function*(){var e,t,i;let r=yield this.transport.signal.getPollsList({count:50,state:"started"}),n=[],s=(t=(e=this.store.getLocalPeer())==null?void 0:e.role)==null?void 0:t.permissions.pollWrite,o=[...r.polls];if(s){let a=yield this.transport.signal.getPollsList({count:50,state:"created"}),l=yield this.transport.signal.getPollsList({count:50,state:"stopped"});o=[...a.polls,...o,...l.polls]}for(let a of o){let l=yield this.transport.signal.getPollQuestions({poll_id:a.poll_id,index:0,count:50}),u=Xu(a),c=this.store.getPoll(a.poll_id);u.questions=l.questions.map(({question:h,options:p,answer:S},k)=>{var E,O;return Ee(H({},h),{options:p,answer:S,responses:(O=(E=c==null?void 0:c.questions)==null?void 0:E[k])==null?void 0:O.responses})}),n.push(u),this.store.setPoll(u)}return(i=this.listener)==null||i.onPollsUpdate(3,n),n})}createQuestionSetParams(e,t){var i,r;if(e.index){let a=(i=e.options)==null?void 0:i.map((l,u)=>Ee(H({},l),{index:u+1}));return{question:Ee(H({},e),{index:t+1}),options:a,answer:e.answer}}let n=Ee(H({},e),{index:t+1}),s,o=e.answer||{hidden:!1};return Array.isArray(e.options)&&["single-choice","multiple-choice"].includes(e.type)?(s=(r=e.options)==null?void 0:r.map((a,l)=>({index:l+1,text:a.text,weight:a.weight})),e.type==="single-choice"?o.option=e.options.findIndex(a=>a.isCorrectAnswer)+1||void 0:o.options=e.options.map((a,l)=>a.isCorrectAnswer?l+1:void 0).filter(a=>!!a)):(o==null||delete o.options,o==null||delete o.option),{question:n,options:s,answer:o}}getQuestionInPoll(e,t){var i;let r=(i=e==null?void 0:e.questions)==null?void 0:i.find(n=>n.index===t);if(!r)throw new Error("Invalid question index - Question not found in poll");return r}},Xu=e=>{let t={userid:"customerID",peerid:"peerID",username:"userName"};return{id:e.poll_id,title:e.title,startedBy:e.started_by,createdBy:e.created_by,anonymous:e.anonymous,type:e.type,duration:e.duration,locked:e.locked,mode:e.mode?t[e.mode]:void 0,visibility:e.visibility,rolesThatCanVote:e.vote||[],rolesThatCanViewResponses:e.responses||[],state:e.state,stoppedBy:e.stopped_by,startedAt:Fe(e.started_at),stoppedAt:Fe(e.stopped_at),createdAt:Fe(e.created_at)}},gC=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){switch(e){case"on-poll-start":{this.handlePollStart(t);break}case"on-poll-stop":{this.handlePollStop(t);break}case"on-poll-stats":this.handlePollStats(t);break}}handlePollStart(e){return f(this,null,function*(){var t,i;let r=[];for(let n of e.polls){let s=this.store.getPoll(n.poll_id);if(s&&s.state==="started"){(t=this.listener)==null||t.onPollsUpdate(1,[s]);return}let o=yield this.transport.signal.getPollQuestions({poll_id:n.poll_id,index:0,count:50}),a=Xu(n);a.questions=o.questions.map(({question:l,options:u,answer:c})=>Ee(H({},l),{options:u,answer:c})),yield this.updatePollResponses(a,!0),r.push(a),this.store.setPoll(a)}(i=this.listener)==null||i.onPollsUpdate(1,r)})}handlePollStop(e){return f(this,null,function*(){var t;let i=[];for(let r of e.polls){let n=this.store.getPoll(r.poll_id);if(n){n.state="stopped",n.stoppedAt=Fe(r.stopped_at),n.stoppedBy=r.stopped_by;let s=yield this.transport.signal.getPollResult({poll_id:r.poll_id});this.updatePollResult(n,s),i.push(n)}}i.length>0&&((t=this.listener)==null||t.onPollsUpdate(2,i))})}handlePollStats(e){return f(this,null,function*(){var t;let i=[];for(let r of e.polls){let n=this.store.getPoll(r.poll_id);if(!n)return;this.updatePollResult(n,r),yield this.updatePollResponses(n,!1),i.push(n)}i.length>0&&((t=this.listener)==null||t.onPollsUpdate(4,i))})}updatePollResult(e,t){var i;e.result=H({},e.result),e.result.totalUsers=t.user_count,e.result.maxUsers=t.max_user,e.result.totalResponses=t.total_response,(i=t.questions)==null||i.forEach(r=>{var n,s;let o=(n=e.questions)==null?void 0:n.find(a=>a.index===r.question);o&&(o.result=H({},o.result),o.result.correctResponses=r.correct,o.result.skippedCount=r.skipped,o.result.totalResponses=r.total,(s=r.options)==null||s.forEach((a,l)=>{var u;let c=(u=o.options)==null?void 0:u[l];c&&c.voteCount!==a&&(c.voteCount=a)}))})}updatePollResponses(e,t){return f(this,null,function*(){var i;(i=(yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t})).responses)==null||i.forEach(({response:r,peer:n,final:s})=>{var o;let a=(o=e==null?void 0:e.questions)==null?void 0:o.find(u=>u.index===r.question);if(!a)return;let l={id:r.response_id,questionIndex:r.question,option:r.option,options:r.options,text:r.text,responseFinal:s,peer:{peerid:n.peerid,userHash:n.hash,userid:n.userid,username:n.username},skipped:r.skipped,type:r.type,update:r.update};Array.isArray(a.responses)&&a.responses.length>0?a.responses.find(({id:u})=>u===l.id)||a.responses.push(l):a.responses=[l]})})}},yC=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case"on-role-change-request":this.handleRoleChangeRequest(t);break;case"on-track-update-request":this.handleTrackUpdateRequest(t);break;case"on-change-track-mute-state-request":this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};(t=this.listener)==null||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:r}=e,n=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find(a=>a.publishedTrackId===i);if(!s)return;let o=()=>{var a;(a=this.listener)==null||a.onChangeTrackStateRequest({requestedBy:n,track:s,enabled:!r})};if(r){if(s.enabled===!r)return;s.setEnabled(!r).then(o)}else o()}handleChangeTrackStateRequest(e){var t;let{type:i,source:r,value:n,requested_by:s}=e,o=s?this.store.getPeerById(s):void 0,a=!n,l=this.getTracksToBeUpdated({type:i,source:r,enabled:a});if(l.length!==0)if(a)(t=this.listener)==null||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,type:i,source:r,enabled:!0});else{let u=[];for(let c of l)u.push(c.setEnabled(!1));Promise.all(u).then(()=>{var c;(c=this.listener)==null||c.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,enabled:!1})})}}getTracksToBeUpdated({type:e,source:t,enabled:i}){let r=this.store.getLocalPeerTracks();return e&&(r=r.filter(n=>n.type===e)),t&&(r=r.filter(n=>n.source===t)),r.filter(n=>n.enabled!==i)}},SC=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="[RoomUpdateManager]"}handleNotification(e,t){switch(e){case"peer-list":this.onRoomState(t.room);break;case"on-rtmp-update":this.updateRTMPStatus(t);break;case"on-record-update":this.updateRecordingStatus(t);break;case"room-state":this.handlePreviewRoomState(t);break;case"room-info":this.handleRoomInfo(t);break;case"session-info":this.handleSessionInfo(t);break;case"on-hls-update":this.updateHLSStatus(t);break}}handleRoomInfo(e){let t=this.store.getRoom();if(!t){y.w(this.TAG,"on session info - room not present");return}t.description=e.description,t.large_room_optimization=e.large_room_optimization,t.max_size=e.max_size,t.name=e.name}handleSessionInfo(e){var t;let i=this.store.getRoom();if(!i){y.w(this.TAG,"on session info - room not present");return}i.sessionId=e.session_id,i.peerCount!==e.peer_count&&(i.peerCount=e.peer_count,(t=this.listener)==null||t.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",i))}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t)}onRoomState(e){var t,i,r,n;let{recording:s,streaming:o,transcriptions:a,session_id:l,started_at:u,name:c}=e,h=this.store.getRoom();if(!h){y.w(this.TAG,"on room state - room not present");return}h.name=c,h.rtmp.running=this.isStreamingRunning((t=o==null?void 0:o.rtmp)==null?void 0:t.state),h.rtmp.startedAt=Fe((i=o==null?void 0:o.rtmp)==null?void 0:i.started_at),h.rtmp.state=(r=o==null?void 0:o.rtmp)==null?void 0:r.state,h.recording.server=this.getPeerListSFURecording(s),h.recording.browser=this.getPeerListBrowserRecording(s),h.recording.hls=this.getPeerListHLSRecording(s),h.hls=this.convertHls(o==null?void 0:o.hls),h.transcriptions=this.addTranscriptionDetail(a),h.sessionId=l,h.startedAt=Fe(u),(n=this.listener)==null||n.onRoomUpdate("RECORDING_STATE_UPDATED",h)}addTranscriptionDetail(e){return e?e.map(t=>({state:t.state,mode:t.mode})):[]}isRecordingRunning(e){return e?!["none","paused","stopped","failed"].includes(e):!1}isStreamingRunning(e){return e?!["none","stopped","failed"].includes(e):!1}initHLS(e){let t=this.store.getRoom(),i={running:!0,variants:[]};return t?(e!=null&&e.variants&&e.variants.forEach((r,n)=>{var s,o,a;r.state!=="initialised"?i.variants.push({meetingURL:r==null?void 0:r.meetingURL,url:r==null?void 0:r.url,metadata:r==null?void 0:r.metadata,playlist_type:r==null?void 0:r.playlist_type,startedAt:Fe((s=e==null?void 0:e.variants)==null?void 0:s[n].started_at),initialisedAt:Fe((o=e==null?void 0:e.variants)==null?void 0:o[n].initialised_at),state:r.state,stream_type:r==null?void 0:r.stream_type}):i.variants.push({initialisedAt:Fe((a=e==null?void 0:e.variants)==null?void 0:a[n].initialised_at),url:""})}),i):(y.w(this.TAG,"on hls - room not present"),i)}updateHLSStatus(e){var t;let i=this.store.getRoom(),r=e.variants&&e.variants.length>0?e.variants.some(n=>this.isStreamingRunning(n.state)):!1;if(!i){y.w(this.TAG,"on hls - room not present");return}e.enabled=r,i.hls=this.convertHls(e),(t=this.listener)==null||t.onRoomUpdate("HLS_STREAMING_STATE_UPDATED",i)}convertHls(e){var t;if(e!=null&&e.variants&&e.variants.length>0&&e.variants.some(r=>r.state==="initialised"))return this.initHLS(e);let i={running:!!(e!=null&&e.enabled),variants:[],error:this.toSdkError(e==null?void 0:e.error)};return(t=e==null?void 0:e.variants)==null||t.forEach(r=>{i.variants.push({meetingURL:r==null?void 0:r.meeting_url,url:r==null?void 0:r.url,metadata:r==null?void 0:r.metadata,playlist_type:r==null?void 0:r.playlist_type,startedAt:Fe(r==null?void 0:r.started_at),initialisedAt:Fe(r==null?void 0:r.initialised_at),state:r.state,stream_type:r==null?void 0:r.stream_type})}),i}getHLSRecording(e){var t,i;let r={running:!1},n=this.isRecordingRunning(e==null?void 0:e.state);return(n||(e==null?void 0:e.state)==="paused")&&(r={running:n,singleFilePerLayer:!!((t=e==null?void 0:e.hls_recording)!=null&&t.single_file_per_layer),hlsVod:!!((i=e==null?void 0:e.hls_recording)!=null&&i.hls_vod),startedAt:Fe(e==null?void 0:e.started_at),initialisedAt:Fe(e==null?void 0:e.initialised_at),state:e==null?void 0:e.state,error:this.toSdkError(e==null?void 0:e.error)}),r}getPeerListHLSRecording(e){var t,i;let r=e==null?void 0:e.hls;return{running:this.isRecordingRunning(r==null?void 0:r.state),startedAt:Fe(r==null?void 0:r.started_at),initialisedAt:Fe(r==null?void 0:r.initialised_at),state:r==null?void 0:r.state,singleFilePerLayer:(t=r==null?void 0:r.config)==null?void 0:t.single_file_per_layer,hlsVod:(i=r==null?void 0:r.config)==null?void 0:i.hls_vod}}getPeerListBrowserRecording(e){let t=e==null?void 0:e.browser;return{running:this.isRecordingRunning(t==null?void 0:t.state),startedAt:Fe(t==null?void 0:t.started_at),state:t==null?void 0:t.state}}getPeerListSFURecording(e){let t=e==null?void 0:e.sfu;return{running:this.isRecordingRunning(t==null?void 0:t.state),startedAt:Fe(t==null?void 0:t.started_at),state:t==null?void 0:t.state}}updateRecordingStatus(e){var t;let i=this.store.getRoom(),r=this.isRecordingRunning(e.state);if(!i){y.w(this.TAG,`set recording status running=${r} - room not present`);return}let n;e.type==="sfu"?(i.recording.server={running:r,startedAt:r?Fe(e.started_at):void 0,error:this.toSdkError(e.error),state:e.state},n="SERVER_RECORDING_STATE_UPDATED"):e.type==="HLS"?(i.recording.hls=this.getHLSRecording(e),n="RECORDING_STATE_UPDATED"):(i.recording.browser={running:r,startedAt:r?Fe(e.started_at):void 0,error:this.toSdkError(e.error),state:e==null?void 0:e.state},n="BROWSER_RECORDING_STATE_UPDATED"),(t=this.listener)==null||t.onRoomUpdate(n,i)}updateRTMPStatus(e){var t,i;let r=this.store.getRoom(),n=this.isStreamingRunning(e.state);if(!r){y.w(this.TAG,"on policy change - room not present");return}if(!n){r.rtmp={running:n,state:e.state,error:this.toSdkError(e.error)},(t=this.listener)==null||t.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",r);return}r.rtmp={running:n,startedAt:n?Fe(e.started_at):void 0,state:e.state,error:this.toSdkError(e.error)},(i=this.listener)==null||i.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",r)}toSdkError(e){if(!(e!=null&&e.code))return;let t=e.message||"error in streaming/recording",i=new ue(e.code,"ServerErrors","NONE",t,t);return y.e(this.TAG,"error in streaming/recording",i),i}},kC=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){e==="on-metadata-change"&&this.handleMetadataChange(t)}handleMetadataChange(e){var t;let i=e.values.map(r=>({key:r.key,value:r.data,updatedAt:Fe(r.updated_at),updatedBy:r.updated_by?this.store.getPeerById(r.updated_by):void 0}));(t=this.listener)==null||t.onSessionStoreUpdate(i)}},TC=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){switch(e){case"on-whiteboard-update":{this.handleWhiteboardUpdate(t);break}}}handleWhiteboardUpdate(e){return f(this,null,function*(){var t;let i=this.store.getLocalPeer(),r=this.store.getWhiteboard(e.id),n=e.owner===(i==null?void 0:i.peerId)||e.owner===(i==null?void 0:i.customerUserId),s=e.state==="open",o={id:e.id,title:e.title,attributes:e.attributes};if(o.open=n?r==null?void 0:r.open:s,o.owner=o.open?e.owner:void 0,o.open)if(n)o.url=r==null?void 0:r.url,o.token=r==null?void 0:r.token,o.addr=r==null?void 0:r.addr,o.permissions=r==null?void 0:r.permissions;else{let a=yield this.transport.signal.getWhiteboard({id:e.id});o.url=Yu(a.token,a.addr,this.store.getEnv()),o.token=a.token,o.addr=a.addr,o.permissions=a.permissions}this.store.setWhiteboard(o),(t=this.listener)==null||t.onWhiteboardUpdate(o)})}},bC=class{constructor(e,t,i,r,n,s){this.store=e,this.transport=i,this.listener=r,this.audioListener=n,this.connectionQualityListener=s,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=a=>{if(a==="peer-list")this.hasConsistentRoomStateArrived=!0;else if(a==="room-state")return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=a=>{this.trackManager.handleTrackAdd(a)},this.handleTrackRemove=a=>{this.trackManager.handleTrackRemove(a)},this.updateLocalPeer=({name:a,metadata:l})=>{let u=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:u,name:a,data:l})};let o=this.transport.isFlagEnabled("onDemandTracks");this.trackManager=o?new dC(this.store,t,this.transport,this.listener):new kg(this.store,t,this.listener),this.peerManager=new pC(this.store,this.trackManager,this.listener),this.peerListManager=new hC(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new uC(this.listener),this.policyChangeManager=new fC(this.store,t),this.requestManager=new yC(this.store,this.listener),this.activeSpeakerManager=new lC(this.store,this.listener,this.audioListener),this.connectionQualityManager=new cC(this.store,this.connectionQualityListener),this.roomUpdateManager=new SC(this.store,this.listener),this.sessionMetadataManager=new kC(this.store,this.listener),this.pollsManager=new gC(this.store,this.transport,this.listener),this.whiteboardManager=new TC(this.store,this.transport,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e,this.sessionMetadataManager.listener=e,this.pollsManager.listener=e,this.whiteboardManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var i,r;let n=e.method,s=e.params;["active-speakers","sfu-stats","on-connection-quality-update",void 0].includes(n)||y.d(this.TAG,`Received notification - ${n}`,{notification:s}),n==="sfu-stats"&&(i=window.HMS)!=null&&i.ON_SFU_STATS&&typeof((r=window.HMS)==null?void 0:r.ON_SFU_STATS)=="function"&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(n)&&(this.roomUpdateManager.handleNotification(n,s),this.peerManager.handleNotification(n,s),this.requestManager.handleNotification(n,s),this.peerListManager.handleNotification(n,s,t),this.broadcastManager.handleNotification(n,s),this.sessionMetadataManager.handleNotification(n,s),this.pollsManager.handleNotification(n,s),this.whiteboardManager.handleNotification(n,s),this.handleIsolatedMethods(n,s))}handleIsolatedMethods(e,t){switch(e){case"on-track-add":{this.trackManager.handleTrackMetadataAdd(t);break}case"on-track-update":{this.trackManager.handleTrackUpdate(t);break}case"on-track-remove":{if(!t.peer){y.d(this.TAG,`Ignoring sfu notification - ${e}`,{notification:t});return}this.trackManager.handleTrackRemovedPermanently(t);break}case"on-track-layer-update":{this.trackManager.handleTrackLayerUpdate(t);break}case"active-speakers":this.activeSpeakerManager.handleActiveSpeakers(t);break;case"on-connection-quality-update":this.connectionQualityManager.handleQualityUpdate(t);break;case"on-policy-change":this.policyChangeManager.handlePolicyChange(t);break}}},CC=class{constructor(e){this.transport=e,this.observedKeys=new Set}get(e){return f(this,null,function*(){let{data:t,updated_at:i}=yield this.transport.signal.getSessionMetadata(e);return{value:t,updatedAt:Fe(i)}})}set(e,t){return f(this,null,function*(){let{data:i,updated_at:r}=yield this.transport.signal.setSessionMetadata({key:e,data:t}),n=Fe(r);return{value:i,updatedAt:n}})}observe(e){return f(this,null,function*(){let t=new Set(this.observedKeys);if(e.forEach(i=>this.observedKeys.add(i)),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(i){throw this.observedKeys=t,i}})}unobserve(e){return f(this,null,function*(){let t=new Set(this.observedKeys);if(this.observedKeys=new Set([...this.observedKeys].filter(i=>!e.includes(i))),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(i){throw this.observedKeys=t,i}})}},EC=class{constructor(e,t,i="",r="",n="https://prod-init.100ms.live/init",s=!1){this.authToken=e,this.peerId=t,this.peerName=i,this.data=r,this.endpoint=n,this.autoSubscribeVideo=s}},xt=(e=>(e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed",e))(xt||{}),wC={0:[],1:[],2:[1],3:[1],4:[1]},Zu=(e=>(e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving",e))(Zu||{}),PC=class{constructor(e){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i,e(t,i)})}},RC=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return f(this,arguments,function*({category:t,error:i,task:r,originalState:n,maxFailedRetries:s=5,changeState:o=!0}){yield this.scheduleTask({category:t,error:i,changeState:o,task:r,originalState:n,maxFailedRetries:s})})}reset(){this.retryTaskIds.forEach(e=>clearTimeout(e)),this.retryTaskIds=[],this.inProgress.clear()}isTaskInProgress(e){return!!this.inProgress.get(e)}scheduleTask(e){return f(this,arguments,function*({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:o=5,failedRetryCount:a=0}){if(y.d(this.TAG,"schedule: ",{category:xt[t],error:i}),a===0){let p=this.inProgress.get(t);if(p){y.d(this.TAG,`schedule: Already a task for ${xt[t]} scheduled, waiting for its completion`),yield p.promise;return}let S=new PC((k,E)=>{});this.inProgress.set(t,S),this.sendEvent(i,t)}let l=!1,u=wC[t];for(let p in u){let S=u[parseInt(p)];try{let k=this.inProgress.get(S);k&&(y.d(this.TAG,`schedule: Suspending retry task of ${xt[t]}, waiting for ${xt[S]} to recover`),yield k.promise,y.d(this.TAG,`schedule: Resuming retry task ${xt[t]} as it's dependency ${xt[S]} is recovered`))}catch{y.d(this.TAG,`schedule: Stopping retry task of ${xt[t]} as it's dependency ${xt[S]} failed to recover`),l=!0;break}}if(a>=o||l){if(i.description+=`. [${xt[t]}] Could not recover after ${a} tries`,l&&(i.description+=` Could not recover all of it's required dependencies - [${u.map(p=>xt[p]).toString()}]`),i.isTerminal=!0,this.inProgress.delete(t),this.sendEvent(i,t),this.reset(),r)this.onStateChange("Failed",i);else throw i;return}r&&this.onStateChange("Reconnecting",i);let c=this.getDelayForRetryCount(t,a);y.d(this.TAG,`schedule: [${xt[t]}] [failedRetryCount=${a}] Scheduling retry task in ${c}ms`);let h;try{h=yield this.setTimeoutPromise(n,c)}catch(p){h=!1,y.w(this.TAG,`[${xt[t]}] Un-caught exception ${p.name} in retry-task, initiating retry`,p)}if(h){let p=this.inProgress.get(t);this.inProgress.delete(t),p==null||p.resolve(a),r&&this.inProgress.size===0&&this.onStateChange(s),y.d(this.TAG,`schedule: [${xt[t]}] [failedRetryCount=${a}] Recovered `)}else yield this.scheduleTask({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:o,failedRetryCount:a+1})})}getBaseDelayForTask(e,t){return e===2?2:Math.pow(2,t)}getDelayForRetryCount(e,t){let i=this.getBaseDelayForTask(e,t),r=e===2?Math.random()*2:Math.random();return Math.round(Math.min(i+r,60)*1e3)}setTimeoutPromise(e,t){return f(this,null,function*(){return new Promise((i,r)=>{let n=window.setTimeout(()=>f(this,null,function*(){try{let s=yield e();s&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(n),1),i(s)}catch(s){r(s)}}),t);this.retryTaskIds.push(n)})})}},AC=class extends cd{constructor(){super(100),this.localStorage=new Ha("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;(e=this.localStorage.get())==null||e.forEach(t=>{let i=new De(t);super.enqueue(i)})}},_C=class{constructor(){this.TAG="[AnalyticsTransport]"}sendEvent(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){y.w(this.TAG,"sendEvent failed",t)}}flushFailedEvents(e){var t;try{for(y.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let i=this.failedEvents.dequeue();i&&(((t=i.metadata)==null?void 0:t.peer.peer_id)===e||!i.metadata.peer.peer_id?this.sendSingleEvent(i):Bs.sendEvent(i))}}catch(i){y.w(this.TAG,"flushFailedEvents failed",i)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),y.d(this.TAG,"Sent event",e.name,e)}catch(t){throw y.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}},IC=class extends _C{constructor(e){super(),this.transportProvider=e,this.failedEvents=new AC}},Tg=class{constructor(e,t,i,r){this.store=e,this.eventBus=t,this.sampleWindowSize=i,this.pushInterval=r,this.shouldSendEvent=!1,this.sequenceNum=1,this.stop=()=>{this.shouldSendEvent&&this.sendEvent(),this.eventBus.statsUpdate.unsubscribe(this.handleStatsUpdate.bind(this)),this.shouldSendEvent=!1},this.start()}start(){this.shouldSendEvent||(this.stop(),this.shouldSendEvent=!0,this.eventBus.statsUpdate.subscribe(this.handleStatsUpdate.bind(this)),this.startLoop().catch(e=>y.e("[StatsAnalytics]",e.message)))}startLoop(){return f(this,null,function*(){for(;this.shouldSendEvent;)yield Ki(this.pushInterval*1e3),this.sendEvent()})}sendEvent(){this.trackAnalytics.forEach(e=>{e.clearSamples()})}cleanTrackAnalyticsAndCreateSample(e){this.trackAnalytics.forEach(t=>{!this.store.hasTrack(t.track)&&!(t.samples.length>0)&&this.trackAnalytics.delete(t.track_id)}),e&&this.trackAnalytics.forEach(t=>{t.createSample()})}},bg=class{constructor({track:e,ssrc:t,rid:i,kind:r,sampleWindowSize:n}){this.samples=[],this.tempStats=[],this.track=e,this.ssrc=t,this.rid=i,this.kind=r,this.track_id=this.track.trackId,this.source=this.track.source,this.sampleWindowSize=n}pushTempStat(e){this.tempStats.push(e)}createSample(){this.tempStats.length!==0&&(this.samples.push(this.collateSample()),this.prevLatestStat=this.getLatestStat(),this.tempStats.length=0)}clearSamples(){this.samples.length=0}getLatestStat(){return this.tempStats[this.tempStats.length-1]}getFirstStat(){return this.tempStats[0]}calculateSum(e){if(typeof this.getLatestStat()[e]=="number")return this.tempStats.reduce((t,i)=>t+(i[e]||0),0)}calculateAverage(e,t=!0){let i=this.calculateSum(e),r=i!==void 0?i/this.tempStats.length:void 0;return r?t?Math.round(r):r:void 0}calculateDifferenceForSample(e){var t;let i=Number((t=this.prevLatestStat)==null?void 0:t[e])||0;return(Number(this.getLatestStat()[e])||0)-i}calculateDifferenceAverage(e,t=!0){let i=this.calculateDifferenceForSample(e)/this.tempStats.length;return t?Math.round(i):i}calculateInstancesOfHigh(e,t){if(typeof this.getLatestStat()[e]=="number")return this.tempStats.reduce((i,r)=>i+((r[e]||0)>t?1:0),0)}},Cg=(e,t)=>e&&t&&(e.frameWidth!==t.frameWidth||e.frameHeight!==t.frameHeight),Eg=(e,t)=>e&&t&&e.enabled!==t.enabled,ec=e=>Object.entries(e).filter(([,t])=>t!==void 0).reduce((t,[i,r])=>(t[i]=r,t),{}),LC=class extends Tg{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],r=[];return this.trackAnalytics.forEach(n=>{n.track.type==="audio"?i.push(n.toAnalytics()):n.track.type==="video"&&r.push(n.toAnalytics())}),{audio:i,video:r,joined_at:(t=(e=this.store.getRoom())==null?void 0:e.joinedAt)==null?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:30}}sendEvent(){this.eventBus.analytics.publish(ke.publishStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=!1,i=e.getLocalTrackStats();Object.keys(i).forEach(r=>{let n=i[r],s=this.store.getLocalPeerTracks().find(o=>o.getTrackIDBeingSent()===r);Object.keys(n).forEach(o=>{var a,l,u;let c=n[o];if(!s)return;let h=this.getTrackIdentifier(s.trackId,c),p=Ee(H({},c),{availableOutgoingBitrate:(l=(a=e.getLocalPeerStats())==null?void 0:a.publish)==null?void 0:l.availableOutgoingBitrate});if(h&&this.trackAnalytics.has(h))(u=this.trackAnalytics.get(h))==null||u.pushTempStat(p);else if(s){let k=new DC({track:s,sampleWindowSize:this.sampleWindowSize,rid:c.rid,ssrc:c.ssrc.toString(),kind:c.kind});k.pushTempStat(p),this.trackAnalytics.set(this.getTrackIdentifier(s.trackId,c),k)}let S=this.trackAnalytics.get(h);S!=null&&S.shouldCreateSample()&&(t=!0)})}),this.cleanTrackAnalyticsAndCreateSample(t)}getTrackIdentifier(e,t){return t.rid?`${e}:${t.rid}`:e}},DC=class extends bg{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=e.qualityLimitationDurations,i=t&&{bandwidth_sec:t.bandwidth,cpu_sec:t.cpu,other_sec:t.other},r=e.frameHeight?{height_px:this.getLatestStat().frameHeight,width_px:this.getLatestStat().frameWidth}:void 0,n=this.calculateAverage("jitter",!1),s=n?Math.round(n*1e3):void 0,o=this.calculateAverage("roundTripTime",!1),a=o?Math.round(o*1e3):void 0;return ec({timestamp:Date.now(),avg_available_outgoing_bitrate_bps:this.calculateAverage("availableOutgoingBitrate"),avg_bitrate_bps:this.calculateAverage("bitrate"),avg_fps:this.calculateAverage("framesPerSecond"),total_packets_lost:this.getLatestStat().packetsLost,total_packets_sent:this.getLatestStat().packetsSent,total_packet_sent_delay_sec:parseFloat(this.calculateDifferenceForSample("totalPacketSendDelay").toFixed(4)),total_fir_count:this.calculateDifferenceForSample("firCount"),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_ms:s,avg_round_trip_time_ms:a,total_quality_limitation:i,resolution:r})},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return e===30||Eg(t,i)||t.kind==="video"&&Cg(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}},MC=class extends Tg{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],r=[];return this.trackAnalytics.forEach(n=>{n.track.type==="audio"?i.push(n.toAnalytics()):n.track.type==="video"&&r.push(n.toAnalytics())}),{audio:i,video:r,joined_at:(t=(e=this.store.getRoom())==null?void 0:e.joinedAt)==null?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:10}}sendEvent(){this.eventBus.analytics.publish(ke.subscribeStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=e.getAllRemoteTracksStats(),i=!1;Object.keys(t).forEach(r=>{var n;let s=t[r],o=this.store.getTrackById(r),a=(h=>h.jitterBufferDelay&&h.jitterBufferEmittedCount&&h.jitterBufferDelay/h.jitterBufferEmittedCount)(s),l=this.calculateAvSyncForStat(s,e),u=Ee(H({},s),{calculatedJitterBufferDelay:a,avSync:l});if(s.kind==="video"){let h=o.getPreferredLayerDefinition();u.expectedFrameHeight=h==null?void 0:h.resolution.height,u.expectedFrameWidth=h==null?void 0:h.resolution.width}if(this.trackAnalytics.has(r))(n=this.trackAnalytics.get(r))==null||n.pushTempStat(u);else if(o){let h=new OC({track:o,sampleWindowSize:this.sampleWindowSize,ssrc:s.ssrc.toString(),kind:s.kind});h.pushTempStat(u),this.trackAnalytics.set(r,h)}let c=this.trackAnalytics.get(r);c!=null&&c.shouldCreateSample()&&(i=!0)}),this.cleanTrackAnalyticsAndCreateSample(i)}calculateAvSyncForStat(e,t){if(!e.peerID||!e.estimatedPlayoutTimestamp||e.kind!=="video")return;let i=this.store.getPeerById(e.peerID),r=i==null?void 0:i.audioTrack,n=i==null?void 0:i.videoTrack;if(!(r&&n&&r.enabled&&n.enabled))return Aa;let s=t.getRemoteTrackStats(r.trackId);if(!s)return Aa;if(s.estimatedPlayoutTimestamp)return s.estimatedPlayoutTimestamp-e.estimatedPlayoutTimestamp}},OC=class extends bg{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=this.getFirstStat(),i={timestamp:Date.now(),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_buffer_delay:this.calculateAverage("calculatedJitterBufferDelay",!1)};if(e.kind==="video")return ec(Ee(H({},i),{avg_av_sync_ms:this.calculateAvgAvSyncForSample(),avg_frames_received_per_sec:this.calculateDifferenceAverage("framesReceived"),avg_frames_dropped_per_sec:this.calculateDifferenceAverage("framesDropped"),avg_frames_decoded_per_sec:this.calculateDifferenceAverage("framesDecoded"),frame_width:this.calculateAverage("frameWidth"),frame_height:this.calculateAverage("frameHeight"),expected_frame_width:this.calculateAverage("expectedFrameWidth"),expected_frame_height:this.calculateAverage("expectedFrameHeight"),pause_count:this.calculateDifferenceForSample("pauseCount"),pause_duration_seconds:this.calculateDifferenceForSample("totalPausesDuration"),freeze_count:this.calculateDifferenceForSample("freezeCount"),freeze_duration_seconds:this.calculateDifferenceForSample("totalFreezesDuration")}));{let r=(e.concealedSamples||0)-(e.silentConcealedSamples||0)-((t.concealedSamples||0)-(t.silentConcealedSamples||0));return ec(Ee(H({},i),{audio_level:this.calculateInstancesOfHigh("audioLevel",.05),audio_concealed_samples:r,audio_total_samples_received:this.calculateDifferenceForSample("totalSamplesReceived"),audio_concealment_events:this.calculateDifferenceForSample("concealmentEvents"),fec_packets_discarded:this.calculateDifferenceForSample("fecPacketsDiscarded"),fec_packets_received:this.calculateDifferenceForSample("fecPacketsReceived"),total_samples_duration:this.calculateDifferenceForSample("totalSamplesDuration"),total_packets_received:this.calculateDifferenceForSample("packetsReceived"),total_packets_lost:this.calculateDifferenceForSample("packetsLost")}))}},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return e===10||Eg(t,i)||t.kind==="video"&&Cg(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}calculateAvgAvSyncForSample(){let e=this.tempStats.map(t=>t.avSync).filter(t=>t!==void 0&&t!==Aa);return e.length===0?Aa:e.reduce((t,i)=>t+i,0)/e.length}},tc=(e=>(e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe",e))(tc||{});function xC(e,t){var i;let r=Om(e.sdp);if(!((i=r.origin)!=null&&i.username.startsWith("mozilla")))return e;let n=t?Array.from(t.values()):[];return r.media.forEach(s=>{var o,a,l;let u=(o=s.msid)==null?void 0:o.split(" ")[0],c=(a=n.find(h=>h.type===s.type&&h.stream_id===u))==null?void 0:a.track_id;c&&(s.msid=(l=s.msid)==null?void 0:l.replace(/\s(.+)/,` ${c}`))}),{type:e.type,sdp:M0(r)}}function NC(e,t){var i;if(!(e!=null&&e.sdp)||!t)return;let r=Om(e.sdp).media.find(n=>Sr(n.mid)&&parseInt(n.mid)===parseInt(t));return(i=r==null?void 0:r.msid)==null?void 0:i.split(" ")[1]}function UC(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Oi="[HMSConnection]",wg=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===0?"PUBLISH":"SUBSCRIBE"}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return f(this,null,function*(){try{let i=yield this.nativeConnection.createOffer(t);return y.d(Oi,`[role=${this.role}] createOffer offer=${JSON.stringify(i,null,1)}`),UC(xC(i,e))}catch(i){throw G.WebrtcErrors.CreateOfferFailed(this.action,i.message)}})}createAnswer(e=void 0){return f(this,null,function*(){try{let t=yield this.nativeConnection.createAnswer(e);return y.d(Oi,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(t){throw G.WebrtcErrors.CreateAnswerFailed(this.action,t.message)}})}setLocalDescription(e){return f(this,null,function*(){try{y.d(Oi,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(t){throw G.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.message)}})}setRemoteDescription(e){return f(this,null,function*(){try{y.d(Oi,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(t){throw G.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.message)}})}addIceCandidate(e){return f(this,null,function*(){if(this.nativeConnection.signalingState==="closed"){y.d(Oi,`[role=${this.role}] addIceCandidate signalling state closed`);return}y.d(Oi,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)})}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}logSelectedIceCandidatePairs(){try{(this.role===0?this.getSenders():this.getReceivers()).forEach(e=>{var t;let i=(t=e.track)==null?void 0:t.kind;if(e.transport){let r=e.transport.iceTransport,n=()=>{typeof r.getSelectedCandidatePair=="function"&&(this.selectedCandidatePair=r.getSelectedCandidatePair(),y.d(Oi,`${tc[this.role]} connection`,`selected ${i||"unknown"} candidate pair`,JSON.stringify(this.selectedCandidatePair,null,2)))};typeof r.onselectedcandidatepairchange=="function"&&(r.onselectedcandidatepairchange=n),n()}})}catch(e){y.w(Oi,`Error in logging selected ice candidate pair for ${tc[this.role]} connection`,e)}}removeTrack(e){this.nativeConnection.signalingState!=="closed"&&this.nativeConnection.removeTrack(e)}setMaxBitrateAndFramerate(e){return f(this,null,function*(){let t=e.settings.maxBitrate,i=e instanceof mi&&e.settings.maxFramerate,r=this.getSenders().find(n=>{var s;return((s=n==null?void 0:n.track)==null?void 0:s.id)===e.getTrackIDBeingSent()});if(r){let n=r.getParameters();n.encodings.length===1&&(t&&(n.encodings[0].maxBitrate=t*1e3),i&&(n.encodings[0].maxFramerate=i)),yield r.setParameters(n)}else y.w(Oi,`no sender found to setMaxBitrate for track - ${e.trackId}, sentTrackId - ${e.getTrackIDBeingSent()}`)})}getStats(){return f(this,null,function*(){return yield this.nativeConnection.getStats()})}close(){return f(this,null,function*(){this.nativeConnection.close()})}getReceivers(){return this.nativeConnection.getReceivers()}},FC=class extends wg{constructor(e,t,i){super(0,e),this.TAG="[HMSPublishConnection]",this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.channel=this.nativeConnection.createDataChannel(Zm,{protocol:"SCTP"}),this.channel.onerror=r=>y.e(this.TAG,`publish data channel onerror ${r}`,r),this.nativeConnection.onicecandidate=({candidate:r})=>{r&&e.trickle(this.role,r)},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState),this.nativeConnection.sctp&&(this.nativeConnection.sctp.transport.onstatechange=()=>{var r;this.observer.onDTLSTransportStateChange((r=this.nativeConnection.sctp)==null?void 0:r.transport.state)},this.nativeConnection.sctp.transport.onerror=r=>{var n;this.observer.onDTLSTransportError(new Error((n=r==null?void 0:r.error)==null?void 0:n.errorDetail)||"DTLS Transport failed")})}}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>f(this,null,function*(){y.d(this.TAG,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()})}},$C=class{constructor(e,t,i=""){this.TAG="[HMSDataChannel]",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=r=>{this.observer.onMessage(r.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){y.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},BC=class Pg extends wg{constructor(t,i,r,n){super(1,t),this.isFlagEnabled=r,this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.MAX_RETRIES=3,this.pendingMessageQueue=[],this.eventEmitter=new h0({maxListeners:60}),this.handlePendingApiMessages=()=>{this.eventEmitter.emit("open",!0),this.pendingMessageQueue.length>0&&(y.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach(s=>this.sendOverApiDataChannel(s)),this.pendingMessageQueue.length=0)},this.sendMessage=(s,o)=>f(this,null,function*(){var a;((a=this.apiChannel)==null?void 0:a.readyState)!=="open"&&(yield this.eventEmitter.waitFor("open"));let l;for(let u=0;u<this.MAX_RETRIES;u++){this.apiChannel.send(s),l=yield this.waitForResponse(o);let c=l.error;if(c){if(c.code===404){y.d(this.TAG,`Track not found ${o}`,{request:s,try:u+1,error:c});break}if(y.d(this.TAG,`Failed sending ${o}`,{request:s,try:u+1,error:c}),!(c.code/100===5||c.code===429))throw Error(`code=${c.code}, message=${c.message}`);let h=(2+Math.random()*2)*1e3;yield Ka(h)}else break}return l}),this.waitForResponse=s=>f(this,null,function*(){let o=yield this.eventEmitter.waitFor("message",function(l){return l.includes(s)}),a=JSON.parse(o[0]);return y.d(this.TAG,`response for ${s} -`,JSON.stringify(a,null,2)),a}),this.observer=n,this.nativeConnection=new RTCPeerConnection(i),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=t=>{t.channel.label===Zm&&(this.apiChannel=new $C(t.channel,{onMessage:i=>{this.eventEmitter.emit("message",i),this.observer.onApiChannelMessage(i)}},`role=${this.role}`),t.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=t=>{t.candidate!==null&&this.signal.trickle(this.role,t.candidate)},this.nativeConnection.ontrack=t=>{var i;let r=t.streams[0],n=r.id;if(!this.remoteStreams.has(n)){let u=new pd(r,this);this.remoteStreams.set(n,u)}r.addEventListener("removetrack",u=>{if(u.track.id!==t.track.id)return;let c=s.tracks.findIndex(h=>{var p;return h.nativeTrack.id===u.track.id&&t.transceiver.mid===((p=h.transceiver)==null?void 0:p.mid)});if(c>=0){let h=s.tracks[c];this.observer.onTrackRemove(h),s.tracks.splice(c,1),s.tracks.length===0&&this.remoteStreams.delete(n)}});let s=this.remoteStreams.get(n),o=t.track.kind==="audio"?Ks:ni,a=new o(s,t.track);t.track.kind==="video"&&s.setVideoLayerLocally("none","addTrack","subscribeConnection"),a.transceiver=t.transceiver;let l=NC(this.remoteDescription,(i=t.transceiver)==null?void 0:i.mid);l&&a.setSdpTrackId(l),s.tracks.push(a),this.observer.onTrackAdd(a)}}sendOverApiDataChannel(t){this.apiChannel&&this.apiChannel.readyState==="open"?this.apiChannel.send(t):(y.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,t),this.pendingMessageQueue.push(t))}sendOverApiDataChannelWithResponse(t,i){return f(this,null,function*(){let r=Cr();if(t.method==="prefer-video-track-state"&&this.isFlagEnabled("disableVideoTrackAutoUnsubscribe")&&t.params.max_spatial_layer==="none")return y.d(this.TAG,"video auto unsubscribe is disabled, request is ignored"),{id:r};let n=JSON.stringify(H({id:i||r,jsonrpc:"2.0"},t));return this.sendMessage(n,r)})}close(){return f(this,null,function*(){var t;yield Gi(Pg.prototype,this,"close").call(this),(t=this.apiChannel)==null||t.close()})}},Ko="[InitService]",jC=class{static handleError(e,t){switch(e.status){case 404:throw G.APIErrors.EndpointUnreachable("INIT",t.message||e.statusText);case 200:break;default:throw G.APIErrors.ServerErrors(t.code||e.status,"INIT",t.message||(e==null?void 0:e.statusText))}}static fetchInitConfig(e){return f(this,arguments,function*({token:t,peerId:i,userAgent:r,initEndpoint:n="https://prod-init.100ms.live",region:s=""}){y.d(Ko,`fetchInitConfig: initEndpoint=${n} token=${t} peerId=${i} region=${s} `);let o=GC(n,i,r,s);try{let a=yield fetch(o,{headers:{Authorization:`Bearer ${t}`}});try{let l=yield a.clone().json();return this.handleError(a,l),y.d(Ko,`config is ${JSON.stringify(l,null,2)}`),zC(l)}catch(l){let u=yield a.text();throw y.e(Ko,"json error",l.message,u),G.APIErrors.ServerErrors(a.status,"INIT",u)}}catch(a){let l=a;throw["Failed to fetch","NetworkError","ECONNRESET"].some(u=>l.message.includes(u))?G.APIErrors.EndpointUnreachable("INIT",l.message):l}})}};function GC(e,t,i,r){try{let n=new URL("/init",e);return r&&r.trim().length>0&&n.searchParams.set("region",r.trim()),n.searchParams.set("peer_id",t),n.searchParams.set("user_agent_v2",i),n.toString()}catch(n){let s=n;throw y.e(Ko,s.name,s.message),s}}function zC(e){var t;return Ee(H({},e),{rtcConfiguration:Ee(H({},e.rtcConfiguration),{iceServers:(t=e.rtcConfiguration)==null?void 0:t.ice_servers})})}var VC=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new cd(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.resolvePingOnAnyResponse=()=>{this.callbacks.forEach((t,i)=>{var r;((r=t.metadata)==null?void 0:r.method)==="ping"&&(t.resolve({timestamp:Date.now()}),this.callbacks.delete(i))})},this.offlineListener=()=>{y.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{y.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setIsConnected(e,t=""){y.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.rejectPendingCalls(t),this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return f(this,null,function*(){var i;let r=Cr(),n={method:e,params:t,id:r,jsonrpc:"2.0"};(i=this.socket)==null||i.send(JSON.stringify(n));try{return yield new Promise((s,o)=>{this.callbacks.set(r,{resolve:s,reject:o,metadata:{method:e}})})}catch(s){if(s instanceof ue)throw s;let o=s;throw G.WebsocketMethodErrors.ServerErrors(Number(o.code),cp(e),o.message)}})}notify(e,t){var i,r;let n={method:e,params:t};((i=this.socket)==null?void 0:i.readyState)===WebSocket.OPEN&&((r=this.socket)==null||r.send(JSON.stringify(n)))}open(e){return new Promise((t,i)=>{let r=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let n=()=>{y.e(this.TAG,"Error from websocket"),r=!0,i(G.WebSocketConnectionErrors.FailedToConnect("JOIN","Error opening websocket connection"))};this.onCloseHandler=o=>{y.w(`Websocket closed code=${o.code}`),r?this.setIsConnected(!1,`code: ${o.code}${o.code!==1e3?", unexpected websocket close":""}`):(r=!0,i(G.WebSocketConnectionErrors.AbnormalClose("JOIN",`Error opening websocket connection - websocket closed unexpectedly with code=${o.code}`)))},this.socket.addEventListener("error",n);let s=()=>{var o,a;r=!0,t(),this.setIsConnected(!0),this.id++,(o=this.socket)==null||o.removeEventListener("open",s),(a=this.socket)==null||a.removeEventListener("error",n),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)})}close(){return f(this,null,function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")})}join(e,t,i,r,n,s,o){return f(this,null,function*(){if(!this.isConnected)throw G.WebSocketConnectionErrors.WebSocketConnectionLost("JOIN","Failed to send join over WS connection");let a={name:e,disableVidAutoSub:i,data:t,offer:o,server_sub_degrade:r,simulcast:n,onDemandTracks:s},l=yield this.internalCall("join",a);return this.isJoinCompleted=!0,this.pendingTrickle.forEach(({target:u,candidate:c})=>this.trickle(u,c)),this.pendingTrickle.length=0,y.d(this.TAG,`join: response=${JSON.stringify(l,null,1)}`),l})}trickle(e,t){this.isJoinCompleted?this.notify("trickle",{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return f(this,null,function*(){return yield this.call("offer",{desc:e,tracks:Object.fromEntries(t)})})}answer(e){this.notify("answer",{desc:e})}trackUpdate(e){this.notify("track-update",{tracks:Object.fromEntries(e)})}broadcast(e){return f(this,null,function*(){return yield this.call("broadcast",e)})}leave(){this.notify("leave",{})}endRoom(e,t){return f(this,null,function*(){yield this.call("end-room",{lock:e,reason:t})})}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify("analytics",e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise(n=>{setTimeout(()=>{n(Date.now()-t)},e+1)}),r=this.internalCall("ping",{timestamp:t}).then(()=>Date.now()-t).catch(()=>Date.now()-t);return Promise.race([i,r])}requestRoleChange(e){return f(this,null,function*(){yield this.call("role-change-request",e)})}requestBulkRoleChange(e){return f(this,null,function*(){yield this.call("role-change-request",e)})}acceptRoleChangeRequest(e){return f(this,null,function*(){yield this.call("role-change",e)})}requestTrackStateChange(e){return f(this,null,function*(){yield this.call("track-update-request",e)})}requestMultiTrackStateChange(e){return f(this,null,function*(){yield this.call("change-track-mute-state-request",e)})}removePeer(e){return f(this,null,function*(){yield this.call("peer-leave-request",e)})}startRTMPOrRecording(e){return f(this,null,function*(){yield this.call("rtmp-start",H({},e))})}stopRTMPAndRecording(){return f(this,null,function*(){yield this.call("rtmp-stop",{})})}startHLSStreaming(e){return f(this,null,function*(){yield this.call("hls-start",H({},e))})}stopHLSStreaming(e){return f(this,null,function*(){yield this.call("hls-stop",H({},e))})}sendHLSTimedMetadata(e){return f(this,null,function*(){yield this.call("hls-timed-metadata",H({},e))})}updatePeer(e){return f(this,null,function*(){yield this.call("peer-update",H({},e))})}getPeer(e){return f(this,null,function*(){yield this.call("get-peer",H({},e))})}joinGroup(e){return f(this,null,function*(){return yield this.call("group-join",{name:e})})}leaveGroup(e){return f(this,null,function*(){return yield this.call("group-leave",{name:e})})}addToGroup(e,t){return f(this,null,function*(){yield this.call("group-add",{name:t,peer_id:e})})}removeFromGroup(e,t){return f(this,null,function*(){yield this.call("group-remove",{name:t,peer_id:e})})}peerIterNext(e){return f(this,null,function*(){return yield this.call("peer-iter-next",e)})}findPeers(e){return f(this,null,function*(){return yield this.call("find-peer",e)})}setSessionMetadata(e){if(!this.isConnected)throw G.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("set-metadata",H({},e))}listenMetadataChange(e){if(!this.isConnected)throw G.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to observe session store key due to network disconnection");return this.call("listen-metadata-change",{keys:e})}getSessionMetadata(e){if(!this.isConnected)throw G.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("get-metadata",{key:e})}setPollInfo(e){return this.call("poll-info-set",H({},e))}getPollInfo(e){return this.call("poll-info-get",H({},e))}setPollQuestions(e){return this.call("poll-questions-set",H({},e))}startPoll(e){return this.call("poll-start",H({},e))}stopPoll(e){return this.call("poll-stop",H({},e))}getPollQuestions(e){return this.call("poll-questions-get",H({},e))}setPollResponses(e){return this.call("poll-response",H({},e))}getPollResponses(e){return this.call("poll-responses",H({},e))}getPollsList(e){return this.call("poll-list",H({},e))}getPollResult(e){return this.call("poll-result",H({},e))}createWhiteboard(e){return this.validateConnection(),this.call("whiteboard-create",H({},e))}getWhiteboard(e){return this.validateConnection(),this.call("whiteboard-get",H({},e))}fetchPollLeaderboard(e){return this.call("poll-leaderboard",H({},e))}validateConnection(){if(!this.isConnected)throw G.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to send message due to network disconnection")}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(this.resolvePingOnAnyResponse(),i.id)this.handleResponseWithId(i);else if(i.method)this.handleResponseWithMethod(i);else throw Error(`WebSocket message has no 'method' or 'id' field, message=${i}`)}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let r=this.callbacks.get(i);this.callbacks.delete(i),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case"offer":this.observer.onOffer(e.params);break;case"trickle":this.observer.onTrickle(e.params);break;case"on-error":this.observer.onServerError(G.WebsocketMethodErrors.ServerErrors(Number(e.params.code),"on-error",e.params.message));break;case"on-warning":y.w(this.TAG,e.params);break;default:this.observer.onNotification(e);break}}rejectPendingCalls(e=""){this.callbacks.forEach((t,i)=>{var r,n,s,o;((r=t.metadata)==null?void 0:r.method)!=="ping"&&(y.e(this.TAG,`rejecting pending callback ${(n=t.metadata)==null?void 0:n.method}, id=${i}`),t.reject(G.WebSocketConnectionErrors.WebSocketConnectionLost((s=t.metadata)!=null&&s.method?cp((o=t.metadata)==null?void 0:o.method):"RECONNECT_SIGNAL",e)),this.callbacks.delete(i))})}pingPongLoop(e){return f(this,null,function*(){var t,i;let r=((t=window.HMS)==null?void 0:t.PING_TIMEOUT)||12e3;if(this.isConnected){let n=yield this.ping(r);this.pongResponseTimes.enqueue(n),n>r?(y.d(this.TAG,`Pong timeout ${e}, pageHidden=${Q0()}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(()=>this.pingPongLoop(e),((i=window.HMS)==null?void 0:i.PING_INTERVAL)||3e3)}})}call(e,t){return f(this,null,function*(){let i=G.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`);this.validateConnection();let r;for(r=1;r<=3;r++)try{return y.d(this.TAG,`Try number ${r} sending ${e}`,t),yield this.internalCall(e,t)}catch(n){if(i=n,y.e(this.TAG,`Failed sending ${e} try: ${r}`,{method:e,params:t,error:i}),!(parseInt(`${i.code/100}`)===5||i.code===429))break;let s=(2+Math.random()*2)*1e3;yield Ka(s)}throw y.e(`Sending ${e} over WS failed after ${Math.min(r,3)} retries`,{method:e,params:t,error:i}),i})}},WC=()=>{if(!jt||typeof navigator.connection>"u")return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}},ge="[HMSTransport]:",HC=class{constructor(e,t,i,r,n,s,o){this.observer=e,this.deviceManager=t,this.store=i,this.eventBus=r,this.analyticsEventsService=n,this.analyticsTimer=s,this.pluginUsageTracker=o,this.state="Disconnected",this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:c=>f(this,null,function*(){try{if(!this.subscribeConnection)return;yield this.subscribeConnection.setRemoteDescription(c),y.d(ge,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let p of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(p);this.subscribeConnection.candidates.length=0;let h=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(h),this.signal.answer(h),y.d(ge,"[role=SUBSCRIBE] onOffer renegotiation DONE ")}catch(h){y.d(ge,"[role=SUBSCRIBE] onOffer renegotiation FAILED ",h),this.state="Failed";let p;h instanceof ue?p=h:p=G.GenericErrors.Unknown("PUBLISH",h.message),this.observer.onFailure(p),this.eventBus.analytics.publish(ke.subscribeFail(p))}}),onTrickle:c=>f(this,null,function*(){let h=c.target===0?this.publishConnection:this.subscribeConnection;h!=null&&h.remoteDescription?yield h.addIceCandidate(c.candidate):h==null||h.candidates.push(c.candidate)}),onNotification:c=>this.observer.onNotification(c),onServerError:c=>f(this,null,function*(){yield this.observer.onStateChange("Failed",c)}),onFailure:c=>{this.joinParameters&&this.retryScheduler.schedule({category:1,error:c,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:c=>f(this,null,function*(){y.d(ge,"socket offline",Zu[this.state]);try{this.state!=="Leaving"&&this.joinParameters&&this.retryScheduler.schedule({category:1,error:G.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL",c),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(h){console.error(h)}}),onOnline:()=>{var c;y.d(ge,"socket online",Zu[this.state]),this.analyticsSignalTransport.flushFailedEvents((c=this.store.getLocalPeer())==null?void 0:c.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new VC(this.signalObserver),this.analyticsSignalTransport=new IC(this.signal),this.publishDtlsStateTimer=0,this.lastPublishDtlsState="new",this.publishConnectionObserver={onRenegotiationNeeded:()=>f(this,null,function*(){yield this.performPublishRenegotiation()}),onDTLSTransportStateChange:c=>{var h,p,S;if((c==="failed"?y.w.bind(y):y.d.bind(y))(ge,`Publisher on dtls transport state change: ${c}`),!c||this.lastPublishDtlsState===c||(this.lastPublishDtlsState=c,this.publishDtlsStateTimer!==0&&(clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0),c!=="connecting"&&c!=="failed"))return;let k=(S=(p=(h=this.initConfig)==null?void 0:h.config)==null?void 0:p.dtlsStateTimeouts)==null?void 0:S[c];!k||k<=0||(this.publishDtlsStateTimer=window.setTimeout(()=>{var E;let O=(E=this.publishConnection)==null?void 0:E.nativeConnection.connectionState;if(O&&c&&O===c){let I=G.WebrtcErrors.ICEFailure("PUBLISH",`DTLS transport state ${c} timeout:${k}ms`,!0);this.eventBus.analytics.publish(ke.disconnect(I)),this.observer.onFailure(I)}},k))},onDTLSTransportError:c=>{y.e(ge,`onDTLSTransportError ${c.name} ${c.message}`,c),this.eventBus.analytics.publish(ke.disconnect(c))},onIceConnectionChange:c=>f(this,null,function*(){(c==="disconnected"?y.w.bind(y):y.d.bind(y))(ge,`Publish ice connection state change: ${c}`)}),onConnectionStateChange:c=>f(this,null,function*(){var h,p,S,k,E;(c==="disconnected"?y.w.bind(y):y.d.bind(y))(ge,`Publish connection state change: ${c}`),c==="connected"&&((h=this.publishConnection)==null||h.logSelectedIceCandidatePairs()),c==="disconnected"&&setTimeout(()=>{var O,I,R,A,M;((O=this.publishConnection)==null?void 0:O.connectionState)==="disconnected"&&this.handleIceConnectionFailure(0,G.WebrtcErrors.ICEDisconnected("PUBLISH",`local candidate - ${(R=(I=this.publishConnection)==null?void 0:I.selectedCandidatePair)==null?void 0:R.local.candidate}; remote candidate - ${(M=(A=this.publishConnection)==null?void 0:A.selectedCandidatePair)==null?void 0:M.remote.candidate}`))},5e3),c==="failed"&&(yield this.handleIceConnectionFailure(0,G.WebrtcErrors.ICEFailure("PUBLISH",`local candidate - ${(S=(p=this.publishConnection)==null?void 0:p.selectedCandidatePair)==null?void 0:S.local.candidate}; remote candidate - ${(E=(k=this.publishConnection)==null?void 0:k.selectedCandidatePair)==null?void 0:E.remote.candidate}`)))})},this.subscribeConnectionObserver={onApiChannelMessage:c=>{this.observer.onNotification(JSON.parse(c))},onTrackAdd:c=>{y.d(ge,"[Subscribe] onTrackAdd",`${c}`),this.observer.onTrackAdd(c)},onTrackRemove:c=>{y.d(ge,"[Subscribe] onTrackRemove",`${c}`),this.observer.onTrackRemove(c)},onIceConnectionChange:c=>f(this,null,function*(){if((c==="disconnected"?y.w.bind(y):y.d.bind(y))(ge,`Subscribe ice connection state change: ${c}`),c==="connected"){let h=this.callbacks.get(ns);this.callbacks.delete(ns),h&&h.promise.resolve(!0)}}),onConnectionStateChange:c=>f(this,null,function*(){var h,p,S,k;(c==="disconnected"?y.w.bind(y):y.d.bind(y))(ge,`Subscribe connection state change: ${c}`),c==="failed"&&(yield this.handleIceConnectionFailure(1,G.WebrtcErrors.ICEFailure("SUBSCRIBE",`local candidate - ${(p=(h=this.subscribeConnection)==null?void 0:h.selectedCandidatePair)==null?void 0:p.local.candidate}; remote candidate - ${(k=(S=this.subscribeConnection)==null?void 0:S.selectedCandidatePair)==null?void 0:k.remote.candidate}`))),c==="disconnected"&&setTimeout(()=>{var E,O,I,R,A;((E=this.subscribeConnection)==null?void 0:E.connectionState)==="disconnected"&&this.handleIceConnectionFailure(1,G.WebrtcErrors.ICEDisconnected("SUBSCRIBE",`local candidate - ${(I=(O=this.subscribeConnection)==null?void 0:O.selectedCandidatePair)==null?void 0:I.local.candidate}; remote candidate - ${(A=(R=this.subscribeConnection)==null?void 0:R.selectedCandidatePair)==null?void 0:A.remote.candidate}`))},5e3),c==="connected"&&this.handleSubscribeConnectionConnected()})},this.handleLocalRoleUpdate=c=>f(this,[c],function*({oldRole:h,newRole:p}){!this.doesRoleNeedWebRTC(h)&&this.doesRoleNeedWebRTC(p)&&(y.d(ge,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation "),this.createPeerConnections(),yield this.negotiateOnFirstPublish())}),this.retryPublishIceFailedTask=()=>f(this,null,function*(){if(this.publishConnection){let c=new Promise((h,p)=>{this.callbacks.set(rs,{promise:{resolve:h,reject:p},action:"RESTART_ICE",extra:{}})});yield this.performPublishRenegotiation({iceRestart:this.publishConnection.connectionState!=="connected"}),yield c}return!0}),this.retrySubscribeIceFailedTask=()=>f(this,null,function*(){if(this.subscribeConnection&&this.subscribeConnection.connectionState!=="connected"){let c=new Promise((p,S)=>{this.callbacks.set(ns,{promise:{resolve:p,reject:S},action:"RESTART_ICE",extra:{}})}),h=new Promise(p=>{setTimeout(p,6e4,!1)});return Promise.race([c,h])}return!0}),this.retrySignalDisconnectTask=()=>f(this,null,function*(){var c;y.d(ge,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected||(yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId));let h=(c=this.store.getRoom())!=null&&c.joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),h});var a,l;this.webrtcInternals=new tb(this.store,this.eventBus,(a=this.publishConnection)==null?void 0:a.nativeConnection,(l=this.subscribeConnection)==null?void 0:l.nativeConnection);let u=(c,h)=>f(this,null,function*(){c!==this.state&&(this.state=c,yield this.observer.onStateChange(this.state,h))});this.retryScheduler=new RC(u,this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(c=>{var h,p;let S=((p=(h=c.getLocalPeerStats())==null?void 0:h.subscribe)==null?void 0:p.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,S)}),this.eventBus.localAudioEnabled.subscribe(({track:c})=>this.trackUpdate(c)),this.eventBus.localVideoEnabled.subscribe(({track:c})=>this.trackUpdate(c))}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let i=(t=this.initConfig)==null?void 0:t.config;return((i==null?void 0:i.enabledFlags)||[]).includes(e)}preview(e,t,i,r,n=!1){return f(this,null,function*(){let s=yield this.connect(e,t,i,r,n);return this.state="Preview",this.observer.onStateChange(this.state),s})}join(e,t,i,r,n=!1){return f(this,null,function*(){y.d(ge,"join: started ");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,r,t,i,n)),this.validateNotDisconnected("connect"),this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(i,n),yield this.initRtcStatsMonitor(),y.d(ge," join: Negotiated over PUBLISH connection"))}catch(s){y.e(ge,`join: failed  [token=${e}]`,s),this.state="Failed";let o=s;throw o.isTerminal=o.isTerminal||o.code===500,yield this.observer.onStateChange(this.state,o),o}y.d(ge," join: successful"),this.state="Joined",this.observer.onStateChange(this.state)})}connect(e,t,i,r,n=!1){return f(this,null,function*(){this.setTransportStateForConnect(),this.joinParameters=new EC(e,i,r.name,r.metaData,t,n);try{return yield this.internalConnect(e,t,i)}catch(s){if(s instanceof ue&&([he.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,he.WebSocketConnectionErrors.FAILED_TO_CONNECT,he.WebSocketConnectionErrors.ABNORMAL_CLOSE,he.APIErrors.ENDPOINT_UNREACHABLE].includes(s.code)||s.code.toString().startsWith("5")||s.code.toString().startsWith("429"))){let o=()=>f(this,null,function*(){return yield this.internalConnect(e,t,i),!!(this.initConfig&&this.initConfig.endpoint)});yield this.retryScheduler.schedule({category:0,error:s,task:o,originalState:this.state,maxFailedRetries:5,changeState:!1})}else throw s}})}leave(e){return f(this,null,function*(){var t,i,r,n,s;this.retryScheduler.reset(),this.joinParameters=void 0,y.d(ge,"leaving in transport");try{let o=this.pluginUsageTracker.getPluginUsage("HMSKrispPlugin");if(o&&this.eventBus.analytics.publish(ke.getKrispUsage(o)),this.state="Leaving",(t=this.publishStatsAnalytics)==null||t.stop(),(i=this.subscribeStatsAnalytics)==null||i.stop(),(r=this.webrtcInternals)==null||r.cleanup(),yield(n=this.publishConnection)==null?void 0:n.close(),yield(s=this.subscribeConnection)==null?void 0:s.close(),e)try{this.signal.leave(),y.d(ge,"signal leave done")}catch(a){y.w(ge,"failed to send leave on websocket to server",a)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(o){this.eventBus.analytics.publish(ke.disconnect(o)),y.e(ge,"leave: FAILED ",o)}finally{this.state="Disconnected",this.observer.onStateChange(this.state)}})}publish(e){return f(this,null,function*(){for(let t of e)try{yield this.publishTrack(t)}catch(i){this.eventBus.analytics.publish(ke.publish({devices:this.deviceManager.getDevices(),error:i}))}})}unpublish(e){return f(this,null,function*(){for(let t of e)yield this.unpublishTrack(t)})}trackUpdate(e){let t=Array.from(this.trackStates.values()).find(i=>e.type===i.type&&e.source===i.source);if(t){let i=new Ap(Ee(H({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,i),y.d(ge,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,i]]))}}publishTrack(e){return f(this,null,function*(){e.publishedTrackId=e.getTrackIDBeingSent(),y.d(ge,` publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new Ap(e));let t=new Promise((n,s)=>{this.callbacks.set(rs,{promise:{resolve:n,reject:s},action:"PUBLISH",extra:{}})}),i=e.stream;i.setConnection(this.publishConnection);let r=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,r),y.time(`publish-${e.trackId}-${e.type}`),yield t,y.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e),yield i.setMaxBitrateAndFramerate(e).then(()=>{y.d(ge,`Setting maxBitrate=${e.settings.maxBitrate} kpbs${e instanceof mi?` and maxFramerate=${e.settings.maxFramerate}`:""} for ${e.source} ${e.type} ${e.trackId}`)}).catch(n=>y.w(ge,"Failed setting maxBitrate and maxFramerate",n)),e.isPublished=!0,y.d(ge,` publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)})}unpublishTrack(e){return f(this,null,function*(){if(y.d(ge,` unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let i=Array.from(this.trackStates.values()).find(r=>e.type===r.type&&e.source===r.source);i&&this.trackStates.delete(i.track_id)}let t=new Promise((i,r)=>{this.callbacks.set(rs,{promise:{resolve:i,reject:r},action:"UNPUBLISH",extra:{}})});e.stream.removeSender(e),yield t,yield e.cleanup(),this.store.removeTrack(e),y.d(ge,` unpublishTrack: trackId=${e.trackId}`,this.callbacks)})}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise(e=>{this.eventBus.policyChange.subscribeOnce(()=>e())})}createConnectionsAndNegotiateJoin(e,t=!1){return f(this,null,function*(){let i=this.doesLocalPeerNeedWebRTC();i&&this.createPeerConnections(),this.analyticsTimer.start("join_response_time"),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:i}),this.analyticsTimer.end("join_response_time")})}createPeerConnections(){this.initConfig&&(this.publishConnection||(this.publishConnection=new FC(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver)),this.subscribeConnection||(this.subscribeConnection=new BC(this.signal,this.initConfig.rtcConfiguration,this.isFlagEnabled.bind(this),this.subscribeConnectionObserver)))}negotiateJoinWithRetry(e){return f(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,isWebRTC:n=!0}){try{yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,isWebRTC:n})}catch(s){y.e(ge,"Join negotiation failed ",s);let o=s instanceof ue?s:G.WebsocketMethodErrors.ServerErrors(500,"JOIN",`Websocket join error - ${s.message}`),a=parseInt(`${o.code/100}`)===5||[he.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,429].includes(o.code);if(o.code===410&&(o.isTerminal=!0),a){this.joinRetryCount=0,o.isTerminal=!1;let l=()=>f(this,null,function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,isWebRTC:n})});yield this.retryScheduler.schedule({category:2,error:o,task:l,originalState:"Joined",maxFailedRetries:3,changeState:!1})}else throw s}})}negotiateJoin(e){return f(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,isWebRTC:n=!0}){return n?yield this.negotiateJoinWebRTC({name:t,data:i,autoSubscribeVideo:r}):yield this.negotiateJoinNonWebRTC({name:t,data:i,autoSubscribeVideo:r})})}negotiateJoinWebRTC(e){return f(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r}){if(y.d(ge," join: Negotiating over PUBLISH connection"),!this.publishConnection)return y.e(ge,"Publish peer connection not found, cannot negotiate"),!1;let n=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(n);let s=this.isFlagEnabled("subscribeDegradation"),o=this.isFlagEnabled("simulcast"),a=this.isFlagEnabled("onDemandTracks"),l=yield this.signal.join(t,i,!r,s,o,a,n);yield this.publishConnection.setRemoteDescription(l);for(let u of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(u);return this.publishConnection.initAfterJoin(),!!l})}negotiateJoinNonWebRTC(e){return f(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r}){y.d(ge," join: Negotiating Non-WebRTC");let n=this.isFlagEnabled("subscribeDegradation"),s=this.isFlagEnabled("simulcast"),o=this.isFlagEnabled("onDemandTracks");return!!(yield this.signal.join(t,i,!r,n,s,o))})}negotiateOnFirstPublish(){return f(this,null,function*(){if(y.d(ge," Negotiating offer over PUBLISH connection"),!this.publishConnection)return y.e(ge,"Publish peer connection not found, cannot negotiate"),!1;let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let i of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(i);return this.publishConnection.initAfterJoin(),!!t})}performPublishRenegotiation(e){return f(this,null,function*(){y.d(ge," [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(rs);if(t){if(!this.publishConnection){y.e(ge,"Publish peer connection not found, cannot renegotiate");return}try{let i=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(i),y.time("renegotiation-offer-exchange");let r=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(rs),y.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(r),t.promise.resolve(!0),y.d(ge,"[role=PUBLISH] onRenegotiationNeeded DONE ")}catch(i){let r;i instanceof ue?r=i:r=G.GenericErrors.Unknown("PUBLISH",i.message),t.promise.reject(r),y.d(ge,"[role=PUBLISH] onRenegotiationNeeded FAILED ")}}})}handleIceConnectionFailure(e,t){return f(this,null,function*(){this.retryScheduler.isTaskInProgress(4)||(e===0?this.retryScheduler.schedule({category:3,error:t,task:this.retryPublishIceFailedTask,originalState:"Joined"}):this.retryScheduler.schedule({category:4,error:t,task:this.retrySubscribeIceFailedTask,originalState:"Joined",maxFailedRetries:1}))})}internalConnect(e,t,i){return f(this,null,function*(){var r;y.d(ge,"connect: started ");let n=new Date;try{this.analyticsTimer.start("init_response_time"),this.initConfig=yield jC.fetchInitConfig({token:e,peerId:i,userAgent:this.store.getUserAgent(),initEndpoint:t});let s=this.store.getRoom();return s&&(s.effectsKey=(r=this.initConfig.config.vb)==null?void 0:r.effectsKey,s.isEffectsEnabled=this.isFlagEnabled("effectsSDKEnabled"),s.isHipaaEnabled=this.isFlagEnabled("hipaa"),s.isNoiseCancellationEnabled=this.isFlagEnabled("noiseCancellation")),this.analyticsTimer.end("init_response_time"),Bs.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),yield this.openSignal(e,i),this.observer.onConnected(),this.store.setSimulcastEnabled(this.isFlagEnabled("simulcast")),y.d(ge,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(s){throw this.state!=="Reconnecting"&&this.eventBus.analytics.publish(ke.connect(s,this.getAdditionalAnalyticsProperties(),n,new Date,t)),y.e(ge," internal connect: failed",s),s}})}validateNotDisconnected(e){if(this.state==="Disconnected")throw y.w(ge,"aborting join as transport state is disconnected"),G.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return f(this,null,function*(){if(!this.initConfig)throw G.APIErrors.InitConfigNotAvailable("INIT","Init Config not found");y.d(ge," internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent_v2",this.store.getUserAgent()),i.searchParams.set("protocol_version",zT),i.searchParams.set("protocol_spec",VT),this.endpoint=i.toString(),this.analyticsTimer.start("ws_connect_time"),yield this.signal.open(this.endpoint),this.analyticsTimer.end("ws_connect_time"),this.analyticsTimer.start("on_policy_change_time"),this.analyticsTimer.start("room_state_time"),y.d(ge," internal connect: connected to ws endpoint")})}initRtcStatsMonitor(){return f(this,null,function*(){var e,t,i;(i=this.webrtcInternals)==null||i.setPeerConnections({publish:(e=this.publishConnection)==null?void 0:e.nativeConnection,subscribe:(t=this.subscribeConnection)==null?void 0:t.nativeConnection}),this.initStatsAnalytics()})}initStatsAnalytics(){var e,t;this.isFlagEnabled("publishStats")&&(this.publishStatsAnalytics=new LC(this.store,this.eventBus,this.getValueFromInitConfig("publishStats","maxSampleWindowSize",30),this.getValueFromInitConfig("publishStats","maxSamplePushInterval",300)),(e=this.getWebrtcInternals())==null||e.start()),this.isFlagEnabled("subscribeStats")&&(this.subscribeStatsAnalytics=new MC(this.store,this.eventBus,this.getValueFromInitConfig("subscribeStats","maxSampleWindowSize",10),this.getValueFromInitConfig("subscribeStats","maxSamplePushInterval",60)),(t=this.getWebrtcInternals())==null||t.start())}getValueFromInitConfig(e,t,i){var r,n;return((n=(r=this.initConfig)==null?void 0:r.config[e])==null?void 0:n[t])||i}doesRoleNeedWebRTC(e){var t,i;if(!this.isFlagEnabled("nonWebRTCDisableOffer"))return!0;let r=!!(e.publishParams.allowed&&((t=e.publishParams.allowed)==null?void 0:t.length)>0),n=!!(e.subscribeParams.subscribeToRoles&&((i=e.subscribeParams.subscribeToRoles)==null?void 0:i.length)>0);return r||n}doesLocalPeerNeedWebRTC(){var e;let t=(e=this.store.getLocalPeer())==null?void 0:e.role;return t?this.doesRoleNeedWebRTC(t):!0}handleSubscribeConnectionConnected(){var e;(e=this.subscribeConnection)==null||e.logSelectedIceCandidatePairs();let t=this.callbacks.get(ns);this.callbacks.delete(ns),t&&t.promise.resolve(!0)}setTransportStateForConnect(){if(this.state==="Failed"&&(this.state="Disconnected"),this.state!=="Disconnected"&&this.state!=="Reconnecting")throw G.WebsocketMethodErrors.AlreadyJoined("JOIN",`Cannot join a meeting in ${this.state} state`);this.state==="Disconnected"&&(this.state="Connecting",this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let i=this.getAdditionalAnalyticsProperties(),r;switch(t){case 0:r=ke.connect(e,i);break;case 1:r=ke.disconnect(e,i);break;case 2:r=ke.join({error:e,time:this.analyticsTimer.getTimeTaken("join_time"),init_response_time:this.analyticsTimer.getTimeTaken("init_response_time"),ws_connect_time:this.analyticsTimer.getTimeTaken("ws_connect_time"),on_policy_change_time:this.analyticsTimer.getTimeTaken("on_policy_change_time"),local_audio_track_time:this.analyticsTimer.getTimeTaken("local_audio_track_time"),local_video_track_time:this.analyticsTimer.getTimeTaken("local_video_track_time"),retries_join:this.joinRetryCount});break;case 3:r=ke.publish({error:e});break;case 4:r=ke.subscribeFail(e);break}this.eventBus.analytics.publish(r)}getSubscribeConnection(){return this.subscribeConnection}getAdditionalAnalyticsProperties(){var e,t,i,r,n,s,o,a;let l=WC(),u=typeof document<"u"&&document.hidden,c=this.store.getRemoteVideoTracks().filter(S=>S.degraded).length,h=(r=(i=(t=(e=this.getWebrtcInternals())==null?void 0:e.getCurrentStats())==null?void 0:t.getLocalPeerStats())==null?void 0:i.publish)==null?void 0:r.bitrate,p=(a=(o=(s=(n=this.getWebrtcInternals())==null?void 0:n.getCurrentStats())==null?void 0:s.getLocalPeerStats())==null?void 0:o.subscribe)==null?void 0:a.bitrate;return{network_info:l,document_hidden:u,num_degraded_tracks:c,bitrate:{publish:h,subscribe:p},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}},qC=(e,t,i)=>f(void 0,null,function*(){let r=Error("something went wrong during fetch");for(let n=0;n<4;n++)try{let s=yield fetch(e,t),o=yield s.clone().json();if(i&&i.length&&!s.ok&&i.includes(o.code))throw G.APIErrors.ServerErrors(o.code,"GET_TOKEN",o.message,!1);return s}catch(s){r=s}throw["Failed to fetch","NetworkError"].some(n=>r.message.includes(n))?G.APIErrors.EndpointUnreachable("GET_TOKEN",r.message):r});function _p(e){if(!e||e.length===0)throw G.APIErrors.InvalidTokenFormat("INIT","Token cannot be an empty string or undefined or null");let t=e.split(".");if(t.length!==3)throw G.APIErrors.InvalidTokenFormat("INIT","Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let r=JSON.parse(i);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(r){throw G.APIErrors.InvalidTokenFormat("INIT",`couldn't parse to json - ${r.message}`)}}var Ip={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isPreviewCalled:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},KC=class{constructor(){this.TAG="[HMSSdk]:",this.transportState="Disconnected",this.analyticsTimer=new BT,this.sdkState=H({},Ip),this.playlistSettings={video:{bitrate:kp},audio:{bitrate:Tp}},this.handleAutoplayError=e=>{var t,i;(i=(t=this.errorListener)==null?void 0:t.onError)==null||i.call(t,e)},this.observer={onNotification:e=>{var t;if(e.method==="on-peer-leave-request"){this.handlePeerLeaveRequest(e.params);return}switch(e.method){case"on-policy-change":this.analyticsTimer.end("on_policy_change_time");break;case"peer-list":this.analyticsTimer.end("peer_list_time"),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled);break;case"room-state":this.analyticsTimer.end("room_state_time");break}(t=this.notificationManager)==null||t.handleNotification(e,this.sdkState.isReconnecting)},onConnected:()=>{this.initNotificationManager()},onTrackAdd:e=>{var t;(t=this.notificationManager)==null||t.handleTrackAdd(e)},onTrackRemove:e=>{var t;(t=this.notificationManager)==null||t.handleTrackRemove(e)},onFailure:e=>{var t;(t=this.errorListener)==null||t.onError(e)},onStateChange:(e,t)=>f(this,null,function*(){var i,r;let n=s=>f(this,null,function*(){var o,a;yield this.internalLeave(!0,s),!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&((a=(o=this.errorListener)==null?void 0:o.onError)==null||a.call(o,s)),this.sdkState.isReconnecting=!1});switch(e){case"Preview":case"Joined":this.initNotificationManager(),this.transportState==="Reconnecting"&&((i=this.listener)==null||i.onReconnected());break;case"Failed":yield n(t);break;case"Reconnecting":this.sdkState.isReconnecting=!0,(r=this.listener)==null||r.onReconnecting(t);break}this.transportState=e,y.d(this.TAG,"Transport State Change",this.transportState)})},this.handlePeerLeaveRequest=e=>{var t;let i=e.requested_by?this.store.getPeerById(e.requested_by):void 0,r={roomEnded:e.room_end,reason:e.reason,requestedBy:i};(t=this.listener)==null||t.onRemovedFromRoom(r),this.internalLeave(!1)},this.handleDeviceChange=e=>{var t,i;e.isUserSelection||(y.d(this.TAG,"Device Change event",e),(i=(t=this.deviceChangeListener)==null?void 0:t.onDeviceChange)==null||i.call(t,e),(()=>{var r,n,s,o;if(e.error&&e.type){let a=e.type.includes("audio")?(r=this.localPeer)==null?void 0:r.audioTrack:(n=this.localPeer)==null?void 0:n.videoTrack;(s=this.errorListener)==null||s.onError(e.error),[he.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,he.TracksErrors.DEVICE_IN_USE,he.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&a&&(a.setEnabled(!1),(o=this.listener)==null||o.onTrackUpdate(2,a,this.localPeer))}})())},this.handleAudioPluginError=e=>{var t;y.e(this.TAG,"Audio Plugin Error event",e),(t=this.errorListener)==null||t.onError(e)},this.handleLocalRoleUpdate=e=>f(this,[e],function*({oldRole:t,newRole:i}){var r;yield this.transport.handleLocalRoleUpdate({oldRole:t,newRole:i}),yield(r=this.roleChangeManager)==null?void 0:r.handleLocalPeerRoleUpdate({oldRole:t,newRole:i}),yield this.interactivityCenter.whiteboard.handleLocalRoleUpdate()}),this.sendAudioPresenceFailed=()=>{let e=G.TracksErrors.NoAudioDetected("PREVIEW");y.w(this.TAG,"Audio Presence Failure",this.transportState,e)},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish(ke.join(Ee(H({error:t},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("join_time"),is_preview_called:e,retries_join:this.transport.joinRetryCount})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(ke.preview(Ee(H({error:e},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("preview_time")})))},this.sendAnalyticsEvent=e=>{this.analyticsEventsService.queue(e).flush()}}initNotificationManager(){this.notificationManager||(this.notificationManager=new bC(this.store,this.eventBus,this.transport,this.listener,this.audioListener))}initStoreAndManagers(){var e;if(this.sdkState.isInitialised){(e=this.notificationManager)==null||e.setListener(this.listener),this.audioSinkManager.setListener(this.listener),this.interactivityCenter.setListener(this.listener);return}this.sdkState.isInitialised=!0,this.store=new eC,this.eventBus=new aC,this.pluginUsageTracker=new nC(this.eventBus),this.wakeLockManager=new tC,this.networkTestManager=new Yb(this.eventBus,this.listener),this.playlistManager=new ab(this,this.eventBus),this.deviceManager=new sC(this.store,this.eventBus),this.audioSinkManager=new rC(this.store,this.deviceManager,this.eventBus),this.audioOutput=new oC(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Ra(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new iC(this.store),this.transport=new HC(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer,this.pluginUsageTracker),this.sessionStore=new CC(this.transport),this.interactivityCenter=new mC(this.transport,this.store,this.listener),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}validateJoined(e){if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION",`Not connected - ${e}`)}sendHLSAnalytics(e){this.sendAnalyticsEvent(ke.hlsPlayerError(e))}refreshDevices(){return f(this,null,function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)})}getWebrtcInternals(){var e;return(e=this.transport)==null?void 0:e.getWebrtcInternals()}getSessionStore(){return this.sessionStore}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return(e=this.store.getRoom())==null?void 0:e.recording}getRTMPState(){var e;return(e=this.store.getRoom())==null?void 0:e.rtmp}getHLSState(){var e;return(e=this.store.getRoom())==null?void 0:e.hls}getTranscriptionState(){var e;return(e=this.store.getRoom())==null?void 0:e.transcriptions}getTemplateAppData(){return this.store.getTemplateAppData()}getInteractivityCenter(){return this.interactivityCenter}getPeerListIterator(e){return new nb(this.transport,this.store,e)}updatePlaylistSettings(e){e.video&&Object.assign(this.playlistSettings.video,e.video),e.audio&&Object.assign(this.playlistSettings.audio,e.audio)}get localPeer(){var e;return(e=this.store)==null?void 0:e.getLocalPeer()}preview(e,t){return f(this,null,function*(){if(hp(),dp(),this.sdkState.isPreviewInProgress)return Promise.reject(G.GenericErrors.PreviewAlreadyInProgress("PREVIEW","Preview already called"));if(["Joined","Reconnecting"].includes(this.transportState))return this.midCallPreview(e.asRole,e.settings);this.analyticsTimer.start("preview_time"),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then(()=>f(this,null,function*(){yield this.initDeviceManagers()}));let i=!1,r=!1,n=setTimeout(()=>{var s,o;(!i||!r)&&((o=(s=this.listener)==null?void 0:s.onNetworkQuality)==null||o.call(s,-1))},3e3);return new Promise((s,o)=>{let a=()=>f(this,null,function*(){var u;if(this.localPeer){let p=e.asRole&&this.store.getPolicyForRole(e.asRole);this.localPeer.asRole=p||this.localPeer.role}let c=yield this.localTrackManager.getTracksToPublish(e.settings);c.forEach(p=>this.setLocalPeerTrack(p)),(u=this.localPeer)!=null&&u.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end("preview_time");let h=this.store.getRoom();h&&t.onPreview(h,c),this.sendPreviewAnalyticsEvent(),s()}),l=u=>{var c;this.analyticsTimer.end("preview_time"),u&&((c=this.errorListener)==null||c.onError(u)),this.sendPreviewAnalyticsEvent(u),this.sdkState.isPreviewInProgress=!1,o(u)};this.eventBus.policyChange.subscribeOnce(a),this.eventBus.leave.subscribeOnce(l),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then(u=>{var c;i=!0,clearTimeout(n),u&&e.captureNetworkQualityInPreview&&this.networkTestManager.start((c=u.config)==null?void 0:c.networkHealth).then(()=>{r=!0})}).catch(l)})})}midCallPreview(e,t){return f(this,null,function*(){var i,r;if(!this.localPeer||this.transportState!=="Joined")throw G.GenericErrors.NotConnected("VALIDATION","Not connected - midCallPreview");let n=e&&this.store.getPolicyForRole(e);if(!n)throw G.GenericErrors.InvalidRole("PREVIEW",`role ${e} does not exist in policy`);this.localPeer.asRole=n;let s=yield this.localTrackManager.getTracksToPublish(t);s.forEach(o=>this.setLocalPeerTrack(o)),(i=this.localPeer)!=null&&i.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),(r=this.listener)==null||r.onPreview(this.store.getRoom(),s)})}cancelMidCallPreview(){return f(this,null,function*(){var e,t,i;if((!this.localPeer||!this.localPeer.isInPreview())&&y.w(this.TAG,"Cannot cancel mid call preview as preview is not in progress"),(e=this.localPeer)!=null&&e.asRole&&this.localPeer.role){let r=this.localPeer.asRole,n=this.localPeer.role;delete this.localPeer.asRole,yield(t=this.roleChangeManager)==null?void 0:t.diffRolesAndPublishTracks({oldRole:r,newRole:n}),(i=this.listener)==null||i.onPeerUpdate(8,this.localPeer)}})}join(e,t){return f(this,null,function*(){var i,r,n,s,o,a;if(hp(),dp(),this.sdkState.isPreviewInProgress)throw G.GenericErrors.NotReady("JOIN","Preview is in progress, can't join");this.analyticsTimer.start("join_time"),this.sdkState.isJoinInProgress=!0;let{roomId:l,userId:u,role:c}=_p(e.authToken),h=((r=(i=this.localPeer)==null?void 0:i.asRole)==null?void 0:r.name)||((s=(n=this.localPeer)==null?void 0:n.role)==null?void 0:s.name);(o=this.networkTestManager)==null||o.stop(),this.listener=t,this.commonSetup(e,l,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),qa.resumeContext();let p=this.store.getConfig();p!=null&&p.autoManageWakeLock&&this.wakeLockManager.acquireLock(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(c),this.localPeer.customerUserId=u,this.localPeer.metadata=e.metaData,delete this.localPeer.asRole):this.createAndAddLocalPeerToStore(e,c,u),this.roleChangeManager=new Xb(this.store,this.transport,this.deviceManager,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),y.d(this.TAG,` Joining room ${l}`),y.time(`join-room-${l}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe),y.d(this.TAG,` Joined room ${l}`),this.analyticsTimer.start("peer_list_time"),yield this.notifyJoin(),this.sdkState.isJoinInProgress=!1,yield this.publish(e.settings,h)}catch(S){throw this.analyticsTimer.end("join_time"),this.sdkState.isJoinInProgress=!1,(a=this.listener)==null||a.onError(S),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled,S),y.e(this.TAG,"Unable to join room",S),S}y.timeEnd(`join-room-${l}`)})}stringifyMetadata(e){e.metaData&&typeof e.metaData!="string"?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanup(){var e,t,i;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanup(),qi.cleanup(),this.playlistManager.cleanup(),(e=this.wakeLockManager)==null||e.cleanup(),Ra.cleanup(),this.notificationManager=void 0,y.cleanup(),this.sdkState=H({},Ip),this.localPeer&&((t=this.localPeer.audioTrack)==null||t.cleanup(),this.localPeer.audioTrack=void 0,(i=this.localPeer.videoTrack)==null||i.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanup(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.handleLocalRoleUpdate)}leave(e){return this.internalLeave(e)}internalLeave(e=!0,t){return f(this,null,function*(){var i,r,n;let s=(i=this.store)==null?void 0:i.getRoom();if(s){for(;(this.sdkState.isPreviewInProgress||this.sdkState.isJoinInProgress)&&!(t!=null&&t.isTerminal);)yield Ka(100);let o=s.id;(r=this.networkTestManager)==null||r.stop(),this.eventBus.leave.publish(t),y.d(this.TAG,` Leaving room ${o}`),yield(n=this.transport)==null?void 0:n.leave(e),this.cleanup(),y.d(this.TAG,` Left room ${o}`)}})}getAuthTokenByRoomCode(e,t){return f(this,null,function*(){let i=(t||{}).endpoint||"https://auth.100ms.live/v2/token";this.analyticsTimer.start("GET_TOKEN");let r=yield qC(i,{method:"POST",body:JSON.stringify({code:e.roomCode,user_id:e.userId})},[429,500,501,502,503,504,505,506,507,508,509,510,511]),n=yield r.json();if(this.analyticsTimer.end("GET_TOKEN"),!r.ok)throw G.APIErrors.ServerErrors(n.code,"GET_TOKEN",n.message,!1);let{token:s}=n;if(!s)throw Error(n.message);return s})}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){return this.store.getPeers()}getPeerMap(){return this.store.getPeerMap()}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return f(this,null,function*(){return yield this.sendMessageInternal({message:e,type:t})})}sendGroupMessage(e,t,i){return f(this,null,function*(){let r=this.store.getKnownRoles();if((t.filter(n=>r[n.name])||[]).length===0)throw G.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return f(this,null,function*(){var r,n;if(((r=this.localPeer)==null?void 0:r.peerId)===t)throw G.GenericErrors.ValidationFailed("Cannot send message to self");let s=!!((n=this.store.getRoom())!=null&&n.large_room_optimization),o=this.store.getPeerById(t);if(!o)if(s){let{peers:a}=yield this.transport.signal.findPeers({peers:[t],limit:1});if(a.length===0)throw G.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);o=Ja(a[0],this.store)}else throw G.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);return yield this.sendMessageInternal({message:e,recipientPeer:o,type:i})})}sendMessageInternal(e){return f(this,arguments,function*({recipientRoles:t,recipientPeer:i,type:r="chat",message:n}){if(n.replace(/\u200b/g," ").trim()==="")throw y.w(this.TAG,"sendMessage","Ignoring empty message send"),G.GenericErrors.ValidationFailed("Empty message not allowed");let s={info:{message:n,type:r}};return t!=null&&t.length&&(s.roles=t.map(o=>o.name)),i!=null&&i.peerId&&(s.peer_id=i.peerId),y.d(this.TAG,"Sending Message: ",s),yield this.transport.signal.broadcast(s)})}startScreenShare(e,t){return f(this,null,function*(){var i,r,n;let s=this.store.getPublishParams();if(!s)return;let{allowed:o}=s;if(!(o&&o.includes("screen"))){y.e(this.TAG,`Role ${(i=this.localPeer)==null?void 0:i.role} cannot share screen`);return}if((n=(r=this.localPeer)==null?void 0:r.auxiliaryTracks)!=null&&n.find(l=>l.source==="screen"))throw Error("Cannot share multiple screens");let a=yield this.getScreenshareTracks(e,t);if(!this.localPeer){y.d(this.TAG,"Screenshared when not connected"),a.forEach(l=>{l.cleanup()});return}yield this.transport.publish(a),a.forEach(l=>{var u,c,h;l.peerId=(u=this.localPeer)==null?void 0:u.peerId,(c=this.localPeer)==null||c.auxiliaryTracks.push(l),(h=this.listener)==null||h.onTrackUpdate(0,l,this.localPeer)})})}stopEndedScreenshare(e){return f(this,null,function*(){y.d(this.TAG," Screenshare ended natively"),yield this.stopScreenShare(),e()})}stopScreenShare(){return f(this,null,function*(){var e;y.d(this.TAG," Screenshare ended from app");let t=(e=this.localPeer)==null?void 0:e.auxiliaryTracks.filter(i=>i.source==="screen");if(t)for(let i of t)yield this.removeTrack(i.trackId)})}addTrack(e,t="regular"){return f(this,null,function*(){var i,r,n,s;if(!e){y.w(this.TAG,"Please pass a valid MediaStreamTrack");return}if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find(h=>h.trackId===e.id))return;let o=e.kind,a=new MediaStream([e]),l=new Ku(a),u=o==="audio"?En:mi,c=new u(l,e,t,this.eventBus);this.setPlaylistSettings({track:e,hmsTrack:c,source:t}),yield(i=this.transport)==null?void 0:i.publish([c]),c.peerId=(r=this.localPeer)==null?void 0:r.peerId,(n=this.localPeer)==null||n.auxiliaryTracks.push(c),(s=this.listener)==null||s.onTrackUpdate(0,c,this.localPeer)})}removeTrack(e,t=!1){return f(this,null,function*(){var i;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot removeTrack");let r=this.localPeer.auxiliaryTracks.findIndex(n=>n.trackId===e);if(r>-1){let n=this.localPeer.auxiliaryTracks[r];n.isPublished?yield this.transport.unpublish([n]):yield n.cleanup(),t||this.stopPlaylist(n),this.localPeer.auxiliaryTracks.splice(r,1),(i=this.listener)==null||i.onTrackUpdate(1,n,this.localPeer)}else y.w(this.TAG,`No track found for ${e}`)})}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){y.level=e}addAudioListener(e){var t;this.audioListener=e,(t=this.notificationManager)==null||t.setAudioListener(e)}addConnectionQualityListener(e){var t;(t=this.notificationManager)==null||t.setConnectionQualityListener(e)}changeRole(e,t,i=!1){return f(this,null,function*(){var r;yield(r=this.transport)==null?void 0:r.signal.requestRoleChange({requested_for:e,role:t,force:i})})}changeRoleOfPeer(e,t,i=!1){return f(this,null,function*(){var r;yield(r=this.transport)==null?void 0:r.signal.requestRoleChange({requested_for:e,role:t,force:i})})}changeRoleOfPeersWithRoles(e,t){return f(this,null,function*(){var i;e.length<=0||!t||(yield(i=this.transport)==null?void 0:i.signal.requestBulkRoleChange({roles:e.map(r=>r.name),role:t,force:!0}))})}acceptChangeRole(e){return f(this,null,function*(){var t,i;yield(i=this.transport)==null?void 0:i.signal.acceptRoleChangeRequest({requested_by:(t=e.requestedBy)==null?void 0:t.peerId,role:e.role.name,token:e.token})})}endRoom(e,t){return f(this,null,function*(){var i;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot end room");yield(i=this.transport)==null?void 0:i.signal.endRoom(e,t),yield this.leave()})}removePeer(e,t){return f(this,null,function*(){var i;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot remove peer");yield(i=this.transport)==null?void 0:i.signal.removePeer({requested_for:e,reason:t})})}startRTMPOrRecording(e){return f(this,null,function*(){var t,i;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start streaming or recording");let r={meeting_url:e.meetingURL,record:e.record};(t=e.rtmpURLs)!=null&&t.length&&(r.rtmp_urls=e.rtmpURLs),e.resolution&&(r.resolution=e.resolution),yield(i=this.transport)==null?void 0:i.signal.startRTMPOrRecording(r)})}stopRTMPAndRecording(){return f(this,null,function*(){var e;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop streaming or recording");yield(e=this.transport)==null?void 0:e.signal.stopRTMPAndRecording()})}startHLSStreaming(e){return f(this,null,function*(){var t;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start HLS streaming");let i={};e&&e.variants&&e.variants.length>0&&(i.variants=e.variants.map(r=>{let n={meeting_url:r.meetingURL};return r.metadata&&(n.metadata=r.metadata),n})),e!=null&&e.recording&&(i.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield(t=this.transport)==null?void 0:t.signal.startHLSStreaming(i)})}stopHLSStreaming(e){return f(this,null,function*(){var t,i,r;if(!this.localPeer)throw G.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop HLS streaming");if(e){let n={variants:(t=e==null?void 0:e.variants)==null?void 0:t.map(s=>{let o={meeting_url:s.meetingURL};return s.metadata&&(o.metadata=s.metadata),o})};yield(i=this.transport)==null?void 0:i.signal.stopHLSStreaming(n)}yield(r=this.transport)==null?void 0:r.signal.stopHLSStreaming()})}sendHLSTimedMetadata(e){return f(this,null,function*(){var t;if(this.validateJoined("sendHLSTimedMetadata"),e.length>0){let i={metadata_objs:e};yield(t=this.transport)==null?void 0:t.signal.sendHLSTimedMetadata(i)}})}changeName(e){return f(this,null,function*(){var t,i;this.validateJoined("changeName");let r=this.store.getLocalPeer();r&&r.name!==e&&(yield(t=this.transport)==null?void 0:t.signal.updatePeer({name:e}),(i=this.notificationManager)==null||i.updateLocalPeer({name:e}))})}changeMetadata(e){return f(this,null,function*(){var t,i;this.validateJoined("changeMetadata"),yield(t=this.transport)==null?void 0:t.signal.updatePeer({data:e}),(i=this.notificationManager)==null||i.updateLocalPeer({metadata:e})})}setSessionMetadata(e){return f(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.setSessionMetadata({key:"default",data:e})})}getSessionMetadata(){return f(this,null,function*(){var e;return(yield(e=this.transport)==null?void 0:e.signal.getSessionMetadata("default")).data})}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return f(this,null,function*(){var i;if(e.type==="video"&&e.source!=="regular"){y.w(this.TAG,"Muting non-regular video tracks is currently not supported");return}if(e.enabled===t){y.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);return}if(!this.store.getTrackById(e.trackId))throw G.GenericErrors.ValidationFailed("No track found for change track state",e);let r=this.store.getPeerByTrackId(e.trackId);if(!r)throw G.GenericErrors.ValidationFailed("No peer found for change track state",e);yield(i=this.transport)==null?void 0:i.signal.requestTrackStateChange({requested_for:r.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})})}changeMultiTrackState(e){return f(this,null,function*(){var t;if(typeof e.enabled!="boolean")throw G.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:r,type:n,source:s}=e;yield(t=this.transport)==null?void 0:t.signal.requestMultiTrackStateChange({value:!i,type:n,source:s,roles:r==null?void 0:r.map(o=>o==null?void 0:o.name)})})}raiseLocalPeerHand(){return f(this,null,function*(){var e;this.validateJoined("raiseLocalPeerHand"),yield(e=this.transport)==null?void 0:e.signal.joinGroup(fn)})}lowerLocalPeerHand(){return f(this,null,function*(){var e;this.validateJoined("lowerLocalPeerHand"),yield(e=this.transport)==null?void 0:e.signal.leaveGroup(fn)})}raiseRemotePeerHand(e){return f(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.addToGroup(e,fn)})}lowerRemotePeerHand(e){return f(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.signal.removeFromGroup(e,fn)})}setFrameworkInfo(e){this.frameworkInfo=H(H({},this.frameworkInfo),e)}attachVideo(e,t){return f(this,null,function*(){let i=this.store.getConfig();i!=null&&i.autoManageVideo?e.attach(t):yield e.addSink(t)})}detachVideo(e,t){return f(this,null,function*(){let i=this.store.getConfig();i!=null&&i.autoManageVideo?e.detach(t):yield e.removeSink(t)})}publish(e,t){return f(this,null,function*(){var i,r,n;if([this.store.getPublishParams(),!this.sdkState.published,!ad].every(s=>!!s)){let s=t&&t!==((r=(i=this.localPeer)==null?void 0:i.role)==null?void 0:r.name)?()=>{var o;return(o=this.roleChangeManager)==null?void 0:o.diffRolesAndPublishTracks({oldRole:this.store.getPolicyForRole(t),newRole:this.localPeer.role})}:()=>this.getAndPublishTracks(e);yield(n=s==null?void 0:s())==null?void 0:n.catch(o=>{var a;y.e(this.TAG,"Error in publish",o),(a=this.listener)==null||a.onError(o)})}})}getAndPublishTracks(e){return f(this,null,function*(){var t,i;let r=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(r),(i=(t=this.localPeer)==null?void 0:t.audioTrack)==null||i.initAudioLevelMonitor(),this.sdkState.published=!0})}setAndPublishTracks(e){return f(this,null,function*(){var t;for(let i of e)yield this.transport.publish([i]),this.setLocalPeerTrack(i),(t=this.listener)==null||t.onTrackUpdate(0,i,this.localPeer);yield this.initDeviceManagers()})}setLocalPeerTrack(e){var t;switch(e.peerId=(t=this.localPeer)==null?void 0:t.peerId,e.type){case"audio":this.localPeer.audioTrack=e;break;case"video":this.localPeer.videoTrack=e;break}}initDeviceManagers(){return f(this,null,function*(){var e,t,i,r,n;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice((t=(e=this.store.getConfig())==null?void 0:e.settings)==null?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice((r=(i=qi.getSelection())==null?void 0:i.audioOutput)==null?void 0:r.deviceId)),this.audioSinkManager.init((n=this.store.getConfig())==null?void 0:n.audioSinkElementId))})}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanup(),this.audioSinkManager.cleanup()}initPreviewTrackAudioLevelMonitor(){var e;let t=(e=this.localPeer)==null?void 0:e.audioTrack;t==null||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(i=>{var r;let n=i&&i.track.trackId===(t==null?void 0:t.trackId)?[{audioLevel:i.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(n),(r=this.audioListener)==null||r.onAudioLevelUpdate(n)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),i=this.store.getRoom();if(!i){y.w(this.TAG,"notify join - room not present");return}if(i.joinedAt=new Date,t&&(t.joinedAt=i.joinedAt),t!=null&&t.role){this.analyticsTimer.end("join_time"),(e=this.listener)==null||e.onJoin(i);return}return new Promise((r,n)=>{this.eventBus.policyChange.subscribeOnce(()=>{var s;this.analyticsTimer.end("join_time"),(s=this.listener)==null||s.onJoin(i),r()}),this.eventBus.leave.subscribeOnce(s=>{n(s)})})}setUpPreview(e,t){this.listener=t,this.sdkState.isPreviewCalled=!0,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:r,role:n}=_p(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,n,r,e.asRole)}setPlaylistSettings(e){return f(this,arguments,function*({track:t,hmsTrack:i,source:r}){var n,s;if(r==="videoplaylist"){let o={};if(t.kind==="audio")o.maxBitrate=((n=this.playlistSettings.audio)==null?void 0:n.bitrate)||Tp;else{o.maxBitrate=((s=this.playlistSettings.video)==null?void 0:s.bitrate)||kp;let{width:a,height:l}=t.getSettings();o.width=a,o.height=l}yield i.setSettings(o)}else r==="audioplaylist"&&(yield i.setSettings({maxBitrate:64}))})}createAndAddLocalPeerToStore(e,t,i,r){let n=this.store.getPolicyForRole(t),s=r?this.store.getPolicyForRole(r):void 0,o=new ib({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:n,asRole:s||n,type:"regular"});this.store.addPeer(o)}commonSetup(e,t,i){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=i,this.deviceChangeListener=i,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new Qb(t))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return f(this,null,function*(){let i=this.transport.isFlagEnabled("scaleScreenshareBasedOnPixels"),[r,n]=yield this.localTrackManager.getLocalScreen(t,i),s=()=>{this.stopEndedScreenshare(e)},o=[];if(t!=null&&t.audioOnly){if(r.nativeTrack.stop(),!n)throw G.TracksErrors.NothingToReturn("TRACK","Select share audio when sharing screen","No audio found");o.push(n),n.nativeTrack.addEventListener("ended",s)}else o.push(r),r.nativeTrack.addEventListener("ended",s),n&&o.push(n);return o})}stopPlaylist(e){e.source==="audioplaylist"?this.playlistManager.stop("audio"):e.source==="videoplaylist"&&this.playlistManager.stop("video")}},Rg=class Or{constructor(t,i,r){this.getStats=()=>(this.stats||(this.stats=new ZC(this.store,this.sdk)),this.stats),t?this.store=t:this.store=Or.createNewHMSStore(Sg("HMSStore"),Fm),r?this.notifications=r:this.notifications=new Bb(this.store),i?this.actions=i:(this.sdk=new KC,this.actions=new Jb(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Um().version}),this.initialTriggerOnSubscribe=!1,jt&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(Or.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(t,i){let r=P0(()=>i()),n=r.setState;r.setState=a=>{let l=typeof a=="function"?E0(a):a;n(l)};let s=r.getState;r.getState=a=>a?a(s()):s(),Or.compareWithShallowCheckInSubscribe(r);let o=Or.setUpDevtools(r,t);return Ee(H({},r),{namedSetState:o})}static makeStoreTriggerOnSubscribe(t){let i=t.subscribe;t.subscribe=(r,n,s)=>(r(t.getState(n),void 0),i(r,n,s))}static compareWithShallowCheckInSubscribe(t){let i=t.subscribe;t.subscribe=(r,n,s)=>(n||(n=o=>o),s=s||w0,i(r,n,s))}static setUpDevtools(t,i){let r;try{r=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!r)return o=>{t.setState(o)};let n=r.connect(Or.devtoolsOptions(i));n.prefix=i?`${i} > `:"";let s=t.setState;return t.setState=o=>{s(o),n.send(`${n.prefix}setState`,t.getState())},n.subscribe(Or.devtoolsSubscribe(n,t,s)),n.send("setUpStore",t.getState()),(o,a)=>{s(o);let l=a||`${n.prefix}action`;n.send(l,t.getState())}}static devtoolsOptions(t){return{name:t,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(t,i,r){return n=>{var s,o,a,l;if(n.type==="DISPATCH"&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?r(JSON.parse(n.state)):i.setState(JSON.parse(n.state));else if(n.type==="DISPATCH"&&((s=n.payload)==null?void 0:s.type)==="COMMIT")t.init(i.getState());else if(n.type==="DISPATCH"&&((o=n.payload)==null?void 0:o.type)==="IMPORT_STATE"){let u=(a=n.payload.nextLiftedState)==null?void 0:a.actionsById;(((l=n.payload.nextLiftedState)==null?void 0:l.computedStates)||[]).forEach(({state:c},h)=>{let p=u[h]||`${t.prefix}setState`;h===0?t.init(c):(r(c),t.send(p,i.getState()))})}}}},JC=(e,t,i)=>{let r;i.getState(Pi)==="Connected"&&(r=Lp(e,t,i)),i.subscribe(n=>{["Connected","Reconnecting"].includes(n)?r||(r=Lp(e,t,i)):["Disconnected","Failed"].includes(n)&&r&&(XC(t,n),r(),r=void 0)},Pi)},Lp=(e,t,i)=>{var r,n;let s=QC(i,t);(r=e.getWebrtcInternals())==null||r.start();let o=(n=e.getWebrtcInternals())==null?void 0:n.onStatsChange(a=>YC(t,a,i,e));return()=>{s(),o&&o()}},QC=(e,t)=>{let i,r,n;return e.getState(Pn)?t.namedSetState(s=>{s.localPeer.id=e.getState(Pn)},"localpeer-id"):i=e.subscribe(s=>{s&&t.namedSetState(o=>{o.localPeer.id=s},"localpeer-id")},Pn),e.getState(fi)?t.namedSetState(s=>{s.localPeer.videoTrack=e.getState(fi)},"localpeer-videotrack-id"):r=e.subscribe(s=>{s&&t.namedSetState(o=>{o.localPeer.videoTrack=s},"localpeer-videotrack-id")},fi),e.getState(Bi)?t.namedSetState(s=>{s.localPeer.audioTrack=e.getState(Bi)},"localpeer-audiotrack-id"):n=e.subscribe(s=>{s&&t.namedSetState(o=>{o.localPeer.audioTrack=s},"localpeer-audiotrack-id")},Bi),()=>{i==null||i(),r==null||r(),n==null||n()}},YC=(e,t,i,r)=>{let n=i.getState(Xe);e.namedSetState(s=>{let o=i.getState(Pn),a={},l=Object.keys(n).filter(c=>n[c].peerId!==o);for(let c of l){let h=t.getRemoteTrackStats(c);h&&(a[c]=h)}wp(s.remoteTrackStats,a);let u={[o]:t.getLocalPeerStats()};wp(s.peerStats,u),Hb(s.localTrackStats,t.getLocalTrackStats(),r.store.getLocalPeerTracks())},"webrtc-stats")},XC=(e,t="resetState")=>{e.namedSetState(i=>{Object.assign(i,$m())},t)},ZC=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=Rg.createNewHMSStore(Sg("HMSStatsStore"),$m),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(Pi)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getPublishPeerConnection()):this.hmsStore.subscribe(s=>{var o,a;s==="Connected"&&i((a=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:a.getPublishPeerConnection())},Pi)}),this.getSubscribePeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(Pi)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getSubscribePeerConnection()):this.hmsStore.subscribe(s=>{var o,a;s==="Connected"&&i((a=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:a.getSubscribePeerConnection())},Pi)}),this.sdk&&JC(this.sdk,this.store,this.hmsStore)}},eE=e=>e.localPeer.id,tE=e=>e.localPeer.audioTrack,iE=e=>e.localPeer.videoTrack,rE=(e,t)=>t,Ag=(e,t)=>t,nE=e=>e.remoteTrackStats,_g=e=>e.peerStats,Td=e=>e.localTrackStats,wr=K([_g,eE],(e,t)=>e[t]);K(wr,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.packetsLost});K(wr,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.jitter});K(wr,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bitrate});K(wr,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bitrate});K(wr,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.availableOutgoingBitrate});K(wr,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.availableIncomingBitrate});K(wr,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bytesSent});K(wr,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bytesReceived});K([_g,rE],(e,t)=>t?e[t]:void 0);K([nE,Ag],(e,t)=>t?e[t]:void 0);var Ig=K([Td,Ag],(e,t)=>t?e[t]:void 0);K([Td,tE],(e,t)=>{var i;return t?(i=e[t])==null?void 0:i[0]:void 0});Rt(K(Ig,e=>e==null?void 0:e[0]));K([Td,iE],(e,t)=>{var i;return t?(i=e[t])==null?void 0:i[0]:void 0});Rt(K(Ig,e=>e));const sE=typeof window<"u",oE=Re.createContext(null),aE=({children:e,actions:t,store:i,notifications:r,stats:n,isHMSStatsOn:s=!1,leaveOnUnload:o=!0})=>{const a=Re.useMemo(()=>{let l;const u=()=>{throw new Error("modifying store is not allowed")};if(t&&i)l={actions:t,store:Co(Object.assign(Object.assign({},i),{setState:u,destroy:u}))},r&&(l.notifications=r),n&&(l.statsStore=Co({getState:n.getState,subscribe:n.subscribe,setState:u,destroy:u}));else{const c=new Rg;if(l={actions:c.getActions(),store:Co(Object.assign(Object.assign({},c.getStore()),{setState:u,destroy:u})),notifications:c.getNotifications()},s){const h=c.getStats();l.statsStore=Co({getState:h.getState,subscribe:h.subscribe,setState:u,destroy:u})}}return l.actions.setFrameworkInfo({type:"react-web",version:Ul.version,sdkVersion:"0.10.8"}),l},[t,i,r,n,s]);return Re.useEffect(()=>{if(sE&&o){const l=()=>a.actions.leave();return window.addEventListener("unload",l),()=>{window.removeEventListener("unload",l)}}return()=>{}},[o,a]),Ul.createElement(oE.Provider,{value:a},e)};var Lg={exports:{}};(function(e){/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */function t(v,d){if(!v)throw"First parameter is required.";d=d||{type:"video"},d=new i(v,d);var m=this;function C(U){return d.disableLogs||console.log("RecordRTC version: ",m.version),U&&(d=new i(v,U)),d.disableLogs||console.log("started recording "+d.type+" stream."),V?(V.clearRecordedData(),V.record(),j("recording"),m.recordingDuration&&F(),m):(_(function(){m.recordingDuration&&F()}),m)}function _(U){U&&(d.initCallback=function(){U(),U=d.initCallback=null});var Y=new r(v,d);V=new Y(v,d),V.record(),j("recording"),d.disableLogs||console.log("Initialized recorderType:",V.constructor.name,"for output-type:",d.type)}function P(U){if(U=U||function(){},!V){q();return}if(m.state==="paused"){m.resumeRecording(),setTimeout(function(){P(U)},1);return}m.state!=="recording"&&!d.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',m.state),d.disableLogs||console.log("Stopped recording "+d.type+" stream."),d.type!=="gif"?V.stop(Y):(V.stop(),Y()),j("stopped");function Y(re){if(!V){typeof U.call=="function"?U.call(m,""):U("");return}Object.keys(V).forEach(function(ie){typeof V[ie]!="function"&&(m[ie]=V[ie])});var x=V.blob;if(!x)if(re)V.blob=x=re;else throw"Recording failed.";if(x&&!d.disableLogs&&console.log(x.type,"->",I(x.size)),U){var z;try{z=c.createObjectURL(x)}catch{}typeof U.call=="function"?U.call(m,z):U(z)}d.autoWriteToDisk&&Q(function(ie){var ae={};ae[d.type+"Blob"]=ie,He.Store(ae)})}}function L(){if(!V){q();return}if(m.state!=="recording"){d.disableLogs||console.warn("Unable to pause the recording. Recording state: ",m.state);return}j("paused"),V.pause(),d.disableLogs||console.log("Paused recording.")}function w(){if(!V){q();return}if(m.state!=="paused"){d.disableLogs||console.warn("Unable to resume the recording. Recording state: ",m.state);return}j("recording"),V.resume(),d.disableLogs||console.log("Resumed recording.")}function N(U){postMessage(new FileReaderSync().readAsDataURL(U))}function Q(U,Y){if(!U)throw"Pass a callback function over getDataURL.";var re=Y?Y.blob:(V||{}).blob;if(!re){d.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){Q(U,Y)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var x=ie(N);x.onmessage=function(ae){U(ae.data)},x.postMessage(re)}else{var z=new FileReader;z.readAsDataURL(re),z.onload=function(ae){U(ae.target.result)}}function ie(ae){try{var be=c.createObjectURL(new Blob([ae.toString(),"this.onmessage =  function (eee) {"+ae.name+"(eee.data);}"],{type:"application/javascript"})),te=new Worker(be);return c.revokeObjectURL(be),te}catch{}}}function F(U){if(U=U||0,m.state==="paused"){setTimeout(function(){F(U)},1e3);return}if(m.state!=="stopped"){if(U>=m.recordingDuration){P(m.onRecordingStopped);return}U+=1e3,setTimeout(function(){F(U)},1e3)}}function j(U){m&&(m.state=U,typeof m.onStateChanged.call=="function"?m.onStateChanged.call(m,U):m.onStateChanged(U))}var $='It seems that recorder is destroyed or "startRecording" is not invoked for '+d.type+" recorder.";function q(){d.disableLogs!==!0&&console.warn($)}var V,de={startRecording:C,stopRecording:P,pauseRecording:L,resumeRecording:w,initRecorder:_,setRecordingDuration:function(U,Y){if(typeof U>"u")throw"recordingDuration is required.";if(typeof U!="number")throw"recordingDuration must be a number.";return m.recordingDuration=U,m.onRecordingStopped=Y||function(){},{onRecordingStopped:function(re){m.onRecordingStopped=re}}},clearRecordedData:function(){if(!V){q();return}V.clearRecordedData(),d.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!V){q();return}return V.blob},getDataURL:Q,toURL:function(){if(!V){q();return}return c.createObjectURL(V.blob)},getInternalRecorder:function(){return V},save:function(U){if(!V){q();return}R(V.blob,U)},getFromDisk:function(U){if(!V){q();return}t.getFromDisk(d.type,U)},setAdvertisementArray:function(U){d.advertisement=[];for(var Y=U.length,re=0;re<Y;re++)d.advertisement.push({duration:re,image:U[re]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){m.state==="recording"&&!d.disableLogs&&console.warn("Stop an active recorder."),V&&typeof V.clearRecordedData=="function"&&V.clearRecordedData(),V=null,j("inactive"),m.blob=null},onStateChanged:function(U){d.disableLogs||console.log("Recorder state changed:",U)},state:"inactive",getState:function(){return m.state},destroy:function(){var U=d.disableLogs;d={disableLogs:!0},m.reset(),j("destroyed"),de=m=null,X.AudioContextConstructor&&(X.AudioContextConstructor.close(),X.AudioContextConstructor=null),d.disableLogs=U,d.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return m=de,de;for(var fe in de)this[fe]=de[fe];return m=this,de}t.version="5.6.2",e.exports=t,t.getFromDisk=function(v,d){if(!d)throw"callback is mandatory.";console.log("Getting recorded "+(v==="all"?"blobs":v+" blob ")+" from disk!"),He.Fetch(function(m,C){v!=="all"&&C===v+"Blob"&&d&&d(m),v==="all"&&d&&d(m,C.replace("Blob",""))})},t.writeToDisk=function(v){console.log("Writing recorded blob(s) to disk!"),v=v||{},v.audio&&v.video&&v.gif?v.audio.getDataURL(function(d){v.video.getDataURL(function(m){v.gif.getDataURL(function(C){He.Store({audioBlob:d,videoBlob:m,gifBlob:C})})})}):v.audio&&v.video?v.audio.getDataURL(function(d){v.video.getDataURL(function(m){He.Store({audioBlob:d,videoBlob:m})})}):v.audio&&v.gif?v.audio.getDataURL(function(d){v.gif.getDataURL(function(m){He.Store({audioBlob:d,gifBlob:m})})}):v.video&&v.gif?v.video.getDataURL(function(d){v.gif.getDataURL(function(m){He.Store({videoBlob:d,gifBlob:m})})}):v.audio?v.audio.getDataURL(function(d){He.Store({audioBlob:d})}):v.video?v.video.getDataURL(function(d){He.Store({videoBlob:d})}):v.gif&&v.gif.getDataURL(function(d){He.Store({gifBlob:d})})};/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function i(v,d){return!d.recorderType&&!d.type&&(d.audio&&d.video?d.type="video":d.audio&&!d.video&&(d.type="audio")),d.recorderType&&!d.type&&(d.recorderType===Ve||d.recorderType===Oe||typeof b<"u"&&d.recorderType===b?d.type="video":d.recorderType===ve?d.type="gif":d.recorderType===pe?d.type="audio":d.recorderType===ce&&(M(v,"audio").length&&M(v,"video").length||!M(v,"audio").length&&M(v,"video").length?d.type="video":M(v,"audio").length&&!M(v,"video").length&&(d.type="audio"))),typeof ce<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(d.mimeType||(d.mimeType="video/webm"),d.type||(d.type=d.mimeType.split("/")[0]),d.bitsPerSecond),d.type||(d.mimeType&&(d.type=d.mimeType.split("/")[0]),d.type||(d.type="audio")),d}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function r(v,d){var m;return(k||h||p)&&(m=pe),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!k&&(m=ce),d.type==="video"&&(k||p)&&(m=Ve,typeof b<"u"&&typeof ReadableStream<"u"&&(m=b)),d.type==="gif"&&(m=ve),d.type==="canvas"&&(m=Oe),ee()&&m!==Oe&&m!==ve&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(M(v,"video").length||M(v,"audio").length)&&(d.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(m=ce):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(m=ce)),v instanceof Array&&v.length&&(m=ut),d.recorderType&&(m=d.recorderType),!d.disableLogs&&m&&m.name&&console.log("Using recorderType:",m.name||m.constructor.name),!m&&E&&(m=ce),m}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function n(v){this.addStream=function(d){d&&(v=d)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var d=this.mediaType,m,C=this.mimeType||{audio:null,video:null,gif:null};if(typeof d.audio!="function"&&ee()&&!M(v,"audio").length&&(d.audio=!1),typeof d.video!="function"&&ee()&&!M(v,"video").length&&(d.video=!1),typeof d.gif!="function"&&ee()&&!M(v,"video").length&&(d.gif=!1),!d.audio&&!d.video&&!d.gif)throw"MediaStream must have either audio or video tracks.";if(d.audio&&(m=null,typeof d.audio=="function"&&(m=d.audio),this.audioRecorder=new t(v,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:m,mimeType:C.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),d.video||this.audioRecorder.startRecording()),d.video){m=null,typeof d.video=="function"&&(m=d.video);var _=v;if(ee()&&d.audio&&typeof d.audio=="function"){var P=M(v,"video")[0];S?(_=new O,_.addTrack(P),m&&m===Ve&&(m=ce)):(_=new O,_.addTrack(P))}this.videoRecorder=new t(_,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:m,mimeType:C.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),d.audio||this.videoRecorder.startRecording()}if(d.audio&&d.video){var L=this,w=ee()===!0;(d.audio instanceof pe&&d.video||d.audio!==!0&&d.video!==!0&&d.audio!==d.video)&&(w=!1),w===!0?(L.audioRecorder=null,L.videoRecorder.startRecording()):L.videoRecorder.initRecorder(function(){L.audioRecorder.initRecorder(function(){L.videoRecorder.startRecording(),L.audioRecorder.startRecording()})})}d.gif&&(m=null,typeof d.gif=="function"&&(m=d.gif),this.gifRecorder=new t(v,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:m,mimeType:C.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(d){d=d||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(m){d(m,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(m){d(m,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(m){d(m,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(d){var m={};return this.audioRecorder&&(m.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(m.video=this.videoRecorder.getBlob()),this.gifRecorder&&(m.gif=this.gifRecorder.getBlob()),d&&d(m),m},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(d){this.getBlob(function(_){_.audio&&_.video?m(_.audio,function(P){m(_.video,function(L){d({audio:P,video:L})})}):_.audio?m(_.audio,function(P){d({audio:P})}):_.video&&m(_.video,function(P){d({video:P})})});function m(_,P){if(typeof Worker<"u"){var L=C(function(Q){postMessage(new FileReaderSync().readAsDataURL(Q))});L.onmessage=function(N){P(N.data)},L.postMessage(_)}else{var w=new FileReader;w.readAsDataURL(_),w.onload=function(N){P(N.target.result)}}}function C(_){var P=c.createObjectURL(new Blob([_.toString(),"this.onmessage =  function (eee) {"+_.name+"(eee.data);}"],{type:"application/javascript"})),L=new Worker(P),w;if(typeof c<"u")w=c;else if(typeof webkitURL<"u")w=webkitURL;else throw"Neither URL nor webkitURL detected.";return w.revokeObjectURL(P),L}},this.writeToDisk=function(){t.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(d){d=d||{audio:!0,video:!0,gif:!0},d.audio&&this.audioRecorder&&this.audioRecorder.save(typeof d.audio=="string"?d.audio:""),d.video&&this.videoRecorder&&this.videoRecorder.save(typeof d.video=="string"?d.video:""),d.gif&&this.gifRecorder&&this.gifRecorder.save(typeof d.gif=="string"?d.gif:"")}}n.getFromDisk=t.getFromDisk,n.writeToDisk=t.writeToDisk,typeof t<"u"&&(t.MRecordRTC=n);var s="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(v){v&&(typeof window<"u"||typeof _e>"u"||(_e.navigator={userAgent:s,getUserMedia:function(){}},_e.console||(_e.console={}),(typeof _e.console.log>"u"||typeof _e.console.error>"u")&&(_e.console.error=_e.console.log=_e.console.log||function(){console.log(arguments)}),typeof document>"u"&&(v.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var d={getContext:function(){return d},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return d},v.HTMLVideoElement=function(){}),typeof location>"u"&&(v.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(v.screen={width:0,height:0}),typeof c>"u"&&(v.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),v.window=_e))})(typeof _e<"u"?_e:null);var o=window.requestAnimationFrame;if(typeof o>"u"){if(typeof webkitRequestAnimationFrame<"u")o=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")o=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")o=msRequestAnimationFrame;else if(typeof o>"u"){var a=0;o=function(v,d){var m=new Date().getTime(),C=Math.max(0,16-(m-a)),_=setTimeout(function(){v(m+C)},C);return a=m+C,_}}}var l=window.cancelAnimationFrame;typeof l>"u"&&(typeof webkitCancelAnimationFrame<"u"?l=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?l=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?l=msCancelAnimationFrame:typeof l>"u"&&(l=function(v){clearTimeout(v)}));var u=window.AudioContext;typeof u>"u"&&(typeof webkitAudioContext<"u"&&(u=webkitAudioContext),typeof mozAudioContext<"u"&&(u=mozAudioContext));var c=window.URL;typeof c>"u"&&typeof webkitURL<"u"&&(c=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),p=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,S=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),k=!p&&!h&&!!navigator.webkitGetUserMedia||A()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,E=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);E&&!k&&navigator.userAgent.indexOf("CriOS")!==-1&&(E=!1,k=!0);var O=window.MediaStream;typeof O>"u"&&typeof webkitMediaStream<"u"&&(O=webkitMediaStream),typeof O<"u"&&typeof O.prototype.stop>"u"&&(O.prototype.stop=function(){this.getTracks().forEach(function(v){v.stop()})});function I(v){var d=1e3,m=["Bytes","KB","MB","GB","TB"];if(v===0)return"0 Bytes";var C=parseInt(Math.floor(Math.log(v)/Math.log(d)),10);return(v/Math.pow(d,C)).toPrecision(3)+" "+m[C]}function R(v,d){if(!v)throw"Blob object is required.";if(!v.type)try{v.type="video/webm"}catch{}var m=(v.type||"video/webm").split("/")[1];if(m.indexOf(";")!==-1&&(m=m.split(";")[0]),d&&d.indexOf(".")!==-1){var C=d.split(".");d=C[0],m=C[1]}var _=(d||Math.round(Math.random()*9999999999)+888888888)+"."+m;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(v,_);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(v,_);var P=document.createElement("a");P.href=c.createObjectURL(v),P.download=_,P.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(P),typeof P.click=="function"?P.click():(P.target="_blank",P.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),c.revokeObjectURL(P.href)}function A(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function M(v,d){return!v||!v.getTracks?[]:v.getTracks().filter(function(m){return m.kind===(d||"audio")})}function W(v,d){"srcObject"in d?d.srcObject=v:"mozSrcObject"in d?d.mozSrcObject=v:d.srcObject=v}function Z(v,d){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var m=new EBML.Reader,C=new EBML.Decoder,_=EBML.tools,P=new FileReader;P.onload=function(L){var w=C.decode(this.result);w.forEach(function(j){m.read(j)}),m.stop();var N=_.makeMetadataSeekable(m.metadatas,m.duration,m.cues),Q=this.result.slice(m.metadataSize),F=new Blob([N,Q],{type:"video/webm"});d(F)},P.readAsArrayBuffer(v)}typeof t<"u"&&(t.invokeSaveAsDialog=R,t.getTracks=M,t.getSeekableBlob=Z,t.bytesToSize=I,t.isElectron=A);/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var X={};typeof u<"u"?X.AudioContext=u:typeof webkitAudioContext<"u"&&(X.AudioContext=webkitAudioContext),typeof t<"u"&&(t.Storage=X);function ee(){if(S||E||h)return!0;var v=navigator.userAgent,d=""+parseFloat(navigator.appVersion),m=parseInt(navigator.appVersion,10),C,_;return(k||p)&&(C=v.indexOf("Chrome"),d=v.substring(C+7)),(_=d.indexOf(";"))!==-1&&(d=d.substring(0,_)),(_=d.indexOf(" "))!==-1&&(d=d.substring(0,_)),m=parseInt(""+d,10),isNaN(m)&&(d=""+parseFloat(navigator.appVersion),m=parseInt(navigator.appVersion,10)),m>=49}/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function ce(v,d){var F=this;if(typeof v>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(d=d||{mimeType:"video/webm"},d.type==="audio"){if(M(v,"video").length&&M(v,"audio").length){var m;navigator.mozGetUserMedia?(m=new O,m.addTrack(M(v,"audio")[0])):m=new O(M(v,"audio")),v=m}(!d.mimeType||d.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(d.mimeType=k?"audio/webm":"audio/ogg"),d.mimeType&&d.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(d.mimeType="audio/ogg")}var C=[];this.getArrayOfBlobs=function(){return C},this.record=function(){F.blob=null,F.clearRecordedData(),F.timestamps=[],Q=[],C=[];var j=d;d.disableLogs||console.log("Passing following config over MediaRecorder API.",j),w&&(w=null),k&&!ee()&&(j="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&j.mimeType&&(MediaRecorder.isTypeSupported(j.mimeType)||(d.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",j.mimeType),j.mimeType=d.type==="audio"?"audio/webm":"video/webm"));try{w=new MediaRecorder(v,j),d.mimeType=j.mimeType}catch{w=new MediaRecorder(v)}j.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in w&&w.canRecordMimeType(j.mimeType)===!1&&(d.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",j.mimeType)),w.ondataavailable=function($){if($.data&&Q.push("ondataavailable: "+I($.data.size)),typeof d.timeSlice=="number"){if($.data&&$.data.size&&(C.push($.data),_(),typeof d.ondataavailable=="function")){var q=d.getNativeBlob?$.data:new Blob([$.data],{type:P(j)});d.ondataavailable(q)}return}if(!$.data||!$.data.size||$.data.size<100||F.blob){F.recordingCallback&&(F.recordingCallback(new Blob([],{type:P(j)})),F.recordingCallback=null);return}F.blob=d.getNativeBlob?$.data:new Blob([$.data],{type:P(j)}),F.recordingCallback&&(F.recordingCallback(F.blob),F.recordingCallback=null)},w.onstart=function(){Q.push("started")},w.onpause=function(){Q.push("paused")},w.onresume=function(){Q.push("resumed")},w.onstop=function(){Q.push("stopped")},w.onerror=function($){$&&($.name||($.name="UnknownError"),Q.push("error: "+$),d.disableLogs||($.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",$):$.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",j.mimeType,") is not supported.",$):$.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",$):$.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",$):$.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",$):$.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",$):$.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",$):console.error("MediaRecorder Error",$)),function(q){if(!F.manuallyStopped&&w&&w.state==="inactive"){delete d.timeslice,w.start(10*60*1e3);return}setTimeout(q,1e3)}(),w.state!=="inactive"&&w.state!=="stopped"&&w.stop())},typeof d.timeSlice=="number"?(_(),w.start(d.timeSlice)):w.start(36e5),d.initCallback&&d.initCallback()},this.timestamps=[];function _(){F.timestamps.push(new Date().getTime()),typeof d.onTimeStamp=="function"&&d.onTimeStamp(F.timestamps[F.timestamps.length-1],F.timestamps)}function P(j){return w&&w.mimeType?w.mimeType:j.mimeType||"video/webm"}this.stop=function(j){j=j||function(){},F.manuallyStopped=!0,w&&(this.recordingCallback=j,w.state==="recording"&&w.stop(),typeof d.timeSlice=="number"&&setTimeout(function(){F.blob=new Blob(C,{type:P(d)}),F.recordingCallback(F.blob)},100))},this.pause=function(){w&&w.state==="recording"&&w.pause()},this.resume=function(){w&&w.state==="paused"&&w.resume()},this.clearRecordedData=function(){w&&w.state==="recording"&&F.stop(L),L()};function L(){C=[],w=null,F.timestamps=[]}var w;this.getInternalRecorder=function(){return w};function N(){if("active"in v){if(!v.active)return!1}else if("ended"in v&&v.ended)return!1;return!0}this.blob=null,this.getState=function(){return w&&w.state||"inactive"};var Q=[];this.getAllStates=function(){return Q},typeof d.checkForInactiveTracks>"u"&&(d.checkForInactiveTracks=!1);var F=this;(function j(){if(!(!w||d.checkForInactiveTracks===!1)){if(N()===!1){d.disableLogs||console.log("MediaStream seems stopped."),F.stop();return}setTimeout(j,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof t<"u"&&(t.MediaStreamRecorder=ce);/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function pe(v,d){if(!M(v,"audio").length)throw"Your stream has no audio tracks.";d=d||{};var m=this,C=[],_=[],P=!1,L=0,w,N=2,Q=d.desiredSampRate;d.leftChannel===!0&&(N=1),d.numberOfAudioChannels===1&&(N=1),(!N||N<1)&&(N=2),d.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+N),typeof d.checkForInactiveTracks>"u"&&(d.checkForInactiveTracks=!0);function F(){if(d.checkForInactiveTracks===!1)return!0;if("active"in v){if(!v.active)return!1}else if("ended"in v&&v.ended)return!1;return!0}this.record=function(){if(F()===!1)throw"Please make sure MediaStream is active.";re(),z=Y=!1,P=!0,typeof d.timeSlice<"u"&&be()};function j(te,me){function ne(Ae,Le){var ye=Ae.numberOfAudioChannels,le=Ae.leftBuffers.slice(0),Qe=Ae.rightBuffers.slice(0),ct=Ae.sampleRate,dt=Ae.internalInterleavedLength,Tt=Ae.desiredSampRate;ye===2&&(le=li(le,dt),Qe=li(Qe,dt),Tt&&(le=bi(le,Tt,ct),Qe=bi(Qe,Tt,ct))),ye===1&&(le=li(le,dt),Tt&&(le=bi(le,Tt,ct))),Tt&&(ct=Tt);function bi(et,Yt,Ot){var _t=Math.round(et.length*(Yt/Ot)),it=[],ht=Number((et.length-1)/(_t-1));it[0]=et[0];for(var Ii=1;Ii<_t-1;Ii++){var Wn=Ii*ht,Xs=Number(Math.floor(Wn)).toFixed(),Za=Number(Math.ceil(Wn)).toFixed(),el=Wn-Xs;it[Ii]=Gn(et[Xs],et[Za],el)}return it[_t-1]=et[et.length-1],it}function Gn(et,Yt,Ot){return et+(Yt-et)*Ot}function li(et,Yt){for(var Ot=new Float64Array(Yt),_t=0,it=et.length,ht=0;ht<it;ht++){var Ii=et[ht];Ot.set(Ii,_t),_t+=Ii.length}return Ot}function Ys(et,Yt){for(var Ot=et.length+Yt.length,_t=new Float64Array(Ot),it=0,ht=0;ht<Ot;)_t[ht++]=et[it],_t[ht++]=Yt[it],it++;return _t}function Yr(et,Yt,Ot){for(var _t=Ot.length,it=0;it<_t;it++)et.setUint8(Yt+it,Ot.charCodeAt(it))}var Xr;ye===2&&(Xr=Ys(le,Qe)),ye===1&&(Xr=le);var Qi=Xr.length,Pr=44+Qi*2,Rr=new ArrayBuffer(Pr),Ze=new DataView(Rr);Yr(Ze,0,"RIFF"),Ze.setUint32(4,36+Qi*2,!0),Yr(Ze,8,"WAVE"),Yr(Ze,12,"fmt "),Ze.setUint32(16,16,!0),Ze.setUint16(20,1,!0),Ze.setUint16(22,ye,!0),Ze.setUint32(24,ct,!0),Ze.setUint32(28,ct*ye*2,!0),Ze.setUint16(32,ye*2,!0),Ze.setUint16(34,16,!0),Yr(Ze,36,"data"),Ze.setUint32(40,Qi*2,!0);for(var zn=Qi,Yi=44,Xa=1,Vn=0;Vn<zn;Vn++)Ze.setInt16(Yi,Xr[Vn]*(32767*Xa),!0),Yi+=2;if(Le)return Le({buffer:Rr,view:Ze});postMessage({buffer:Rr,view:Ze})}if(te.noWorker){ne(te,function(Ae){me(Ae.buffer,Ae.view)});return}var Ce=$(ne);Ce.onmessage=function(Ae){me(Ae.data.buffer,Ae.data.view),c.revokeObjectURL(Ce.workerURL),Ce.terminate()},Ce.postMessage(te)}function $(te){var me=c.createObjectURL(new Blob([te.toString(),";this.onmessage =  function (eee) {"+te.name+"(eee.data);}"],{type:"application/javascript"})),ne=new Worker(me);return ne.workerURL=me,ne}this.stop=function(te){te=te||function(){},P=!1,j({desiredSampRate:Q,sampleRate:U,numberOfAudioChannels:N,internalInterleavedLength:L,leftBuffers:C,rightBuffers:N===1?[]:_,noWorker:d.noWorker},function(me,ne){m.blob=new Blob([ne],{type:"audio/wav"}),m.buffer=new ArrayBuffer(ne.buffer.byteLength),m.view=ne,m.sampleRate=Q||U,m.bufferSize=fe,m.length=L,z=!1,te&&te(m.blob)})},typeof t.Storage>"u"&&(t.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!t.Storage.AudioContextConstructor||t.Storage.AudioContextConstructor.state==="closed")&&(t.Storage.AudioContextConstructor=new t.Storage.AudioContext);var q=t.Storage.AudioContextConstructor,V=q.createMediaStreamSource(v),de=[0,256,512,1024,2048,4096,8192,16384],fe=typeof d.bufferSize>"u"?4096:d.bufferSize;if(de.indexOf(fe)===-1&&(d.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(de,null,"	"))),q.createJavaScriptNode)w=q.createJavaScriptNode(fe,N,N);else if(q.createScriptProcessor)w=q.createScriptProcessor(fe,N,N);else throw"WebAudio API has no support on this browser.";V.connect(w),d.bufferSize||(fe=w.bufferSize);var U=typeof d.sampleRate<"u"?d.sampleRate:q.sampleRate||44100;(U<22050||U>96e3)&&(d.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),d.disableLogs||d.desiredSampRate&&console.log("Desired sample-rate: "+d.desiredSampRate);var Y=!1;this.pause=function(){Y=!0},this.resume=function(){if(F()===!1)throw"Please make sure MediaStream is active.";if(!P){d.disableLogs||console.log("Seems recording has been restarted."),this.record();return}Y=!1},this.clearRecordedData=function(){d.checkForInactiveTracks=!1,P&&this.stop(x),x()};function re(){C=[],_=[],L=0,z=!1,P=!1,Y=!1,q=null,m.leftchannel=C,m.rightchannel=_,m.numberOfAudioChannels=N,m.desiredSampRate=Q,m.sampleRate=U,m.recordingLength=L,ae={left:[],right:[],recordingLength:0}}function x(){w&&(w.onaudioprocess=null,w.disconnect(),w=null),V&&(V.disconnect(),V=null),re()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var z=!1;function ie(te){if(!Y){if(F()===!1&&(d.disableLogs||console.log("MediaStream seems stopped."),w.disconnect(),P=!1),!P){V&&(V.disconnect(),V=null);return}z||(z=!0,d.onAudioProcessStarted&&d.onAudioProcessStarted(),d.initCallback&&d.initCallback());var me=te.inputBuffer.getChannelData(0),ne=new Float32Array(me);if(C.push(ne),N===2){var Ce=te.inputBuffer.getChannelData(1),Ae=new Float32Array(Ce);_.push(Ae)}L+=fe,m.recordingLength=L,typeof d.timeSlice<"u"&&(ae.recordingLength+=fe,ae.left.push(ne),N===2&&ae.right.push(Ae))}}w.onaudioprocess=ie,q.createMediaStreamDestination?w.connect(q.createMediaStreamDestination()):w.connect(q.destination),this.leftchannel=C,this.rightchannel=_,this.numberOfAudioChannels=N,this.desiredSampRate=Q,this.sampleRate=U,m.recordingLength=L;var ae={left:[],right:[],recordingLength:0};function be(){!P||typeof d.ondataavailable!="function"||typeof d.timeSlice>"u"||(ae.left.length?(j({desiredSampRate:Q,sampleRate:U,numberOfAudioChannels:N,internalInterleavedLength:ae.recordingLength,leftBuffers:ae.left,rightBuffers:N===1?[]:ae.right},function(te,me){var ne=new Blob([me],{type:"audio/wav"});d.ondataavailable(ne),setTimeout(be,d.timeSlice)}),ae={left:[],right:[],recordingLength:0}):setTimeout(be,d.timeSlice))}}typeof t<"u"&&(t.StereoAudioRecorder=pe);/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function Oe(v,d){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";d=d||{},d.frameInterval||(d.frameInterval=10);var m=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(de){de in document.createElement("canvas")&&(m=!0)});var C=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,_=50,P=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);C&&P&&P[2]&&(_=parseInt(P[2],10)),C&&_<52&&(m=!1),d.useWhammyRecorder&&(m=!1);var L,w;if(m)if(d.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),v instanceof HTMLCanvasElement)L=v;else if(v instanceof CanvasRenderingContext2D)L=v.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(d.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var N;this.record=function(){if(N=!0,m&&!d.useWhammyRecorder){var de;"captureStream"in L?de=L.captureStream(25):"mozCaptureStream"in L?de=L.mozCaptureStream(25):"webkitCaptureStream"in L&&(de=L.webkitCaptureStream(25));try{var fe=new O;fe.addTrack(M(de,"video")[0]),de=fe}catch{}if(!de)throw"captureStream API are NOT available.";w=new ce(de,{mimeType:d.mimeType||"video/webm"}),w.record()}else V.frames=[],q=new Date().getTime(),$();d.initCallback&&d.initCallback()},this.getWebPImages=function(de){if(v.nodeName.toLowerCase()!=="canvas"){de();return}var fe=V.frames.length;V.frames.forEach(function(U,Y){var re=fe-Y;d.disableLogs||console.log(re+"/"+fe+" frames remaining"),d.onEncodingCallback&&d.onEncodingCallback(re,fe);var x=U.image.toDataURL("image/webp",1);V.frames[Y].image=x}),d.disableLogs||console.log("Generating WebM"),de()},this.stop=function(de){N=!1;var fe=this;if(m&&w){w.stop(de);return}this.getWebPImages(function(){V.compile(function(U){d.disableLogs||console.log("Recording finished!"),fe.blob=U,fe.blob.forEach&&(fe.blob=new Blob([],{type:"video/webm"})),de&&de(fe.blob),V.frames=[]})})};var Q=!1;this.pause=function(){if(Q=!0,w instanceof ce){w.pause();return}},this.resume=function(){if(Q=!1,w instanceof ce){w.resume();return}N||this.record()},this.clearRecordedData=function(){N&&this.stop(F),F()};function F(){V.frames=[],N=!1,Q=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function j(){var de=document.createElement("canvas"),fe=de.getContext("2d");return de.width=v.width,de.height=v.height,fe.drawImage(v,0,0),de}function $(){if(Q)return q=new Date().getTime(),setTimeout($,500);if(v.nodeName.toLowerCase()==="canvas"){var de=new Date().getTime()-q;q=new Date().getTime(),V.frames.push({image:j(),duration:de}),N&&setTimeout($,d.frameInterval);return}html2canvas(v,{grabMouse:typeof d.showMousePointer>"u"||d.showMousePointer,onrendered:function(fe){var U=new Date().getTime()-q;if(!U)return setTimeout($,d.frameInterval);q=new Date().getTime(),V.frames.push({image:fe.toDataURL("image/webp",1),duration:U}),N&&setTimeout($,d.frameInterval)}})}var q=new Date().getTime(),V=new We.Video(100)}typeof t<"u"&&(t.CanvasRecorder=Oe);/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function Ve(v,d){d=d||{},d.frameInterval||(d.frameInterval=10),d.disableLogs||console.log("Using frames-interval:",d.frameInterval),this.record=function(){d.width||(d.width=320),d.height||(d.height=240),d.video||(d.video={width:d.width,height:d.height}),d.canvas||(d.canvas={width:d.width,height:d.height}),N.width=d.canvas.width||320,N.height=d.canvas.height||240,Q=N.getContext("2d"),d.video&&d.video instanceof HTMLVideoElement?(F=d.video.cloneNode(),d.initCallback&&d.initCallback()):(F=document.createElement("video"),W(v,F),F.onloadedmetadata=function(){d.initCallback&&d.initCallback()},F.width=d.video.width,F.height=d.video.height),F.muted=!0,F.play(),j=new Date().getTime(),$=new We.Video,d.disableLogs||(console.log("canvas resolutions",N.width,"*",N.height),console.log("video width/height",F.width||N.width,"*",F.height||N.height)),m(d.frameInterval)};function m(q){q=typeof q<"u"?q:10;var V=new Date().getTime()-j;if(!V)return setTimeout(m,q,q);if(L)return j=new Date().getTime(),setTimeout(m,100);j=new Date().getTime(),F.paused&&F.play(),Q.drawImage(F,0,0,N.width,N.height),$.frames.push({duration:V,image:N.toDataURL("image/webp")}),P||setTimeout(m,q,q)}function C(q){var V=-1,de=q.length;(function fe(){if(V++,V===de){q.callback();return}setTimeout(function(){q.functionToLoop(fe,V)},1)})()}function _(q,V,de,fe,U){var Y=document.createElement("canvas");Y.width=N.width,Y.height=N.height;var re=Y.getContext("2d"),x=[],z=V===-1,ie=V&&V>0&&V<=q.length?V:q.length,ae={r:0,g:0,b:0},be=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),te=de&&de>=0&&de<=1?de:0,me=fe&&fe>=0&&fe<=1?fe:0,ne=!1;C({length:ie,functionToLoop:function(Ce,Ae){var Le,ye,le,Qe=function(){!ne&&le-Le<=le*me||(z&&(ne=!0),x.push(q[Ae])),Ce()};if(ne)Qe();else{var ct=new Image;ct.onload=function(){re.drawImage(ct,0,0,N.width,N.height);var dt=re.getImageData(0,0,N.width,N.height);Le=0,ye=dt.data.length,le=dt.data.length/4;for(var Tt=0;Tt<ye;Tt+=4){var bi={r:dt.data[Tt],g:dt.data[Tt+1],b:dt.data[Tt+2]},Gn=Math.sqrt(Math.pow(bi.r-ae.r,2)+Math.pow(bi.g-ae.g,2)+Math.pow(bi.b-ae.b,2));Gn<=be*te&&Le++}Qe()},ct.src=q[Ae].image}},callback:function(){x=x.concat(q.slice(ie)),x.length<=0&&x.push(q[q.length-1]),U(x)}})}var P=!1;this.stop=function(q){q=q||function(){},P=!0;var V=this;setTimeout(function(){_($.frames,-1,null,null,function(de){$.frames=de,d.advertisement&&d.advertisement.length&&($.frames=d.advertisement.concat($.frames)),$.compile(function(fe){V.blob=fe,V.blob.forEach&&(V.blob=new Blob([],{type:"video/webm"})),q&&q(V.blob)})})},10)};var L=!1;this.pause=function(){L=!0},this.resume=function(){L=!1,P&&this.record()},this.clearRecordedData=function(){P||this.stop(w),w()};function w(){$.frames=[],P=!0,L=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var N=document.createElement("canvas"),Q=N.getContext("2d"),F,j,$}typeof t<"u"&&(t.WhammyRecorder=Ve);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var We=function(){function v(C){this.frames=[],this.duration=C||1,this.quality=.8}v.prototype.add=function(C,_){if("canvas"in C&&(C=C.canvas),"toDataURL"in C&&(C=C.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(C))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:C,duration:_||this.duration})};function d(C){var _=c.createObjectURL(new Blob([C.toString(),"this.onmessage =  function (eee) {"+C.name+"(eee.data);}"],{type:"application/javascript"})),P=new Worker(_);return c.revokeObjectURL(_),P}function m(C){function _(U){var Y=L(U);if(!Y)return[];for(var re=3e4,x=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:de(Y.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:Y.width,id:176},{data:Y.height,id:186}]}]}]}]}],z=0,ie=0;z<U.length;){var ae=[],be=0;do ae.push(U[z]),be+=U[z].duration,z++;while(z<U.length&&be<re);var te=0,me={id:524531317,data:P(ie,te,ae)};x[1].data.push(me),ie+=be}return F(x)}function P(U,Y,re){return[{data:U,id:231}].concat(re.map(function(x){var z=j({discardable:0,frame:x.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(Y)});return Y+=x.duration,{data:z,id:163}}))}function L(U){if(!U[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var Y=U[0].width,re=U[0].height,x=U[0].duration,z=1;z<U.length;z++)x+=U[z].duration;return{duration:x,width:Y,height:re}}function w(U){for(var Y=[];U>0;)Y.push(U&255),U=U>>8;return new Uint8Array(Y.reverse())}function N(U){return new Uint8Array(U.split("").map(function(Y){return Y.charCodeAt(0)}))}function Q(U){var Y=[],re=U.length%8?new Array(9-U.length%8).join("0"):"";U=re+U;for(var x=0;x<U.length;x+=8)Y.push(parseInt(U.substr(x,8),2));return new Uint8Array(Y)}function F(U){for(var Y=[],re=0;re<U.length;re++){var x=U[re].data;typeof x=="object"&&(x=F(x)),typeof x=="number"&&(x=Q(x.toString(2))),typeof x=="string"&&(x=N(x));var z=x.size||x.byteLength||x.length,ie=Math.ceil(Math.ceil(Math.log(z)/Math.log(2))/8),ae=z.toString(2),be=new Array(ie*7+7+1-ae.length).join("0")+ae,te=new Array(ie).join("0")+"1"+be;Y.push(w(U[re].id)),Y.push(Q(te)),Y.push(x)}return new Blob(Y,{type:"video/webm"})}function j(U){var Y=0;if(U.keyframe&&(Y|=128),U.invisible&&(Y|=8),U.lacing&&(Y|=U.lacing<<1),U.discardable&&(Y|=1),U.trackNum>127)throw"TrackNumber > 127 not supported";var re=[U.trackNum|128,U.timecode>>8,U.timecode&255,Y].map(function(x){return String.fromCharCode(x)}).join("")+U.frame;return re}function $(U){for(var Y=U.RIFF[0].WEBP[0],re=Y.indexOf("*"),x=0,z=[];x<4;x++)z[x]=Y.charCodeAt(re+3+x);var ie,ae,be;return be=z[1]<<8|z[0],ie=be&16383,be=z[3]<<8|z[2],ae=be&16383,{width:ie,height:ae,data:Y,riff:U}}function q(U,Y){return parseInt(U.substr(Y+4,4).split("").map(function(re){var x=re.charCodeAt(0).toString(2);return new Array(8-x.length+1).join("0")+x}).join(""),2)}function V(U){for(var Y=0,re={};Y<U.length;){var x=U.substr(Y,4),z=q(U,Y),ie=U.substr(Y+4+4,z);Y+=8+z,re[x]=re[x]||[],x==="RIFF"||x==="LIST"?re[x].push(V(ie)):re[x].push(ie)}return re}function de(U){return[].slice.call(new Uint8Array(new Float64Array([U]).buffer),0).map(function(Y){return String.fromCharCode(Y)}).reverse().join("")}var fe=new _(C.map(function(U){var Y=$(V(atob(U.image.slice(23))));return Y.duration=U.duration,Y}));postMessage(fe)}return v.prototype.compile=function(C){var _=d(m);_.onmessage=function(P){if(P.data.error){console.error(P.data.error);return}C(P.data)},_.postMessage(this.frames)},{Video:v}}();typeof t<"u"&&(t.Whammy=We);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var He={init:function(){var v=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var d=1,m=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),C,_=indexedDB.open(m,d);function P(w){w.createObjectStore(v.dataStoreName)}function L(){var w=C.transaction([v.dataStoreName],"readwrite");v.videoBlob&&w.objectStore(v.dataStoreName).put(v.videoBlob,"videoBlob"),v.gifBlob&&w.objectStore(v.dataStoreName).put(v.gifBlob,"gifBlob"),v.audioBlob&&w.objectStore(v.dataStoreName).put(v.audioBlob,"audioBlob");function N(Q){w.objectStore(v.dataStoreName).get(Q).onsuccess=function(F){v.callback&&v.callback(F.target.result,Q)}}N("audioBlob"),N("videoBlob"),N("gifBlob")}_.onerror=v.onError,_.onsuccess=function(){if(C=_.result,C.onerror=v.onError,C.setVersion)if(C.version!==d){var w=C.setVersion(d);w.onsuccess=function(){P(C),L()}}else L();else L()},_.onupgradeneeded=function(w){P(w.target.result)}},Fetch:function(v){return this.callback=v,this.init(),this},Store:function(v){return this.audioBlob=v.audioBlob,this.videoBlob=v.videoBlob,this.gifBlob=v.gifBlob,this.init(),this},onError:function(v){console.error(JSON.stringify(v,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof t<"u"&&(t.DiskStorage=He);/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function ve(v,d){if(typeof GIFEncoder>"u"){var m=document.createElement("script");m.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(m)}d=d||{};var C=v instanceof CanvasRenderingContext2D||v instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(q.record,1e3);return}if(!N){setTimeout(q.record,1e3);return}C||(d.width||(d.width=Q.offsetWidth||320),d.height||(d.height=Q.offsetHeight||240),d.video||(d.video={width:d.width,height:d.height}),d.canvas||(d.canvas={width:d.width,height:d.height}),L.width=d.canvas.width||320,L.height=d.canvas.height||240,Q.width=d.video.width||320,Q.height=d.video.height||240),$=new GIFEncoder,$.setRepeat(0),$.setDelay(d.frameRate||200),$.setQuality(d.quality||10),$.start(),typeof d.onGifRecordingStarted=="function"&&d.onGifRecordingStarted();function V(de){if(q.clearedRecordedData!==!0){if(_)return setTimeout(function(){V(de)},100);F=o(V),typeof j===void 0&&(j=de),!(de-j<90)&&(!C&&Q.paused&&Q.play(),C||w.drawImage(Q,0,0,L.width,L.height),d.onGifPreview&&d.onGifPreview(L.toDataURL("image/png")),$.addFrame(w),j=de)}}F=o(V),d.initCallback&&d.initCallback()},this.stop=function(V){V=V||function(){},F&&l(F),this.blob=new Blob([new Uint8Array($.stream().bin)],{type:"image/gif"}),V(this.blob),$.stream().bin=[]};var _=!1;this.pause=function(){_=!0},this.resume=function(){_=!1},this.clearRecordedData=function(){q.clearedRecordedData=!0,P()};function P(){$&&($.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var L=document.createElement("canvas"),w=L.getContext("2d");C&&(v instanceof CanvasRenderingContext2D?(w=v,L=w.canvas):v instanceof HTMLCanvasElement&&(w=v.getContext("2d"),L=v));var N=!0;if(!C){var Q=document.createElement("video");Q.muted=!0,Q.autoplay=!0,Q.playsInline=!0,N=!1,Q.onloadedmetadata=function(){N=!0},W(v,Q),Q.play()}var F=null,j,$,q=this}typeof t<"u"&&(t.GifRecorder=ve);function At(v,d){var m="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(x){typeof t<"u"||x&&(typeof window<"u"||typeof _e>"u"||(_e.navigator={userAgent:m,getUserMedia:function(){}},_e.console||(_e.console={}),(typeof _e.console.log>"u"||typeof _e.console.error>"u")&&(_e.console.error=_e.console.log=_e.console.log||function(){console.log(arguments)}),typeof document>"u"&&(x.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var z={getContext:function(){return z},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return z},x.HTMLVideoElement=function(){}),typeof location>"u"&&(x.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(x.screen={width:0,height:0}),typeof Q>"u"&&(x.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),x.window=_e))})(typeof _e<"u"?_e:null),d=d||"multi-streams-mixer";var C=[],_=!1,P=document.createElement("canvas"),L=P.getContext("2d");P.style.opacity=0,P.style.position="absolute",P.style.zIndex=-1,P.style.top="-1000em",P.style.left="-1000em",P.className=d,(document.body||document.documentElement).appendChild(P),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var w=this,N=window.AudioContext;typeof N>"u"&&(typeof webkitAudioContext<"u"&&(N=webkitAudioContext),typeof mozAudioContext<"u"&&(N=mozAudioContext));var Q=window.URL;typeof Q>"u"&&typeof webkitURL<"u"&&(Q=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var F=window.MediaStream;typeof F>"u"&&typeof webkitMediaStream<"u"&&(F=webkitMediaStream),typeof F<"u"&&typeof F.prototype.stop>"u"&&(F.prototype.stop=function(){this.getTracks().forEach(function(x){x.stop()})});var j={};typeof N<"u"?j.AudioContext=N:typeof webkitAudioContext<"u"&&(j.AudioContext=webkitAudioContext);function $(x,z){"srcObject"in z?z.srcObject=x:"mozSrcObject"in z?z.mozSrcObject=x:z.srcObject=x}this.startDrawingFrames=function(){q()};function q(){if(!_){var x=C.length,z=!1,ie=[];if(C.forEach(function(be){be.stream||(be.stream={}),be.stream.fullcanvas?z=be:ie.push(be)}),z)P.width=z.stream.width,P.height=z.stream.height;else if(ie.length){P.width=x>1?ie[0].width*2:ie[0].width;var ae=1;(x===3||x===4)&&(ae=2),(x===5||x===6)&&(ae=3),(x===7||x===8)&&(ae=4),(x===9||x===10)&&(ae=5),P.height=ie[0].height*ae}else P.width=w.width||360,P.height=w.height||240;z&&z instanceof HTMLVideoElement&&V(z),ie.forEach(function(be,te){V(be,te)}),setTimeout(q,w.frameInterval)}}function V(x,z){if(!_){var ie=0,ae=0,be=x.width,te=x.height;z===1&&(ie=x.width),z===2&&(ae=x.height),z===3&&(ie=x.width,ae=x.height),z===4&&(ae=x.height*2),z===5&&(ie=x.width,ae=x.height*2),z===6&&(ae=x.height*3),z===7&&(ie=x.width,ae=x.height*3),typeof x.stream.left<"u"&&(ie=x.stream.left),typeof x.stream.top<"u"&&(ae=x.stream.top),typeof x.stream.width<"u"&&(be=x.stream.width),typeof x.stream.height<"u"&&(te=x.stream.height),L.drawImage(x,ie,ae,be,te),typeof x.stream.onRender=="function"&&x.stream.onRender(L,ie,ae,be,te,z)}}function de(){_=!1;var x=fe(),z=U();return z&&z.getTracks().filter(function(ie){return ie.kind==="audio"}).forEach(function(ie){x.addTrack(ie)}),v.forEach(function(ie){ie.fullcanvas}),x}function fe(){re();var x;"captureStream"in P?x=P.captureStream():"mozCaptureStream"in P?x=P.mozCaptureStream():w.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var z=new F;return x.getTracks().filter(function(ie){return ie.kind==="video"}).forEach(function(ie){z.addTrack(ie)}),P.stream=z,z}function U(){j.AudioContextConstructor||(j.AudioContextConstructor=new j.AudioContext),w.audioContext=j.AudioContextConstructor,w.audioSources=[],w.useGainNode===!0&&(w.gainNode=w.audioContext.createGain(),w.gainNode.connect(w.audioContext.destination),w.gainNode.gain.value=0);var x=0;if(v.forEach(function(z){if(z.getTracks().filter(function(ae){return ae.kind==="audio"}).length){x++;var ie=w.audioContext.createMediaStreamSource(z);w.useGainNode===!0&&ie.connect(w.gainNode),w.audioSources.push(ie)}}),!!x)return w.audioDestination=w.audioContext.createMediaStreamDestination(),w.audioSources.forEach(function(z){z.connect(w.audioDestination)}),w.audioDestination.stream}function Y(x){var z=document.createElement("video");return $(x,z),z.className=d,z.muted=!0,z.volume=0,z.width=x.width||w.width||360,z.height=x.height||w.height||240,z.play(),z}this.appendStreams=function(x){if(!x)throw"First parameter is required.";x instanceof Array||(x=[x]),x.forEach(function(z){var ie=new F;if(z.getTracks().filter(function(te){return te.kind==="video"}).length){var ae=Y(z);ae.stream=z,C.push(ae),ie.addTrack(z.getTracks().filter(function(te){return te.kind==="video"})[0])}if(z.getTracks().filter(function(te){return te.kind==="audio"}).length){var be=w.audioContext.createMediaStreamSource(z);w.audioDestination=w.audioContext.createMediaStreamDestination(),be.connect(w.audioDestination),ie.addTrack(w.audioDestination.stream.getTracks().filter(function(te){return te.kind==="audio"})[0])}v.push(ie)})},this.releaseStreams=function(){C=[],_=!0,w.gainNode&&(w.gainNode.disconnect(),w.gainNode=null),w.audioSources.length&&(w.audioSources.forEach(function(x){x.disconnect()}),w.audioSources=[]),w.audioDestination&&(w.audioDestination.disconnect(),w.audioDestination=null),w.audioContext&&w.audioContext.close(),w.audioContext=null,L.clearRect(0,0,P.width,P.height),P.stream&&(P.stream.stop(),P.stream=null)},this.resetVideoStreams=function(x){x&&!(x instanceof Array)&&(x=[x]),re(x)};function re(x){C=[],x=x||v,x.forEach(function(z){if(z.getTracks().filter(function(ae){return ae.kind==="video"}).length){var ie=Y(z);ie.stream=z,C.push(ie)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=de}typeof t>"u"&&(e.exports=At);/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */function ut(v,d){v=v||[];var m=this,C,_;d=d||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},d.frameInterval||(d.frameInterval=10),d.video||(d.video={}),d.video.width||(d.video.width=360),d.video.height||(d.video.height=240),this.record=function(){C=new At(v,d.elementClass||"multi-streams-mixer"),P().length&&(C.frameInterval=d.frameInterval||10,C.width=d.video.width||360,C.height=d.video.height||240,C.startDrawingFrames()),d.previewStream&&typeof d.previewStream=="function"&&d.previewStream(C.getMixedStream()),_=new ce(C.getMixedStream(),d),_.record()};function P(){var L=[];return v.forEach(function(w){M(w,"video").forEach(function(N){L.push(N)})}),L}this.stop=function(L){_&&_.stop(function(w){m.blob=w,L(w),m.clearRecordedData()})},this.pause=function(){_&&_.pause()},this.resume=function(){_&&_.resume()},this.clearRecordedData=function(){_&&(_.clearRecordedData(),_=null),C&&(C.releaseStreams(),C=null)},this.addStreams=function(L){if(!L)throw"First parameter is required.";L instanceof Array||(L=[L]),v.concat(L),!(!_||!C)&&(C.appendStreams(L),d.previewStream&&typeof d.previewStream=="function"&&d.previewStream(C.getMixedStream()))},this.resetVideoStreams=function(L){C&&(L&&!(L instanceof Array)&&(L=[L]),C.resetVideoStreams(L))},this.getMixer=function(){return C},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof t<"u"&&(t.MultiStreamRecorder=ut);/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */function g(v,d){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof v>"u")throw'First argument "MediaStream" is required.';var m=this;m.recordRTC=new t(v,d),this.startRecording=function(){return new Promise(function(C,_){try{m.recordRTC.startRecording(),C()}catch(P){_(P)}})},this.stopRecording=function(){return new Promise(function(C,_){try{m.recordRTC.stopRecording(function(P){if(m.blob=m.recordRTC.getBlob(),!m.blob||!m.blob.size){_("Empty blob.",m.blob);return}C(P)})}catch(P){_(P)}})},this.pauseRecording=function(){return new Promise(function(C,_){try{m.recordRTC.pauseRecording(),C()}catch(P){_(P)}})},this.resumeRecording=function(){return new Promise(function(C,_){try{m.recordRTC.resumeRecording(),C()}catch(P){_(P)}})},this.getDataURL=function(C){return new Promise(function(_,P){try{m.recordRTC.getDataURL(function(L){_(L)})}catch(L){P(L)}})},this.getBlob=function(){return new Promise(function(C,_){try{C(m.recordRTC.getBlob())}catch(P){_(P)}})},this.getInternalRecorder=function(){return new Promise(function(C,_){try{C(m.recordRTC.getInternalRecorder())}catch(P){_(P)}})},this.reset=function(){return new Promise(function(C,_){try{C(m.recordRTC.reset())}catch(P){_(P)}})},this.destroy=function(){return new Promise(function(C,_){try{C(m.recordRTC.destroy())}catch(P){_(P)}})},this.getState=function(){return new Promise(function(C,_){try{C(m.recordRTC.getState())}catch(P){_(P)}})},this.blob=null,this.version="5.6.2"}typeof t<"u"&&(t.RecordRTCPromisesHandler=g);/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */function b(v,d){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),d=d||{},d.width=d.width||640,d.height=d.height||480,d.frameRate=d.frameRate||30,d.bitrate=d.bitrate||1200,d.realtime=d.realtime||!0;var m;function C(){return new ReadableStream({start:function(Q){var F=document.createElement("canvas"),j=document.createElement("video"),$=!0;j.srcObject=v,j.muted=!0,j.height=d.height,j.width=d.width,j.volume=0,j.onplaying=function(){F.width=d.width,F.height=d.height;var q=F.getContext("2d"),V=1e3/d.frameRate,de=setInterval(function(){if(m&&(clearInterval(de),Q.close()),$&&($=!1,d.onVideoProcessStarted&&d.onVideoProcessStarted()),q.drawImage(j,0,0),Q._controlledReadableStream.state!=="closed")try{Q.enqueue(q.getImageData(0,0,d.width,d.height))}catch{}},V)},j.play()}})}var _;function P(Q,F){if(!d.workerPath&&!F){m=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function($){$.arrayBuffer().then(function(q){P(Q,q)})});return}if(!d.workerPath&&F instanceof ArrayBuffer){var j=new Blob([F],{type:"text/javascript"});d.workerPath=c.createObjectURL(j)}d.workerPath||console.error("workerPath parameter is missing."),_=new Worker(d.workerPath),_.postMessage(d.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),_.addEventListener("message",function($){$.data==="READY"?(_.postMessage({width:d.width,height:d.height,bitrate:d.bitrate||1200,timebaseDen:d.frameRate||30,realtime:d.realtime}),C().pipeTo(new WritableStream({write:function(q){if(m){console.error("Got image, but recorder is finished!");return}_.postMessage(q.data.buffer,[q.data.buffer])}}))):$.data&&(L||N.push($.data))})}this.record=function(){N=[],L=!1,this.blob=null,P(v),typeof d.initCallback=="function"&&d.initCallback()};var L;this.pause=function(){L=!0},this.resume=function(){L=!1};function w(Q){if(!_){Q&&Q();return}_.addEventListener("message",function(F){F.data===null&&(_.terminate(),_=null,Q&&Q())}),_.postMessage(null)}var N=[];this.stop=function(Q){m=!0;var F=this;w(function(){F.blob=new Blob(N,{type:"video/webm"}),Q(F.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){N=[],L=!1,this.blob=null},this.blob=null}typeof t<"u"&&(t.WebAssemblyRecorder=b)})(Lg);var Dg=Lg.exports;const lE=js(Dg),Mg="meet.jit.si";var uE=function(e,t,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):n(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const cE=(e,t,i)=>uE(void 0,void 0,void 0,function*(){return new Promise((r,n)=>{if(window.JitsiMeetExternalAPI)return r(window.JitsiMeetExternalAPI);const s=document.createElement("script"),o=t?`?release=${t}`:"",a=i?`${i}/`:"";s.async=!0,s.src=`https://${e}/${a}external_api.js${o}`,s.onload=()=>r(window.JitsiMeetExternalAPI),s.onerror=()=>n(new Error(`Script load error: ${s.src}`)),document.head.appendChild(s)})});let Ro;const dE=(e=Mg,t,i)=>Ro||(Ro=cE(e,t,i),Ro),hE=e=>{const t=e.split("/");if(!(t.length<=1))return t[0]};let pE=0;const Dp=e=>`${e}-${pE++}`,fE=({domain:e=Mg,roomName:t,configOverwrite:i,interfaceConfigOverwrite:r,jwt:n,invitees:s,devices:o,userInfo:a,release:l,lang:u,spinner:c,onApiReady:h,onReadyToClose:p,getIFrameRef:S})=>{const[k,E]=Re.useState(!0),[O,I]=Re.useState(!1),R=Re.useRef(),A=Re.useRef(),M=Re.useRef(null),W=Re.useMemo(()=>Dp("jitsiMeeting"),[Dp]);Re.useEffect(()=>{dE(e,l,hE(t)).then(ee=>{R.current=ee,I(!0)}).catch(ee=>console.error(ee.message))},[]);const Z=Re.useCallback(ee=>{A.current=new ee(e,{roomName:t,configOverwrite:i,interfaceConfigOverwrite:r,jwt:n,invitees:s,devices:o,userInfo:a,release:l,lang:u,parentNode:M.current}),E(!1),A.current&&(typeof h=="function"&&h(A.current),A.current.on("readyToClose",()=>{typeof p=="function"&&p()}),M.current&&typeof S=="function"&&S(M.current))},[A,M,h,p,S,e,t,i,r,n,s,o,a,l,u]);Re.useEffect(()=>{O&&!A.current&&R.current&&Z(R.current)},[O,Z]);const X=Re.useCallback(()=>!c||!k||A.current?null:rt.jsx(c,{},void 0),[c,A.current]);return rt.jsxs(rt.Fragment,{children:[X(),rt.jsx("div",{id:W,ref:M},W)]},void 0)},vE=({roomName:e})=>rt.jsx(fE,{domain:"plvc-dev-back.theblackswan.in",roomName:e,configOverwrite:{startWithAudioMuted:!1,disableModeratorIndicator:!1,startScreenSharing:!0,enableEmailInStats:!1,prejoinPageEnabled:!1,disableTileView:!1},interfaceConfigOverwrite:{APP_NAME:"Rohan Meet",DISABLE_JOIN_LEAVE_NOTIFICATIONS:!0},userInfo:{displayName:"Rohan Gupta",email:"rohan.gupta@zopper.com"},onApiReady:t=>{},getIFrameRef:t=>{t.style.height="800px"}}),mE=()=>{const[e,t]=Re.useState(null),i=Re.useRef(null),[r,n]=Re.useState(null),s=Re.useRef(null),o=async()=>{var u;try{console.log("first");const c=await navigator.mediaDevices.getDisplayMedia({video:{width:1920,height:1080,frameRate:30},audio:{echoCancellation:!0,noiseSuppression:!0}}),h=await navigator.mediaDevices.getUserMedia({audio:!0}),p=c.clone();p.addTrack(h.getAudioTracks()[0]),p&&t(p),i.current=new lE(p,{type:"video",ondataavailable:S=>{console.log({blob:S})}}),(u=i.current)==null||u.startRecording()}catch(c){console.log({e:c})}},a=()=>{i.current.stopRecording(()=>{n(i.current.getBlob())})},l=()=>{r&&Dg.invokeSaveAsDialog(r)};return Re.useEffect(()=>{s.current&&(s.current.srcObject=e)},[e,s]),rt.jsxs(rt.Fragment,{children:[rt.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"white",padding:"1rem"},children:[rt.jsx("img",{alt:"logo",src:"https://www.zopperinsurance.com/static/media/zopper_logo.7ee8cda1738ac3b8afe07952361c6f72.svg"}),rt.jsxs("div",{children:[rt.jsx("button",{onClick:o,children:"Start Recording"}),rt.jsx("button",{onClick:a,children:"Stop Recording"}),rt.jsx("button",{onClick:l,children:"Save Recording"})]})]}),rt.jsx("div",{style:{height:"85vh",width:"100%"},children:rt.jsx(vE,{roomName:"RohanGuptaRoom"})}),r&&rt.jsx("video",{src:URL.createObjectURL(r),controls:!0,autoPlay:!0,ref:s,style:{width:"700px",margin:"1em"}})]})};Fl.createRoot(document.getElementById("root")).render(rt.jsx(Ul.StrictMode,{children:rt.jsx(aE,{children:rt.jsx(mE,{})})}));
